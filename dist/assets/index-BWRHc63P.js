var h_=Object.defineProperty;var o=(i,e)=>h_(i,"name",{value:e,configurable:!0});import{b as v_,_ as u,g as m_,a as S,K as Ft,L as Ot,l as W,D as Dt,E as V,H as mt,T as bt,C,M as E,d as ci,e as Fn,c as k_,f as S_,s as se,h as Et,i as Zo,j as Xo,V as Be,k as F,m as e_,n as t_,I as qe,o as r_,p as Te,A as R_,q as K_,r as gi,t as I_,u as C_,U as Cs,v as kt,S as Os,w as Es,x as zn,y as Ms,z as T,B as U,F as Mt,G as Y,J as ft,N as x,O as O_}from"./index-Bqzq3z01.js";var Un=[139,1];function Bs(i){var e,t=new Uint8Array(Un.length+i.length+1);t.set(Un,0),t.set(i,Un.length);for(var r=0,s=0;s<t.length-1;++s)r^=t[s];t[t.length-1]=r;var _=v_.encode(t);return(e=_.match(/.{1,4}/g))===null||e===void 0?void 0:e.join(" ")}o(Bs,"encodeRecoveryKey");var E_=256;function n_(i,e,t){return ui.apply(this,arguments)}o(n_,"deriveRecoveryKeyFromPassphrase");function ui(){return ui=u(function*(i,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:E_;if(!globalThis.crypto.subtle||!TextEncoder)throw new Error("Password-based backup is not available on this platform");var s=yield globalThis.crypto.subtle.importKey("raw",new TextEncoder().encode(i),{name:"PBKDF2"},!1,["deriveBits"]),_=yield globalThis.crypto.subtle.deriveBits({name:"PBKDF2",salt:new TextEncoder().encode(e),iterations:t,hash:"SHA-512"},s,r);return new Uint8Array(_)}),ui.apply(this,arguments)}o(ui,"_deriveRecoveryKeyFromPassphrase");let n;function $i(i){n=i}o($i,"__wbg_set_wasm");let d=0,St=null;function ye(){return(St===null||St.byteLength===0)&&(St=new Uint8Array(n.memory.buffer)),St}o(ye,"getUint8ArrayMemory0");const M_=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let Bt=new M_("utf-8");const B_=typeof Bt.encodeInto=="function"?function(i,e){return Bt.encodeInto(i,e)}:function(i,e){const t=Bt.encode(i);return e.set(t),{read:i.length,written:t.length}};function w(i,e,t){if(t===void 0){const c=Bt.encode(i),g=e(c.length,1)>>>0;return ye().subarray(g,g+c.length).set(c),d=c.length,g}let r=i.length,s=e(r,1)>>>0;const _=ye();let a=0;for(;a<r;a++){const c=i.charCodeAt(a);if(c>127)break;_[s+a]=c}if(a!==r){a!==0&&(i=i.slice(a)),s=t(s,r,r=a+i.length*3,1)>>>0;const c=ye().subarray(s+a,s+r),g=B_(i,c);a+=g.written,s=t(s,r,a,1)>>>0}return d=a,s}o(w,"passStringToWasm0");let ge=null;function B(){return(ge===null||ge.buffer.detached===!0||ge.buffer.detached===void 0&&ge.buffer!==n.memory.buffer)&&(ge=new DataView(n.memory.buffer)),ge}o(B,"getDataViewMemory0");function M(i){const e=n.__externref_table_alloc();return n.__wbindgen_export_4.set(e,i),e}o(M,"addToExternrefTable0");function R(i,e){try{return i.apply(this,e)}catch(t){const r=M(t);n.__wbindgen_exn_store(r)}}o(R,"handleError");const q_=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let i_=new q_("utf-8",{ignoreBOM:!0,fatal:!0});i_.decode();function b(i,e){return i=i>>>0,i_.decode(ye().subarray(i,i+e))}o(b,"getStringFromWasm0");function v(i){return i==null}o(v,"isLikeNone");function L(i,e){return i=i>>>0,ye().subarray(i/1,i/1+e)}o(L,"getArrayU8FromWasm0");const zt=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>{n.__wbindgen_export_6.get(i.dtor)(i.a,i.b)});function Qi(i,e,t,r){const s={a:i,b:e,cnt:1,dtor:t},_=o((...a)=>{s.cnt++;const c=s.a;s.a=0;try{return r(c,s.b,...a)}finally{--s.cnt===0?(n.__wbindgen_export_6.get(s.dtor)(c,s.b),zt.unregister(s)):s.a=c}},"real");return _.original=s,zt.register(_,s,s),_}o(Qi,"makeMutClosure");function s_(i,e,t,r){const s={a:i,b:e,cnt:1,dtor:t},_=o((...a)=>{s.cnt++;try{return r(s.a,s.b,...a)}finally{--s.cnt===0&&(n.__wbindgen_export_6.get(s.dtor)(s.a,s.b),s.a=0,zt.unregister(s))}},"real");return _.original=s,zt.register(_,s,s),_}o(s_,"makeClosure");function di(i){const e=typeof i;if(e=="number"||e=="boolean"||i==null)return`${i}`;if(e=="string")return`"${i}"`;if(e=="symbol"){const s=i.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){const s=i.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(i)){const s=i.length;let _="[";s>0&&(_+=di(i[0]));for(let a=1;a<s;a++)_+=", "+di(i[a]);return _+="]",_}const t=/\[object ([^\]]+)\]/.exec(toString.call(i));let r;if(t&&t.length>1)r=t[1];else return toString.call(i);if(r=="Object")try{return"Object("+JSON.stringify(i)+")"}catch{return"Object"}return i instanceof Error?`${i.name}: ${i.message}
${i.stack}`:r}o(di,"debugString");function G(i,e){const t=e(i.length*1,1)>>>0;return ye().set(i,t/1),d=i.length,t}o(G,"passArray8ToWasm0");function l(i){const e=n.__wbindgen_export_4.get(i);return n.__externref_table_dealloc(i),e}o(l,"takeFromExternrefTable0");function f(i,e){if(!(i instanceof e))throw new Error(`expected instance of ${e.name}`)}o(f,"_assertClass");function z(i,e){const t=e(i.length*4,4)>>>0;for(let r=0;r<i.length;r++){const s=M(i[r]);B().setUint32(t+4*r,s,!0)}return d=i.length,t}o(z,"passArrayJsValueToWasm0");function Ne(i,e){i=i>>>0;const t=B(),r=[];for(let s=i;s<i+4*e;s+=4)r.push(n.__wbindgen_export_4.get(t.getUint32(s,!0)));return n.__externref_drop_slice(i,e),r}o(Ne,"getArrayJsValueFromWasm0");let Rt=null;function F_(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Uint16Array(n.memory.buffer)),Rt}o(F_,"getUint16ArrayMemory0");function D_(i,e){return i=i>>>0,F_().subarray(i/2,i/2+e)}o(D_,"getArrayU16FromWasm0");function o_(){const i=n.getVersions();return lr.__wrap(i)}o(o_,"getVersions");function z_(){n.start()}o(z_,"start");function U_(i,e,t){const r=n.closure38_externref_shim_multivalue_shim(i,e,t);if(r[1])throw l(r[0])}o(U_,"__wbg_adapter_62");function T_(i,e){n._dyn_core__ops__function__FnMut_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h9a610c366a7f0d0a(i,e)}o(T_,"__wbg_adapter_65");function V_(i,e,t){n.closure751_externref_shim(i,e,t)}o(V_,"__wbg_adapter_68");function j_(i,e,t){n.closure434_externref_shim(i,e,t)}o(j_,"__wbg_adapter_71");function x_(i,e){n._dyn_core__ops__function__Fn_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__ha55834deaaca03e1(i,e)}o(x_,"__wbg_adapter_74");function P_(i,e,t,r){n.closure450_externref_shim(i,e,t,r)}o(P_,"__wbg_adapter_832");const Z=Object.freeze({MissingRoomKey:0,0:"MissingRoomKey",UnknownMessageIndex:1,1:"UnknownMessageIndex",MismatchedIdentityKeys:2,2:"MismatchedIdentityKeys",UnknownSenderDevice:3,3:"UnknownSenderDevice",UnsignedSenderDevice:4,4:"UnsignedSenderDevice",SenderIdentityVerificationViolation:5,5:"SenderIdentityVerificationViolation",UnableToDecrypt:6,6:"UnableToDecrypt",MismatchedSender:7,7:"MismatchedSender"}),A_=Object.freeze({Ed25519:0,0:"Ed25519",Curve25519:1,1:"Curve25519",Unknown:3,3:"Unknown"}),N_=Object.freeze({Curve25519:0,0:"Curve25519",Ed25519:1,1:"Ed25519",Unknown:2,2:"Unknown"}),be=Object.freeze({OlmV1Curve25519AesSha2:0,0:"OlmV1Curve25519AesSha2",MegolmV1AesSha2:1,1:"MegolmV1AesSha2",Unknown:2,2:"Unknown"}),Fe=Object.freeze({Invited:0,0:"Invited",Joined:1,1:"Joined",Shared:2,2:"Shared",WorldReadable:3,3:"WorldReadable"}),li=Object.freeze({Verified:0,0:"Verified",BlackListed:1,1:"BlackListed",Ignored:2,2:"Ignored",Unset:3,3:"Unset"}),L_=Object.freeze({Trace:0,0:"Trace",Debug:1,1:"Debug",Info:2,2:"Info",Warn:3,3:"Warn",Error:4,4:"Error"}),De=Object.freeze({Decrypted:0,0:"Decrypted",UnableToDecrypt:1,1:"UnableToDecrypt",PlainText:2,2:"PlainText",Invalid:3,3:"Invalid"}),W_=Object.freeze({Login:0,0:"Login",Reciprocate:1,1:"Reciprocate"}),re=Object.freeze({Created:0,0:"Created",Scanned:1,1:"Scanned",Confirmed:2,2:"Confirmed",Reciprocated:3,3:"Reciprocated",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),G_=Object.freeze({KeysUpload:0,0:"KeysUpload",KeysQuery:1,1:"KeysQuery",KeysClaim:2,2:"KeysClaim",ToDevice:3,3:"ToDevice",SignatureUpload:4,4:"SignatureUpload",RoomMessage:5,5:"RoomMessage",KeysBackup:6,6:"KeysBackup"}),pi=Object.freeze({Red:0,0:"Red",Grey:1,1:"Grey",None:2,2:"None"}),X=Object.freeze({AuthenticityNotGuaranteed:0,0:"AuthenticityNotGuaranteed",UnknownDevice:1,1:"UnknownDevice",UnsignedDevice:2,2:"UnsignedDevice",UnverifiedIdentity:3,3:"UnverifiedIdentity",SentInClear:4,4:"SentInClear",VerificationViolation:5,5:"VerificationViolation",MismatchedSender:6,6:"MismatchedSender"}),J_=Object.freeze({Missing:0,0:"Missing",Invalid:1,1:"Invalid",ValidButNotTrusted:2,2:"ValidButNotTrusted",ValidAndTrusted:3,3:"ValidAndTrusted"}),wi=Object.freeze({Untrusted:0,0:"Untrusted",CrossSignedOrLegacy:1,1:"CrossSignedOrLegacy",CrossSigned:2,2:"CrossSigned"}),ze=Object.freeze({SasV1:0,0:"SasV1",QrCodeScanV1:1,1:"QrCodeScanV1",QrCodeShowV1:2,2:"QrCodeShowV1",ReciprocateV1:3,3:"ReciprocateV1"}),ee=Object.freeze({Created:0,0:"Created",Requested:1,1:"Requested",Ready:2,2:"Ready",Transitioned:3,3:"Transitioned",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),H_=["pending","done"],__=["readonly","readwrite","versionchange","readwriteflush","cleanup"],$_=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_attachment_free(i>>>0,1)),Zi=class Zi{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$_.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_attachment_free(e,0)}static encrypt(e){const t=G(e,n.__wbindgen_malloc),r=d,s=n.attachment_encrypt(t,r);if(s[2])throw l(s[1]);return ke.__wrap(s[0])}static decrypt(e){f(e,ke);const t=n.attachment_decrypt(e.__wbg_ptr);if(t[3])throw l(t[2]);var r=L(t[0],t[1]).slice();return n.__wbindgen_free(t[0],t[1]*1,1),r}};o(Zi,"Attachment");let yi=Zi;const qs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_backupdecryptionkey_free(i>>>0,1)),ue=class ue{static __wrap(e){e=e>>>0;const t=Object.create(ue.prototype);return t.__wbg_ptr=e,qs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,qs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupdecryptionkey_free(e,0)}static createRandomKey(){const e=n.backupdecryptionkey_createRandomKey();return ue.__wrap(e)}static fromBase64(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.backupdecryptionkey_fromBase64(t,r);if(s[2])throw l(s[1]);return ue.__wrap(s[0])}toBase64(){return n.backupdecryptionkey_toBase64(this.__wbg_ptr)}get megolmV1PublicKey(){const e=n.backupdecryptionkey_megolmV1PublicKey(this.__wbg_ptr);return Xt.__wrap(e)}decryptV1(e,t,r){let s,_;try{const g=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),p=d,y=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),m=d,k=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),I=d,D=n.backupdecryptionkey_decryptV1(this.__wbg_ptr,g,p,y,m,k,I);var a=D[0],c=D[1];if(D[3])throw a=0,c=0,l(D[2]);return s=a,_=c,b(a,c)}finally{n.__wbindgen_free(s,_,1)}}};o(ue,"BackupDecryptionKey");let j=ue;const Fs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_backupkeys_free(i>>>0,1)),fr=class fr{static __wrap(e){e=e>>>0;const t=Object.create(fr.prototype);return t.__wbg_ptr=e,Fs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupkeys_free(e,0)}get decryptionKey(){const e=n.__wbg_get_backupkeys_decryptionKey(this.__wbg_ptr);return e===0?void 0:j.__wrap(e)}set decryptionKey(e){let t=0;v(e)||(f(e,j),t=e.__destroy_into_raw()),n.__wbg_set_backupkeys_decryptionKey(this.__wbg_ptr,t)}get backupVersion(){const e=n.__wbg_get_backupkeys_backupVersion(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set backupVersion(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupkeys_backupVersion(this.__wbg_ptr,t,r)}get decryptionKeyBase64(){return n.backupkeys_decryptionKeyBase64(this.__wbg_ptr)}};o(fr,"BackupKeys");let Ut=fr;const Ds=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_backupsecretsbundle_free(i>>>0,1)),hr=class hr{static __wrap(e){e=e>>>0;const t=Object.create(hr.prototype);return t.__wbg_ptr=e,Ds.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ds.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupsecretsbundle_free(e,0)}get key(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_key(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set key(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backup_version(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_backup_version(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set backup_version(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}};o(hr,"BackupSecretsBundle");let Tt=hr;const Tn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_base64encodedpkmessage_free(i>>>0,1)),vr=class vr{static __wrap(e){e=e>>>0;const t=Object.create(vr.prototype);return t.__wbg_ptr=e,Tn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_base64encodedpkmessage_free(e,0)}get ciphertext(){let e,t;try{const r=n.__wbg_get_base64encodedpkmessage_ciphertext(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set ciphertext(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get mac(){let e,t;try{const r=n.__wbg_get_base64encodedpkmessage_mac(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set mac(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get ephemeralKey(){let e,t;try{const r=n.__wbg_get_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set ephemeralKey(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr,t,r)}constructor(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),p=d,y=n.base64encodedpkmessage_new(s,_,a,c,g,p);return this.__wbg_ptr=y>>>0,Tn.register(this,this.__wbg_ptr,this),this}};o(vr,"Base64EncodedPkMessage");let Le=vr;const zs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_basemigrationdata_free(i>>>0,1)),Xi=class Xi{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,zs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_basemigrationdata_free(e,0)}get userId(){const e=n.__wbg_get_basemigrationdata_userId(this.__wbg_ptr);return e===0?void 0:h.__wrap(e)}set userId(e){let t=0;v(e)||(f(e,h),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_userId(this.__wbg_ptr,t)}get deviceId(){const e=n.__wbg_get_basemigrationdata_deviceId(this.__wbg_ptr);return e===0?void 0:O.__wrap(e)}set deviceId(e){let t=0;v(e)||(f(e,O),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_deviceId(this.__wbg_ptr,t)}get pickledAccount(){let e,t;try{const r=n.__wbg_get_basemigrationdata_pickledAccount(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickledAccount(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backupVersion(){const e=n.__wbg_get_basemigrationdata_backupVersion(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set backupVersion(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}get backupRecoveryKey(){const e=n.__wbg_get_basemigrationdata_backupRecoveryKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set backupRecoveryKey(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get privateCrossSigningMasterKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set privateCrossSigningMasterKey(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr,t,r)}get privateCrossSigningSelfSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set privateCrossSigningSelfSigningKey(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr,t,r)}get privateCrossSigningUserSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set privateCrossSigningUserSigningKey(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr,t,r)}constructor(){const e=n.basemigrationdata_new();return this.__wbg_ptr=e>>>0,zs.register(this,this.__wbg_ptr,this),this}};o(Xi,"BaseMigrationData");let We=Xi;const Us=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_cancelinfo_free(i>>>0,1)),mr=class mr{static __wrap(e){e=e>>>0;const t=Object.create(mr.prototype);return t.__wbg_ptr=e,Us.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Us.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_cancelinfo_free(e,0)}reason(){return n.cancelinfo_reason(this.__wbg_ptr)}cancelCode(){let e,t;try{const r=n.cancelinfo_cancelCode(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}cancelledbyUs(){return n.cancelinfo_cancelledbyUs(this.__wbg_ptr)!==0}};o(mr,"CancelInfo");let fe=mr;const Ts=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_checkcode_free(i>>>0,1)),kr=class kr{static __wrap(e){e=e>>>0;const t=Object.create(kr.prototype);return t.__wbg_ptr=e,Ts.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ts.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_checkcode_free(e,0)}as_bytes(){const e=n.checkcode_as_bytes(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}to_digit(){return n.checkcode_to_digit(this.__wbg_ptr)}};o(kr,"CheckCode");let Vt=kr;const Vs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_collectstrategy_free(i>>>0,1)),N=class N{static __wrap(e){e=e>>>0;const t=Object.create(N.prototype);return t.__wbg_ptr=e,Vs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_collectstrategy_free(e,0)}eq(e){return f(e,N),n.collectstrategy_eq(this.__wbg_ptr,e.__wbg_ptr)!==0}static deviceBasedStrategy(e,t){const r=n.collectstrategy_deviceBasedStrategy(e,t);return N.__wrap(r)}static allDevices(){const e=n.collectstrategy_allDevices();return N.__wrap(e)}static errorOnUnverifiedUserProblem(){const e=n.collectstrategy_errorOnUnverifiedUserProblem();return N.__wrap(e)}static identityBasedStrategy(){const e=n.collectstrategy_identityBasedStrategy();return N.__wrap(e)}static onlyTrustedDevices(){const e=n.collectstrategy_onlyTrustedDevices();return N.__wrap(e)}};o(N,"CollectStrategy");let J=N;const js=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_crosssigningbootstraprequests_free(i>>>0,1)),Sr=class Sr{static __wrap(e){e=e>>>0;const t=Object.create(Sr.prototype);return t.__wbg_ptr=e,js.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,js.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningbootstraprequests_free(e,0)}get uploadKeysRequest(){return n.__wbg_get_crosssigningbootstraprequests_uploadKeysRequest(this.__wbg_ptr)}get uploadSigningKeysRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSigningKeysRequest(this.__wbg_ptr);return yt.__wrap(e)}get uploadSignaturesRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSignaturesRequest(this.__wbg_ptr);return Oe.__wrap(e)}};o(Sr,"CrossSigningBootstrapRequests");let jt=Sr;const xs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_crosssigningkeyexport_free(i>>>0,1)),Rr=class Rr{static __wrap(e){e=e>>>0;const t=Object.create(Rr.prototype);return t.__wbg_ptr=e,xs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningkeyexport_free(e,0)}get masterKey(){const e=n.crosssigningkeyexport_masterKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get self_signing_key(){const e=n.crosssigningkeyexport_self_signing_key(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get userSigningKey(){const e=n.crosssigningkeyexport_userSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}};o(Rr,"CrossSigningKeyExport");let xt=Rr;const Ps=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_crosssigningstatus_free(i>>>0,1)),Kr=class Kr{static __wrap(e){e=e>>>0;const t=Object.create(Kr.prototype);return t.__wbg_ptr=e,Ps.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ps.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningstatus_free(e,0)}get hasMaster(){return n.crosssigningstatus_hasMaster(this.__wbg_ptr)!==0}get hasSelfSigning(){return n.crosssigningstatus_hasSelfSigning(this.__wbg_ptr)!==0}get hasUserSigning(){return n.crosssigningstatus_hasUserSigning(this.__wbg_ptr)!==0}};o(Kr,"CrossSigningStatus");let Pt=Kr;const Vn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_curve25519publickey_free(i>>>0,1)),Ir=class Ir{static __wrap(e){e=e>>>0;const t=Object.create(Ir.prototype);return t.__wbg_ptr=e,Vn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_curve25519publickey_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.curve25519publickey_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,Vn.register(this,this.__wbg_ptr,this),this}get length(){return n.curve25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=n.curve25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Ir,"Curve25519PublicKey");let q=Ir;const As=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_curve25519secretkey_free(i>>>0,1)),ie=class ie{static __wrap(e){e=e>>>0;const t=Object.create(ie.prototype);return t.__wbg_ptr=e,As.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,As.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_curve25519secretkey_free(e,0)}static new(){const e=n.curve25519secretkey_new();return ie.__wrap(e)}static fromBase64(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.curve25519secretkey_fromBase64(t,r);if(s[2])throw l(s[1]);return ie.__wrap(s[0])}toBase64(){let e,t;try{const r=n.curve25519secretkey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}toUint8Array(){const e=n.curve25519secretkey_toUint8Array(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}static fromUint8Array(e){const t=G(e,n.__wbindgen_malloc),r=d,s=n.curve25519secretkey_fromUint8Array(t,r);if(s[2])throw l(s[1]);return ie.__wrap(s[0])}};o(ie,"Curve25519SecretKey");let Ge=ie;const Ns=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_decryptedroomevent_free(i>>>0,1)),Cr=class Cr{static __wrap(e){e=e>>>0;const t=Object.create(Cr.prototype);return t.__wbg_ptr=e,Ns.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ns.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptedroomevent_free(e,0)}get event(){return n.__wbg_get_decryptedroomevent_event(this.__wbg_ptr)}get sender(){const e=n.decryptedroomevent_sender(this.__wbg_ptr);return h.__wrap(e)}get senderDevice(){const e=n.decryptedroomevent_senderDevice(this.__wbg_ptr);return e===0?void 0:O.__wrap(e)}get senderCurve25519Key(){let e,t;try{const r=n.decryptedroomevent_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get senderClaimedEd25519Key(){return n.decryptedroomevent_senderClaimedEd25519Key(this.__wbg_ptr)}get forwardingCurve25519KeyChain(){return n.decryptedroomevent_forwardingCurve25519KeyChain(this.__wbg_ptr)}shieldState(e){const t=n.decryptedroomevent_shieldState(this.__wbg_ptr,e);return dt.__wrap(t)}};o(Cr,"DecryptedRoomEvent");let At=Cr;const Ls=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_decryptedtodeviceevent_free(i>>>0,1)),Or=class Or{static __wrap(e){e=e>>>0;const t=Object.create(Or.prototype);return t.__wbg_ptr=e,Ls.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ls.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptedtodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_decryptedtodeviceevent_rawEvent(this.__wbg_ptr)}get encryptionInfo(){const e=n.__wbg_get_decryptedtodeviceevent_encryptionInfo(this.__wbg_ptr);return gr.__wrap(e)}get type(){return n.decryptedtodeviceevent_type(this.__wbg_ptr)}};o(Or,"DecryptedToDeviceEvent");let Nt=Or;const Ws=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_decryptionsettings_free(i>>>0,1)),es=class es{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ws.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptionsettings_free(e,0)}get sender_device_trust_requirement(){return n.__wbg_get_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr)}set sender_device_trust_requirement(e){n.__wbg_set_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr,e)}constructor(e){const t=n.decryptionsettings_new(e);return this.__wbg_ptr=t>>>0,Ws.register(this,this.__wbg_ptr,this),this}};o(es,"DecryptionSettings");let Je=es;const Gs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_dehydrateddevice_free(i>>>0,1)),Er=class Er{static __wrap(e){e=e>>>0;const t=Object.create(Er.prototype);return t.__wbg_ptr=e,Gs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevice_free(e,0)}keysForUpload(e,t){return f(t,H),n.dehydrateddevice_keysForUpload(this.__wbg_ptr,e,t.__wbg_ptr)}};o(Er,"DehydratedDevice");let Lt=Er;const Js=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_dehydrateddevicekey_free(i>>>0,1)),de=class de{static __wrap(e){e=e>>>0;const t=Object.create(de.prototype);return t.__wbg_ptr=e,Js.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Js.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevicekey_free(e,0)}static createRandomKey(){const e=n.dehydrateddevicekey_createRandomKey();if(e[2])throw l(e[1]);return de.__wrap(e[0])}static createKeyFromArray(e){const t=n.dehydrateddevicekey_createKeyFromArray(e);if(t[2])throw l(t[1]);return de.__wrap(t[0])}toBase64(){return n.dehydrateddevicekey_toBase64(this.__wbg_ptr)}};o(de,"DehydratedDeviceKey");let H=de;const Hs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_dehydrateddevices_free(i>>>0,1)),Mr=class Mr{static __wrap(e){e=e>>>0;const t=Object.create(Mr.prototype);return t.__wbg_ptr=e,Hs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Hs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevices_free(e,0)}create(){return n.dehydrateddevices_create(this.__wbg_ptr)}rehydrate(e,t,r){f(e,H),f(t,O);const s=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;return n.dehydrateddevices_rehydrate(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,s,_)}getDehydratedDeviceKey(){return n.dehydrateddevices_getDehydratedDeviceKey(this.__wbg_ptr)}saveDehydratedDeviceKey(e){return f(e,H),n.dehydrateddevices_saveDehydratedDeviceKey(this.__wbg_ptr,e.__wbg_ptr)}deleteDehydratedDeviceKey(){return n.dehydrateddevices_deleteDehydratedDeviceKey(this.__wbg_ptr)}};o(Mr,"DehydratedDevices");let Wt=Mr;const $s=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_device_free(i>>>0,1)),Br=class Br{static __wrap(e){e=e>>>0;const t=Object.create(Br.prototype);return t.__wbg_ptr=e,$s.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$s.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_device_free(e,0)}requestVerification(e){var t=v(e)?0:z(e,n.__wbindgen_malloc),r=d;const s=n.device_requestVerification(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return l(s[0])}encryptToDeviceEvent(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;return n.device_encryptToDeviceEvent(this.__wbg_ptr,r,s,t)}isVerified(){return n.device_isVerified(this.__wbg_ptr)!==0}isCrossSigningTrusted(){return n.device_isCrossSigningTrusted(this.__wbg_ptr)!==0}isCrossSignedByOwner(){return n.device_isCrossSignedByOwner(this.__wbg_ptr)!==0}setLocalTrust(e){return n.device_setLocalTrust(this.__wbg_ptr,e)}get userId(){const e=n.device_userId(this.__wbg_ptr);return h.__wrap(e)}get deviceId(){const e=n.device_deviceId(this.__wbg_ptr);return O.__wrap(e)}get displayName(){const e=n.device_displayName(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}getKey(e){const t=n.device_getKey(this.__wbg_ptr,e);if(t[2])throw l(t[1]);return t[0]===0?void 0:$e.__wrap(t[0])}get curve25519Key(){const e=n.device_curve25519Key(this.__wbg_ptr);return e===0?void 0:q.__wrap(e)}get ed25519Key(){const e=n.device_ed25519Key(this.__wbg_ptr);return e===0?void 0:oe.__wrap(e)}get keys(){return n.device_keys(this.__wbg_ptr)}get algorithms(){return n.device_algorithms(this.__wbg_ptr)}get signatures(){const e=n.device_signatures(this.__wbg_ptr);return lt.__wrap(e)}get localTrustState(){return n.device_localTrustState(this.__wbg_ptr)}isLocallyTrusted(){return n.device_isLocallyTrusted(this.__wbg_ptr)!==0}isBlacklisted(){return n.device_isBlacklisted(this.__wbg_ptr)!==0}isDeleted(){return n.device_isDeleted(this.__wbg_ptr)!==0}firstTimeSeen(){const e=n.device_firstTimeSeen(this.__wbg_ptr);return BigInt.asUintN(64,e)}verify(){return n.device_verify(this.__wbg_ptr)}get isDehydrated(){return n.device_isDehydrated(this.__wbg_ptr)!==0}};o(Br,"Device");let He=Br;const jn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_deviceid_free(i>>>0,1)),qr=class qr{static __wrap(e){e=e>>>0;const t=Object.create(qr.prototype);return t.__wbg_ptr=e,jn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_deviceid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.deviceid_new(t,r);return this.__wbg_ptr=s>>>0,jn.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.deviceid_toString(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(qr,"DeviceId");let O=qr;const Qs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicekey_free(i>>>0,1)),Fr=class Fr{static __wrap(e){e=e>>>0;const t=Object.create(Fr.prototype);return t.__wbg_ptr=e,Qs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekey_free(e,0)}get name(){return n.devicekey_name(this.__wbg_ptr)}get curve25519(){const e=n.devicekey_curve25519(this.__wbg_ptr);return e===0?void 0:q.__wrap(e)}get ed25519(){const e=n.devicekey_ed25519(this.__wbg_ptr);return e===0?void 0:oe.__wrap(e)}get unknown(){const e=n.devicekey_unknown(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}toBase64(){let e,t;try{const r=n.devicekey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Fr,"DeviceKey");let $e=Fr;const Ys=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicekeyalgorithm_free(i>>>0,1)),Dr=class Dr{static __wrap(e){e=e>>>0;const t=Object.create(Dr.prototype);return t.__wbg_ptr=e,Ys.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ys.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyalgorithm_free(e,0)}get name(){return n.devicekeyalgorithm_name(this.__wbg_ptr)}toString(){let e,t;try{const r=n.devicekeyalgorithm_toString(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Dr,"DeviceKeyAlgorithm");let Gt=Dr;const xn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicekeyid_free(i>>>0,1)),zr=class zr{static __wrap(e){e=e>>>0;const t=Object.create(zr.prototype);return t.__wbg_ptr=e,xn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.devicekeyid_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,xn.register(this,this.__wbg_ptr,this),this}get algorithm(){const e=n.devicekeyid_algorithm(this.__wbg_ptr);return Gt.__wrap(e)}get deviceId(){const e=n.devicekeyid_deviceId(this.__wbg_ptr);return O.__wrap(e)}toString(){let e,t;try{const r=n.devicekeyid_toString(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(zr,"DeviceKeyId");let he=zr;const Zs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicelists_free(i>>>0,1)),ts=class ts{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicelists_free(e,0)}constructor(e,t){var r=v(e)?0:z(e,n.__wbindgen_malloc),s=d,_=v(t)?0:z(t,n.__wbindgen_malloc),a=d;const c=n.devicelists_new(r,s,_,a);if(c[2])throw l(c[1]);return this.__wbg_ptr=c[0]>>>0,Zs.register(this,this.__wbg_ptr,this),this}isEmpty(){return n.devicelists_isEmpty(this.__wbg_ptr)!==0}get changed(){const e=n.devicelists_changed(this.__wbg_ptr);var t=Ne(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*4,4),t}get left(){const e=n.devicelists_left(this.__wbg_ptr);var t=Ne(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*4,4),t}};o(ts,"DeviceLists");let ve=ts;const Xs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ecies_free(i>>>0,1)),rs=class rs{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ecies_free(e,0)}constructor(){const e=n.ecies_new();return this.__wbg_ptr=e>>>0,Xs.register(this,this.__wbg_ptr,this),this}public_key(){const e=n.ecies_public_key(this.__wbg_ptr);return q.__wrap(e)}establish_inbound_channel(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.ecies_establish_inbound_channel(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return Qt.__wrap(s[0])}establish_outbound_channel(e,t){f(e,q);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.ecies_establish_outbound_channel(this.__wbg_ptr,e.__wbg_ptr,r,s);if(_[2])throw l(_[1]);return er.__wrap(_[0])}};o(rs,"Ecies");let bi=rs;const eo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ed25519publickey_free(i>>>0,1)),Ur=class Ur{static __wrap(e){e=e>>>0;const t=Object.create(Ur.prototype);return t.__wbg_ptr=e,eo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,eo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519publickey_free(e,0)}get length(){return n.ed25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=n.ed25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Ur,"Ed25519PublicKey");let oe=Ur;const Pn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ed25519signature_free(i>>>0,1)),Tr=class Tr{static __wrap(e){e=e>>>0;const t=Object.create(Tr.prototype);return t.__wbg_ptr=e,Pn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519signature_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.ed25519signature_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,Pn.register(this,this.__wbg_ptr,this),this}toBase64(){let e,t;try{const r=n.ed25519signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Tr,"Ed25519Signature");let me=Tr;const to=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_emoji_free(i>>>0,1)),Vr=class Vr{static __wrap(e){e=e>>>0;const t=Object.create(Vr.prototype);return t.__wbg_ptr=e,to.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,to.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_emoji_free(e,0)}get symbol(){return n.emoji_symbol(this.__wbg_ptr)}get description(){return n.emoji_description(this.__wbg_ptr)}};o(Vr,"Emoji");let Jt=Vr;const An=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_encryptedattachment_free(i>>>0,1)),jr=class jr{static __wrap(e){e=e>>>0;const t=Object.create(jr.prototype);return t.__wbg_ptr=e,An.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,An.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptedattachment_free(e,0)}constructor(e,t){const r=G(e,n.__wbindgen_malloc),s=d,_=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d,c=n.encryptedattachment_new(r,s,_,a);if(c[2])throw l(c[1]);return this.__wbg_ptr=c[0]>>>0,An.register(this,this.__wbg_ptr,this),this}get encryptedData(){const e=n.encryptedattachment_encryptedData(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}get mediaEncryptionInfo(){const e=n.encryptedattachment_mediaEncryptionInfo(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get hasMediaEncryptionInfoBeenConsumed(){return n.encryptedattachment_hasMediaEncryptionInfoBeenConsumed(this.__wbg_ptr)!==0}};o(jr,"EncryptedAttachment");let ke=jr;const ro=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_encryptioninfo_free(i>>>0,1)),xr=class xr{static __wrap(e){e=e>>>0;const t=Object.create(xr.prototype);return t.__wbg_ptr=e,ro.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ro.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptioninfo_free(e,0)}get sender(){const e=n.__wbg_get_encryptioninfo_sender(this.__wbg_ptr);return h.__wrap(e)}set sender(e){f(e,h);var t=e.__destroy_into_raw();n.__wbg_set_encryptioninfo_sender(this.__wbg_ptr,t)}get senderDevice(){const e=n.__wbg_get_encryptioninfo_senderDevice(this.__wbg_ptr);return e===0?void 0:O.__wrap(e)}set senderDevice(e){let t=0;v(e)||(f(e,O),t=e.__destroy_into_raw()),n.__wbg_set_encryptioninfo_senderDevice(this.__wbg_ptr,t)}get senderCurve25519Key(){let e,t;try{const r=n.__wbg_get_encryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderCurve25519Key(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderClaimedEd25519Key(){const e=n.__wbg_get_encryptioninfo_senderClaimedEd25519Key(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set senderClaimedEd25519Key(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}shieldState(e){const t=n.encryptioninfo_shieldState(this.__wbg_ptr,e);return dt.__wrap(t)}};o(xr,"EncryptionInfo");let Ht=xr;const no=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_encryptionsettings_free(i>>>0,1)),ns=class ns{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,no.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptionsettings_free(e,0)}get algorithm(){return n.__wbg_get_encryptionsettings_algorithm(this.__wbg_ptr)}set algorithm(e){n.__wbg_set_encryptionsettings_algorithm(this.__wbg_ptr,e)}get rotationPeriod(){const e=n.__wbg_get_encryptionsettings_rotationPeriod(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriod(e){n.__wbg_set_encryptionsettings_rotationPeriod(this.__wbg_ptr,e)}get rotationPeriodMessages(){const e=n.__wbg_get_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriodMessages(e){n.__wbg_set_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr,e)}get historyVisibility(){return n.__wbg_get_encryptionsettings_historyVisibility(this.__wbg_ptr)}set historyVisibility(e){n.__wbg_set_encryptionsettings_historyVisibility(this.__wbg_ptr,e)}get sharingStrategy(){const e=n.__wbg_get_encryptionsettings_sharingStrategy(this.__wbg_ptr);return J.__wrap(e)}set sharingStrategy(e){f(e,J);var t=e.__destroy_into_raw();n.__wbg_set_encryptionsettings_sharingStrategy(this.__wbg_ptr,t)}constructor(){const e=n.encryptionsettings_new();return this.__wbg_ptr=e>>>0,no.register(this,this.__wbg_ptr,this),this}};o(ns,"EncryptionSettings");let Qe=ns;const io=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_establishedecies_free(i>>>0,1)),Pr=class Pr{static __wrap(e){e=e>>>0;const t=Object.create(Pr.prototype);return t.__wbg_ptr=e,io.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,io.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_establishedecies_free(e,0)}public_key(){const e=n.establishedecies_public_key(this.__wbg_ptr);return q.__wrap(e)}encrypt(e){let t,r;try{const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=n.establishedecies_encrypt(this.__wbg_ptr,s,_);return t=a[0],r=a[1],b(a[0],a[1])}finally{n.__wbindgen_free(t,r,1)}}decrypt(e){let t,r;try{const a=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=n.establishedecies_decrypt(this.__wbg_ptr,a,c);var s=g[0],_=g[1];if(g[3])throw s=0,_=0,l(g[2]);return t=s,r=_,b(s,_)}finally{n.__wbindgen_free(t,r,1)}}check_code(){const e=n.establishedecies_check_code(this.__wbg_ptr);return Vt.__wrap(e)}};o(Pr,"EstablishedEcies");let _e=Pr;const so=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_eventid_free(i>>>0,1)),is=class is{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,so.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_eventid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.eventid_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,so.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.eventid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.eventid_serverName(this.__wbg_ptr);return e===0?void 0:ut.__wrap(e)}toString(){let e,t;try{const r=n.eventid_toString(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(is,"EventId");let Ye=is;const oo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_identitykeys_free(i>>>0,1)),Ar=class Ar{static __wrap(e){e=e>>>0;const t=Object.create(Ar.prototype);return t.__wbg_ptr=e,oo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_identitykeys_free(e,0)}get ed25519(){const e=n.__wbg_get_identitykeys_ed25519(this.__wbg_ptr);return oe.__wrap(e)}set ed25519(e){f(e,oe);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_ed25519(this.__wbg_ptr,t)}get curve25519(){const e=n.__wbg_get_identitykeys_curve25519(this.__wbg_ptr);return q.__wrap(e)}set curve25519(e){f(e,q);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_curve25519(this.__wbg_ptr,t)}};o(Ar,"IdentityKeys");let $t=Ar;const _o=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_inboundcreationresult_free(i>>>0,1)),Nr=class Nr{static __wrap(e){e=e>>>0;const t=Object.create(Nr.prototype);return t.__wbg_ptr=e,_o.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_o.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return _e.__wrap(e)}set channel(e){f(e,_e);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get message(){let e,t;try{const r=n.__wbg_get_inboundcreationresult_message(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set message(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}};o(Nr,"InboundCreationResult");let Qt=Nr;const ao=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_inboundgroupsession_free(i>>>0,1)),Lr=class Lr{static __wrap(e){e=e>>>0;const t=Object.create(Lr.prototype);return t.__wbg_ptr=e,ao.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ao.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundgroupsession_free(e,0)}get roomId(){const e=n.inboundgroupsession_roomId(this.__wbg_ptr);return K.__wrap(e)}get senderKey(){const e=n.inboundgroupsession_senderKey(this.__wbg_ptr);return q.__wrap(e)}get sessionId(){let e,t;try{const r=n.inboundgroupsession_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}hasBeenImported(){return n.inboundgroupsession_hasBeenImported(this.__wbg_ptr)!==0}};o(Lr,"InboundGroupSession");let Yt=Lr;const co=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_invalidtodeviceevent_free(i>>>0,1)),Wr=class Wr{static __wrap(e){e=e>>>0;const t=Object.create(Wr.prototype);return t.__wbg_ptr=e,co.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,co.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_invalidtodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_invalidtodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return n.invalidtodeviceevent_type(this.__wbg_ptr)}};o(Wr,"InvalidToDeviceEvent");let Zt=Wr;const Nn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysbackuprequest_free(i>>>0,1)),Gr=class Gr{static __wrap(e){e=e>>>0;const t=Object.create(Gr.prototype);return t.__wbg_ptr=e,Nn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Nn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysbackuprequest_free(e,0)}get id(){return n.__wbg_get_keysbackuprequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysbackuprequest_body(this.__wbg_ptr)}get version(){return n.__wbg_get_keysbackuprequest_version(this.__wbg_ptr)}constructor(e,t,r){const s=n.keysbackuprequest_new(e,t,r);return this.__wbg_ptr=s>>>0,Nn.register(this,this.__wbg_ptr,this),this}get type(){return n.keysbackuprequest_type(this.__wbg_ptr)}};o(Gr,"KeysBackupRequest");let Ze=Gr;const Ln=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysclaimrequest_free(i>>>0,1)),Jr=class Jr{static __wrap(e){e=e>>>0;const t=Object.create(Jr.prototype);return t.__wbg_ptr=e,Ln.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ln.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysclaimrequest_free(e,0)}get id(){return n.__wbg_get_keysclaimrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysclaimrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysclaimrequest_new(e,t);return this.__wbg_ptr=r>>>0,Ln.register(this,this.__wbg_ptr,this),this}get type(){return n.keysclaimrequest_type(this.__wbg_ptr)}};o(Jr,"KeysClaimRequest");let Xe=Jr;const Wn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysqueryrequest_free(i>>>0,1)),Hr=class Hr{static __wrap(e){e=e>>>0;const t=Object.create(Hr.prototype);return t.__wbg_ptr=e,Wn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysqueryrequest_free(e,0)}get id(){return n.__wbg_get_keysqueryrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysqueryrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysqueryrequest_new(e,t);return this.__wbg_ptr=r>>>0,Wn.register(this,this.__wbg_ptr,this),this}get type(){return n.keysqueryrequest_type(this.__wbg_ptr)}};o(Hr,"KeysQueryRequest");let Se=Hr;const Gn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysuploadrequest_free(i>>>0,1)),$r=class $r{static __wrap(e){e=e>>>0;const t=Object.create($r.prototype);return t.__wbg_ptr=e,Gn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysuploadrequest_free(e,0)}get id(){return n.__wbg_get_keysuploadrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Gn.register(this,this.__wbg_ptr,this),this}get type(){return n.keysuploadrequest_type(this.__wbg_ptr)}};o($r,"KeysUploadRequest");let et=$r;const go=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_maybesignature_free(i>>>0,1)),Qr=class Qr{static __wrap(e){e=e>>>0;const t=Object.create(Qr.prototype);return t.__wbg_ptr=e,go.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,go.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_maybesignature_free(e,0)}isValid(){return n.maybesignature_isValid(this.__wbg_ptr)!==0}isInvalid(){return n.maybesignature_isInvalid(this.__wbg_ptr)!==0}get signature(){const e=n.maybesignature_signature(this.__wbg_ptr);return e===0?void 0:ar.__wrap(e)}get invalidSignatureSource(){const e=n.maybesignature_invalidSignatureSource(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}};o(Qr,"MaybeSignature");let tt=Qr;const uo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_megolmdecryptionerror_free(i>>>0,1)),Yr=class Yr{static __wrap(e){e=e>>>0;const t=Object.create(Yr.prototype);return t.__wbg_ptr=e,uo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,uo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmdecryptionerror_free(e,0)}get code(){return n.__wbg_get_megolmdecryptionerror_code(this.__wbg_ptr)}get description(){return n.__wbg_get_megolmdecryptionerror_description(this.__wbg_ptr)}get maybe_withheld(){return n.__wbg_get_megolmdecryptionerror_maybe_withheld(this.__wbg_ptr)}};o(Yr,"MegolmDecryptionError");let rt=Yr;const lo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_megolmv1backupkey_free(i>>>0,1)),Zr=class Zr{static __wrap(e){e=e>>>0;const t=Object.create(Zr.prototype);return t.__wbg_ptr=e,lo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmv1backupkey_free(e,0)}get publicKeyBase64(){return n.megolmv1backupkey_publicKeyBase64(this.__wbg_ptr)}get algorithm(){return n.megolmv1backupkey_algorithm(this.__wbg_ptr)}};o(Zr,"MegolmV1BackupKey");let Xt=Zr;const Q_=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_migration_free(i>>>0,1)),ss=class ss{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Q_.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_migration_free(e,0)}static migrateBaseData(e,t,r,s){return f(e,We),f(r,A),n.migration_migrateBaseData(e.__wbg_ptr,t,r.__wbg_ptr,v(s)?0:M(s))}static migrateOlmSessions(e,t,r,s){const _=z(e,n.__wbindgen_malloc),a=d;f(r,A);const c=n.migration_migrateOlmSessions(_,a,t,r.__wbg_ptr,v(s)?0:M(s));if(c[2])throw l(c[1]);return l(c[0])}static migrateMegolmSessions(e,t,r,s){const _=z(e,n.__wbindgen_malloc),a=d;f(r,A);const c=n.migration_migrateMegolmSessions(_,a,t,r.__wbg_ptr,v(s)?0:M(s));if(c[2])throw l(c[1]);return l(c[0])}};o(ss,"Migration");let Re=ss;const Jn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_olmmachine_free(i>>>0,1)),Xr=class Xr{static __wrap(e){e=e>>>0;const t=Object.create(Xr.prototype);return t.__wbg_ptr=e,Jn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Jn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_olmmachine_free(e,0)}constructor(){const e=n.olmmachine_new();if(e[2])throw l(e[1]);return this.__wbg_ptr=e[0]>>>0,Jn.register(this,this.__wbg_ptr,this),this}static initialize(e,t,r,s,_){f(e,h),f(t,O);var a=v(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=v(s)?0:w(s,n.__wbindgen_malloc,n.__wbindgen_realloc),p=d;return n.olmmachine_initialize(e.__wbg_ptr,t.__wbg_ptr,a,c,g,p,v(_)?0:M(_))}static initFromStore(e,t,r,s){return f(e,h),f(t,O),f(r,A),n.olmmachine_initFromStore(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,v(s)?0:M(s))}get userId(){const e=n.olmmachine_userId(this.__wbg_ptr);return h.__wrap(e)}get deviceId(){const e=n.olmmachine_deviceId(this.__wbg_ptr);return O.__wrap(e)}get deviceCreationTimeMs(){return n.olmmachine_deviceCreationTimeMs(this.__wbg_ptr)}get identityKeys(){const e=n.olmmachine_identityKeys(this.__wbg_ptr);return $t.__wrap(e)}get displayName(){return n.olmmachine_displayName(this.__wbg_ptr)}get roomKeyRequestsEnabled(){return n.olmmachine_roomKeyRequestsEnabled(this.__wbg_ptr)!==0}set roomKeyRequestsEnabled(e){n.olmmachine_set_roomKeyRequestsEnabled(this.__wbg_ptr,e)}get roomKeyForwardingEnabled(){return n.olmmachine_roomKeyForwardingEnabled(this.__wbg_ptr)!==0}set roomKeyForwardingEnabled(e){n.olmmachine_set_roomKeyForwardingEnabled(this.__wbg_ptr,e)}trackedUsers(){const e=n.olmmachine_trackedUsers(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}updateTrackedUsers(e){const t=z(e,n.__wbindgen_malloc),r=d;return n.olmmachine_updateTrackedUsers(this.__wbg_ptr,t,r)}markAllTrackedUsersAsDirty(){return n.olmmachine_markAllTrackedUsersAsDirty(this.__wbg_ptr)}receiveSyncChanges(e,t,r,s){const _=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d;f(t,ve);const c=n.olmmachine_receiveSyncChanges(this.__wbg_ptr,_,a,t.__wbg_ptr,r,v(s)?0:M(s));if(c[2])throw l(c[1]);return l(c[0])}outgoingRequests(){return n.olmmachine_outgoingRequests(this.__wbg_ptr)}markRequestAsSent(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=n.olmmachine_markRequestAsSent(this.__wbg_ptr,s,_,t,a,c);if(g[2])throw l(g[1]);return l(g[0])}encryptRoomEvent(e,t,r){f(e,K);const s=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=n.olmmachine_encryptRoomEvent(this.__wbg_ptr,e.__wbg_ptr,s,_,a,c);if(g[2])throw l(g[1]);return l(g[0])}decryptRoomEvent(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;f(t,K),f(r,Je);const a=n.olmmachine_decryptRoomEvent(this.__wbg_ptr,s,_,t.__wbg_ptr,r.__wbg_ptr);if(a[2])throw l(a[1]);return l(a[0])}getRoomEventEncryptionInfo(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;f(t,K);const _=n.olmmachine_getRoomEventEncryptionInfo(this.__wbg_ptr,r,s,t.__wbg_ptr);if(_[2])throw l(_[1]);return l(_[0])}crossSigningStatus(){return n.olmmachine_crossSigningStatus(this.__wbg_ptr)}exportSecretsBundle(){return n.olmmachine_exportSecretsBundle(this.__wbg_ptr)}importSecretsBundle(e){f(e,Ce);var t=e.__destroy_into_raw();return n.olmmachine_importSecretsBundle(this.__wbg_ptr,t)}exportCrossSigningKeys(){return n.olmmachine_exportCrossSigningKeys(this.__wbg_ptr)}importCrossSigningKeys(e,t,r){var s=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=v(t)?0:w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=v(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),p=d;return n.olmmachine_importCrossSigningKeys(this.__wbg_ptr,s,_,a,c,g,p)}bootstrapCrossSigning(e){return n.olmmachine_bootstrapCrossSigning(this.__wbg_ptr,e)}getIdentity(e){return f(e,h),n.olmmachine_getIdentity(this.__wbg_ptr,e.__wbg_ptr)}sign(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.olmmachine_sign(this.__wbg_ptr,t,r)}invalidateGroupSession(e){return f(e,K),n.olmmachine_invalidateGroupSession(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKey(e,t,r){f(e,K);const s=z(t,n.__wbindgen_malloc),_=d;return f(r,Qe),n.olmmachine_shareRoomKey(this.__wbg_ptr,e.__wbg_ptr,s,_,r.__wbg_ptr)}queryKeysForUsers(e){const t=z(e,n.__wbindgen_malloc),r=d,s=n.olmmachine_queryKeysForUsers(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return Se.__wrap(s[0])}getMissingSessions(e){const t=z(e,n.__wbindgen_malloc),r=d;return n.olmmachine_getMissingSessions(this.__wbg_ptr,t,r)}getUserDevices(e,t){return f(e,h),n.olmmachine_getUserDevices(this.__wbg_ptr,e.__wbg_ptr,!v(t),v(t)?0:t)}getDevice(e,t,r){return f(e,h),f(t,O),n.olmmachine_getDevice(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,!v(r),v(r)?0:r)}getVerification(e,t){f(e,h);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_getVerification(this.__wbg_ptr,e.__wbg_ptr,r,s);if(_[2])throw l(_[1]);return l(_[0])}getVerificationRequest(e,t){f(e,h);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_getVerificationRequest(this.__wbg_ptr,e.__wbg_ptr,r,s);return _===0?void 0:Ee.__wrap(_)}getVerificationRequests(e){return f(e,h),n.olmmachine_getVerificationRequests(this.__wbg_ptr,e.__wbg_ptr)}receiveVerificationEvent(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;f(t,K);const _=n.olmmachine_receiveVerificationEvent(this.__wbg_ptr,r,s,t.__wbg_ptr);if(_[2])throw l(_[1]);return l(_[0])}exportRoomKeys(e){return n.olmmachine_exportRoomKeys(this.__wbg_ptr,e)}importRoomKeys(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_importRoomKeys(this.__wbg_ptr,r,s,t);if(_[2])throw l(_[1]);return l(_[0])}importExportedRoomKeys(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_importExportedRoomKeys(this.__wbg_ptr,r,s,t);if(_[2])throw l(_[1]);return l(_[0])}importBackedUpRoomKeys(e,t,r){const s=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=n.olmmachine_importBackedUpRoomKeys(this.__wbg_ptr,e,v(t)?0:M(t),s,_);if(a[2])throw l(a[1]);return l(a[0])}saveBackupDecryptionKey(e,t){f(e,j);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;return n.olmmachine_saveBackupDecryptionKey(this.__wbg_ptr,e.__wbg_ptr,r,s)}getBackupKeys(){return n.olmmachine_getBackupKeys(this.__wbg_ptr)}verifyBackup(e){const t=n.olmmachine_verifyBackup(this.__wbg_ptr,e);if(t[2])throw l(t[1]);return l(t[0])}enableBackupV1(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d,c=n.olmmachine_enableBackupV1(this.__wbg_ptr,r,s,_,a);if(c[2])throw l(c[1]);return l(c[0])}isBackupEnabled(){return n.olmmachine_isBackupEnabled(this.__wbg_ptr)}disableBackup(){return n.olmmachine_disableBackup(this.__wbg_ptr)}backupRoomKeys(){return n.olmmachine_backupRoomKeys(this.__wbg_ptr)}roomKeyCounts(){return n.olmmachine_roomKeyCounts(this.__wbg_ptr)}static encryptExportedRoomKeys(e,t,r){let s,_;try{const g=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),p=d,y=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),m=d,k=n.olmmachine_encryptExportedRoomKeys(g,p,y,m,r);var a=k[0],c=k[1];if(k[3])throw a=0,c=0,l(k[2]);return s=a,_=c,b(a,c)}finally{n.__wbindgen_free(s,_,1)}}static decryptExportedRoomKeys(e,t){let r,s;try{const c=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),g=d,p=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),y=d,m=n.olmmachine_decryptExportedRoomKeys(c,g,p,y);var _=m[0],a=m[1];if(m[3])throw _=0,a=0,l(m[2]);return r=_,s=a,b(_,a)}finally{n.__wbindgen_free(r,s,1)}}registerRoomKeyUpdatedCallback(e){n.olmmachine_registerRoomKeyUpdatedCallback(this.__wbg_ptr,e)}registerRoomKeysWithheldCallback(e){n.olmmachine_registerRoomKeysWithheldCallback(this.__wbg_ptr,e)}registerUserIdentityUpdatedCallback(e){n.olmmachine_registerUserIdentityUpdatedCallback(this.__wbg_ptr,e)}registerDevicesUpdatedCallback(e){n.olmmachine_registerDevicesUpdatedCallback(this.__wbg_ptr,e)}registerReceiveSecretCallback(e){n.olmmachine_registerReceiveSecretCallback(this.__wbg_ptr,e)}getSecretsFromInbox(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.olmmachine_getSecretsFromInbox(this.__wbg_ptr,t,r)}deleteSecretsFromInbox(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.olmmachine_deleteSecretsFromInbox(this.__wbg_ptr,t,r)}requestMissingSecretsIfNeeded(){return n.olmmachine_requestMissingSecretsIfNeeded(this.__wbg_ptr)}getRoomSettings(e){return f(e,K),n.olmmachine_getRoomSettings(this.__wbg_ptr,e.__wbg_ptr)}setRoomSettings(e,t){return f(e,K),f(t,ce),n.olmmachine_setRoomSettings(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}dehydratedDevices(){const e=n.olmmachine_dehydratedDevices(this.__wbg_ptr);return Wt.__wrap(e)}buildRoomKeyBundle(e){return f(e,K),n.olmmachine_buildRoomKeyBundle(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKeyBundleData(e,t,r,s,_){f(e,h),f(t,K);const a=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d;var g=v(s)?0:w(s,n.__wbindgen_malloc,n.__wbindgen_realloc),p=d;f(_,J);var y=_.__destroy_into_raw();const m=n.olmmachine_shareRoomKeyBundleData(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,a,c,g,p,y);if(m[2])throw l(m[1]);return l(m[0])}getReceivedRoomKeyBundleData(e,t){return f(e,K),f(t,h),n.olmmachine_getReceivedRoomKeyBundleData(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}receiveRoomKeyBundle(e,t){f(e,pt);const r=G(t,n.__wbindgen_malloc),s=d,_=n.olmmachine_receiveRoomKeyBundle(this.__wbg_ptr,e.__wbg_ptr,r,s);if(_[2])throw l(_[1]);return l(_[0])}close(){const e=this.__destroy_into_raw();n.olmmachine_close(e)}};o(Xr,"OlmMachine");let nt=Xr;const po=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_otheruseridentity_free(i>>>0,1)),en=class en{static __wrap(e){e=e>>>0;const t=Object.create(en.prototype);return t.__wbg_ptr=e,po.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,po.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_otheruseridentity_free(e,0)}isVerified(){return n.otheruseridentity_isVerified(this.__wbg_ptr)!==0}verify(){return n.otheruseridentity_verify(this.__wbg_ptr)}requestVerification(e,t,r){f(e,K),f(t,Ye);var s=v(r)?0:z(r,n.__wbindgen_malloc),_=d;const a=n.otheruseridentity_requestVerification(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,s,_);if(a[2])throw l(a[1]);return Ee.__wrap(a[0])}verificationRequestContent(e){let t,r;try{var s=v(e)?0:z(e,n.__wbindgen_malloc),_=d;const g=n.otheruseridentity_verificationRequestContent(this.__wbg_ptr,s,_);var a=g[0],c=g[1];if(g[3])throw a=0,c=0,l(g[2]);return t=a,r=c,b(a,c)}finally{n.__wbindgen_free(t,r,1)}}get masterKey(){let e,t;try{const _=n.otheruseridentity_masterKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,l(_[2]);return e=r,t=s,b(r,s)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const _=n.otheruseridentity_selfSigningKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,l(_[2]);return e=r,t=s,b(r,s)}finally{n.__wbindgen_free(e,t,1)}}pinCurrentMasterKey(){return n.otheruseridentity_pinCurrentMasterKey(this.__wbg_ptr)}identityNeedsUserApproval(){return n.otheruseridentity_identityNeedsUserApproval(this.__wbg_ptr)!==0}wasPreviouslyVerified(){return n.otheruseridentity_wasPreviouslyVerified(this.__wbg_ptr)!==0}withdrawVerification(){return n.otheruseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return n.otheruseridentity_hasVerificationViolation(this.__wbg_ptr)!==0}};o(en,"OtherUserIdentity");let it=en;const wo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_outboundcreationresult_free(i>>>0,1)),tn=class tn{static __wrap(e){e=e>>>0;const t=Object.create(tn.prototype);return t.__wbg_ptr=e,wo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_outboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return _e.__wrap(e)}set channel(e){f(e,_e);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get initial_message(){let e,t;try{const r=n.__wbg_get_outboundcreationresult_initial_message(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set initial_message(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}};o(tn,"OutboundCreationResult");let er=tn;const yo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ownuseridentity_free(i>>>0,1)),rn=class rn{static __wrap(e){e=e>>>0;const t=Object.create(rn.prototype);return t.__wbg_ptr=e,yo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ownuseridentity_free(e,0)}isVerified(){return n.ownuseridentity_isVerified(this.__wbg_ptr)!==0}verify(){return n.ownuseridentity_verify(this.__wbg_ptr)}requestVerification(e){var t=v(e)?0:z(e,n.__wbindgen_malloc),r=d;const s=n.ownuseridentity_requestVerification(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return l(s[0])}trustsOurOwnDevice(){return n.ownuseridentity_trustsOurOwnDevice(this.__wbg_ptr)}get masterKey(){let e,t;try{const _=n.ownuseridentity_masterKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,l(_[2]);return e=r,t=s,b(r,s)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const _=n.ownuseridentity_selfSigningKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,l(_[2]);return e=r,t=s,b(r,s)}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const _=n.ownuseridentity_userSigningKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,l(_[2]);return e=r,t=s,b(r,s)}finally{n.__wbindgen_free(e,t,1)}}wasPreviouslyVerified(){return n.ownuseridentity_wasPreviouslyVerified(this.__wbg_ptr)!==0}withdrawVerification(){return n.ownuseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return n.ownuseridentity_hasVerificationViolation(this.__wbg_ptr)!==0}};o(rn,"OwnUserIdentity");let st=rn;const bo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pickledinboundgroupsession_free(i>>>0,1)),nn=class nn{static __unwrap(e){return e instanceof nn?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledinboundgroupsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get senderSigningKey(){const e=n.__wbg_get_pickledinboundgroupsession_senderSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set senderSigningKey(e){var t=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get roomId(){const e=n.__wbg_get_pickledinboundgroupsession_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}set roomId(e){let t=0;v(e)||(f(e,K),t=e.__destroy_into_raw()),n.__wbg_set_pickledinboundgroupsession_roomId(this.__wbg_ptr,t)}get imported(){return n.__wbg_get_pickledinboundgroupsession_imported(this.__wbg_ptr)!==0}set imported(e){n.__wbg_set_pickledinboundgroupsession_imported(this.__wbg_ptr,e)}get backedUp(){return n.__wbg_get_pickledinboundgroupsession_backedUp(this.__wbg_ptr)!==0}set backedUp(e){n.__wbg_set_pickledinboundgroupsession_backedUp(this.__wbg_ptr,e)}constructor(){const e=n.pickledinboundgroupsession_new();return this.__wbg_ptr=e>>>0,bo.register(this,this.__wbg_ptr,this),this}};o(nn,"PickledInboundGroupSession");let ot=nn;const fo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pickledsession_free(i>>>0,1)),sn=class sn{static __unwrap(e){return e instanceof sn?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get createdUsingFallbackKey(){return n.__wbg_get_pickledsession_createdUsingFallbackKey(this.__wbg_ptr)!==0}set createdUsingFallbackKey(e){n.__wbg_set_pickledsession_createdUsingFallbackKey(this.__wbg_ptr,e)}get creationTime(){return n.__wbg_get_pickledsession_creationTime(this.__wbg_ptr)}set creationTime(e){n.__wbg_set_pickledsession_creationTime(this.__wbg_ptr,e)}get lastUseTime(){return n.__wbg_get_pickledsession_lastUseTime(this.__wbg_ptr)}set lastUseTime(e){n.__wbg_set_pickledsession_lastUseTime(this.__wbg_ptr,e)}constructor(){const e=n.pickledsession_new();return this.__wbg_ptr=e>>>0,fo.register(this,this.__wbg_ptr,this),this}};o(sn,"PickledSession");let _t=sn;const Hn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pkdecryption_free(i>>>0,1)),Ve=class Ve{static __wrap(e){e=e>>>0;const t=Object.create(Ve.prototype);return t.__wbg_ptr=e,Hn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Hn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pkdecryption_free(e,0)}constructor(){const e=n.pkdecryption_new();return this.__wbg_ptr=e>>>0,Hn.register(this,this.__wbg_ptr,this),this}static fromKey(e){f(e,Ge);const t=n.pkdecryption_fromKey(e.__wbg_ptr);return Ve.__wrap(t)}secretKey(){const e=n.pkdecryption_secretKey(this.__wbg_ptr);return Ge.__wrap(e)}publicKey(){const e=n.pkdecryption_publicKey(this.__wbg_ptr);return q.__wrap(e)}decryptString(e){let t,r;try{f(e,ae);const a=n.pkdecryption_decryptString(this.__wbg_ptr,e.__wbg_ptr);var s=a[0],_=a[1];if(a[3])throw s=0,_=0,l(a[2]);return t=s,r=_,b(s,_)}finally{n.__wbindgen_free(t,r,1)}}decrypt(e){f(e,ae);const t=n.pkdecryption_decrypt(this.__wbg_ptr,e.__wbg_ptr);if(t[3])throw l(t[2]);var r=L(t[0],t[1]).slice();return n.__wbindgen_free(t[0],t[1]*1,1),r}};o(Ve,"PkDecryption");let fi=Ve;const ho=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pkencryption_free(i>>>0,1)),je=class je{static __wrap(e){e=e>>>0;const t=Object.create(je.prototype);return t.__wbg_ptr=e,ho.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ho.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pkencryption_free(e,0)}static fromKey(e){f(e,q);const t=n.pkencryption_fromKey(e.__wbg_ptr);return je.__wrap(t)}encrypt(e){const t=G(e,n.__wbindgen_malloc),r=d,s=n.pkencryption_encrypt(this.__wbg_ptr,t,r);return ae.__wrap(s)}encryptString(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.pkencryption_encrypt(this.__wbg_ptr,t,r);return ae.__wrap(s)}};o(je,"PkEncryption");let hi=je;const vo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pkmessage_free(i>>>0,1)),le=class le{static __wrap(e){e=e>>>0;const t=Object.create(le.prototype);return t.__wbg_ptr=e,vo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pkmessage_free(e,0)}ciphertext(){const e=n.pkmessage_ciphertext(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}mac(){const e=n.pkmessage_mac(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}ephemeralKey(){const e=n.pkmessage_ephemeralKey(this.__wbg_ptr);return q.__wrap(e)}static fromParts(e,t,r){const s=G(e,n.__wbindgen_malloc),_=d,a=G(t,n.__wbindgen_malloc),c=d;f(r,q);const g=n.pkmessage_fromParts(s,_,a,c,r.__wbg_ptr);return le.__wrap(g)}static fromBase64(e){f(e,Le);const t=n.pkmessage_fromBase64(e.__wbg_ptr);if(t[2])throw l(t[1]);return le.__wrap(t[0])}toBase64(){const e=n.pkmessage_toBase64(this.__wbg_ptr);return Le.__wrap(e)}};o(le,"PkMessage");let ae=le;const mo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_plaintexttodeviceevent_free(i>>>0,1)),on=class on{static __wrap(e){e=e>>>0;const t=Object.create(on.prototype);return t.__wbg_ptr=e,mo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_plaintexttodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_plaintexttodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return n.plaintexttodeviceevent_type(this.__wbg_ptr)}};o(on,"PlainTextToDeviceEvent");let tr=on;const $n=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_putdehydrateddevicerequest_free(i>>>0,1)),_n=class _n{static __wrap(e){e=e>>>0;const t=Object.create(_n.prototype);return t.__wbg_ptr=e,$n.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$n.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_putdehydrateddevicerequest_free(e,0)}get body(){return n.__wbg_get_putdehydrateddevicerequest_body(this.__wbg_ptr)}constructor(e){const t=n.putdehydrateddevicerequest_new(e);return this.__wbg_ptr=t>>>0,$n.register(this,this.__wbg_ptr,this),this}};o(_n,"PutDehydratedDeviceRequest");let at=_n;const ko=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qr_free(i>>>0,1)),an=class an{static __wrap(e){e=e>>>0;const t=Object.create(an.prototype);return t.__wbg_ptr=e,ko.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ko.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qr_free(e,0)}state(){return n.qr_state(this.__wbg_ptr)}hasBeenScanned(){return n.qr_hasBeenScanned(this.__wbg_ptr)!==0}hasBeenConfirmed(){return n.qr_hasBeenConfirmed(this.__wbg_ptr)!==0}get userId(){const e=n.qr_userId(this.__wbg_ptr);return h.__wrap(e)}get otherUserId(){const e=n.qr_otherUserId(this.__wbg_ptr);return h.__wrap(e)}get otherDeviceId(){const e=n.qr_otherDeviceId(this.__wbg_ptr);return O.__wrap(e)}weStarted(){return n.qr_weStarted(this.__wbg_ptr)!==0}cancelInfo(){const e=n.qr_cancelInfo(this.__wbg_ptr);return e===0?void 0:fe.__wrap(e)}isDone(){return n.qr_isDone(this.__wbg_ptr)!==0}isCancelled(){return n.qr_isCancelled(this.__wbg_ptr)!==0}isSelfVerification(){return n.qr_isSelfVerification(this.__wbg_ptr)!==0}reciprocated(){return n.qr_reciprocated(this.__wbg_ptr)!==0}get flowId(){let e,t;try{const r=n.qr_flowId(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.qr_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}toQrCode(){const e=n.qr_toQrCode(this.__wbg_ptr);if(e[2])throw l(e[1]);return rr.__wrap(e[0])}toBytes(){const e=n.qr_toBytes(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}reciprocate(){const e=n.qr_reciprocate(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}confirmScanning(){const e=n.qr_confirmScanning(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}cancel(){const e=n.qr_cancel(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}cancelWithCode(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.qr_cancelWithCode(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return l(s[0])}registerChangesCallback(e){n.qr_registerChangesCallback(this.__wbg_ptr,e)}};o(an,"Qr");let Ke=an;const So=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qrcode_free(i>>>0,1)),cn=class cn{static __wrap(e){e=e>>>0;const t=Object.create(cn.prototype);return t.__wbg_ptr=e,So.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,So.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcode_free(e,0)}renderIntoBuffer(){const e=n.qrcode_renderIntoBuffer(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}};o(cn,"QrCode");let rr=cn;const Qn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qrcodedata_free(i>>>0,1)),pe=class pe{static __wrap(e){e=e>>>0;const t=Object.create(pe.prototype);return t.__wbg_ptr=e,Qn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodedata_free(e,0)}constructor(e,t,r){f(e,q);var s=e.__destroy_into_raw();const _=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d;var c=v(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),g=d;const p=n.qrcodedata_new(s,_,a,c,g);if(p[2])throw l(p[1]);return this.__wbg_ptr=p[0]>>>0,Qn.register(this,this.__wbg_ptr,this),this}static fromBytes(e){const t=G(e,n.__wbindgen_malloc),r=d,s=n.qrcodedata_fromBytes(t,r);if(s[2])throw l(s[1]);return pe.__wrap(s[0])}toBytes(){const e=n.qrcodedata_toBytes(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}static fromBase64(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.qrcodedata_fromBase64(t,r);if(s[2])throw l(s[1]);return pe.__wrap(s[0])}toBase64(){let e,t;try{const r=n.qrcodedata_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get publicKey(){const e=n.qrcodedata_publicKey(this.__wbg_ptr);return q.__wrap(e)}get rendezvousUrl(){let e,t;try{const r=n.qrcodedata_rendezvousUrl(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.qrcodedata_serverName(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get mode(){return n.qrcodedata_mode(this.__wbg_ptr)}};o(pe,"QrCodeData");let vi=pe;const Ro=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qrcodescan_free(i>>>0,1)),xe=class xe{static __wrap(e){e=e>>>0;const t=Object.create(xe.prototype);return t.__wbg_ptr=e,Ro.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ro.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodescan_free(e,0)}static fromBytes(e){const t=n.qrcodescan_fromBytes(e);if(t[2])throw l(t[1]);return xe.__wrap(t[0])}};o(xe,"QrCodeScan");let ct=xe;const Ko=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_rehydrateddevice_free(i>>>0,1)),gn=class gn{static __wrap(e){e=e>>>0;const t=Object.create(gn.prototype);return t.__wbg_ptr=e,Ko.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ko.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_rehydrateddevice_free(e,0)}receiveEvents(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.rehydrateddevice_receiveEvents(this.__wbg_ptr,t,r)}};o(gn,"RehydratedDevice");let nr=gn;const Yn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomid_free(i>>>0,1)),Pe=class Pe{static __wrap(e){e=e>>>0;const t=Object.create(Pe.prototype);return t.__wbg_ptr=e,Yn.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof Pe?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Yn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.roomid_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,Yn.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.roomid_toString(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Pe,"RoomId");let K=Pe;const Io=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeycounts_free(i>>>0,1)),un=class un{static __wrap(e){e=e>>>0;const t=Object.create(un.prototype);return t.__wbg_ptr=e,Io.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Io.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeycounts_free(e,0)}get total(){return n.__wbg_get_roomkeycounts_total(this.__wbg_ptr)}set total(e){n.__wbg_set_roomkeycounts_total(this.__wbg_ptr,e)}get backedUp(){return n.__wbg_get_roomkeycounts_backedUp(this.__wbg_ptr)}set backedUp(e){n.__wbg_set_roomkeycounts_backedUp(this.__wbg_ptr,e)}};o(un,"RoomKeyCounts");let ir=un;const Co=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeyimportresult_free(i>>>0,1)),dn=class dn{static __wrap(e){e=e>>>0;const t=Object.create(dn.prototype);return t.__wbg_ptr=e,Co.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Co.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyimportresult_free(e,0)}get importedCount(){return n.__wbg_get_roomkeyimportresult_importedCount(this.__wbg_ptr)>>>0}get totalCount(){return n.__wbg_get_roomkeyimportresult_totalCount(this.__wbg_ptr)>>>0}keys(){return n.roomkeyimportresult_keys(this.__wbg_ptr)}};o(dn,"RoomKeyImportResult");let sr=dn;const Oo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeyinfo_free(i>>>0,1)),ln=class ln{static __wrap(e){e=e>>>0;const t=Object.create(ln.prototype);return t.__wbg_ptr=e,Oo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Oo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyinfo_free(e,0)}get algorithm(){return n.roomkeyinfo_algorithm(this.__wbg_ptr)}get roomId(){const e=n.roomkeyinfo_roomId(this.__wbg_ptr);return K.__wrap(e)}get senderKey(){const e=n.roomkeyinfo_senderKey(this.__wbg_ptr);return q.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeyinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(ln,"RoomKeyInfo");let or=ln;const Eo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeywithheldinfo_free(i>>>0,1)),pn=class pn{static __wrap(e){e=e>>>0;const t=Object.create(pn.prototype);return t.__wbg_ptr=e,Eo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Eo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeywithheldinfo_free(e,0)}get sender(){const e=n.roomkeywithheldinfo_sender(this.__wbg_ptr);return h.__wrap(e)}get algorithm(){return n.roomkeywithheldinfo_algorithm(this.__wbg_ptr)}get withheldCode(){let e,t;try{const r=n.roomkeywithheldinfo_withheldCode(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.roomkeywithheldinfo_roomId(this.__wbg_ptr);return K.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeywithheldinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(pn,"RoomKeyWithheldInfo");let _r=pn;const Zn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roommessagerequest_free(i>>>0,1)),wn=class wn{static __wrap(e){e=e>>>0;const t=Object.create(wn.prototype);return t.__wbg_ptr=e,Zn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roommessagerequest_free(e,0)}get id(){return n.__wbg_get_roommessagerequest_id(this.__wbg_ptr)}get room_id(){return n.__wbg_get_roommessagerequest_room_id(this.__wbg_ptr)}get txn_id(){return n.__wbg_get_roommessagerequest_txn_id(this.__wbg_ptr)}get event_type(){return n.__wbg_get_roommessagerequest_event_type(this.__wbg_ptr)}get body(){return n.__wbg_get_roommessagerequest_body(this.__wbg_ptr)}constructor(e,t,r,s,_){const a=n.roommessagerequest_new(e,t,r,s,_);return this.__wbg_ptr=a>>>0,Zn.register(this,this.__wbg_ptr,this),this}get type(){return n.roommessagerequest_type(this.__wbg_ptr)}};o(wn,"RoomMessageRequest");let gt=wn;const Xn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomsettings_free(i>>>0,1)),yn=class yn{static __wrap(e){e=e>>>0;const t=Object.create(yn.prototype);return t.__wbg_ptr=e,Xn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomsettings_free(e,0)}get algorithm(){return n.__wbg_get_roomsettings_algorithm(this.__wbg_ptr)}set algorithm(e){n.__wbg_set_roomsettings_algorithm(this.__wbg_ptr,e)}get onlyAllowTrustedDevices(){return n.__wbg_get_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr)!==0}set onlyAllowTrustedDevices(e){n.__wbg_set_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr,e)}get sessionRotationPeriodMs(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set sessionRotationPeriodMs(e){n.__wbg_set_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr,!v(e),v(e)?0:e)}get sessionRotationPeriodMessages(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set sessionRotationPeriodMessages(e){n.__wbg_set_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr,!v(e),v(e)?0:e)}constructor(){const e=n.roomsettings_new();return this.__wbg_ptr=e>>>0,Xn.register(this,this.__wbg_ptr,this),this}};o(yn,"RoomSettings");let ce=yn;const Mo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_sas_free(i>>>0,1)),bn=class bn{static __wrap(e){e=e>>>0;const t=Object.create(bn.prototype);return t.__wbg_ptr=e,Mo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Mo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_sas_free(e,0)}get userId(){const e=n.sas_userId(this.__wbg_ptr);return h.__wrap(e)}get deviceId(){const e=n.sas_deviceId(this.__wbg_ptr);return O.__wrap(e)}get otherUserId(){const e=n.sas_otherUserId(this.__wbg_ptr);return h.__wrap(e)}get otherDeviceId(){const e=n.sas_otherDeviceId(this.__wbg_ptr);return O.__wrap(e)}get flowId(){let e,t;try{const r=n.sas_flowId(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.sas_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}supportsEmoji(){return n.sas_supportsEmoji(this.__wbg_ptr)!==0}startedFromRequest(){return n.sas_startedFromRequest(this.__wbg_ptr)!==0}isSelfVerification(){return n.sas_isSelfVerification(this.__wbg_ptr)!==0}haveWeConfirmed(){return n.sas_haveWeConfirmed(this.__wbg_ptr)!==0}hasBeenAccepted(){return n.sas_hasBeenAccepted(this.__wbg_ptr)!==0}cancelInfo(){const e=n.sas_cancelInfo(this.__wbg_ptr);return e===0?void 0:fe.__wrap(e)}weStarted(){return n.sas_weStarted(this.__wbg_ptr)!==0}accept(){const e=n.sas_accept(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}confirm(){return n.sas_confirm(this.__wbg_ptr)}cancel(){const e=n.sas_cancel(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}cancelWithCode(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.sas_cancelWithCode(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return l(s[0])}timedOut(){return n.sas_timedOut(this.__wbg_ptr)!==0}canBePresented(){return n.sas_canBePresented(this.__wbg_ptr)!==0}isDone(){return n.sas_isDone(this.__wbg_ptr)!==0}isCancelled(){return n.sas_isCancelled(this.__wbg_ptr)!==0}emoji(){const e=n.sas_emoji(this.__wbg_ptr);let t;return e[0]!==0&&(t=Ne(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*4,4)),t}emojiIndex(){const e=n.sas_emojiIndex(this.__wbg_ptr);let t;return e[0]!==0&&(t=L(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}decimals(){const e=n.sas_decimals(this.__wbg_ptr);let t;return e[0]!==0&&(t=D_(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*2,2)),t}registerChangesCallback(e){n.sas_registerChangesCallback(this.__wbg_ptr,e)}};o(bn,"Sas");let Ie=bn;const Bo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_secretsbundle_free(i>>>0,1)),Ae=class Ae{static __wrap(e){e=e>>>0;const t=Object.create(Ae.prototype);return t.__wbg_ptr=e,Bo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Bo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_secretsbundle_free(e,0)}get masterKey(){let e,t;try{const r=n.secretsbundle_masterKey(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const r=n.secretsbundle_selfSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const r=n.secretsbundle_userSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get backupBundle(){const e=n.secretsbundle_backupBundle(this.__wbg_ptr);return e===0?void 0:Tt.__wrap(e)}to_json(){const e=n.secretsbundle_to_json(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}static from_json(e){const t=n.secretsbundle_from_json(e);if(t[2])throw l(t[1]);return Ae.__wrap(t[0])}};o(Ae,"SecretsBundle");let Ce=Ae;const ei=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_servername_free(i>>>0,1)),fn=class fn{static __wrap(e){e=e>>>0;const t=Object.create(fn.prototype);return t.__wbg_ptr=e,ei.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ei.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_servername_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.servername_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,ei.register(this,this.__wbg_ptr,this),this}get host(){let e,t;try{const r=n.servername_host(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get port(){const e=n.servername_port(this.__wbg_ptr);return e===16777215?void 0:e}isIpLiteral(){return n.servername_isIpLiteral(this.__wbg_ptr)!==0}};o(fn,"ServerName");let ut=fn;const qo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_shieldstate_free(i>>>0,1)),hn=class hn{static __wrap(e){e=e>>>0;const t=Object.create(hn.prototype);return t.__wbg_ptr=e,qo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,qo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_shieldstate_free(e,0)}get color(){return n.__wbg_get_shieldstate_color(this.__wbg_ptr)}set color(e){n.__wbg_set_shieldstate_color(this.__wbg_ptr,e)}get code(){const e=n.__wbg_get_shieldstate_code(this.__wbg_ptr);return e===7?void 0:e}set code(e){n.__wbg_set_shieldstate_code(this.__wbg_ptr,v(e)?7:e)}get message(){const e=n.shieldstate_message(this.__wbg_ptr);let t;return e[0]!==0&&(t=b(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}};o(hn,"ShieldState");let dt=hn;const Fo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signature_free(i>>>0,1)),vn=class vn{static __wrap(e){e=e>>>0;const t=Object.create(vn.prototype);return t.__wbg_ptr=e,Fo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signature_free(e,0)}get ed25519(){const e=n.signature_ed25519(this.__wbg_ptr);return e===0?void 0:me.__wrap(e)}toBase64(){let e,t;try{const r=n.signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(vn,"Signature");let ar=vn;const ti=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signatureuploadrequest_free(i>>>0,1)),mn=class mn{static __wrap(e){e=e>>>0;const t=Object.create(mn.prototype);return t.__wbg_ptr=e,ti.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ti.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureuploadrequest_free(e,0)}get id(){return n.__wbg_get_signatureuploadrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_signatureuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.signatureuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,ti.register(this,this.__wbg_ptr,this),this}get type(){return n.signatureuploadrequest_type(this.__wbg_ptr)}};o(mn,"SignatureUploadRequest");let Oe=mn;const Do=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signatureverification_free(i>>>0,1)),kn=class kn{static __wrap(e){e=e>>>0;const t=Object.create(kn.prototype);return t.__wbg_ptr=e,Do.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Do.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureverification_free(e,0)}get deviceState(){return n.signatureverification_deviceState(this.__wbg_ptr)}get userState(){return n.signatureverification_userState(this.__wbg_ptr)}trusted(){return n.signatureverification_trusted(this.__wbg_ptr)!==0}};o(kn,"SignatureVerification");let cr=kn;const ri=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signatures_free(i>>>0,1)),Sn=class Sn{static __wrap(e){e=e>>>0;const t=Object.create(Sn.prototype);return t.__wbg_ptr=e,ri.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ri.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatures_free(e,0)}constructor(){const e=n.signatures_new();return this.__wbg_ptr=e>>>0,ri.register(this,this.__wbg_ptr,this),this}addSignature(e,t,r){f(e,h),f(t,he),f(r,me);const s=n.signatures_addSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return s===0?void 0:tt.__wrap(s)}getSignature(e,t){f(e,h),f(t,he);const r=n.signatures_getSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return r===0?void 0:me.__wrap(r)}get(e){return f(e,h),n.signatures_get(this.__wbg_ptr,e.__wbg_ptr)}clear(){n.signatures_clear(this.__wbg_ptr)}isEmpty(){return n.signatures_isEmpty(this.__wbg_ptr)!==0}get count(){return n.signatures_count(this.__wbg_ptr)>>>0}asJSON(){const e=n.signatures_asJSON(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}};o(Sn,"Signatures");let lt=Sn;const zo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_storehandle_free(i>>>0,1)),Rn=class Rn{static __wrap(e){e=e>>>0;const t=Object.create(Rn.prototype);return t.__wbg_ptr=e,zo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,zo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_storehandle_free(e,0)}static open(e,t,r){var s=v(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=v(t)?0:w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d;return n.storehandle_open(s,_,a,c,v(r)?0:M(r))}static openWithKey(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=G(t,n.__wbindgen_malloc),c=d;return n.storehandle_openWithKey(s,_,a,c,v(r)?0:M(r))}};o(Rn,"StoreHandle");let A=Rn;const Uo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_storedroomkeybundledata_free(i>>>0,1)),Kn=class Kn{static __wrap(e){e=e>>>0;const t=Object.create(Kn.prototype);return t.__wbg_ptr=e,Uo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Uo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_storedroomkeybundledata_free(e,0)}get senderUser(){const e=n.__wbg_get_storedroomkeybundledata_senderUser(this.__wbg_ptr);return h.__wrap(e)}get roomId(){const e=n.__wbg_get_storedroomkeybundledata_roomId(this.__wbg_ptr);return K.__wrap(e)}get url(){let e,t;try{const r=n.__wbg_get_storedroomkeybundledata_url(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get encryptionInfo(){let e,t;try{const r=n.__wbg_get_storedroomkeybundledata_encryptionInfo(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Kn,"StoredRoomKeyBundleData");let pt=Kn;const To=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_todeviceencryptioninfo_free(i>>>0,1)),In=class In{static __wrap(e){e=e>>>0;const t=Object.create(In.prototype);return t.__wbg_ptr=e,To.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,To.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todeviceencryptioninfo_free(e,0)}get senderCurve25519Key(){let e,t;try{const r=n.__wbg_get_todeviceencryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderCurve25519Key(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get sender(){const e=n.__wbg_get_todeviceencryptioninfo_sender(this.__wbg_ptr);return h.__wrap(e)}set sender(e){f(e,h);var t=e.__destroy_into_raw();n.__wbg_set_todeviceencryptioninfo_sender(this.__wbg_ptr,t)}get senderDevice(){const e=n.__wbg_get_todeviceencryptioninfo_senderDevice(this.__wbg_ptr);return e===0?void 0:O.__wrap(e)}set senderDevice(e){let t=0;v(e)||(f(e,O),t=e.__destroy_into_raw()),n.__wbg_set_todeviceencryptioninfo_senderDevice(this.__wbg_ptr,t)}isSenderVerified(){return n.todeviceencryptioninfo_isSenderVerified(this.__wbg_ptr)!==0}};o(In,"ToDeviceEncryptionInfo");let gr=In;const ni=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_todevicerequest_free(i>>>0,1)),Cn=class Cn{static __wrap(e){e=e>>>0;const t=Object.create(Cn.prototype);return t.__wbg_ptr=e,ni.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ni.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todevicerequest_free(e,0)}get id(){return n.__wbg_get_todevicerequest_id(this.__wbg_ptr)}get event_type(){return n.__wbg_get_todevicerequest_event_type(this.__wbg_ptr)}get txn_id(){return n.__wbg_get_todevicerequest_txn_id(this.__wbg_ptr)}get body(){return n.__wbg_get_todevicerequest_body(this.__wbg_ptr)}constructor(e,t,r,s){const _=n.todevicerequest_new(e,t,r,s);return this.__wbg_ptr=_>>>0,ni.register(this,this.__wbg_ptr,this),this}get type(){return n.todevicerequest_type(this.__wbg_ptr)}};o(Cn,"ToDeviceRequest");let wt=Cn;const Vo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_tracing_free(i>>>0,1)),os=class os{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_tracing_free(e,0)}static isAvailable(){return n.tracing_isAvailable()!==0}constructor(e){const t=n.tracing_new(e);if(t[2])throw l(t[1]);return this.__wbg_ptr=t[0]>>>0,Vo.register(this,this.__wbg_ptr,this),this}set minLevel(e){const t=n.tracing_set_minLevel(this.__wbg_ptr,e);if(t[1])throw l(t[0])}turnOn(){const e=n.tracing_turnOn(this.__wbg_ptr);if(e[1])throw l(e[0])}turnOff(){const e=n.tracing_turnOff(this.__wbg_ptr);if(e[1])throw l(e[0])}};o(os,"Tracing");let mi=os;const jo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_utdtodeviceevent_free(i>>>0,1)),On=class On{static __wrap(e){e=e>>>0;const t=Object.create(On.prototype);return t.__wbg_ptr=e,jo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_utdtodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_utdtodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return n.utdtodeviceevent_type(this.__wbg_ptr)}};o(On,"UTDToDeviceEvent");let ur=On;const ii=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_uploadsigningkeysrequest_free(i>>>0,1)),En=class En{static __wrap(e){e=e>>>0;const t=Object.create(En.prototype);return t.__wbg_ptr=e,ii.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ii.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_uploadsigningkeysrequest_free(e,0)}get body(){return n.__wbg_get_uploadsigningkeysrequest_body(this.__wbg_ptr)}constructor(e){const t=n.uploadsigningkeysrequest_new(e);return this.__wbg_ptr=t>>>0,ii.register(this,this.__wbg_ptr,this),this}};o(En,"UploadSigningKeysRequest");let yt=En;const xo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_userdevices_free(i>>>0,1)),Mn=class Mn{static __wrap(e){e=e>>>0;const t=Object.create(Mn.prototype);return t.__wbg_ptr=e,xo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userdevices_free(e,0)}get(e){f(e,O);const t=n.userdevices_get(this.__wbg_ptr,e.__wbg_ptr);return t===0?void 0:He.__wrap(t)}isAnyVerified(){return n.userdevices_isAnyVerified(this.__wbg_ptr)!==0}keys(){return n.userdevices_keys(this.__wbg_ptr)}devices(){return n.userdevices_devices(this.__wbg_ptr)}};o(Mn,"UserDevices");let dr=Mn;const si=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_userid_free(i>>>0,1)),we=class we{static __wrap(e){e=e>>>0;const t=Object.create(we.prototype);return t.__wbg_ptr=e,si.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof we?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,si.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.userid_new(t,r);if(s[2])throw l(s[1]);return this.__wbg_ptr=s[0]>>>0,si.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.userid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.userid_serverName(this.__wbg_ptr);return ut.__wrap(e)}isHistorical(){return n.userid_isHistorical(this.__wbg_ptr)!==0}toString(){let e,t;try{const r=n.userid_toString(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}clone(){const e=n.userid_clone(this.__wbg_ptr);return we.__wrap(e)}};o(we,"UserId");let h=we;const Po=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_verificationrequest_free(i>>>0,1)),Bn=class Bn{static __wrap(e){e=e>>>0;const t=Object.create(Bn.prototype);return t.__wbg_ptr=e,Po.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Po.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_verificationrequest_free(e,0)}static request(e,t,r,s){let _,a;try{f(e,h),f(t,O),f(r,h);var c=v(s)?0:z(s,n.__wbindgen_malloc),g=d;const m=n.verificationrequest_request(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,c,g);var p=m[0],y=m[1];if(m[3])throw p=0,y=0,l(m[2]);return _=p,a=y,b(p,y)}finally{n.__wbindgen_free(_,a,1)}}get ownUserId(){const e=n.verificationrequest_ownUserId(this.__wbg_ptr);return h.__wrap(e)}get otherUserId(){const e=n.verificationrequest_otherUserId(this.__wbg_ptr);return h.__wrap(e)}get otherDeviceId(){const e=n.verificationrequest_otherDeviceId(this.__wbg_ptr);return e===0?void 0:O.__wrap(e)}get roomId(){const e=n.verificationrequest_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}get cancelInfo(){const e=n.verificationrequest_cancelInfo(this.__wbg_ptr);return e===0?void 0:fe.__wrap(e)}isPassive(){return n.verificationrequest_isPassive(this.__wbg_ptr)!==0}isReady(){return n.verificationrequest_isReady(this.__wbg_ptr)!==0}timedOut(){return n.verificationrequest_timedOut(this.__wbg_ptr)!==0}timeRemainingMillis(){return n.verificationrequest_timeRemainingMillis(this.__wbg_ptr)}get theirSupportedMethods(){const e=n.verificationrequest_theirSupportedMethods(this.__wbg_ptr);if(e[3])throw l(e[2]);let t;return e[0]!==0&&(t=Ne(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*4,4)),t}get ourSupportedMethods(){const e=n.verificationrequest_ourSupportedMethods(this.__wbg_ptr);if(e[3])throw l(e[2]);let t;return e[0]!==0&&(t=Ne(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*4,4)),t}get flowId(){let e,t;try{const r=n.verificationrequest_flowId(this.__wbg_ptr);return e=r[0],t=r[1],b(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}isSelfVerification(){return n.verificationrequest_isSelfVerification(this.__wbg_ptr)!==0}weStarted(){return n.verificationrequest_weStarted(this.__wbg_ptr)!==0}isDone(){return n.verificationrequest_isDone(this.__wbg_ptr)!==0}phase(){return n.verificationrequest_phase(this.__wbg_ptr)}getVerification(){return n.verificationrequest_getVerification(this.__wbg_ptr)}registerChangesCallback(e){n.verificationrequest_registerChangesCallback(this.__wbg_ptr,e)}isCancelled(){return n.verificationrequest_isCancelled(this.__wbg_ptr)!==0}acceptWithMethods(e){const t=z(e,n.__wbindgen_malloc),r=d,s=n.verificationrequest_acceptWithMethods(this.__wbg_ptr,t,r);if(s[2])throw l(s[1]);return l(s[0])}accept(){const e=n.verificationrequest_accept(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}cancel(){const e=n.verificationrequest_cancel(this.__wbg_ptr);if(e[2])throw l(e[1]);return l(e[0])}startSas(){return n.verificationrequest_startSas(this.__wbg_ptr)}generateQrCode(){return n.verificationrequest_generateQrCode(this.__wbg_ptr)}scanQrCode(e){return f(e,ct),n.verificationrequest_scanQrCode(this.__wbg_ptr,e.__wbg_ptr)}};o(Bn,"VerificationRequest");let Ee=Bn;const Ao=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_versions_free(i>>>0,1)),qn=class qn{static __wrap(e){e=e>>>0;const t=Object.create(qn.prototype);return t.__wbg_ptr=e,Ao.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ao.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_versions_free(e,0)}get vodozemac(){return n.__wbg_get_versions_vodozemac(this.__wbg_ptr)}get matrix_sdk_crypto(){return n.__wbg_get_versions_matrix_sdk_crypto(this.__wbg_ptr)}get git_sha(){return n.__wbg_get_versions_git_sha(this.__wbg_ptr)}get git_description(){return n.__wbg_get_versions_git_description(this.__wbg_ptr)}};o(qn,"Versions");let lr=qn;function Y_(i,e){const t=String(e),r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(Y_,"__wbg_String_8f0eb39a4a4c2f66");function Z_(i){return i.Window}o(Z_,"__wbg_Window_b0044ac7db258535");function X_(i){return i.WorkerGlobalScope}o(X_,"__wbg_WorkerGlobalScope_b74cefefc62a37da");function ea(i,e){return i.add(e)}o(ea,"__wbg_add_883d9432f9188ef2");function ta(){return R(function(i,e,t){return i.add(e,t)},arguments)}o(ta,"__wbg_add_9338901b80183e0f");function ra(i,e){return i.at(e)}o(ra,"__wbg_at_7d852dd9f194d43e");function na(i){return Ut.__wrap(i)}o(na,"__wbg_backupkeys_new");function ia(){return R(function(i,e){return IDBKeyRange.bound(i,e)},arguments)}o(ia,"__wbg_bound_55a8d08e0491e17a");function sa(){return R(function(i,e,t,r){return IDBKeyRange.bound(i,e,t!==0,r!==0)},arguments)}o(sa,"__wbg_bound_f2afc3766d4545cf");function oa(i){return i.buffer}o(oa,"__wbg_buffer_609cc3eee51ed158");function _a(){return R(function(i,e){return i.call(e)},arguments)}o(_a,"__wbg_call_672a4d21634d4a24");function aa(){return R(function(i,e,t){return i.call(e,t)},arguments)}o(aa,"__wbg_call_7cccdd69e0791ae2");function ca(){return R(function(i,e,t,r){return i.call(e,t,r)},arguments)}o(ca,"__wbg_call_833bed5770ea2041");function ga(){return R(function(i,e,t,r,s){return i.call(e,t,r,s)},arguments)}o(ga,"__wbg_call_b8adc8b1d0a0d8eb");function ua(i){return clearTimeout(i)}o(ua,"__wbg_clearTimeout_5a54f8841c30079a");function da(){return R(function(i){return i.clear()},arguments)}o(da,"__wbg_clear_f450db7eeb71163f");function la(i){i.close()}o(la,"__wbg_close_26fc2e6856d8567a");function pa(i){return i.code}o(pa,"__wbg_code_cfd8f6868bdaed9b");function wa(){return R(function(i){i.continue()},arguments)}o(wa,"__wbg_continue_c46c11d3dbe1b030");function ya(){return R(function(i){return i.count()},arguments)}o(ya,"__wbg_count_613cb921d67a4f26");function ba(){return R(function(i){return i.count()},arguments)}o(ba,"__wbg_count_ea1a2987dff7759e");function fa(){return R(function(i,e,t,r,s){return i.createIndex(b(e,t),r,s)},arguments)}o(fa,"__wbg_createIndex_873ac48adc772309");function ha(){return R(function(i,e,t,r){return i.createIndex(b(e,t),r)},arguments)}o(ha,"__wbg_createIndex_fcfd513cf4581834");function va(){return R(function(i,e,t){return i.createObjectStore(b(e,t))},arguments)}o(va,"__wbg_createObjectStore_e566459f7161f82f");function ma(i){return jt.__wrap(i)}o(ma,"__wbg_crosssigningbootstraprequests_new");function ka(i){return xt.__wrap(i)}o(ka,"__wbg_crosssigningkeyexport_new");function Sa(i){return Pt.__wrap(i)}o(Sa,"__wbg_crosssigningstatus_new");function Ra(i){return i.crypto}o(Ra,"__wbg_crypto_574e78ad8b13b65f");function Ka(i){console.debug(i)}o(Ka,"__wbg_debug_3cb59063b29f58c1");function Ia(i,e){i.debug(e)}o(Ia,"__wbg_debug_5f2014cb259e3fd1");function Ca(i){return At.__wrap(i)}o(Ca,"__wbg_decryptedroomevent_new");function Oa(i){return Nt.__wrap(i)}o(Oa,"__wbg_decryptedtodeviceevent_new");function Ea(i){return Lt.__wrap(i)}o(Ea,"__wbg_dehydrateddevice_new");function Ma(i){return H.__wrap(i)}o(Ma,"__wbg_dehydrateddevicekey_new");function Ba(){return R(function(i,e,t){i.deleteObjectStore(b(e,t))},arguments)}o(Ba,"__wbg_deleteObjectStore_3f08ae00cd288224");function qa(){return R(function(i,e){return i.delete(e)},arguments)}o(qa,"__wbg_delete_200677093b4cf756");function Fa(){return R(function(i){return i.delete()},arguments)}o(Fa,"__wbg_delete_2ecf7cf20900b3a2");function Da(i){return He.__wrap(i)}o(Da,"__wbg_device_new");function za(i){return O.__wrap(i)}o(za,"__wbg_deviceid_new");function Ua(i){return $e.__wrap(i)}o(Ua,"__wbg_devicekey_new");function Ta(i){return he.__wrap(i)}o(Ta,"__wbg_devicekeyid_new");function Va(i){return i.done}o(Va,"__wbg_done_769e5ede4b31c67b");function ja(i){return Jt.__wrap(i)}o(ja,"__wbg_emoji_new");function xa(i){return ke.__wrap(i)}o(xa,"__wbg_encryptedattachment_new");function Pa(i){return Ht.__wrap(i)}o(Pa,"__wbg_encryptioninfo_new");function Aa(i){return Object.entries(i)}o(Aa,"__wbg_entries_3265d4158b33e5dc");function Na(i){return i.entries()}o(Na,"__wbg_entries_c8a90a7ed73e84ce");function La(i){console.error(i)}o(La,"__wbg_error_524f506f44df1645");function Wa(i,e){i.error(e)}o(Wa,"__wbg_error_64e73d9e9f03e8a4");function Ga(i,e){let t,r;try{t=i,r=e,console.error(b(i,e))}finally{n.__wbindgen_free(t,r,1)}}o(Ga,"__wbg_error_7534b8e9a36f1ab4");function Ja(){return R(function(i){const e=i.error;return v(e)?0:M(e)},arguments)}o(Ja,"__wbg_error_ff4ddaabdfc5dbb3");function Ha(i){return Array.from(i)}o(Ha,"__wbg_from_2a5d3e218e67aa85");function $a(){return R(function(i){return i.getAllKeys()},arguments)}o($a,"__wbg_getAllKeys_b11d8835dc4be0e8");function Qa(){return R(function(i){return i.getAll()},arguments)}o(Qa,"__wbg_getAll_304e868beec2021f");function Ya(){return R(function(i,e,t){return i.getAll(e,t>>>0)},arguments)}o(Ya,"__wbg_getAll_d1e60c13c0073374");function Za(){return R(function(i,e){return i.getAll(e)},arguments)}o(Za,"__wbg_getAll_e6903c610babcd42");function Xa(){return R(function(i,e){globalThis.crypto.getRandomValues(L(i,e))},arguments)}o(Xa,"__wbg_getRandomValues_3d90134a348e46b3");function ec(){return R(function(i,e){i.getRandomValues(e)},arguments)}o(ec,"__wbg_getRandomValues_b8f5dbd5f3995a9e");function tc(i){return i.getTime()}o(tc,"__wbg_getTime_46267b1c24877e30");function rc(){return R(function(i,e){return Reflect.get(i,e)},arguments)}o(rc,"__wbg_get_67b2ba62fc30de12");function nc(){return R(function(i,e){return i.get(e)},arguments)}o(nc,"__wbg_get_8da03f81f6a1111e");function ic(){return R(function(i,e){return i.get(e)},arguments)}o(ic,"__wbg_get_93e54e8e166fbcab");function sc(i,e){return i[e>>>0]}o(sc,"__wbg_get_b9b93047fe3cf45b");function oc(i,e){return i[e]}o(oc,"__wbg_getwithrefkey_1dc361bd10053bfe");function _c(i){return i.global}o(_c,"__wbg_global_b6f5c73312f62313");function ac(i){return Yt.__wrap(i)}o(ac,"__wbg_inboundgroupsession_new");function cc(){return R(function(i,e,t){return i.index(b(e,t))},arguments)}o(cc,"__wbg_index_e00ca5fff206ee3e");function gc(){return R(function(i){const e=i.indexedDB;return v(e)?0:M(e)},arguments)}o(gc,"__wbg_indexedDB_601ec26c63e333de");function uc(){return R(function(i){const e=i.indexedDB;return v(e)?0:M(e)},arguments)}o(uc,"__wbg_indexedDB_b1f49280282046f8");function dc(){return R(function(i){const e=i.indexedDB;return v(e)?0:M(e)},arguments)}o(dc,"__wbg_indexedDB_f6b47b0dc333fd2f");function lc(i){console.info(i)}o(lc,"__wbg_info_3daf2e093e091b66");function pc(i,e){i.info(e)}o(pc,"__wbg_info_9dbb68f6a8dca153");function wc(i){let e;try{e=i instanceof ArrayBuffer}catch{e=!1}return e}o(wc,"__wbg_instanceof_ArrayBuffer_e14585432e3737fc");function yc(i){let e;try{e=i instanceof Map}catch{e=!1}return e}o(yc,"__wbg_instanceof_Map_f3469ce2244d2430");function bc(i){let e;try{e=i instanceof Promise}catch{e=!1}return e}o(bc,"__wbg_instanceof_Promise_935168b8f4b49db3");function fc(i){let e;try{e=i instanceof Uint8Array}catch{e=!1}return e}o(fc,"__wbg_instanceof_Uint8Array_17156bcf118086a9");function hc(i){return Zt.__wrap(i)}o(hc,"__wbg_invalidtodeviceevent_new");function vc(i){return Array.isArray(i)}o(vc,"__wbg_isArray_a1eab7e0d067391b");function mc(i){return Number.isSafeInteger(i)}o(mc,"__wbg_isSafeInteger_343e2beeeece1bb0");function kc(i,e,t){const r=e.item(t>>>0);var s=v(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;B().setInt32(i+4*1,_,!0),B().setInt32(i+4*0,s,!0)}o(kc,"__wbg_item_c3c26b4103ad5aaf");function Sc(){return Symbol.iterator}o(Sc,"__wbg_iterator_9a24c88df860dc65");function Rc(){return R(function(i){return i.key},arguments)}o(Rc,"__wbg_key_29fefecef430db96");function Kc(i){return Ze.__wrap(i)}o(Kc,"__wbg_keysbackuprequest_new");function Ic(i){return Xe.__wrap(i)}o(Ic,"__wbg_keysclaimrequest_new");function Cc(i){return Se.__wrap(i)}o(Cc,"__wbg_keysqueryrequest_new");function Oc(i){return et.__wrap(i)}o(Oc,"__wbg_keysuploadrequest_new");function Ec(i){return i.length}o(Ec,"__wbg_length_238152a0aedbb6e7");function Mc(i){return i.length}o(Mc,"__wbg_length_a446193dc22c12f8");function Bc(i){return i.length}o(Bc,"__wbg_length_e2d2a49132c1b256");function qc(){return R(function(i,e){return IDBKeyRange.lowerBound(i,e!==0)},arguments)}o(qc,"__wbg_lowerBound_1872d19f5bcf83c6");function Fc(i){return tt.__wrap(i)}o(Fc,"__wbg_maybesignature_new");function Dc(i){return rt.__wrap(i)}o(Dc,"__wbg_megolmdecryptionerror_new");function zc(i,e){const t=e.message,r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(zc,"__wbg_message_5c5d919204d42400");function Uc(i){return i.msCrypto}o(Uc,"__wbg_msCrypto_a61aeb35a24c1329");function Tc(i,e){const t=e.name,r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(Tc,"__wbg_name_f2d27098bfd843e7");function Vc(i,e){try{var t={a:i,b:e},r=o((_,a)=>{const c=t.a;t.a=0;try{return P_(c,t.b,_,a)}finally{t.a=c}},"cb0");return new Promise(r)}finally{t.a=t.b=0}}o(Vc,"__wbg_new_23a2665fac83c611");function jc(i){return new Date(i)}o(jc,"__wbg_new_31a97dac4f10fab7");function xc(){return new Object}o(xc,"__wbg_new_405e22f390576ce2");function Pc(){return new Map}o(Pc,"__wbg_new_5e0be73521bc8c17");function Ac(){return new Array}o(Ac,"__wbg_new_78feb108b6472713");function Nc(i){return new Uint8ClampedArray(i)}o(Nc,"__wbg_new_7a91e41fe43b3c92");function Lc(){return new Error}o(Lc,"__wbg_new_8a6f238a6ece86ea");function Wc(i){return new Uint8Array(i)}o(Wc,"__wbg_new_a12002a7f91c75be");function Gc(i){return new Set(i)}o(Gc,"__wbg_new_a239edaa1dc2968f");function Jc(i,e){return new Function(b(i,e))}o(Jc,"__wbg_newnoargs_105ed471475aaf50");function Hc(i,e,t){return new Uint8ClampedArray(i,e>>>0,t>>>0)}o(Hc,"__wbg_newwithbyteoffsetandlength_6d34787141015158");function $c(i,e,t){return new Uint8Array(i,e>>>0,t>>>0)}o($c,"__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a");function Qc(i){return new Uint8Array(i>>>0)}o(Qc,"__wbg_newwithlength_a381634e90c276d4");function Yc(i){return new Uint8ClampedArray(i>>>0)}o(Yc,"__wbg_newwithlength_ee8e1b95dea9d37c");function Zc(){return R(function(i,e){return new DOMException(b(i,e))},arguments)}o(Zc,"__wbg_newwithmessage_baedba94f03976fd");function Xc(i){return i.next}o(Xc,"__wbg_next_25feadfc0913fea9");function eg(){return R(function(i){return i.next()},arguments)}o(eg,"__wbg_next_6574e1a8a62d1055");function tg(i){return i.node}o(tg,"__wbg_node_905d3e251edff8a2");function rg(i){return i.now()}o(rg,"__wbg_now_2c95c9de01293173");function ng(){return Date.now()}o(ng,"__wbg_now_807e54c39636c349");function ig(i){return i.objectStoreNames}o(ig,"__wbg_objectStoreNames_9bb1ab04a7012aaf");function sg(){return R(function(i,e,t){return i.objectStore(b(e,t))},arguments)}o(sg,"__wbg_objectStore_21878d46d25b64b6");function og(i){return i.oldVersion}o(og,"__wbg_oldVersion_e8337811e52861c6");function _g(i){return nt.__wrap(i)}o(_g,"__wbg_olmmachine_new");function ag(){return R(function(i){return i.openCursor()},arguments)}o(ag,"__wbg_openCursor_1adef2266972fb45");function cg(){return R(function(i){return i.openCursor()},arguments)}o(cg,"__wbg_openCursor_238e247d18bde2cd");function gg(){return R(function(i,e){return i.openCursor(e)},arguments)}o(gg,"__wbg_openCursor_f4b061aa6d804b93");function ug(){return R(function(i,e,t){return i.open(b(e,t))},arguments)}o(ug,"__wbg_open_88b1390d99a7c691");function dg(){return R(function(i,e,t,r){return i.open(b(e,t),r>>>0)},arguments)}o(dg,"__wbg_open_e0c0b2993eb596e1");function lg(i){return it.__wrap(i)}o(lg,"__wbg_otheruseridentity_new");function pg(i){return st.__wrap(i)}o(pg,"__wbg_ownuseridentity_new");function wg(){return R(function(i,e){return JSON.parse(b(i,e))},arguments)}o(wg,"__wbg_parse_def2e24ef1252aff");function yg(i){return i.performance}o(yg,"__wbg_performance_7a3ffd0b17f663ad");function bg(i){return ot.__unwrap(i)}o(bg,"__wbg_pickledinboundgroupsession_unwrap");function fg(i){return _t.__unwrap(i)}o(fg,"__wbg_pickledsession_unwrap");function hg(i){return tr.__wrap(i)}o(hg,"__wbg_plaintexttodeviceevent_new");function vg(i){return i.process}o(vg,"__wbg_process_dc0fbacc7c1c06f7");function mg(i,e){return i.push(e)}o(mg,"__wbg_push_737cfc8c1432c2c6");function kg(){return R(function(i,e,t){return i.put(e,t)},arguments)}o(kg,"__wbg_put_066faa31a6a88f5b");function Sg(i){return at.__wrap(i)}o(Sg,"__wbg_putdehydrateddevicerequest_new");function Rg(i){return Ke.__wrap(i)}o(Rg,"__wbg_qr_new");function Kg(i){queueMicrotask(i)}o(Kg,"__wbg_queueMicrotask_97d92b4fcc8a61c5");function Ig(i){return i.queueMicrotask}o(Ig,"__wbg_queueMicrotask_d3219def82552485");function Cg(){return R(function(i,e){i.randomFillSync(e)},arguments)}o(Cg,"__wbg_randomFillSync_ac0988aba3254290");function Og(i){const e=i.readyState;return(H_.indexOf(e)+1||3)-1}o(Og,"__wbg_readyState_4013cfdf4f22afb0");function Eg(i){return nr.__wrap(i)}o(Eg,"__wbg_rehydrateddevice_new");function Mg(){return R(function(){return module.require},arguments)}o(Mg,"__wbg_require_60cc747a6bc5215a");function Bg(i){return Promise.resolve(i)}o(Bg,"__wbg_resolve_4851785c9c5f573d");function qg(){return R(function(i){return i.result},arguments)}o(qg,"__wbg_result_f29afabdf2c05826");function Fg(i){return K.__unwrap(i)}o(Fg,"__wbg_roomid_unwrap");function Dg(i){return ir.__wrap(i)}o(Dg,"__wbg_roomkeycounts_new");function zg(i){return sr.__wrap(i)}o(zg,"__wbg_roomkeyimportresult_new");function Ug(i){return or.__wrap(i)}o(Ug,"__wbg_roomkeyinfo_new");function Tg(i){return _r.__wrap(i)}o(Tg,"__wbg_roomkeywithheldinfo_new");function Vg(i){return gt.__wrap(i)}o(Vg,"__wbg_roommessagerequest_new");function jg(i){return ce.__wrap(i)}o(jg,"__wbg_roomsettings_new");function xg(i){return Ie.__wrap(i)}o(xg,"__wbg_sas_new");function Pg(i){return Ce.__wrap(i)}o(Pg,"__wbg_secretsbundle_new");function Ag(){return R(function(i,e){return setTimeout(i,e)},arguments)}o(Ag,"__wbg_setTimeout_db2dbaeefb6f39c7");function Ng(i,e,t){i[e>>>0]=t}o(Ng,"__wbg_set_37837023f3d740e8");function Lg(i,e,t){i[e]=t}o(Lg,"__wbg_set_3f1d0b984ed272ed");function Wg(i,e,t){i.set(e,t>>>0)}o(Wg,"__wbg_set_65595bdd868b3009");function Gg(i,e,t){i.set(e,t>>>0)}o(Gg,"__wbg_set_6775f73144c2ef27");function Jg(i,e,t){return i.set(e,t)}o(Jg,"__wbg_set_8fc6bf8a5b1071d1");function Hg(i,e){i.onabort=e}o(Hg,"__wbg_setonabort_3bf4db6614fa98e9");function $g(i,e){i.onblocked=e}o($g,"__wbg_setonblocked_aebf64bd39f1eca8");function Qg(i,e){i.oncomplete=e}o(Qg,"__wbg_setoncomplete_4d19df0dadb7c4d4");function Yg(i,e){i.onerror=e}o(Yg,"__wbg_setonerror_b0d9d723b8fddbbb");function Zg(i,e){i.onerror=e}o(Zg,"__wbg_setonerror_d7e3056cc6e56085");function Xg(i,e){i.onsuccess=e}o(Xg,"__wbg_setonsuccess_afa464ee777a396d");function eu(i,e){i.onupgradeneeded=e}o(eu,"__wbg_setonupgradeneeded_fcf7ce4f2eb0cb5f");function tu(i,e){i.onversionchange=e}o(tu,"__wbg_setonversionchange_6ee07fa49ee1e3a5");function ru(i,e){i.unique=e!==0}o(ru,"__wbg_setunique_dd24c422aa05df89");function nu(i){return lt.__wrap(i)}o(nu,"__wbg_signatures_new");function iu(i){return Oe.__wrap(i)}o(iu,"__wbg_signatureuploadrequest_new");function su(i){return cr.__wrap(i)}o(su,"__wbg_signatureverification_new");function ou(i,e){const t=e.stack,r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(ou,"__wbg_stack_0ed75d68575b0f3c");function _u(){const i=typeof global>"u"?null:global;return v(i)?0:M(i)}o(_u,"__wbg_static_accessor_GLOBAL_88a902d13a557d07");function au(){const i=typeof globalThis>"u"?null:globalThis;return v(i)?0:M(i)}o(au,"__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0");function cu(){const i=typeof self>"u"?null:self;return v(i)?0:M(i)}o(cu,"__wbg_static_accessor_SELF_37c5d418e4bf5819");function gu(){const i=typeof window>"u"?null:window;return v(i)?0:M(i)}o(gu,"__wbg_static_accessor_WINDOW_5de37043a91a9c40");function uu(i){return pt.__wrap(i)}o(uu,"__wbg_storedroomkeybundledata_new");function du(i){return A.__wrap(i)}o(du,"__wbg_storehandle_new");function lu(){return R(function(i){return JSON.stringify(i)},arguments)}o(lu,"__wbg_stringify_f7ed6987935b4a24");function pu(i,e,t){return i.subarray(e>>>0,t>>>0)}o(pu,"__wbg_subarray_aa9065fa9dc5df96");function wu(i){const e=i.target;return v(e)?0:M(e)}o(wu,"__wbg_target_0a62d9d79a2a1ede");function yu(i,e){return i.then(e)}o(yu,"__wbg_then_44b73946d2fb3e7d");function bu(i,e,t){return i.then(e,t)}o(bu,"__wbg_then_48b406749878a531");function fu(i){return wt.__wrap(i)}o(fu,"__wbg_todevicerequest_new");function hu(){return R(function(i,e,t,r){return i.transaction(b(e,t),__[r])},arguments)}o(hu,"__wbg_transaction_babc423936946a37");function vu(){return R(function(i,e,t){return i.transaction(e,__[t])},arguments)}o(vu,"__wbg_transaction_d6d07c3c9963c49e");function mu(i){const e=i.transaction;return v(e)?0:M(e)}o(mu,"__wbg_transaction_e713aa7b07ccaedd");function ku(){return R(function(i,e){return i.update(e)},arguments)}o(ku,"__wbg_update_acd72607f506872a");function Su(i){return dr.__wrap(i)}o(Su,"__wbg_userdevices_new");function Ru(i){return h.__wrap(i)}o(Ru,"__wbg_userid_new");function Ku(i){return h.__unwrap(i)}o(Ku,"__wbg_userid_unwrap");function Iu(i){return ur.__wrap(i)}o(Iu,"__wbg_utdtodeviceevent_new");function Cu(){return R(function(i){return i.value},arguments)}o(Cu,"__wbg_value_68c4e9a54bb7fd5e");function Ou(i){return i.value}o(Ou,"__wbg_value_cd1ffa7b1ab794f1");function Eu(i){return i.values()}o(Eu,"__wbg_values_53465c57fc8cd691");function Mu(i){return Ee.__wrap(i)}o(Mu,"__wbg_verificationrequest_new");function Bu(i){return i.version}o(Bu,"__wbg_version_a70a33e5bbc6d6db");function qu(i){return i.versions}o(qu,"__wbg_versions_c01dfd4722a88165");function Fu(i){console.warn(i)}o(Fu,"__wbg_warn_4ca3906c248c47c4");function Du(i,e){i.warn(e)}o(Du,"__wbg_warn_c3cc2bbed3f9c3c0");function zu(){return[]}o(zu,"__wbindgen_array_new");function Uu(i,e){i.push(e)}o(Uu,"__wbindgen_array_push");function Tu(i){return+i}o(Tu,"__wbindgen_as_number");function Vu(i){return i}o(Vu,"__wbindgen_bigint_from_i64");function ju(i){return BigInt.asUintN(64,i)}o(ju,"__wbindgen_bigint_from_u64");function xu(i,e){const t=e,r=typeof t=="bigint"?t:void 0;B().setBigInt64(i+8*1,v(r)?BigInt(0):r,!0),B().setInt32(i+4*0,!v(r),!0)}o(xu,"__wbindgen_bigint_get_as_i64");function Pu(i){const e=i;return typeof e=="boolean"?e?1:0:2}o(Pu,"__wbindgen_boolean_get");function Au(i){const e=i.original;return e.cnt--==1?(e.a=0,!0):!1}o(Au,"__wbindgen_cb_drop");function Nu(i,e,t){return Qi(i,e,39,U_)}o(Nu,"__wbindgen_closure_wrapper1145");function Lu(i,e,t){return Qi(i,e,429,T_)}o(Lu,"__wbindgen_closure_wrapper2371");function Wu(i,e,t){return Qi(i,e,429,V_)}o(Wu,"__wbindgen_closure_wrapper5561");function Gu(i,e,t){return s_(i,e,435,j_)}o(Gu,"__wbindgen_closure_wrapper7047");function Ju(i,e,t){return s_(i,e,435,x_)}o(Ju,"__wbindgen_closure_wrapper7052");function Hu(i,e){const t=di(e),r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(Hu,"__wbindgen_debug_string");function $u(i,e){return new Error(b(i,e))}o($u,"__wbindgen_error_new");function Qu(i,e){return i in e}o(Qu,"__wbindgen_in");function Yu(){const i=n.__wbindgen_export_4,e=i.grow(4);i.set(0,void 0),i.set(e+0,void 0),i.set(e+1,null),i.set(e+2,!0),i.set(e+3,!1)}o(Yu,"__wbindgen_init_externref_table");function Zu(i){return Array.isArray(i)}o(Zu,"__wbindgen_is_array");function Xu(i){return typeof i=="bigint"}o(Xu,"__wbindgen_is_bigint");function ed(i){return typeof i=="function"}o(ed,"__wbindgen_is_function");function td(i){return i===null}o(td,"__wbindgen_is_null");function rd(i){const e=i;return typeof e=="object"&&e!==null}o(rd,"__wbindgen_is_object");function nd(i){return typeof i=="string"}o(nd,"__wbindgen_is_string");function id(i){return i===void 0}o(id,"__wbindgen_is_undefined");function sd(i,e){return i===e}o(sd,"__wbindgen_jsval_eq");function od(i,e){return i==e}o(od,"__wbindgen_jsval_loose_eq");function _d(){return n.memory}o(_d,"__wbindgen_memory");function ad(i,e){const t=e,r=typeof t=="number"?t:void 0;B().setFloat64(i+8*1,v(r)?0:r,!0),B().setInt32(i+4*0,!v(r),!0)}o(ad,"__wbindgen_number_get");function cd(i){return i}o(cd,"__wbindgen_number_new");function gd(i,e){const t=e,r=typeof t=="string"?t:void 0;var s=v(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;B().setInt32(i+4*1,_,!0),B().setInt32(i+4*0,s,!0)}o(gd,"__wbindgen_string_get");function ud(i,e){return b(i,e)}o(ud,"__wbindgen_string_new");function dd(i,e){throw new Error(b(i,e))}o(dd,"__wbindgen_throw");function ld(i){let e;try{e=+i}catch(r){e=r}return e}o(ld,"__wbindgen_try_into_number");const pd=Object.freeze(Object.defineProperty({__proto__:null,Attachment:yi,BackupDecryptionKey:j,BackupKeys:Ut,BackupSecretsBundle:Tt,Base64EncodedPkMessage:Le,BaseMigrationData:We,CancelInfo:fe,CheckCode:Vt,CollectStrategy:J,CrossSigningBootstrapRequests:jt,CrossSigningKeyExport:xt,CrossSigningStatus:Pt,Curve25519PublicKey:q,Curve25519SecretKey:Ge,DecryptedRoomEvent:At,DecryptedToDeviceEvent:Nt,DecryptionErrorCode:Z,DecryptionSettings:Je,DehydratedDevice:Lt,DehydratedDeviceKey:H,DehydratedDevices:Wt,Device:He,DeviceId:O,DeviceKey:$e,DeviceKeyAlgorithm:Gt,DeviceKeyAlgorithmName:A_,DeviceKeyId:he,DeviceKeyName:N_,DeviceLists:ve,Ecies:bi,Ed25519PublicKey:oe,Ed25519Signature:me,Emoji:Jt,EncryptedAttachment:ke,EncryptionAlgorithm:be,EncryptionInfo:Ht,EncryptionSettings:Qe,EstablishedEcies:_e,EventId:Ye,HistoryVisibility:Fe,IdentityKeys:$t,InboundCreationResult:Qt,InboundGroupSession:Yt,InvalidToDeviceEvent:Zt,KeysBackupRequest:Ze,KeysClaimRequest:Xe,KeysQueryRequest:Se,KeysUploadRequest:et,LocalTrust:li,LoggerLevel:L_,MaybeSignature:tt,MegolmDecryptionError:rt,MegolmV1BackupKey:Xt,Migration:Re,OlmMachine:nt,OtherUserIdentity:it,OutboundCreationResult:er,OwnUserIdentity:st,PickledInboundGroupSession:ot,PickledSession:_t,PkDecryption:fi,PkEncryption:hi,PkMessage:ae,PlainTextToDeviceEvent:tr,ProcessedToDeviceEventType:De,PutDehydratedDeviceRequest:at,Qr:Ke,QrCode:rr,QrCodeData:vi,QrCodeMode:W_,QrCodeScan:ct,QrState:re,RehydratedDevice:nr,RequestType:G_,RoomId:K,RoomKeyCounts:ir,RoomKeyImportResult:sr,RoomKeyInfo:or,RoomKeyWithheldInfo:_r,RoomMessageRequest:gt,RoomSettings:ce,Sas:Ie,SecretsBundle:Ce,ServerName:ut,ShieldColor:pi,ShieldState:dt,ShieldStateCode:X,Signature:ar,SignatureState:J_,SignatureUploadRequest:Oe,SignatureVerification:cr,Signatures:lt,StoreHandle:A,StoredRoomKeyBundleData:pt,ToDeviceEncryptionInfo:gr,ToDeviceRequest:wt,Tracing:mi,TrustRequirement:wi,UTDToDeviceEvent:ur,UploadSigningKeysRequest:yt,UserDevices:dr,UserId:h,VerificationMethod:ze,VerificationRequest:Ee,VerificationRequestPhase:ee,Versions:lr,__wbg_String_8f0eb39a4a4c2f66:Y_,__wbg_Window_b0044ac7db258535:Z_,__wbg_WorkerGlobalScope_b74cefefc62a37da:X_,__wbg_add_883d9432f9188ef2:ea,__wbg_add_9338901b80183e0f:ta,__wbg_at_7d852dd9f194d43e:ra,__wbg_backupkeys_new:na,__wbg_bound_55a8d08e0491e17a:ia,__wbg_bound_f2afc3766d4545cf:sa,__wbg_buffer_609cc3eee51ed158:oa,__wbg_call_672a4d21634d4a24:_a,__wbg_call_7cccdd69e0791ae2:aa,__wbg_call_833bed5770ea2041:ca,__wbg_call_b8adc8b1d0a0d8eb:ga,__wbg_clearTimeout_5a54f8841c30079a:ua,__wbg_clear_f450db7eeb71163f:da,__wbg_close_26fc2e6856d8567a:la,__wbg_code_cfd8f6868bdaed9b:pa,__wbg_continue_c46c11d3dbe1b030:wa,__wbg_count_613cb921d67a4f26:ya,__wbg_count_ea1a2987dff7759e:ba,__wbg_createIndex_873ac48adc772309:fa,__wbg_createIndex_fcfd513cf4581834:ha,__wbg_createObjectStore_e566459f7161f82f:va,__wbg_crosssigningbootstraprequests_new:ma,__wbg_crosssigningkeyexport_new:ka,__wbg_crosssigningstatus_new:Sa,__wbg_crypto_574e78ad8b13b65f:Ra,__wbg_debug_3cb59063b29f58c1:Ka,__wbg_debug_5f2014cb259e3fd1:Ia,__wbg_decryptedroomevent_new:Ca,__wbg_decryptedtodeviceevent_new:Oa,__wbg_dehydrateddevice_new:Ea,__wbg_dehydrateddevicekey_new:Ma,__wbg_deleteObjectStore_3f08ae00cd288224:Ba,__wbg_delete_200677093b4cf756:qa,__wbg_delete_2ecf7cf20900b3a2:Fa,__wbg_device_new:Da,__wbg_deviceid_new:za,__wbg_devicekey_new:Ua,__wbg_devicekeyid_new:Ta,__wbg_done_769e5ede4b31c67b:Va,__wbg_emoji_new:ja,__wbg_encryptedattachment_new:xa,__wbg_encryptioninfo_new:Pa,__wbg_entries_3265d4158b33e5dc:Aa,__wbg_entries_c8a90a7ed73e84ce:Na,__wbg_error_524f506f44df1645:La,__wbg_error_64e73d9e9f03e8a4:Wa,__wbg_error_7534b8e9a36f1ab4:Ga,__wbg_error_ff4ddaabdfc5dbb3:Ja,__wbg_from_2a5d3e218e67aa85:Ha,__wbg_getAllKeys_b11d8835dc4be0e8:$a,__wbg_getAll_304e868beec2021f:Qa,__wbg_getAll_d1e60c13c0073374:Ya,__wbg_getAll_e6903c610babcd42:Za,__wbg_getRandomValues_3d90134a348e46b3:Xa,__wbg_getRandomValues_b8f5dbd5f3995a9e:ec,__wbg_getTime_46267b1c24877e30:tc,__wbg_get_67b2ba62fc30de12:rc,__wbg_get_8da03f81f6a1111e:nc,__wbg_get_93e54e8e166fbcab:ic,__wbg_get_b9b93047fe3cf45b:sc,__wbg_getwithrefkey_1dc361bd10053bfe:oc,__wbg_global_b6f5c73312f62313:_c,__wbg_inboundgroupsession_new:ac,__wbg_index_e00ca5fff206ee3e:cc,__wbg_indexedDB_601ec26c63e333de:gc,__wbg_indexedDB_b1f49280282046f8:uc,__wbg_indexedDB_f6b47b0dc333fd2f:dc,__wbg_info_3daf2e093e091b66:lc,__wbg_info_9dbb68f6a8dca153:pc,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:wc,__wbg_instanceof_Map_f3469ce2244d2430:yc,__wbg_instanceof_Promise_935168b8f4b49db3:bc,__wbg_instanceof_Uint8Array_17156bcf118086a9:fc,__wbg_invalidtodeviceevent_new:hc,__wbg_isArray_a1eab7e0d067391b:vc,__wbg_isSafeInteger_343e2beeeece1bb0:mc,__wbg_item_c3c26b4103ad5aaf:kc,__wbg_iterator_9a24c88df860dc65:Sc,__wbg_key_29fefecef430db96:Rc,__wbg_keysbackuprequest_new:Kc,__wbg_keysclaimrequest_new:Ic,__wbg_keysqueryrequest_new:Cc,__wbg_keysuploadrequest_new:Oc,__wbg_length_238152a0aedbb6e7:Ec,__wbg_length_a446193dc22c12f8:Mc,__wbg_length_e2d2a49132c1b256:Bc,__wbg_lowerBound_1872d19f5bcf83c6:qc,__wbg_maybesignature_new:Fc,__wbg_megolmdecryptionerror_new:Dc,__wbg_message_5c5d919204d42400:zc,__wbg_msCrypto_a61aeb35a24c1329:Uc,__wbg_name_f2d27098bfd843e7:Tc,__wbg_new_23a2665fac83c611:Vc,__wbg_new_31a97dac4f10fab7:jc,__wbg_new_405e22f390576ce2:xc,__wbg_new_5e0be73521bc8c17:Pc,__wbg_new_78feb108b6472713:Ac,__wbg_new_7a91e41fe43b3c92:Nc,__wbg_new_8a6f238a6ece86ea:Lc,__wbg_new_a12002a7f91c75be:Wc,__wbg_new_a239edaa1dc2968f:Gc,__wbg_newnoargs_105ed471475aaf50:Jc,__wbg_newwithbyteoffsetandlength_6d34787141015158:Hc,__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a:$c,__wbg_newwithlength_a381634e90c276d4:Qc,__wbg_newwithlength_ee8e1b95dea9d37c:Yc,__wbg_newwithmessage_baedba94f03976fd:Zc,__wbg_next_25feadfc0913fea9:Xc,__wbg_next_6574e1a8a62d1055:eg,__wbg_node_905d3e251edff8a2:tg,__wbg_now_2c95c9de01293173:rg,__wbg_now_807e54c39636c349:ng,__wbg_objectStoreNames_9bb1ab04a7012aaf:ig,__wbg_objectStore_21878d46d25b64b6:sg,__wbg_oldVersion_e8337811e52861c6:og,__wbg_olmmachine_new:_g,__wbg_openCursor_1adef2266972fb45:ag,__wbg_openCursor_238e247d18bde2cd:cg,__wbg_openCursor_f4b061aa6d804b93:gg,__wbg_open_88b1390d99a7c691:ug,__wbg_open_e0c0b2993eb596e1:dg,__wbg_otheruseridentity_new:lg,__wbg_ownuseridentity_new:pg,__wbg_parse_def2e24ef1252aff:wg,__wbg_performance_7a3ffd0b17f663ad:yg,__wbg_pickledinboundgroupsession_unwrap:bg,__wbg_pickledsession_unwrap:fg,__wbg_plaintexttodeviceevent_new:hg,__wbg_process_dc0fbacc7c1c06f7:vg,__wbg_push_737cfc8c1432c2c6:mg,__wbg_put_066faa31a6a88f5b:kg,__wbg_putdehydrateddevicerequest_new:Sg,__wbg_qr_new:Rg,__wbg_queueMicrotask_97d92b4fcc8a61c5:Kg,__wbg_queueMicrotask_d3219def82552485:Ig,__wbg_randomFillSync_ac0988aba3254290:Cg,__wbg_readyState_4013cfdf4f22afb0:Og,__wbg_rehydrateddevice_new:Eg,__wbg_require_60cc747a6bc5215a:Mg,__wbg_resolve_4851785c9c5f573d:Bg,__wbg_result_f29afabdf2c05826:qg,__wbg_roomid_unwrap:Fg,__wbg_roomkeycounts_new:Dg,__wbg_roomkeyimportresult_new:zg,__wbg_roomkeyinfo_new:Ug,__wbg_roomkeywithheldinfo_new:Tg,__wbg_roommessagerequest_new:Vg,__wbg_roomsettings_new:jg,__wbg_sas_new:xg,__wbg_secretsbundle_new:Pg,__wbg_setTimeout_db2dbaeefb6f39c7:Ag,__wbg_set_37837023f3d740e8:Ng,__wbg_set_3f1d0b984ed272ed:Lg,__wbg_set_65595bdd868b3009:Wg,__wbg_set_6775f73144c2ef27:Gg,__wbg_set_8fc6bf8a5b1071d1:Jg,__wbg_set_wasm:$i,__wbg_setonabort_3bf4db6614fa98e9:Hg,__wbg_setonblocked_aebf64bd39f1eca8:$g,__wbg_setoncomplete_4d19df0dadb7c4d4:Qg,__wbg_setonerror_b0d9d723b8fddbbb:Yg,__wbg_setonerror_d7e3056cc6e56085:Zg,__wbg_setonsuccess_afa464ee777a396d:Xg,__wbg_setonupgradeneeded_fcf7ce4f2eb0cb5f:eu,__wbg_setonversionchange_6ee07fa49ee1e3a5:tu,__wbg_setunique_dd24c422aa05df89:ru,__wbg_signatures_new:nu,__wbg_signatureuploadrequest_new:iu,__wbg_signatureverification_new:su,__wbg_stack_0ed75d68575b0f3c:ou,__wbg_static_accessor_GLOBAL_88a902d13a557d07:_u,__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0:au,__wbg_static_accessor_SELF_37c5d418e4bf5819:cu,__wbg_static_accessor_WINDOW_5de37043a91a9c40:gu,__wbg_storedroomkeybundledata_new:uu,__wbg_storehandle_new:du,__wbg_stringify_f7ed6987935b4a24:lu,__wbg_subarray_aa9065fa9dc5df96:pu,__wbg_target_0a62d9d79a2a1ede:wu,__wbg_then_44b73946d2fb3e7d:yu,__wbg_then_48b406749878a531:bu,__wbg_todevicerequest_new:fu,__wbg_transaction_babc423936946a37:hu,__wbg_transaction_d6d07c3c9963c49e:vu,__wbg_transaction_e713aa7b07ccaedd:mu,__wbg_update_acd72607f506872a:ku,__wbg_userdevices_new:Su,__wbg_userid_new:Ru,__wbg_userid_unwrap:Ku,__wbg_utdtodeviceevent_new:Iu,__wbg_value_68c4e9a54bb7fd5e:Cu,__wbg_value_cd1ffa7b1ab794f1:Ou,__wbg_values_53465c57fc8cd691:Eu,__wbg_verificationrequest_new:Mu,__wbg_version_a70a33e5bbc6d6db:Bu,__wbg_versions_c01dfd4722a88165:qu,__wbg_warn_4ca3906c248c47c4:Fu,__wbg_warn_c3cc2bbed3f9c3c0:Du,__wbindgen_array_new:zu,__wbindgen_array_push:Uu,__wbindgen_as_number:Tu,__wbindgen_bigint_from_i64:Vu,__wbindgen_bigint_from_u64:ju,__wbindgen_bigint_get_as_i64:xu,__wbindgen_boolean_get:Pu,__wbindgen_cb_drop:Au,__wbindgen_closure_wrapper1145:Nu,__wbindgen_closure_wrapper2371:Lu,__wbindgen_closure_wrapper5561:Wu,__wbindgen_closure_wrapper7047:Gu,__wbindgen_closure_wrapper7052:Ju,__wbindgen_debug_string:Hu,__wbindgen_error_new:$u,__wbindgen_in:Qu,__wbindgen_init_externref_table:Yu,__wbindgen_is_array:Zu,__wbindgen_is_bigint:Xu,__wbindgen_is_function:ed,__wbindgen_is_null:td,__wbindgen_is_object:rd,__wbindgen_is_string:nd,__wbindgen_is_undefined:id,__wbindgen_jsval_eq:sd,__wbindgen_jsval_loose_eq:od,__wbindgen_memory:_d,__wbindgen_number_get:ad,__wbindgen_number_new:cd,__wbindgen_string_get:gd,__wbindgen_string_new:ud,__wbindgen_throw:dd,__wbindgen_try_into_number:ld,getVersions:o_,start:z_},Symbol.toStringTag,{value:"Module"})),wd=new URL("/assets/matrix_sdk_crypto_wasm_bg-X-iWfZQJ.wasm",import.meta.url);$i(new Proxy({},{get(){throw new Error("@matrix-org/matrix-sdk-crypto-wasm was used before it was initialized. Call `initAsync` first.")}}));let oi=null;async function yd(i){const{instance:e}=await WebAssembly.instantiateStreaming(fetch(i),{"./matrix_sdk_crypto_wasm_bg.js":pd});$i(e.exports),e.exports.__wbindgen_start()}o(yd,"loadModuleAsync");async function a_(i=wd){oi||(oi=yd(i)),await oi}o(a_,"initAsync");var No=/[\\\"\x00-\x1F]/g,$={};for(var Kt=0;Kt<32;++Kt)$[String.fromCharCode(Kt)]="\\U"+("0000"+Kt.toString(16)).slice(-4).toUpperCase();$["\b"]="\\b";$["	"]="\\t";$[`
`]="\\n";$["\f"]="\\f";$["\r"]="\\r";$['"']='\\"';$["\\"]="\\\\";function c_(i){return No.lastIndex=0,i.replace(No,function(e){return $[e]})}o(c_,"escapeString");function Yi(i){switch(typeof i){case"string":return'"'+c_(i)+'"';case"number":return isFinite(i)?i:"null";case"boolean":return i;case"object":return i===null?"null":Array.isArray(i)?bd(i):fd(i);default:throw new Error("Cannot stringify: "+typeof i)}}o(Yi,"stringify");function bd(i){for(var e="[",t="",r=0;r<i.length;++r)t+=e,e=",",t+=Yi(i[r]);return e!=","?"[]":t+"]"}o(bd,"stringifyArray");function fd(i){var e="{",t="",r=Object.keys(i);r.sort();for(var s=0;s<r.length;++s){var _=r[s];t+=e+'"'+c_(_)+'":',e=",",t+=Yi(i[_])}return e!=","?"{}":t+"}"}o(fd,"stringifyObject");var hd={stringify:Yi};const vd=m_(hd),_s=class _s{constructor(e,t,r,s,_,a){this.prefixedLogger=e,this.olmMachine=t,this.keyClaimManager=r,this.outgoingRequestManager=s,this.room=_,this.encryptionSettings=a,S(this,"lazyLoadedMembersResolved",!1),S(this,"currentEncryptionPromise",Promise.resolve());var c=_.getJoinedMembers();this.olmMachine.updateTrackedUsers(c.map(g=>new h(g.userId))).catch(g=>this.prefixedLogger.error("Error initializing tracked users",g))}onCryptoEvent(e){if(JSON.stringify(this.encryptionSettings)!=JSON.stringify(e))throw new Error("Cannot reconfigure an active RoomEncryptor")}onRoomMembership(e){(e.membership==Ft.Join||e.membership==Ft.Invite&&this.room.shouldEncryptForInvitedMembers())&&this.olmMachine.updateTrackedUsers([new h(e.userId)]).catch(t=>{this.prefixedLogger.error("Unable to update tracked users",t)})}prepareForEncryption(e,t){var r=this;return u(function*(){yield r.encryptEvent(null,e,t)})()}encryptEvent(e,t,r){var s,_=this,a=new Ot(this.prefixedLogger,e?(s=e.getTxnId())!==null&&s!==void 0?s:"":"prepareForEncryption"),c=this.currentEncryptionPromise.catch(()=>{}).then(u(function*(){yield W(a,"ensureEncryptionSession",u(function*(){yield _.ensureEncryptionSession(a,t,r)})),e&&(yield W(a,"encryptEventInner",u(function*(){yield _.encryptEventInner(a,e)})))}));return this.currentEncryptionPromise=c,c}ensureEncryptionSession(e,t,r){var s=this;return u(function*(){if(s.encryptionSettings.algorithm!=="m.megolm.v1.aes-sha2")throw new Error("Cannot encrypt in ".concat(s.room.roomId," for unsupported algorithm '").concat(s.encryptionSettings.algorithm,"'"));e.debug("Starting encryption");var _=yield s.room.getEncryptionTargetMembers();s.lazyLoadedMembersResolved?(e.debug("Processing outgoing requests in background"),s.outgoingRequestManager.doProcessOutgoingRequests()):(yield W(e,"loadMembersIfNeeded: updateTrackedUsers",u(function*(){yield s.olmMachine.updateTrackedUsers(_.map(y=>new h(y.userId)))})),e.debug("Updated tracked users"),s.lazyLoadedMembersResolved=!0,e.debug("Processing outgoing requests"),yield W(e,"doProcessOutgoingRequests",u(function*(){yield s.outgoingRequestManager.doProcessOutgoingRequests()}))),e.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(s.room.shouldEncryptForInvitedMembers(),"):"),_.map(y=>"".concat(y.userId," (").concat(y.membership,")")));var a=_.map(y=>new h(y.userId));yield W(e,"ensureSessionsForUsers",u(function*(){yield s.keyClaimManager.ensureSessionsForUsers(e,a)}));var c=new Qe;switch(c.historyVisibility=md(s.room.getHistoryVisibility()),c.algorithm=be.MegolmV1AesSha2,typeof s.encryptionSettings.rotation_period_ms=="number"&&(c.rotationPeriod=BigInt(s.encryptionSettings.rotation_period_ms*1e3)),typeof s.encryptionSettings.rotation_period_msgs=="number"&&(c.rotationPeriodMessages=BigInt(s.encryptionSettings.rotation_period_msgs)),r.kind){case Dt.AllDevicesIsolationMode:{var g,p=(g=s.room.getBlacklistUnverifiedDevices())!==null&&g!==void 0?g:t;c.sharingStrategy=J.deviceBasedStrategy(p,r.errorOnVerifiedUserProblems)}break;case Dt.OnlySignedDevicesIsolationMode:c.sharingStrategy=J.identityBasedStrategy();break}yield W(e,"shareRoomKey",u(function*(){var y=yield s.olmMachine.shareRoomKey(new K(s.room.roomId),a,c);if(y)for(var m of y)yield s.outgoingRequestManager.outgoingRequestProcessor.makeOutgoingRequest(m)}))})()}forceDiscardSession(){var e=this;return u(function*(){var t=yield e.olmMachine.invalidateGroupSession(new K(e.room.roomId));t&&e.prefixedLogger.info("Discarded existing group session")})()}encryptEventInner(e,t){var r=this;return u(function*(){e.debug("Encrypting actual message content");var s=yield r.olmMachine.encryptRoomEvent(new K(r.room.roomId),t.getType(),JSON.stringify(t.getContent()));t.makeEncrypted(V.RoomMessageEncrypted,JSON.parse(s),r.olmMachine.identityKeys.curve25519.toBase64(),r.olmMachine.identityKeys.ed25519.toBase64()),e.debug("Encrypted event successfully")})()}};o(_s,"RoomEncryptor");let ki=_s;function md(i){switch(i){case mt.Invited:return Fe.Invited;case mt.Joined:return Fe.Joined;case mt.Shared:return Fe.Shared;case mt.WorldReadable:return Fe.WorldReadable}}o(md,"toRustHistoryVisibility");var Ue="/_matrix/client/unstable/org.matrix.msc3814.v1",_i="org.matrix.msc3814",kd=7*24*60*60*1e3;const as=class as extends bt{constructor(e,t,r,s,_){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=s,this.secretStorage=_,S(this,"intervalId",void 0)}cacheKey(e){var t=this;return u(function*(){yield t.olmMachine.dehydratedDevices().saveDehydratedDeviceKey(e),t.emit(C.DehydrationKeyCached)})()}isSupported(){var e=this;return u(function*(){try{yield e.http.authedRequest(E.Get,"/dehydrated_device",void 0,void 0,{prefix:Ue})}catch(r){var t=r;if(t.errcode==="M_UNRECOGNIZED")return!1;if(t.errcode==="M_NOT_FOUND")return!0;throw r}return!0})()}start(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};if(typeof r=="boolean"&&(r={createNewKey:r}),!(r.onlyIfKeyCached&&!(yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey()))){if(t.stop(),r.rehydrate!==!1)try{yield t.rehydrateDeviceIfAvailable()}catch(s){t.logger.info("dehydration: Error rehydrating device:",s),t.emit(C.RehydrationError,s.message)}r.createNewKey&&(yield t.resetKey()),yield t.scheduleDeviceDehydration()}})()}isKeyStored(){var e=this;return u(function*(){return!!(yield e.secretStorage.isStored(_i))})()}resetKey(){var e=this;return u(function*(){var t=H.createRandomKey();return yield e.secretStorage.store(_i,t.toBase64()),yield e.cacheKey(t),t})()}getKey(e){var t=this;return u(function*(){var r=yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey();if(r)return r;var s=yield t.secretStorage.get(_i);if(s===void 0)return e?yield t.resetKey():null;var _=ci(s);try{var a=H.createKeyFromArray(_);return yield t.cacheKey(a),a}finally{_.fill(0)}})()}rehydrateDeviceIfAvailable(){var e=this;return u(function*(){var t=yield e.getKey(!1);if(!t)return!1;var r;try{r=yield e.http.authedRequest(E.Get,"/dehydrated_device",void 0,void 0,{prefix:Ue})}catch(k){var s=k;if(s.errcode==="M_NOT_FOUND"||s.errcode==="M_UNRECOGNIZED")return e.logger.info("dehydration: No dehydrated device"),!1;throw s}e.logger.info("dehydration: dehydrated device found"),e.emit(C.RehydrationStarted);var _=yield e.olmMachine.dehydratedDevices().rehydrate(t,new O(r.device_id),JSON.stringify(r.device_data));e.logger.info("dehydration: device rehydrated");for(var a=void 0,c=0,g=0,p=Fn("/dehydrated_device/$device_id/events",{$device_id:r.device_id});;){var y=yield e.http.authedRequest(E.Post,p,void 0,a?{next_batch:a}:{},{prefix:Ue});if(y.events.length===0)break;c+=y.events.length,a=y.next_batch;var m=yield _.receiveEvents(JSON.stringify(y.events));g+=m.length,e.emit(C.RehydrationProgress,g,c)}return e.logger.info("dehydration: received ".concat(g," room keys from ").concat(c," to-device events")),e.emit(C.RehydrationCompleted),!0})()}createAndUploadDehydratedDevice(){var e=this;return u(function*(){var t=yield e.getKey(!0),r=yield e.olmMachine.dehydratedDevices().create();e.emit(C.DehydratedDeviceCreated);var s=yield r.keysForUpload("Dehydrated device",t);yield e.outgoingRequestProcessor.makeOutgoingRequest(s),e.emit(C.DehydratedDeviceUploaded),e.logger.info("dehydration: uploaded device")})()}scheduleDeviceDehydration(){var e=this;return u(function*(){e.stop(),yield e.createAndUploadDehydratedDevice(),e.intervalId=setInterval(()=>{e.createAndUploadDehydratedDevice().catch(t=>{e.emit(C.DehydratedDeviceRotationError,t.message),e.logger.error("Error creating dehydrated device:",t)})},kd)})()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}delete(){var e=this;return u(function*(){e.stop();try{yield e.http.authedRequest(E.Delete,"/dehydrated_device",void 0,{},{prefix:Ue})}catch(r){var t=r;if(t.errcode==="M_UNRECOGNIZED")return;if(t.errcode==="M_NOT_FOUND")return;throw r}})()}};o(as,"DehydratedDeviceManager");let Si=as;function Lo(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}o(Lo,"ownKeys$2");function Sd(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Lo(Object(t),!0).forEach(function(r){S(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Lo(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}o(Sd,"_objectSpread$2");const cs=class cs{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.http=r}makeOutgoingRequest(e,t){var r=this;return u(function*(){var s;if(e instanceof et)s=yield r.requestWithRetry(E.Post,"/_matrix/client/v3/keys/upload",{},e.body);else if(e instanceof Se)s=yield r.requestWithRetry(E.Post,"/_matrix/client/v3/keys/query",{},e.body);else if(e instanceof Xe)s=yield r.requestWithRetry(E.Post,"/_matrix/client/v3/keys/claim",{},e.body);else if(e instanceof Oe)s=yield r.requestWithRetry(E.Post,"/_matrix/client/v3/keys/signatures/upload",{},e.body);else if(e instanceof Ze)s=yield r.requestWithRetry(E.Put,"/_matrix/client/v3/room_keys/keys",{version:e.version},e.body);else if(e instanceof wt)s=yield r.sendToDeviceRequest(e);else if(e instanceof gt){var _="/_matrix/client/v3/rooms/".concat(encodeURIComponent(e.room_id),"/send/")+"".concat(encodeURIComponent(e.event_type),"/").concat(encodeURIComponent(e.txn_id));s=yield r.requestWithRetry(E.Put,_,{},e.body)}else if(e instanceof yt){yield r.makeRequestWithUIA(E.Post,"/_matrix/client/v3/keys/device_signing/upload",{},e.body,t);return}else if(e instanceof at){var a=Ue+"/dehydrated_device";yield r.rawJsonRequest(E.Put,a,{},e.body);return}else r.logger.warn("Unsupported outgoing message",Object.getPrototypeOf(e)),s="";if(e.id)try{yield W(r.logger,"Mark Request as sent ".concat(e.type),u(function*(){yield r.olmMachine.markRequestAsSent(e.id,e.type,s)}))}catch(c){if(c instanceof Error&&(c.message==="Attempt to use a moved value"||c.message==="null pointer passed to rust"))r.logger.debug("Ignoring error '".concat(c.message,"': client is likely shutting down"));else throw c}else r.logger.trace("Outgoing request type:".concat(e.type," does not have an ID"))})()}sendToDeviceRequest(e){var t=this;return u(function*(){var r=JSON.parse(e.body),s=[];for(var[_,a]of Object.entries(r.messages))for(var[c,g]of Object.entries(a))s.push("".concat(_,"/").concat(c," (msgid ").concat(g[k_],")"));t.logger.info("Sending batch of to-device messages. type=".concat(e.event_type," txnid=").concat(e.txn_id),s);var p="/_matrix/client/v3/sendToDevice/".concat(encodeURIComponent(e.event_type),"/")+encodeURIComponent(e.txn_id);return yield t.requestWithRetry(E.Put,p,{},e.body)})()}makeRequestWithUIA(e,t,r,s,_){var a=this;return u(function*(){if(!_)return yield a.requestWithRetry(e,t,r,s);var c=JSON.parse(s),g=function(){var y=u(function*(m){var k=Sd({},c);m!==null&&(k.auth=m);var I=yield a.requestWithRetry(e,t,r,JSON.stringify(k));return JSON.parse(I)});return o(function(k){return y.apply(this,arguments)},"makeRequest")}(),p=yield _(g);return JSON.stringify(p)})()}requestWithRetry(e,t,r,s){var _=this;return u(function*(){for(var a=0;;)try{return yield _.rawJsonRequest(e,t,r,s)}catch(g){a++;var c=S_(g,a,!0);if(c<0)throw g;yield se(c)}})()}rawJsonRequest(e,t,r,s){var _=this;return u(function*(){var a={json:!1,headers:{"Content-Type":"application/json",Accept:"application/json"},prefix:"",localTimeoutMs:6e4};return yield _.http.authedRequest(e,t,r,s,a)})()}};o(cs,"OutgoingRequestProcessor");let Ri=cs;const gs=class gs{constructor(e,t){this.olmMachine=e,this.outgoingRequestProcessor=t,S(this,"currentClaimPromise",void 0),S(this,"stopped",!1),this.currentClaimPromise=Promise.resolve()}stop(){this.stopped=!0}ensureSessionsForUsers(e,t){var r=this.currentClaimPromise.catch(()=>{}).then(()=>this.ensureSessionsForUsersInner(e,t));return this.currentClaimPromise=r,r}ensureSessionsForUsersInner(e,t){var r=this;return u(function*(){if(r.stopped)throw new Error("Cannot ensure Olm sessions: shutting down");e.info("Checking for missing Olm sessions");var s=yield r.olmMachine.getMissingSessions(t.map(_=>_.clone()));s&&(e.info("Making /keys/claim request"),yield r.outgoingRequestProcessor.makeOutgoingRequest(s)),e.info("Olm sessions prepared")})()}};o(gs,"KeyClaimManager");let Ki=gs;function Rd(i,e){var t=new Map;for(var[r,s]of i.keys.entries())t.set(r.toString(),s.toBase64());var _=Et.Unverified;i.isBlacklisted()?_=Et.Blocked:i.isVerified()&&(_=Et.Verified);var a=new Map,c=i.signatures.get(e);if(c){var g=new Map;for(var[p,y]of c.entries())y.isValid()&&y.signature&&g.set(p,y.signature.toBase64());a.set(e.toString(),g)}var m=i.algorithms,k=new Set;return m.forEach(I=>{switch(I){case be.MegolmV1AesSha2:k.add("m.megolm.v1.aes-sha2");break;case be.OlmV1Curve25519AesSha2:default:k.add("m.olm.v1.curve25519-aes-sha2");break}}),new Zo({deviceId:i.deviceId.toString(),userId:e.toString(),keys:t,algorithms:Array.from(k),verified:_,signatures:a,displayName:i.displayName,dehydrated:i.isDehydrated})}o(Rd,"rustDeviceToJsDevice");function Kd(i){return new Map(Object.entries(i).map(e=>{var[t,r]=e;return[t,Id(r)]}))}o(Kd,"deviceKeysToDeviceMap");function Id(i){var e,t=new Map(Object.entries(i.keys)),r=(e=i.unsigned)===null||e===void 0?void 0:e.device_display_name,s=new Map;if(i.signatures)for(var _ in i.signatures)s.set(_,new Map(Object.entries(i.signatures[_])));return new Zo({deviceId:i.device_id,userId:i.user_id,keys:t,algorithms:i.algorithms,verified:Et.Unverified,signatures:s,displayName:r})}o(Id,"downloadDeviceToJsDevice");const us=class us{constructor(e,t,r,s){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,this.secretStorage=s}bootstrapCrossSigning(e){var t=this;return u(function*(){if(e.setupNewCrossSigning){yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);return}var r=yield t.olmMachine.crossSigningStatus(),s=yield t.secretStorage.get("m.cross_signing.master"),_=yield t.secretStorage.get("m.cross_signing.self_signing"),a=yield t.secretStorage.get("m.cross_signing.user_signing"),c=!!(s&&_&&a),g=r.hasMaster&&r.hasUserSigning&&r.hasSelfSigning;if(t.logger.debug("bootstrapCrossSigning: starting",{setupNewCrossSigning:e.setupNewCrossSigning,olmDeviceHasMaster:r.hasMaster,olmDeviceHasUserSigning:r.hasUserSigning,olmDeviceHasSelfSigning:r.hasSelfSigning,privateKeysInSecretStorage:c}),g)(yield t.secretStorage.hasKey())?c?t.logger.debug("bootstrapCrossSigning: Olm device has private keys and they are saved in secret storage; doing nothing"):(t.logger.debug("bootstrapCrossSigning: Olm device has private keys: exporting to secret storage"),yield t.exportCrossSigningKeysToStorage()):t.logger.warn("bootstrapCrossSigning: Olm device has private keys, but secret storage is not yet set up; doing nothing for now.");else if(c){t.logger.debug("bootstrapCrossSigning: Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally");var p=yield t.olmMachine.importCrossSigningKeys(s,_,a);if(!p.hasMaster||!p.hasSelfSigning||!p.hasUserSigning)throw new Error("importCrossSigningKeys failed to import the keys");var y=yield t.olmMachine.getDevice(t.olmMachine.userId,t.olmMachine.deviceId);try{var m=yield y.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(m)}finally{y.free()}}else t.logger.debug("bootstrapCrossSigning: Cross-signing private keys not found locally or in secret storage, creating new keys"),yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);t.logger.debug("bootstrapCrossSigning: complete")})()}resetCrossSigning(e){var t=this;return u(function*(){var r=yield t.olmMachine.bootstrapCrossSigning(!0);(yield t.secretStorage.hasKey())?(t.logger.debug("resetCrossSigning: exporting private keys to secret storage"),yield t.exportCrossSigningKeysToStorage()):t.logger.warn("resetCrossSigning: Secret storage is not yet set up; not exporting keys to secret storage yet."),t.logger.debug("resetCrossSigning: publishing public keys to server");for(var s of[r.uploadKeysRequest,r.uploadSigningKeysRequest,r.uploadSignaturesRequest])s&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(s,e))})()}exportCrossSigningKeysToStorage(){var e=this;return u(function*(){var t=yield e.olmMachine.exportCrossSigningKeys();t!=null&&t.masterKey?yield e.secretStorage.store("m.cross_signing.master",t.masterKey):e.logger.error("Cannot export MSK to secret storage, private key unknown"),t!=null&&t.self_signing_key?yield e.secretStorage.store("m.cross_signing.self_signing",t.self_signing_key):e.logger.error("Cannot export SSK to secret storage, private key unknown"),t!=null&&t.userSigningKey?yield e.secretStorage.store("m.cross_signing.user_signing",t.userSigningKey):e.logger.error("Cannot export USK to secret storage, private key unknown")})()}};o(us,"CrossSigningIdentity");let Ii=us;function Wo(i){return Ci.apply(this,arguments)}o(Wo,"secretStorageContainsCrossSigningKeys");function Ci(){return Ci=u(function*(i){return g_(i,["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"])}),Ci.apply(this,arguments)}o(Ci,"_secretStorageContainsCrossSigningKeys");function g_(i,e){return Oi.apply(this,arguments)}o(g_,"secretStorageCanAccessSecrets");function Oi(){return Oi=u(function*(i,e){var t=yield i.getDefaultKeyId();if(!t)return!1;for(var r of e){var s=(yield i.isStored(r))||{};if(!(t in s))return!1}return!0}),Oi.apply(this,arguments)}o(Oi,"_secretStorageCanAccessSecrets");var P=function(i){return i.Sas="m.sas.v1",i.ShowQrCode="m.qr_code.show.v1",i.ScanQrCode="m.qr_code.scan.v1",i.Reciprocate="m.reciprocate.v1",i}({});const ds=class ds extends bt{constructor(e,t,r,s,_){super(),this.logger=e,this.olmMachine=t,this.inner=r,this.outgoingRequestProcessor=s,this.supportedVerificationMethods=_,S(this,"reEmitter",void 0),S(this,"_accepting",!1),S(this,"_cancelling",!1),S(this,"_verifier",void 0),this.reEmitter=new Xo(this);var a=new WeakRef(this);r.registerChangesCallback(u(function*(){var c;return(c=a.deref())===null||c===void 0?void 0:c.onChange()}))}onChange(){var e=this.inner.getVerification();e instanceof Ie?this._verifier===void 0||this._verifier instanceof wr?this.setVerifier(new yr(e,this,this.outgoingRequestProcessor)):this._verifier instanceof yr&&this._verifier.replaceInner(e):e instanceof Ke&&this._verifier===void 0&&this.setVerifier(new wr(e,this.outgoingRequestProcessor)),this.emit(Be.Change)}setVerifier(e){this._verifier&&this.reEmitter.stopReEmitting(this._verifier,[Be.Change]),this._verifier=e,this.reEmitter.reEmit(this._verifier,[Be.Change])}get transactionId(){return this.inner.flowId}get roomId(){var e;return(e=this.inner.roomId)===null||e===void 0?void 0:e.toString()}get initiatedByMe(){return this.inner.weStarted()}get otherUserId(){return this.inner.otherUserId.toString()}get otherDeviceId(){var e;return(e=this.inner.otherDeviceId)===null||e===void 0?void 0:e.toString()}getOtherDevice(){var e=this;return u(function*(){var t=e.inner.otherDeviceId;if(t)return yield e.olmMachine.getDevice(e.inner.otherUserId,t,5)})()}get isSelfVerification(){return this.inner.isSelfVerification()}get phase(){var e=this.inner.phase();switch(e){case ee.Created:case ee.Requested:return F.Requested;case ee.Ready:return this._accepting?F.Requested:F.Ready;case ee.Transitioned:if(!this._verifier)throw new Error("VerificationRequest: inner phase == Transitioned but no verifier!");return this._verifier.verificationPhase;case ee.Done:return F.Done;case ee.Cancelled:return F.Cancelled}throw new Error("Unknown verification phase ".concat(e))}get pending(){if(this.inner.isPassive())return!1;var e=this.phase;return e!==F.Done&&e!==F.Cancelled}get accepting(){return this._accepting}get declining(){return this._cancelling}get timeout(){return this.inner.timeRemainingMillis()}get methods(){throw new Error("not implemented")}get chosenMethod(){if(this.phase!==F.Started)return null;var e=this.inner.getVerification();return e instanceof Ie?P.Sas:e instanceof Ke?P.Reciprocate:null}otherPartySupportsMethod(e){var t=this.inner.theirSupportedMethods;if(t===void 0)return!1;var r=u_[e];return t.some(s=>s===r)}accept(){var e=this;return u(function*(){if(e.inner.phase()!==ee.Requested||e._accepting)throw new Error("Cannot accept a verification request in phase ".concat(e.phase));e._accepting=!0;try{var t=e.inner.acceptWithMethods(e.supportedVerificationMethods.map(qt));t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}finally{e._accepting=!1}e.emit(Be.Change)})()}cancel(e){var t=this;return u(function*(){if(!t._cancelling){t.logger.info("Cancelling verification request with params:",e),t._cancelling=!0;try{var r=t.inner.cancel();r&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(r))}finally{t._cancelling=!1}}})()}beginKeyVerification(e,t){throw new Error("not implemented")}startVerification(e){var t=this;return u(function*(){if(e!==P.Sas)throw new Error("Unsupported verification method ".concat(e));if(!(yield t.getOtherDevice()))throw new Error("startVerification(): other device is unknown");var r=yield t.inner.startSas();if(r){var[,s]=r;yield t.outgoingRequestProcessor.makeOutgoingRequest(s)}if(!t._verifier)throw new Error("Still no verifier after startSas() call");return t._verifier})()}scanQRCode(e){var t=this;return u(function*(){var r=ct.fromBytes(e),s=yield t.inner.scanQrCode(r);if(!t._verifier)throw new Error("Still no verifier after scanQrCode() call");var _=s.reciprocate();return _&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(_)),t._verifier})()}get verifier(){return this.phase===F.Started?this._verifier:void 0}getQRCodeBytes(){throw new Error("getQRCodeBytes() unsupported in Rust Crypto; use generateQRCode() instead.")}generateQRCode(){var e=this;return u(function*(){if(!(yield e.getOtherDevice()))throw new Error("generateQRCode(): other device is unknown");var t=yield e.inner.generateQrCode();if(t)return t.toBytes()})()}get cancellationCode(){var e,t;return(e=(t=this.inner.cancelInfo)===null||t===void 0?void 0:t.cancelCode())!==null&&e!==void 0?e:null}get cancellingUserId(){var e=this.inner.cancelInfo;if(e)return e.cancelledbyUs()?this.olmMachine.userId.toString():this.inner.otherUserId.toString()}};o(ds,"RustVerificationRequest");let Ei=ds;const ls=class ls extends bt{constructor(e,t){super(),this.inner=e,this.outgoingRequestProcessor=t,S(this,"completionDeferred",void 0),this.completionDeferred=Promise.withResolvers();var r=new WeakRef(this);e.registerChangesCallback(u(function*(){var s;return(s=r.deref())===null||s===void 0?void 0:s.onChange()})),this.completionDeferred.promise.catch(()=>null)}onChange(){if(this.inner.isDone())this.completionDeferred.resolve(void 0);else if(this.inner.isCancelled()){var e=this.inner.cancelInfo();this.completionDeferred.reject(new Error("Verification cancelled by ".concat(e.cancelledbyUs()?"us":"them"," with code ").concat(e.cancelCode(),": ").concat(e.reason())))}this.emit(Be.Change)}get hasBeenCancelled(){return this.inner.isCancelled()}get userId(){return this.inner.otherUserId.toString()}cancel(e){var t=this.inner.cancel();t&&this.outgoingRequestProcessor.makeOutgoingRequest(t)}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}};o(ls,"BaseRustVerifer");let pr=ls;const ps=class ps extends pr{constructor(e,t){super(e,t),S(this,"callbacks",null)}onChange(){this.callbacks===null&&this.inner.hasBeenScanned()&&(this.callbacks={confirm:o(()=>{this.confirmScanning()},"confirm"),cancel:o(()=>this.cancel(),"cancel")}),super.onChange()}verify(){var e=this;return u(function*(){e.callbacks!==null&&e.emit(t_.ShowReciprocateQr,e.callbacks),yield e.completionDeferred.promise})()}get verificationPhase(){switch(this.inner.state()){case re.Created:return F.Ready;case re.Scanned:return F.Started;case re.Confirmed:return F.Started;case re.Reciprocated:return F.Started;case re.Done:return F.Done;case re.Cancelled:return F.Cancelled;default:throw new Error("Unknown qr code state ".concat(this.inner.state()))}}getReciprocateQrCodeCallbacks(){return this.callbacks}confirmScanning(){var e=this;return u(function*(){var t=e.inner.confirmScanning();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))})()}};o(ps,"RustQrCodeVerifier");let wr=ps;const ws=class ws extends pr{constructor(e,t,r){super(e,r),S(this,"callbacks",null)}verify(){var e=this;return u(function*(){yield e.sendAccept(),yield e.completionDeferred.promise})()}sendAccept(){var e=this;return u(function*(){var t=e.inner.accept();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))})()}onChange(){var e=this;if(super.onChange(),this.callbacks===null){var t=this.inner.emoji(),r=this.inner.decimals();if(t===void 0&&r===void 0)return;var s={};t&&(s.emoji=t.map(_=>[_.symbol,_.description])),r&&(s.decimal=[r[0],r[1],r[2]]),this.callbacks={sas:s,confirm:function(){var _=u(function*(){var c=yield e.inner.confirm();for(var g of c)yield e.outgoingRequestProcessor.makeOutgoingRequest(g)});function a(){return _.apply(this,arguments)}return o(a,"confirm"),a}(),mismatch:o(()=>{var _=this.inner.cancelWithCode("m.mismatched_sas");_&&this.outgoingRequestProcessor.makeOutgoingRequest(_)},"mismatch"),cancel:o(()=>{var _=this.inner.cancelWithCode("m.user");_&&this.outgoingRequestProcessor.makeOutgoingRequest(_)},"cancel")},this.emit(t_.ShowSas,this.callbacks)}}get verificationPhase(){return F.Started}getShowSasCallbacks(){return this.callbacks}replaceInner(e){if(this.inner!=e){this.inner=e;var t=new WeakRef(this);e.registerChangesCallback(u(function*(){var r;return(r=t.deref())===null||r===void 0?void 0:r.onChange()})),this.sendAccept(),this.onChange()}}};o(ws,"RustSASVerifier");let yr=ws;var u_={[P.Sas]:ze.SasV1,[P.ScanQrCode]:ze.QrCodeScanV1,[P.ShowQrCode]:ze.QrCodeShowV1,[P.Reciprocate]:ze.ReciprocateV1};function qt(i){var e=u_[i];if(e===void 0)throw new Error("Unknown verification method ".concat(i));return e}o(qt,"verificationMethodIdentifierToMethod");function Cd(i){switch(i.getType()){case V.KeyVerificationCancel:case V.KeyVerificationDone:case V.KeyVerificationMac:case V.KeyVerificationStart:case V.KeyVerificationKey:case V.KeyVerificationReady:case V.KeyVerificationAccept:return!0;case V.RoomMessage:return i.getContent().msgtype===e_.KeyVerificationRequest;default:return!1}}o(Cd,"isVerificationEvent");const ys=class ys extends bt{constructor(e,t,r,s){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=s,S(this,"checkedForBackup",!1),S(this,"serverBackupInfo",void 0),S(this,"activeBackupVersion",null),S(this,"stopped",!1),S(this,"backupKeysLoopRunning",!1),S(this,"keyBackupCheckInProgress",null)}stop(){this.stopped=!0}getActiveBackupVersion(){var e=this;return u(function*(){return(yield e.olmMachine.isBackupEnabled())?e.activeBackupVersion:null})()}getServerBackupInfo(){var e=this;return u(function*(){return yield e.checkKeyBackupAndEnable(!1),e.serverBackupInfo})()}isKeyBackupTrusted(e){var t=this;return u(function*(){var r=yield t.olmMachine.verifyBackup(e),s=yield t.olmMachine.getBackupKeys(),_=s==null?void 0:s.decryptionKey,a=!!_&&t.backupInfoMatchesBackupDecryptionKey(e,_);return{matchesDecryptionKey:a,trusted:r.trusted()}})()}checkKeyBackupAndEnable(e){return!e&&this.checkedForBackup?Promise.resolve(null):(this.keyBackupCheckInProgress||(this.keyBackupCheckInProgress=this.doCheckKeyBackup().finally(()=>{this.keyBackupCheckInProgress=null})),this.keyBackupCheckInProgress)}handleBackupSecretReceived(e){var t=this;return u(function*(){var r,s;try{s=yield t.requestKeyBackupVersion()}catch(c){return t.logger.warn("handleBackupSecretReceived: Error checking for latest key backup",c),!1}if(!((r=s)!==null&&r!==void 0&&r.version))return t.logger.warn("handleBackupSecretReceived: Received a backup decryption key, but there is no trusted server-side key backup"),!1;try{var _=j.fromBase64(e),a=t.backupInfoMatchesBackupDecryptionKey(s,_);return a?(t.logger.info("handleBackupSecretReceived: A valid backup decryption key has been received and stored in cache."),yield t.saveBackupDecryptionKey(_,s.version),!0):(t.logger.warn("handleBackupSecretReceived: Private decryption key does not match the public key of the current remote backup."),!1)}catch(c){t.logger.warn("handleBackupSecretReceived: Invalid backup decryption key",c)}return!1})()}saveBackupDecryptionKey(e,t){var r=this;return u(function*(){yield r.olmMachine.saveBackupDecryptionKey(e,t),r.emit(C.KeyBackupDecryptionKeyCached,t)})()}importRoomKeys(e,t){var r=this;return u(function*(){yield r.importRoomKeysAsJson(JSON.stringify(e),t)})()}importRoomKeysAsJson(e,t){var r=this;return u(function*(){yield r.olmMachine.importExportedRoomKeys(e,(s,_)=>{var a,c={total:Number(_),successes:Number(s),stage:qe.LoadKeys,failures:0};t==null||(a=t.progressCallback)===null||a===void 0||a.call(t,c)})})()}importBackedUpRoomKeys(e,t,r){var s=this;return u(function*(){var _=new Map;for(var a of e){var c=new K(a.room_id);_.has(c)||_.set(c,new Map),_.get(c).set(a.session_id,a)}yield s.olmMachine.importBackedUpRoomKeys(_,(g,p,y)=>{var m,k={total:Number(p),successes:Number(g),stage:qe.LoadKeys,failures:Number(y)};r==null||(m=r.progressCallback)===null||m===void 0||m.call(r,k)},t)})()}doCheckKeyBackup(){var e=this;return u(function*(){e.logger.debug("Checking key backup status...");var t;try{t=yield e.requestKeyBackupVersion()}catch(_){return e.logger.warn("Error checking for active key backup",_),e.serverBackupInfo=void 0,null}e.checkedForBackup=!0,t&&!t.version&&(e.logger.warn("active backup lacks a useful 'version'; ignoring it"),t=void 0),e.serverBackupInfo=t;var r=yield e.getActiveBackupVersion();if(!t)return r!==null?(e.logger.debug("No key backup present on server: disabling key backup"),yield e.disableKeyBackup()):e.logger.debug("No key backup present on server: not enabling key backup"),null;var s=yield e.isKeyBackupTrusted(t);return!s.matchesDecryptionKey&&!s.trusted?r!==null?(e.logger.debug("Key backup present on server but not trusted: disabling key backup"),yield e.disableKeyBackup()):e.logger.debug("Key backup present on server but not trusted: not enabling key backup"):r===null?(e.logger.debug("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):r!==t.version?(e.logger.debug("On backup version ".concat(r," but found version ").concat(t.version,": switching.")),yield e.disableKeyBackup(),yield e.enableKeyBackup(t)):e.logger.debug("Backup version ".concat(t.version," still current")),{backupInfo:t,trustInfo:s}})()}enableKeyBackup(e){var t=this;return u(function*(){yield t.olmMachine.enableBackupV1(e.auth_data.public_key,e.version),t.activeBackupVersion=e.version,t.emit(C.KeyBackupStatus,!0),t.backupKeysLoop()})()}maybeUploadKey(){var e=this;return u(function*(){e.activeBackupVersion!=null&&e.backupKeysLoop()})()}disableKeyBackup(){var e=this;return u(function*(){yield e.olmMachine.disableBackup(),e.activeBackupVersion=null,e.emit(C.KeyBackupStatus,!1)})()}backupKeysLoop(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:1e4;if(t.backupKeysLoopRunning){t.logger.debug("Backup loop already running");return}t.backupKeysLoopRunning=!0,t.logger.debug("Backup: Starting keys upload loop for backup version:".concat(t.activeBackupVersion,"."));var s=Math.random()*r;yield se(s);try{for(var _=0,a=null,c=!0;!t.stopped;){var g=void 0;try{g=yield W(t.logger,"BackupRoomKeys: Get keys to backup from rust crypto-sdk",u(function*(){return yield t.olmMachine.backupRoomKeys()}))}catch(I){t.logger.error("Backup: Failed to get keys to backup from rust crypto-sdk",I)}if(!g||t.stopped||!t.activeBackupVersion){t.logger.debug("Backup: Ending loop for version ".concat(t.activeBackupVersion,".")),g||t.emit(C.KeyBackupSessionsRemaining,0);return}try{if(yield t.outgoingRequestProcessor.makeOutgoingRequest(g),_=0,t.stopped)break;if(!c&&a===null)try{var p=yield t.olmMachine.roomKeyCounts();a=p.total-p.backedUp}catch(I){t.logger.error("Backup: Failed to get key counts from rust crypto-sdk",I)}if(a!==null){t.emit(C.KeyBackupSessionsRemaining,a);var y=t.keysCountInBatch(g);a=Math.max(a-y,0)}}catch(I){if(_++,t.logger.error("Backup: Error processing backup request for rust crypto-sdk",I),I instanceof r_){var m=I.data.errcode;if(m=="M_NOT_FOUND"||m=="M_WRONG_ROOM_KEYS_VERSION"){t.logger.debug("Backup: Failed to upload keys to current vesion: ".concat(m,"."));try{yield t.disableKeyBackup()}catch(D){t.logger.error("Backup: An error occurred while disabling key backup:",D)}t.emit(C.KeyBackupFailed,I.data.errcode),t.backupKeysLoopRunning=!1,t.checkKeyBackupAndEnable(!0);return}else if(I.isRateLimitError())try{var k=I.getRetryAfterMs();if(k&&k>0){yield se(k);continue}}catch(D){t.logger.warn("Backup: An error occurred while retrieving a rate-limit retry delay",D)}}yield se(1e3*Math.pow(2,Math.min(_-1,4)))}c=!1}}finally{t.backupKeysLoopRunning=!1}})()}keysCountInBatch(e){var t=JSON.parse(e.body);return Go(t)}requestKeyBackupVersion(e){var t=this;return u(function*(){return yield d_(t.http,e)})()}setupKeyBackup(e){var t=this;return u(function*(){yield t.deleteAllKeyBackupVersions();var r=j.createRandomKey(),s=r.megolmV1PublicKey,_={public_key:s.publicKeyBase64};yield e(_);var a=yield t.http.authedRequest(E.Post,"/room_keys/version",void 0,{algorithm:s.algorithm,auth_data:_},{prefix:Te.V3});return yield t.saveBackupDecryptionKey(r,a.version),{version:a.version,algorithm:s.algorithm,authData:_,decryptionKey:r}})()}deleteAllKeyBackupVersions(){var e=this;return u(function*(){for(var t,r,s=(t=(r=yield e.requestKeyBackupVersion())===null||r===void 0?void 0:r.version)!==null&&t!==void 0?t:null;s!=null;){var _,a;yield e.deleteKeyBackupVersion(s),s=(_=(a=yield e.requestKeyBackupVersion())===null||a===void 0?void 0:a.version)!==null&&_!==void 0?_:null}})()}deleteKeyBackupVersion(e){var t=this;return u(function*(){t.logger.debug("deleteKeyBackupVersion v:".concat(e));var r=Fn("/room_keys/version/$version",{$version:e});yield t.http.authedRequest(E.Delete,r,void 0,void 0,{prefix:Te.V3}),t.activeBackupVersion===e&&(t.serverBackupInfo=null,yield t.disableKeyBackup())})()}createBackupDecryptor(e){return new Bi(this.logger,e)}restoreKeyBackup(e,t,r){var s=this;return u(function*(){var _=yield s.downloadKeyBackup(e);return s.importKeyBackup(_,e,t,r)})()}downloadKeyBackup(e){return this.http.authedRequest(E.Get,"/room_keys/keys",{version:e},void 0,{prefix:Te.V3})}importKeyBackup(e,t,r,s){var _=this;return u(function*(){var a,c=200,g=Go(e),p=0,y=0;s==null||(a=s.progressCallback)===null||a===void 0||a.call(s,{total:g,successes:p,stage:qe.LoadKeys,failures:y});var m=function(){var w_=u(function*(Dn){var ht,vt=[],y_=o(function*(Ks){var f_=yield r.decryptSessions(Dn.get(Ks));f_.forEach(Is=>{Is.room_id=Ks,vt.push(Is)})},"_loop");for(var b_ of Dn.keys())yield*y_(b_);try{yield _.importBackedUpRoomKeys(vt,t),p+=vt.length}catch(Rs){y+=vt.length,_.logger.error("Error importing keys from backup",Rs)}s==null||(ht=s.progressCallback)===null||ht===void 0||ht.call(s,{total:g,successes:p,stage:qe.LoadKeys,failures:y})});return o(function(ht){return w_.apply(this,arguments)},"handleChunkCallback")}(),k=0,I=new Map;for(var[D,Q]of Object.entries(e.rooms))if(Q.sessions){I.set(D,{});for(var[Me,l_]of Object.entries(Q.sessions)){var p_=I.get(D);p_[Me]=l_,k+=1,k>=c&&(yield m(I),I=new Map,I.set(D,{}),k=0)}}return k>0&&(yield m(I)),{total:g,imported:p}})()}backupInfoMatchesBackupDecryptionKey(e,t){var r;return e.algorithm!=="m.megolm_backup.v1.curve25519-aes-sha2"?(this.logger.warn("backupMatchesPrivateKey: Unsupported backup algorithm",e.algorithm),!1):((r=e.auth_data)===null||r===void 0?void 0:r.public_key)===t.megolmV1PublicKey.publicKeyBase64}};o(ys,"RustBackupManager");let Mi=ys;const bs=class bs{constructor(e,t){this.logger=e,S(this,"decryptionKey",void 0),S(this,"sourceTrusted",void 0),this.decryptionKey=t,this.sourceTrusted=!1}decryptSessions(e){var t=this;return u(function*(){var r=[];for(var[s,_]of Object.entries(e))try{var a=JSON.parse(t.decryptionKey.decryptV1(_.session_data.ephemeral,_.session_data.mac,_.session_data.ciphertext));a.session_id=s,r.push(a)}catch(c){t.logger.debug("Failed to decrypt megolm session from backup",c,_)}return r})()}free(){this.decryptionKey.free()}};o(bs,"RustBackupDecryptor");let Bi=bs;function d_(i,e){return qi.apply(this,arguments)}o(d_,"requestKeyBackupVersion");function qi(){return qi=u(function*(i,e){try{var t=e?Fn("/room_keys/version/$version",{$version:e}):"/room_keys/version";return yield i.authedRequest(E.Get,t,void 0,void 0,{prefix:Te.V3})}catch(r){if(r.errcode==="M_NOT_FOUND")return null;throw r}}),qi.apply(this,arguments)}o(qi,"_requestKeyBackupVersion");function ai(i,e){var t=e.auth_data;return t.public_key===i.megolmV1PublicKey.publicKeyBase64}o(ai,"decryptionKeyMatchesKeyBackupInfo");function Go(i){var e=0;for(var{sessions:t}of Object.values(i.rooms))e+=Object.keys(t).length;return e}o(Go,"countKeysInBackup");const fs=class fs{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,S(this,"stopped",!1),S(this,"outgoingRequestLoopRunning",!1),S(this,"nextLoopDeferred",void 0)}stop(){this.stopped=!0}doProcessOutgoingRequests(){this.nextLoopDeferred||(this.nextLoopDeferred=Promise.withResolvers());var e=this.nextLoopDeferred.promise;return this.outgoingRequestLoopRunning||this.outgoingRequestLoop().catch(t=>{this.logger.error("Uncaught error in outgoing request loop",t)}),e}outgoingRequestLoop(){var e=this;return u(function*(){if(e.outgoingRequestLoopRunning)throw new Error("Cannot run two outgoing request loops");e.outgoingRequestLoopRunning=!0;try{for(;!e.stopped&&e.nextLoopDeferred;){var t=e.nextLoopDeferred;e.nextLoopDeferred=void 0,yield e.processOutgoingRequests().then(t.resolve,t.reject)}}finally{e.outgoingRequestLoopRunning=!1}e.nextLoopDeferred&&e.nextLoopDeferred.reject(new Error("OutgoingRequestsManager was stopped"))})()}processOutgoingRequests(){var e=this;return u(function*(){if(!e.stopped){var t=yield e.olmMachine.outgoingRequests(),r=o(function*(c){if(e.stopped)return{v:void 0};try{yield W(e.logger,"Make outgoing request ".concat(c.type),u(function*(){yield e.outgoingRequestProcessor.makeOutgoingRequest(c)}))}catch(g){e.logger.error("Failed to process outgoing request ".concat(c.type,": ").concat(g))}},"_loop"),s;for(var _ of t)if(s=yield*r(_),s)return s.v}})()}};o(fs,"OutgoingRequestsManager");let Fi=fs;var It=5e3,te=function(i){return i.MISSING_DECRYPTION_KEY="MISSING_DECRYPTION_KEY",i.NETWORK_ERROR="NETWORK_ERROR",i.STOPPED="STOPPED",i}(te||{});const hs=class hs extends Error{constructor(e){super("Failed to get key from backup: ".concat(e)),this.code=e,this.name="KeyDownloadError"}};o(hs,"KeyDownloadError");let ne=hs;const vs=class vs extends Error{constructor(e){super("Failed to get key from backup: rate limited"),this.retryMillis=e,this.name="KeyDownloadRateLimitError"}};o(vs,"KeyDownloadRateLimitError");let br=vs;const ms=class ms{constructor(e,t,r,s){this.olmMachine=t,this.http=r,this.backupManager=s,S(this,"stopped",!1),S(this,"configuration",null),S(this,"sessionLastCheckAttemptedTime",new Map),S(this,"logger",void 0),S(this,"downloadLoopRunning",!1),S(this,"queuedRequests",[]),S(this,"hasConfigurationProblem",!1),S(this,"currentBackupVersionCheck",null),S(this,"onBackupStatusChanged",()=>{this.hasConfigurationProblem=!1,this.configuration=null,this.getOrCreateBackupConfiguration().then(_=>{_&&this.downloadKeysLoop()})}),this.logger=e.getChild("[PerSessionKeyBackupDownloader]"),s.on(C.KeyBackupStatus,this.onBackupStatusChanged),s.on(C.KeyBackupFailed,this.onBackupStatusChanged),s.on(C.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isKeyBackupDownloadConfigured(){return this.configuration!==null}getServerBackupInfo(){var e=this;return u(function*(){return yield e.backupManager.getServerBackupInfo()})()}onDecryptionKeyMissingError(e,t){if(this.isAlreadyInQueue(e,t)){this.logger.trace("Not checking key backup for session ".concat(t," as it is already queued"));return}if(this.wasRequestedRecently(t)){this.logger.trace("Not checking key backup for session ".concat(t," as it was already requested recently"));return}this.queuedRequests.push({roomId:e,megolmSessionId:t}),this.downloadKeysLoop()}stop(){this.stopped=!0,this.backupManager.off(C.KeyBackupStatus,this.onBackupStatusChanged),this.backupManager.off(C.KeyBackupFailed,this.onBackupStatusChanged),this.backupManager.off(C.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isAlreadyInQueue(e,t){return this.queuedRequests.some(r=>r.roomId==e&&r.megolmSessionId==t)}markAsNotFoundInBackup(e){var t=Date.now();this.sessionLastCheckAttemptedTime.set(e,t),this.sessionLastCheckAttemptedTime.size>100&&(this.sessionLastCheckAttemptedTime=new Map(Array.from(this.sessionLastCheckAttemptedTime).filter((r,s)=>Math.max(t-s,0)<It)))}wasRequestedRecently(e){var t=this.sessionLastCheckAttemptedTime.get(e);return t?Math.max(Date.now()-t,0)<It:!1}getBackupDecryptionKey(){var e=this;return u(function*(){try{return yield e.olmMachine.getBackupKeys()}catch{return null}})()}requestRoomKeyFromBackup(e,t,r){var s=this;return u(function*(){var _=Fn("/room_keys/keys/$roomId/$sessionId",{$roomId:t,$sessionId:r});return yield s.http.authedRequest(E.Get,_,{version:e},void 0,{prefix:Te.V3})})()}downloadKeysLoop(){var e=this;return u(function*(){if(!e.downloadLoopRunning&&!e.hasConfigurationProblem){e.downloadLoopRunning=!0;try{for(;e.queuedRequests.length>0;){var t=e.queuedRequests[0];try{var r=yield e.getOrCreateBackupConfiguration();if(!r){e.downloadLoopRunning=!1;return}var s=yield e.queryKeyBackup(t.roomId,t.megolmSessionId,r);if(e.stopped)return;try{yield e.decryptAndImport(t,s,r)}catch(_){e.logger.error("Error while decrypting and importing key backup for session ".concat(t.megolmSessionId),_)}e.queuedRequests.shift()}catch(_){if(_ instanceof ne)switch(_.code){case te.MISSING_DECRYPTION_KEY:e.markAsNotFoundInBackup(t.megolmSessionId),e.queuedRequests.shift();break;case te.NETWORK_ERROR:yield se(It);break;case te.STOPPED:e.downloadLoopRunning=!1;return}else _ instanceof br&&(yield se(_.retryMillis))}}}finally{e.downloadLoopRunning=!1}}})()}queryKeyBackup(e,t,r){var s=this;return u(function*(){if(s.logger.debug("Checking key backup for session ".concat(t)),s.stopped)throw new ne(te.STOPPED);try{var _=yield s.requestRoomKeyFromBackup(r.backupVersion,e,t);return s.logger.debug("Got key from backup for sessionId:".concat(t)),_}catch(p){if(s.stopped)throw new ne(te.STOPPED);if(s.logger.info("No luck requesting key backup for session ".concat(t,": ").concat(p)),p instanceof r_){var a=p.data.errcode;if(a=="M_NOT_FOUND")throw new ne(te.MISSING_DECRYPTION_KEY);if(p.isRateLimitError()){var c;try{var g;c=(g=p.getRetryAfterMs())!==null&&g!==void 0?g:void 0}catch(y){s.logger.warn("Error while retrieving a rate-limit retry delay",y)}throw c&&c>0&&s.logger.info("Rate limited by server, waiting ".concat(c,"ms")),new br(c??It)}}throw new ne(te.NETWORK_ERROR)}})()}decryptAndImport(e,t,r){var s=this;return u(function*(){var _={[e.megolmSessionId]:t},a=yield r.decryptor.decryptSessions(_);for(var c of a)c.room_id=e.roomId;yield s.backupManager.importBackedUpRoomKeys(a,r.backupVersion)})()}getOrCreateBackupConfiguration(){var e=this;return u(function*(){if(e.configuration)return e.configuration;if(e.hasConfigurationProblem)return null;if(e.currentBackupVersionCheck!=null)return e.logger.debug("Already checking server version, use current promise"),yield e.currentBackupVersionCheck;e.currentBackupVersionCheck=e.internalCheckFromServer();try{return yield e.currentBackupVersionCheck}finally{e.currentBackupVersionCheck=null}})()}internalCheckFromServer(){var e=this;return u(function*(){var t,r,s,_=null;try{_=yield e.backupManager.getServerBackupInfo()}catch(m){return e.logger.debug("Backup: error while checking server version: ".concat(m)),e.hasConfigurationProblem=!0,null}if(e.logger.debug("Got current backup version from server: ".concat((t=_)===null||t===void 0?void 0:t.version)),((r=_)===null||r===void 0?void 0:r.algorithm)!="m.megolm_backup.v1.curve25519-aes-sha2"){var a;return e.logger.info("Unsupported algorithm ".concat((a=_)===null||a===void 0?void 0:a.algorithm)),e.hasConfigurationProblem=!0,null}if(!((s=_)!==null&&s!==void 0&&s.version))return e.logger.info("No current key backup"),e.hasConfigurationProblem=!0,null;var c=yield e.backupManager.getActiveBackupVersion();if(c==null||_.version!=c)return e.logger.info("The current backup version on the server (".concat(_.version,") is not trusted. Version we are currently backing up to: ").concat(c)),e.hasConfigurationProblem=!0,null;var g=yield e.getBackupDecryptionKey();if(!(g!=null&&g.decryptionKey))return e.logger.debug("Not checking key backup for session (no decryption key)"),e.hasConfigurationProblem=!0,null;if(c!=g.backupVersion)return e.logger.debug("Version for which we have a decryption key (".concat(g.backupVersion,") doesn't match the version we are backing up to (").concat(c,")")),e.hasConfigurationProblem=!0,null;var p=_.auth_data;if(p.public_key!=g.decryptionKey.megolmV1PublicKey.publicKeyBase64)return e.logger.debug("Key backup on server does not match our decryption key"),e.hasConfigurationProblem=!0,null;var y=e.backupManager.createBackupDecryptor(g.decryptionKey);return e.hasConfigurationProblem=!1,e.configuration={decryptor:y,backupVersion:c},e.configuration})()}};o(ms,"PerSessionKeyBackupDownloader");let Di=ms;function Od(i,e){if(!i.private_key_salt||!i.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return n_(e,i.private_key_salt,i.private_key_iterations,i.private_key_bits)}o(Od,"keyFromAuthData");function Jo(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}o(Jo,"ownKeys$1");function Ho(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Jo(Object(t),!0).forEach(function(r){S(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Jo(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}o(Ho,"_objectSpread$1");var $o=[P.Sas,P.ScanQrCode,P.ShowQrCode,P.Reciprocate];const ks=class ks extends bt{constructor(e,t,r,s,_,a,c){super(),this.logger=e,this.olmMachine=t,this.http=r,this.userId=s,this.secretStorage=a,this.cryptoCallbacks=c,S(this,"RECOVERY_KEY_DERIVATION_ITERATIONS",5e5),S(this,"_trustCrossSignedDevices",!0),S(this,"deviceIsolationMode",new R_(!1)),S(this,"stopped",!1),S(this,"roomEncryptors",{}),S(this,"eventDecryptor",void 0),S(this,"keyClaimManager",void 0),S(this,"outgoingRequestProcessor",void 0),S(this,"crossSigningIdentity",void 0),S(this,"backupManager",void 0),S(this,"outgoingRequestsManager",void 0),S(this,"perSessionBackupDownloader",void 0),S(this,"dehydratedDeviceManager",void 0),S(this,"reemitter",new Xo(this)),S(this,"globalBlacklistUnverifiedDevices",!1),S(this,"_supportedVerificationMethods",$o),this.outgoingRequestProcessor=new Ri(e,t,r),this.outgoingRequestsManager=new Fi(this.logger,t,this.outgoingRequestProcessor),this.keyClaimManager=new Ki(t,this.outgoingRequestProcessor),this.backupManager=new Mi(e,t,r,this.outgoingRequestProcessor),this.perSessionBackupDownloader=new Di(this.logger,this.olmMachine,this.http,this.backupManager),this.dehydratedDeviceManager=new Si(this.logger,t,r,this.outgoingRequestProcessor,a),this.eventDecryptor=new Ui(this.logger,t,this.perSessionBackupDownloader),this.reemitter.reEmit(this.backupManager,[C.KeyBackupStatus,C.KeyBackupSessionsRemaining,C.KeyBackupFailed,C.KeyBackupDecryptionKeyCached]),this.reemitter.reEmit(this.dehydratedDeviceManager,[C.DehydratedDeviceCreated,C.DehydratedDeviceUploaded,C.RehydrationStarted,C.RehydrationProgress,C.RehydrationCompleted,C.RehydrationError,C.DehydrationKeyCached,C.DehydratedDeviceRotationError]),this.crossSigningIdentity=new Ii(e,t,this.outgoingRequestProcessor,a),this.checkKeyBackupAndEnable()}getOlmMachineOrThrow(){if(this.stopped)throw new K_;return this.olmMachine}set globalErrorOnUnknownDevices(e){}get globalErrorOnUnknownDevices(){return!1}stop(){this.stopped||(this.stopped=!0,this.keyClaimManager.stop(),this.backupManager.stop(),this.outgoingRequestsManager.stop(),this.perSessionBackupDownloader.stop(),this.dehydratedDeviceManager.stop(),this.olmMachine.close())}encryptEvent(e,t){var r=this;return u(function*(){var s=e.getRoomId(),_=r.roomEncryptors[s];if(!_)throw new Error("Cannot encrypt event in unconfigured room ".concat(s));yield _.encryptEvent(e,r.globalBlacklistUnverifiedDevices,r.deviceIsolationMode)})()}decryptEvent(e){var t=this;return u(function*(){var r=e.getRoomId();if(!r)throw new Error("to-device event was not decrypted in preprocessToDeviceMessages");return yield t.eventDecryptor.attemptEventDecryption(e,t.deviceIsolationMode)})()}getBackupDecryptor(e,t){var r=this;return u(function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor: expects Uint8Array");if(e.algorithm!="m.megolm_backup.v1.curve25519-aes-sha2")throw new Error("getBackupDecryptor: Unsupported algorithm ".concat(e.algorithm));var s=j.fromBase64(gi(t));if(!ai(s,e))throw new Error("getBackupDecryptor: key backup on server does not match the decryption key");return r.backupManager.createBackupDecryptor(s)})()}importBackedUpRoomKeys(e,t,r){var s=this;return u(function*(){return yield s.backupManager.importBackedUpRoomKeys(e,t,r)})()}maybeAcceptKeyBundle(e,t){var r=this;return u(function*(){var s=new Ot(r.logger,"maybeAcceptKeyBundle(".concat(e,", ").concat(t,")")),_=yield r.olmMachine.getReceivedRoomKeyBundleData(new K(e),new h(t));if(!_){s.info("No key bundle found for user");return}s.info("Fetching key bundle ".concat(_.url));var a=I_(r.http.opts.baseUrl,_.url,void 0,void 0,void 0,!1,!0,!0),c;try{var g=new URL(a);c=yield r.http.authedRequest(E.Get,g.pathname+g.search,{},void 0,{rawResponseBody:!0,prefix:""})}catch(p){throw s.warn("Error downloading encrypted bundle from ".concat(a,":"),p),p}s.info("Received blob of length ".concat(c.size));try{yield r.olmMachine.receiveRoomKeyBundle(_,new Uint8Array(yield c.arrayBuffer()))}catch(p){throw s.warn("Error receiving encrypted bundle:",p),p}})()}getVersion(){var e=o_();return"Rust SDK ".concat(e.matrix_sdk_crypto," (").concat(e.git_sha,"), Vodozemac ").concat(e.vodozemac)}setDeviceIsolationMode(e){this.deviceIsolationMode=e}isEncryptionEnabledInRoom(e){var t=this;return u(function*(){var r=yield t.olmMachine.getRoomSettings(new K(e));return!!(r!=null&&r.algorithm)})()}getOwnDeviceKeys(){var e=this;return u(function*(){var t=e.olmMachine.identityKeys;return{ed25519:t.ed25519.toBase64(),curve25519:t.curve25519.toBase64()}})()}prepareToEncrypt(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareForEncryption(this.globalBlacklistUnverifiedDevices,this.deviceIsolationMode)}forceDiscardSession(e){var t;return(t=this.roomEncryptors[e])===null||t===void 0?void 0:t.forceDiscardSession()}exportRoomKeys(){var e=this;return u(function*(){var t=yield e.olmMachine.exportRoomKeys(()=>!0);return JSON.parse(t)})()}exportRoomKeysAsJson(){var e=this;return u(function*(){return yield e.olmMachine.exportRoomKeys(()=>!0)})()}importRoomKeys(e,t){var r=this;return u(function*(){return yield r.backupManager.importRoomKeys(e,t)})()}importRoomKeysAsJson(e,t){var r=this;return u(function*(){return yield r.backupManager.importRoomKeysAsJson(e,t)})()}userHasCrossSigningKeys(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:t.userId,s=e.length>1&&e[1]!==void 0?e[1]:!1,_=yield t.olmMachine.trackedUsers(),a;for(var c of _)if(r===c.toString()){a=c;break}if(a!==void 0){if(r===t.userId){var g=t.olmMachine.queryKeysForUsers([a.clone()]);yield t.outgoingRequestProcessor.makeOutgoingRequest(g)}var p=yield t.olmMachine.getIdentity(a);return p==null||p.free(),p!==void 0}else if(s){var y,m=yield t.downloadDeviceList(new Set([r])),k=(y=m.master_keys)===null||y===void 0?void 0:y[r];return k?!!Object.values(k.keys)[0]:!1}else return!1})()}getUserDeviceInfo(e){var t=arguments,r=this;return u(function*(){var s=t.length>1&&t[1]!==void 0?t[1]:!1,_=new Map,a=yield r.getOlmMachineOrThrow().trackedUsers(),c=new Set;a.forEach(m=>c.add(m.toString()));var g=new Set;for(var p of e)c.has(p)?_.set(p,yield r.getUserDevices(p)):g.add(p);if(s&&g.size>=1){var y=yield r.downloadDeviceList(g);Object.entries(y.device_keys).forEach(m=>{var[k,I]=m;return _.set(k,Kd(I))})}return _})()}getUserDevices(e){var t=this;return u(function*(){var r=new h(e),s=yield t.olmMachine.getUserDevices(r,1);try{var _=s.devices();try{return new Map(_.map(a=>[a.deviceId.toString(),Rd(a,r)]))}finally{_.forEach(a=>a.free())}}finally{s.free()}})()}downloadDeviceList(e){var t=this;return u(function*(){var r={device_keys:{}};return e.forEach(s=>r.device_keys[s]=[]),yield t.http.authedRequest(E.Post,"/_matrix/client/v3/keys/query",void 0,r,{prefix:""})})()}getTrustCrossSignedDevices(){return this._trustCrossSignedDevices}setTrustCrossSignedDevices(e){this._trustCrossSignedDevices=e}setDeviceVerified(e,t){var r=arguments,s=this;return u(function*(){var _=r.length>2&&r[2]!==void 0?r[2]:!0,a=yield s.olmMachine.getDevice(new h(e),new O(t));if(!a)throw new Error("Unknown device ".concat(e,"|").concat(t));try{yield a.setLocalTrust(_?li.Verified:li.Unset)}finally{a.free()}})()}crossSignDevice(e){var t=this;return u(function*(){var r=yield t.olmMachine.getDevice(new h(t.userId),new O(e));if(!r)throw new Error("Unknown device ".concat(e));try{var s=yield r.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(s)}finally{r.free()}})()}getDeviceVerificationStatus(e,t){var r=this;return u(function*(){var s=yield r.olmMachine.getDevice(new h(e),new O(t));if(!s)return null;try{return new C_({signedByOwner:s.isCrossSignedByOwner(),crossSigningVerified:s.isCrossSigningTrusted(),localVerified:s.isLocallyTrusted(),trustCrossSignedDevices:r._trustCrossSignedDevices})}finally{s.free()}})()}getUserVerificationStatus(e){var t=this;return u(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new h(e));if(r===void 0)return new Cs(!1,!1,!1);var s=r.isVerified(),_=r.wasPreviouslyVerified(),a=r instanceof it?r.identityNeedsUserApproval():!1;return r.free(),new Cs(s,_,!1,a)})()}pinCurrentUserIdentity(e){var t=this;return u(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new h(e));if(r===void 0)throw new Error("Cannot pin identity of unknown user");if(r instanceof st)throw new Error("Cannot pin identity of own user");yield r.pinCurrentMasterKey()})()}withdrawVerificationRequirement(e){var t=this;return u(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new h(e));if(r===void 0)throw new Error("Cannot withdraw verification of unknown user");yield r.withdrawVerification()})()}isCrossSigningReady(){var e=this;return u(function*(){var{privateKeysInSecretStorage:t,privateKeysCachedLocally:r}=yield e.getCrossSigningStatus(),s=!!r.masterKey&&!!r.selfSigningKey&&!!r.userSigningKey,_=yield e.getOwnIdentity();return!!(_!=null&&_.isVerified())&&(s||t)})()}getCrossSigningKeyId(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:kt.Master,s=yield t.olmMachine.getIdentity(new h(t.userId));if(!s)return null;try{var _=yield t.olmMachine.crossSigningStatus(),a=_.hasMaster&&_.hasUserSigning&&_.hasSelfSigning;if(!a||!s.isVerified())return null;var c;switch(r){case kt.Master:c=s.masterKey;break;case kt.SelfSigning:c=s.selfSigningKey;break;case kt.UserSigning:c=s.userSigningKey;break;default:return null}var g=JSON.parse(c);return Object.values(g.keys)[0]}finally{s.free()}})()}bootstrapCrossSigning(e){var t=this;return u(function*(){yield t.crossSigningIdentity.bootstrapCrossSigning(e)})()}isSecretStorageReady(){var e=this;return u(function*(){var t=["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"],r=(yield e.backupManager.getActiveBackupVersion())!=null;return r&&t.push("m.megolm_backup.v1"),g_(e.secretStorage,t)})()}bootstrapSecretStorage(){var e=arguments,t=this;return u(function*(){var{createSecretStorageKey:r,setupNewSecretStorage:s,setupNewKeyBackup:_}=e.length>0&&e[0]!==void 0?e[0]:{},a=s||!(yield t.secretStorageHasAESKey());if(a){if(!r)throw new Error("unable to create a new secret storage key, createSecretStorageKey is not set");t.logger.info("bootstrapSecretStorage: creating new secret storage key");var c=yield r();if(!c)throw new Error("createSecretStorageKey() callback did not return a secret storage key");yield t.addSecretStorageKeyToSecretStorage(c)}var g=yield t.olmMachine.exportCrossSigningKeys(),p=g&&g.masterKey!==void 0&&g.self_signing_key!==void 0&&g.userSigningKey!==void 0;p&&(a||!(yield Wo(t.secretStorage)))&&(t.logger.info("bootstrapSecretStorage: cross-signing keys not yet exported; doing so now."),yield t.secretStorage.store("m.cross_signing.master",g.masterKey),yield t.secretStorage.store("m.cross_signing.user_signing",g.userSigningKey),yield t.secretStorage.store("m.cross_signing.self_signing",g.self_signing_key)),_?yield t.resetKeyBackup():yield t.saveBackupKeyToStorage()})()}saveBackupKeyToStorage(){var e=this;return u(function*(){var t=yield e.backupManager.getServerBackupInfo();if(!t||!t.version){e.logger.info("Not saving backup key to secret storage: no backup info");return}var r=yield e.olmMachine.getBackupKeys();if(!r.decryptionKey){e.logger.info("Not saving backup key to secret storage: no backup key");return}if(!ai(r.decryptionKey,t)){e.logger.info("Not saving backup key to secret storage: decryption key does not match backup info");return}var s=r.decryptionKey.toBase64();yield e.secretStorage.store("m.megolm_backup.v1",s)})()}addSecretStorageKeyToSecretStorage(e){var t=this;return u(function*(){var r,s,_,a,c=yield t.secretStorage.addKey(Os,{passphrase:(r=e.keyInfo)===null||r===void 0?void 0:r.passphrase,name:(s=e.keyInfo)===null||s===void 0?void 0:s.name,key:e.privateKey});yield t.secretStorage.setDefaultKeyId(c.keyId),(_=(a=t.cryptoCallbacks).cacheSecretStorageKey)===null||_===void 0||_.call(a,c.keyId,c.keyInfo,e.privateKey)})()}secretStorageHasAESKey(){var e=this;return u(function*(){var t=yield e.secretStorage.getKey();if(!t)return!1;var[,r]=t;return r.algorithm===Os})()}getCrossSigningStatus(){var e=this;return u(function*(){var t=yield e.getOlmMachineOrThrow().getIdentity(new h(e.userId)),r=!!(t!=null&&t.masterKey)&&!!(t!=null&&t.selfSigningKey)&&!!(t!=null&&t.userSigningKey);t==null||t.free();var s=yield Wo(e.secretStorage),_=yield e.getOlmMachineOrThrow().crossSigningStatus();return{publicKeysOnDevice:r,privateKeysInSecretStorage:s,privateKeysCachedLocally:{masterKey:!!(_!=null&&_.hasMaster),userSigningKey:!!(_!=null&&_.hasUserSigning),selfSigningKey:!!(_!=null&&_.hasSelfSigning)}}})()}createRecoveryKeyFromPassphrase(e){var t=this;return u(function*(){if(e){var r=Es(32),s=yield n_(e,r,t.RECOVERY_KEY_DERIVATION_ITERATIONS);return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:t.RECOVERY_KEY_DERIVATION_ITERATIONS,salt:r}},privateKey:s,encodedPrivateKey:Bs(s)}}else{var _=new Uint8Array(32);return globalThis.crypto.getRandomValues(_),{privateKey:_,encodedPrivateKey:Bs(_)}}})()}getEncryptionInfoForEvent(e){var t=this;return u(function*(){return t.eventDecryptor.getEncryptionInfoForEvent(e)})()}getVerificationRequestsToDeviceInProgress(e){var t=this.olmMachine.getVerificationRequests(new h(e));return t.filter(r=>r.roomId===void 0).map(r=>this.makeVerificationRequest(r))}findVerificationRequestDMInProgress(e,t){if(!t)throw new Error("missing userId");var r=this.olmMachine.getVerificationRequests(new h(t)),s=r.find(_=>{var a;return((a=_.roomId)===null||a===void 0?void 0:a.toString())===e});if(s)return this.makeVerificationRequest(s)}requestVerificationDM(e,t){var r=this;return u(function*(){var s=yield r.olmMachine.getIdentity(new h(e));if(!s)throw new Error("unknown userId ".concat(e));try{var _=r._supportedVerificationMethods.map(p=>qt(p)),a=yield s.verificationRequestContent(_),c=yield r.sendVerificationRequestContent(t,a),g=yield s.requestVerification(new K(t),new Ye(c),_);return r.makeVerificationRequest(g)}finally{s.free()}})()}sendVerificationRequestContent(e,t){var r=this;return u(function*(){var s=Es(32),{event_id:_}=yield r.http.authedRequest(E.Put,"/_matrix/client/v3/rooms/".concat(encodeURIComponent(e),"/send/m.room.message/").concat(encodeURIComponent(s)),void 0,t,{prefix:""});return _})()}setSupportedVerificationMethods(e){this._supportedVerificationMethods=e??$o}requestOwnUserVerification(){var e=this;return u(function*(){var t=yield e.olmMachine.getIdentity(new h(e.userId));if(t===void 0)throw new Error("cannot request verification for this device when there is no existing cross-signing key");try{var[r,s]=yield t.requestVerification(e._supportedVerificationMethods.map(qt));return yield e.outgoingRequestProcessor.makeOutgoingRequest(s),e.makeVerificationRequest(r)}finally{t.free()}})()}requestDeviceVerification(e,t){var r=this;return u(function*(){var s=yield r.olmMachine.getDevice(new h(e),new O(t));if(!s)throw new Error("Not a known device");try{var[_,a]=s.requestVerification(r._supportedVerificationMethods.map(qt));return yield r.outgoingRequestProcessor.makeOutgoingRequest(a),r.makeVerificationRequest(_)}finally{s.free()}})()}getSessionBackupPrivateKey(){var e=this;return u(function*(){var t=yield e.olmMachine.getBackupKeys();return t.decryptionKey?ci(t.decryptionKey.toBase64()):null})()}storeSessionBackupPrivateKey(e,t){var r=this;return u(function*(){var s=gi(e);if(!t)throw new Error("storeSessionBackupPrivateKey: version is required");yield r.backupManager.saveBackupDecryptionKey(j.fromBase64(s),t)})()}loadSessionBackupPrivateKeyFromSecretStorage(){var e=this;return u(function*(){var t=yield e.secretStorage.get("m.megolm_backup.v1");if(!t)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: missing decryption key in secret storage");var r=yield e.backupManager.getServerBackupInfo();if(!r||!r.version)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: unable to get backup version");var s=j.fromBase64(t);if(!ai(s,r))throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: decryption key does not match backup info");yield e.backupManager.saveBackupDecryptionKey(s,r.version)})()}getActiveSessionBackupVersion(){var e=this;return u(function*(){return yield e.backupManager.getActiveBackupVersion()})()}getKeyBackupInfo(){var e=this;return u(function*(){return(yield e.backupManager.getServerBackupInfo())||null})()}isKeyBackupTrusted(e){var t=this;return u(function*(){return yield t.backupManager.isKeyBackupTrusted(e)})()}checkKeyBackupAndEnable(){var e=this;return u(function*(){return yield e.backupManager.checkKeyBackupAndEnable(!0)})()}deleteKeyBackupVersion(e){var t=this;return u(function*(){yield t.backupManager.deleteKeyBackupVersion(e)})()}resetKeyBackup(){var e=this;return u(function*(){var t=yield e.backupManager.setupKeyBackup(r=>e.signObject(r));(yield e.secretStorageHasAESKey())&&(yield e.secretStorage.store("m.megolm_backup.v1",t.decryptionKey.toBase64())),e.checkKeyBackupAndEnable()})()}disableKeyStorage(){var e=this;return u(function*(){var t=yield e.getKeyBackupInfo();t!=null&&t.version?yield e.deleteKeyBackupVersion(t.version):e.logger.error("Can't delete key backup version: no version available"),yield e.deleteSecretStorage(),yield e.dehydratedDeviceManager.delete()})()}signObject(e){var t=this;return u(function*(){var r=new Map(Object.entries(e.signatures||{})),s=e.unsigned;delete e.signatures,delete e.unsigned;var _=r.get(t.userId)||{},a=vd.stringify(e),c=yield t.olmMachine.sign(a),g=JSON.parse(c.asJSON());r.set(t.userId,Ho(Ho({},_),g[t.userId])),s!==void 0&&(e.unsigned=s),e.signatures=Object.fromEntries(r.entries())})()}restoreKeyBackupWithPassphrase(e,t){var r=this;return u(function*(){var s=yield r.backupManager.getServerBackupInfo();if(!(s!=null&&s.version))throw new Error("No backup info available");var _=yield Od(s.auth_data,e);return yield r.storeSessionBackupPrivateKey(_,s.version),r.restoreKeyBackup(t)})()}restoreKeyBackup(e){var t=this;return u(function*(){var r=yield t.olmMachine.getBackupKeys(),{decryptionKey:s,backupVersion:_}=r;if(!s||!_)throw new Error("No decryption key found in crypto store");var a=ci(s.toBase64()),c=yield t.backupManager.requestKeyBackupVersion(_);if(!c)throw new Error("Backup version to restore ".concat(_," not found on server"));var g=yield t.getBackupDecryptor(c,a);try{var p;return e==null||(p=e.progressCallback)===null||p===void 0||p.call(e,{stage:qe.Fetch}),yield t.backupManager.restoreKeyBackup(_,g,e)}finally{g.free()}})()}isDehydrationSupported(){var e=this;return u(function*(){return yield e.dehydratedDeviceManager.isSupported()})()}startDehydration(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};if(!(yield t.isCrossSigningReady())||!(yield t.isSecretStorageReady()))throw new Error("Device dehydration requires cross-signing and secret storage to be set up");return yield t.dehydratedDeviceManager.start(r||{})})()}importSecretsBundle(e){var t=this;return u(function*(){var r=Ce.from_json(e);yield t.getOlmMachineOrThrow().importSecretsBundle(r)})()}exportSecretsBundle(){var e=this;return u(function*(){var t=yield e.getOlmMachineOrThrow().exportSecretsBundle(),r=t.to_json();return t.free(),r})()}encryptToDeviceMessages(e,t,r){var s=this;return u(function*(){var _=new Ot(s.logger,"encryptToDeviceMessages"),a=new Set(t.map(g=>{var{userId:p}=g;return p}));yield s.keyClaimManager.ensureSessionsForUsers(_,Array.from(a).map(g=>new h(g)));var c={batch:[],eventType:V.RoomMessageEncrypted};return yield Promise.all(t.map(function(){var g=u(function*(p){var{userId:y,deviceId:m}=p,k=yield s.olmMachine.getDevice(new h(y),new O(m));if(k){var I=JSON.parse(yield k.encryptToDeviceEvent(e,r));c.batch.push({deviceId:m,userId:y,payload:I})}else s.logger.warn("encryptToDeviceMessages: unknown device ".concat(y,":").concat(m))});return function(p){return g.apply(this,arguments)}}())),c})()}resetEncryption(e){var t=this;return u(function*(){t.logger.debug("resetEncryption: resetting encryption"),t.dehydratedDeviceManager.delete(),yield t.backupManager.deleteAllKeyBackupVersions(),yield t.deleteSecretStorage(),yield t.crossSigningIdentity.bootstrapCrossSigning({setupNewCrossSigning:!0,authUploadDeviceSigningKeys:e}),yield t.resetKeyBackup(),t.logger.debug("resetEncryption: ended")})()}deleteSecretStorage(){var e=this;return u(function*(){yield e.secretStorage.store("m.cross_signing.master",null),yield e.secretStorage.store("m.cross_signing.self_signing",null),yield e.secretStorage.store("m.cross_signing.user_signing",null),yield e.secretStorage.store("m.megolm_backup.v1",null);var t=yield e.secretStorage.getDefaultKeyId();t&&(yield e.secretStorage.store("m.secret_storage.key.".concat(t),null)),yield e.secretStorage.setDefaultKeyId(null)})()}shareRoomHistoryWithUser(e,t){var r=this;return u(function*(){var s=new Ot(r.logger,"shareRoomHistoryWithUser(".concat(e,", ").concat(t,")")),_=yield r.getOwnIdentity();if(!(_!=null&&_.isVerified())){s.warn("Not sharing message history as the current device is not verified by our cross-signing identity");return}s.info("Sharing message history");var a=yield r.getOlmMachineOrThrow().buildRoomKeyBundle(new K(e));if(!a){s.info("No keys to share");return}var c=yield r.http.uploadContent(a.encryptedData);s.info("Uploaded encrypted key blob: ".concat(JSON.stringify(c)));var g=r.getOlmMachineOrThrow().queryKeysForUsers([new h(t)]);yield r.outgoingRequestProcessor.makeOutgoingRequest(g),yield r.keyClaimManager.ensureSessionsForUsers(s,[new h(t)]);var p=yield r.getOlmMachineOrThrow().shareRoomKeyBundleData(new h(t),new K(e),c.content_uri,a.mediaEncryptionInfo,J.identityBasedStrategy());for(var y of p)yield r.outgoingRequestProcessor.makeOutgoingRequest(y)})()}receiveSyncChanges(e){var t=this;return u(function*(){var{events:r,oneTimeKeysCounts:s=new Map,unusedFallbackKeys:_,devices:a=new ve}=e;return yield t.olmMachine.receiveSyncChanges(r?JSON.stringify(r):"[]",a,s,_)})()}preprocessToDeviceMessages(e){var t=this;return u(function*(){var r=yield t.receiveSyncChanges({events:e}),s=[];for(var _ of r){var a=JSON.parse(_.rawEvent);if(a.type===V.KeyVerificationRequest){var c=a.sender,g=a.content.transaction_id;g&&c&&t.onIncomingKeyVerificationRequest(c,g)}switch(_.type){case De.Decrypted:{var p,y=_.encryptionInfo;s.push({message:a,encryptionInfo:{sender:y.sender.toString(),senderDevice:(p=y.senderDevice)===null||p===void 0?void 0:p.toString(),senderCurve25519KeyBase64:y.senderCurve25519Key,senderVerified:y.isSenderVerified()}});break}case De.PlainText:{s.push({message:a,encryptionInfo:null});break}case De.UnableToDecrypt:break;case De.Invalid:break}}return s})()}processKeyCounts(e,t){var r=this;return u(function*(){var s=e&&new Map(Object.entries(e)),_=t&&new Set(t);(s!==void 0||_!==void 0)&&(yield r.receiveSyncChanges({oneTimeKeysCounts:s,unusedFallbackKeys:_}))})()}processDeviceLists(e){var t=this;return u(function*(){var r,s,_=new ve((r=e.changed)===null||r===void 0?void 0:r.map(a=>new h(a)),(s=e.left)===null||s===void 0?void 0:s.map(a=>new h(a)));yield t.receiveSyncChanges({devices:_})})()}onCryptoEvent(e,t){var r=this;return u(function*(){var s=t.getContent(),_=new ce;if(s.algorithm==="m.megolm.v1.aes-sha2")_.algorithm=be.MegolmV1AesSha2;else{r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event with invalid algorithm ").concat(s.algorithm));return}try{_.sessionRotationPeriodMs=s.rotation_period_ms,_.sessionRotationPeriodMessages=s.rotation_period_msgs,yield r.olmMachine.setRoomSettings(new K(e.roomId),_)}catch(c){r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event which caused error: ").concat(c));return}var a=r.roomEncryptors[e.roomId];a?a.onCryptoEvent(s):r.roomEncryptors[e.roomId]=new ki(r.logger.getChild("[".concat(e.roomId," encryption]")),r.olmMachine,r.keyClaimManager,r.outgoingRequestsManager,e,s)})()}onSyncCompleted(e){this.outgoingRequestsManager.doProcessOutgoingRequests().catch(t=>{this.logger.warn("onSyncCompleted: Error processing outgoing requests",t)})}markAllTrackedUsersAsDirty(){var e=this;return u(function*(){yield e.olmMachine.markAllTrackedUsersAsDirty()})()}onIncomingKeyVerificationRequest(e,t){var r=this.olmMachine.getVerificationRequest(new h(e),t);r?this.emit(C.VerificationRequestReceived,this.makeVerificationRequest(r)):this.logger.info("Ignoring just-received verification request ".concat(t," which did not start a rust-side verification"))}makeVerificationRequest(e){return new Ei(this.logger,this.olmMachine,e,this.outgoingRequestProcessor,this._supportedVerificationMethods)}onRoomMembership(e,t,r){var s=this.roomEncryptors[e.getRoomId()];s&&s.onRoomMembership(t)}onRoomKeysUpdated(e){var t=this;return u(function*(){for(var r of e)t.onRoomKeyUpdated(r);t.backupManager.maybeUploadKey()})()}onRoomKeyUpdated(e){var t=this;if(!this.stopped){this.logger.debug("Got update for session ".concat(e.sessionId," from sender ").concat(e.senderKey.toBase64()," in ").concat(e.roomId.toString()));var r=this.eventDecryptor.getEventsPendingRoomKey(e.roomId.toString(),e.sessionId);if(r.length!==0){this.logger.debug("Retrying decryption on events:",r.map(a=>"".concat(a.getId())));var s=o(function(c){c.attemptDecryption(t,{isRetry:!0}).catch(g=>{t.logger.info("Still unable to decrypt event ".concat(c.getId()," after receiving key"))})},"_loop");for(var _ of r)s(_)}}}onRoomKeysWithheld(e){var t=this;return u(function*(){for(var r of e){t.logger.debug("Got withheld message for session ".concat(r.sessionId," in ").concat(r.roomId.toString()));var s=t.eventDecryptor.getEventsPendingRoomKey(r.roomId.toString(),r.sessionId);if(s.length===0)return;t.logger.debug("Retrying decryption on events:",s.map(a=>"".concat(a.getId())));for(var _ of s)_.attemptDecryption(t,{isRetry:!0}).catch(a=>{})}})()}onUserIdentityUpdated(e){var t=this;return u(function*(){var r=yield t.getUserVerificationStatus(e.toString());t.emit(C.UserTrustStatusChanged,e.toString(),r),e.toString()===t.userId&&(t.emit(C.KeysChanged,{}),yield t.checkKeyBackupAndEnable())})()}onDevicesUpdated(e){var t=this;return u(function*(){t.emit(C.WillUpdateDevices,e,!1),t.emit(C.DevicesUpdated,e,!1)})()}handleSecretReceived(e,t){var r=this;return u(function*(){return r.logger.debug("onReceiveSecret: Received secret ".concat(e)),e==="m.megolm_backup.v1"?yield r.backupManager.handleBackupSecretReceived(t):!1})()}checkSecrets(e){var t=this;return u(function*(){var r=yield t.olmMachine.getSecretsFromInbox(e);for(var s of r)if(yield t.handleSecretReceived(e,s))break;yield t.olmMachine.deleteSecretsFromInbox(e)})()}onLiveEventFromSync(e){var t=this;return u(function*(){if(!(e.isState()||e.getUnsigned().transaction_id)){var r=function(){var c=u(function*(g){Cd(e)&&(yield t.onKeyVerificationEvent(g))});return o(function(p){return c.apply(this,arguments)},"processEvent")}();if(e.isDecryptionFailure()||e.isEncrypted()){var s=3e5,_=setTimeout(()=>e.off(zn.Decrypted,a),s),a=o((c,g)=>{g||(clearTimeout(_),e.off(zn.Decrypted,a),r(c))},"onDecrypted");e.on(zn.Decrypted,a)}else yield r(e)}})()}onKeyVerificationEvent(e){var t=this;return u(function*(){var r=e.getRoomId();if(!r)throw new Error("missing roomId in the event");t.logger.debug("Incoming verification event ".concat(e.getId()," type ").concat(e.getType()," from ").concat(e.getSender())),yield t.olmMachine.receiveVerificationEvent(JSON.stringify({event_id:e.getId(),type:e.getType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getContent(),origin_server_ts:e.getTs()}),new K(r)),e.getType()===V.RoomMessage&&e.getContent().msgtype===e_.KeyVerificationRequest&&t.onIncomingKeyVerificationRequest(e.getSender(),e.getId()),t.outgoingRequestsManager.doProcessOutgoingRequests().catch(s=>{t.logger.warn("onKeyVerificationRequest: Error processing outgoing requests",s)})})()}getOwnIdentity(){var e=this;return u(function*(){return yield e.olmMachine.getIdentity(new h(e.userId))})()}};o(ks,"RustCrypto");let zi=ks;const Ss=class Ss{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.perSessionBackupDownloader=r,S(this,"eventsPendingKey",new Ms(()=>new Ms(()=>new Set)))}attemptEventDecryption(e,t){var r=this;return u(function*(){r.addEventToPendingList(e);var s;switch(t.kind){case Dt.AllDevicesIsolationMode:s=wi.Untrusted;break;case Dt.OnlySignedDevicesIsolationMode:s=wi.CrossSignedOrLegacy;break}try{var _=yield r.olmMachine.decryptRoomEvent(Qo(e),new K(e.getRoomId()),new Je(s));return r.removeEventFromPendingList(e),{clearEvent:JSON.parse(_.event),claimedEd25519Key:_.senderClaimedEd25519Key,senderCurve25519Key:_.senderCurve25519Key,forwardingCurve25519KeyChain:_.forwardingCurve25519KeyChain}}catch(a){if(a instanceof rt)r.onMegolmDecryptionError(e,a,yield r.perSessionBackupDownloader.getServerBackupInfo());else throw new T(U.UNKNOWN_ERROR,"Unknown error")}})()}onMegolmDecryptionError(e,t,r){var s=e.getWireContent(),_={sender_key:s.sender_key,session_id:s.session_id};if(t.code===Z.MissingRoomKey||t.code===Z.UnknownMessageIndex){this.perSessionBackupDownloader.onDecryptionKeyMissingError(e.getRoomId(),s.session_id);var a=e.getMembershipAtEvent();if(a&&a!==Ft.Join&&a!==Ft.Invite)throw new T(U.HISTORICAL_MESSAGE_USER_NOT_JOINED,"This message was sent when we were not a member of the room.",_);if(e.getTs()<=this.olmMachine.deviceCreationTimeMs)throw r===null?new T(U.HISTORICAL_MESSAGE_NO_KEY_BACKUP,"This message was sent before this device logged in, and there is no key backup on the server.",_):this.perSessionBackupDownloader.isKeyBackupDownloadConfigured()?new T(U.HISTORICAL_MESSAGE_WORKING_BACKUP,"This message was sent before this device logged in. Key backup is working, but we still do not (yet) have the key.",_):new T(U.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED,"This message was sent before this device logged in, and key backup is not working.",_)}if(t.maybe_withheld){var c=t.maybe_withheld==="The sender has disabled encrypting to unverified devices."?U.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:U.MEGOLM_KEY_WITHHELD;throw new T(c,t.maybe_withheld,_)}switch(t.code){case Z.MissingRoomKey:throw new T(U.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",_);case Z.UnknownMessageIndex:throw new T(U.OLM_UNKNOWN_MESSAGE_INDEX,"The sender's device has not sent us the keys for this message at this index.",_);case Z.SenderIdentityVerificationViolation:throw this.removeEventFromPendingList(e),new T(U.SENDER_IDENTITY_PREVIOUSLY_VERIFIED,"The sender identity is unverified, but was previously verified.");case Z.UnknownSenderDevice:throw this.removeEventFromPendingList(e),new T(U.UNKNOWN_SENDER_DEVICE,"The sender device is not known.");case Z.UnsignedSenderDevice:throw this.removeEventFromPendingList(e),new T(U.UNSIGNED_SENDER_DEVICE,"The sender identity is not cross-signed.");default:throw new T(U.UNKNOWN_ERROR,t.description,_)}}getEncryptionInfoForEvent(e){var t=this;return u(function*(){if(!e.getClearContent()||e.isDecryptionFailure())return null;if(e.status!==null)return{shieldColour:Mt.NONE,shieldReason:null};var r=yield t.olmMachine.getRoomEventEncryptionInfo(Qo(e),new K(e.getRoomId()));return Ed(t.logger,r)})()}getEventsPendingRoomKey(e,t){var r=this.eventsPendingKey.get(e);if(!r)return[];var s=r.get(t);return s?[...s]:[]}addEventToPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t),s=r.getOrCreate(e.getWireContent().session_id);s.add(e)}}removeEventFromPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t);if(r){var s=r.get(e.getWireContent().session_id);s&&(s.delete(e),s.size===0&&(r.delete(e.getWireContent().session_id),r.size===0&&this.eventsPendingKey.delete(t)))}}}};o(Ss,"EventDecryptor");let Ui=Ss;function Qo(i){return JSON.stringify({event_id:i.getId(),type:i.getWireType(),sender:i.getSender(),state_key:i.getStateKey(),content:i.getWireContent(),origin_server_ts:i.getTs()})}o(Qo,"stringifyEvent");function Ed(i,e){if(e===void 0)return null;var t=e.shieldState(!1),r;switch(t.color){case pi.Grey:r=Mt.GREY;break;case pi.None:r=Mt.NONE;break;default:r=Mt.RED}var s;switch(t.code){case void 0:case null:s=null;break;case X.AuthenticityNotGuaranteed:s=Y.AUTHENTICITY_NOT_GUARANTEED;break;case X.UnknownDevice:s=Y.UNKNOWN_DEVICE;break;case X.UnsignedDevice:s=Y.UNSIGNED_DEVICE;break;case X.UnverifiedIdentity:s=Y.UNVERIFIED_IDENTITY;break;case X.SentInClear:s=Y.SENT_IN_CLEAR;break;case X.VerificationViolation:s=Y.VERIFICATION_VIOLATION;break;case X.MismatchedSender:s=Y.MISMATCHED_SENDER;break;default:s=Y.UNKNOWN;break}return{shieldColour:r,shieldReason:s}}o(Ed,"rustEncryptionInfoToJsEncryptionInfo");function Md(i){return Ti.apply(this,arguments)}o(Md,"migrateFromLegacyCrypto");function Ti(){return Ti=u(function*(i){var e,{logger:t,legacyStore:r}=i;if(yield a_(),!(yield r.containsData()))return;yield r.startup();var s=null;if(yield r.doTxn("readonly",[ft.STORE_ACCOUNT],k=>{r.getAccount(k,I=>{s=I})}),!s){t.debug("Legacy crypto store is not set up (no account found). Not migrating.");return}var _=yield r.getMigrationState();if(_>=x.MEGOLM_SESSIONS_MIGRATED)return;var a=yield qd(t,r),c=yield Fd(t,r),g=1+a+c;t.info("Migrating data from legacy crypto store. ".concat(a," olm sessions and ").concat(c," megolm sessions to migrate."));var p=0;function y(k){var I;p+=k,(I=i.legacyMigrationProgressListener)===null||I===void 0||I.call(i,p,g)}o(y,"onProgress"),y(0);var m=new TextEncoder().encode(i.legacyPickleKey);_===x.NOT_STARTED&&(t.info("Migrating data from legacy crypto store. Step 1: base data"),yield Bd(i.http,i.userId,i.deviceId,r,m,i.storeHandle,t),_=x.INITIAL_DATA_MIGRATED,yield r.setMigrationState(_)),y(1),_===x.INITIAL_DATA_MIGRATED&&(t.info("Migrating data from legacy crypto store. Step 2: olm sessions (".concat(a," sessions to migrate).")),yield Dd(t,r,m,i.storeHandle,y),_=x.OLM_SESSIONS_MIGRATED,yield r.setMigrationState(_)),_===x.OLM_SESSIONS_MIGRATED&&(t.info("Migrating data from legacy crypto store. Step 3: megolm sessions (".concat(c," sessions to migrate).")),yield zd(t,r,m,i.storeHandle,y),_=x.MEGOLM_SESSIONS_MIGRATED,yield r.setMigrationState(_)),(e=i.legacyMigrationProgressListener)===null||e===void 0||e.call(i,-1,-1),t.info("Migration from legacy crypto store complete")}),Ti.apply(this,arguments)}o(Ti,"_migrateFromLegacyCrypto");function Bd(i,e,t,r,s,_,a){return Vi.apply(this,arguments)}o(Bd,"migrateBaseData");function Vi(){return Vi=u(function*(i,e,t,r,s,_,a){var c=new We;c.userId=new h(e),c.deviceId=new O(t),yield r.doTxn("readonly",[ft.STORE_ACCOUNT],Q=>r.getAccount(Q,Me=>{c.pickledAccount=Me??""}));var g=yield Ct(r,s,"m.megolm_backup.v1");if(g){for(var p=!1,y=null;!p;)try{y=yield d_(i),p=!0}catch(Q){a.info("Failed to get backup version during migration, retrying in 2 seconds",Q),yield se(2e3)}if(y&&y.algorithm=="m.megolm_backup.v1.curve25519-aes-sha2")try{var m,k=j.fromBase64(g),I=(m=y.auth_data)===null||m===void 0?void 0:m.public_key,D=k.megolmV1PublicKey.publicKeyBase64==I;D?(c.backupVersion=y.version,c.backupRecoveryKey=g):a.debug("The backup key to migrate does not match the active backup version","Cached pub key: ".concat(k.megolmV1PublicKey.publicKeyBase64),"Active pub key: ".concat(I))}catch(Q){a.warn("Failed to check if the backup key to migrate matches the active backup version",Q)}}c.privateCrossSigningMasterKey=yield Ct(r,s,"master"),c.privateCrossSigningSelfSigningKey=yield Ct(r,s,"self_signing"),c.privateCrossSigningUserSigningKey=yield Ct(r,s,"user_signing"),yield Re.migrateBaseData(c,s,_,a)}),Vi.apply(this,arguments)}o(Vi,"_migrateBaseData");function qd(i,e){return ji.apply(this,arguments)}o(qd,"countOlmSessions");function ji(){return ji=u(function*(i,e){i.debug("Counting olm sessions to be migrated");var t;return yield e.doTxn("readonly",[ft.STORE_SESSIONS],r=>e.countEndToEndSessions(r,s=>t=s)),t}),ji.apply(this,arguments)}o(ji,"_countOlmSessions");function Fd(i,e){return xi.apply(this,arguments)}o(Fd,"countMegolmSessions");function xi(){return xi=u(function*(i,e){return i.debug("Counting megolm sessions to be migrated"),yield e.countEndToEndInboundGroupSessions()}),xi.apply(this,arguments)}o(xi,"_countMegolmSessions");function Dd(i,e,t,r,s){return Pi.apply(this,arguments)}o(Dd,"migrateOlmSessions");function Pi(){return Pi=u(function*(i,e,t,r,s){for(;;){var _=yield e.getEndToEndSessionsBatch();if(_===null)return;i.debug("Migrating batch of ".concat(_.length," olm sessions"));var a=[];for(var c of _){var g=new _t;g.senderKey=c.deviceKey,g.pickle=c.session,g.lastUseTime=g.creationTime=new Date(c.lastReceivedMessageTs),a.push(g)}yield Re.migrateOlmSessions(a,t,r,i),yield e.deleteEndToEndSessionsBatch(_),s(_.length)}}),Pi.apply(this,arguments)}o(Pi,"_migrateOlmSessions");function zd(i,e,t,r,s){return Ai.apply(this,arguments)}o(zd,"migrateMegolmSessions");function Ai(){return Ai=u(function*(i,e,t,r,s){for(;;){var _=yield e.getEndToEndInboundGroupSessionsBatch();if(_===null)return;i.debug("Migrating batch of ".concat(_.length," megolm sessions"));var a=[];for(var c of _){var g,p=c.sessionData,y=new ot;y.pickle=p.session,y.roomId=new K(p.room_id),y.senderKey=c.senderKey,y.senderSigningKey=(g=p.keysClaimed)===null||g===void 0?void 0:g.ed25519,y.backedUp=!c.needsBackup,y.imported=p.untrusted===!0,a.push(y)}yield Re.migrateMegolmSessions(a,t,r,i),yield e.deleteEndToEndInboundGroupSessionsBatch(_),s(_.length)}}),Ai.apply(this,arguments)}o(Ai,"_migrateMegolmSessions");function Ud(i){return Ni.apply(this,arguments)}o(Ud,"migrateRoomSettingsFromLegacyCrypto");function Ni(){return Ni=u(function*(i){var{logger:e,legacyStore:t,olmMachine:r}=i;if(yield t.containsData()){var s=yield t.getMigrationState();if(!(s>=x.ROOM_SETTINGS_MIGRATED)){var _={};yield t.doTxn("readwrite",[ft.STORE_ROOMS],p=>{t.getEndToEndRooms(p,y=>{_=y})}),e.debug("Migrating ".concat(Object.keys(_).length," sets of room settings"));for(var[a,c]of Object.entries(_))try{var g=new ce;if(c.algorithm!=="m.megolm.v1.aes-sha2"){e.warn("Room ".concat(a,": ignoring room with invalid algorithm ").concat(c.algorithm));continue}g.algorithm=be.MegolmV1AesSha2,g.sessionRotationPeriodMs=c.rotation_period_ms,g.sessionRotationPeriodMessages=c.rotation_period_msgs,yield r.setRoomSettings(new K(a),g)}catch(p){e.warn("Room ".concat(a,": ignoring settings ").concat(JSON.stringify(c)," which caused error ").concat(p))}e.debug("Completed room settings migration"),yield t.setMigrationState(x.ROOM_SETTINGS_MIGRATED)}}}),Ni.apply(this,arguments)}o(Ni,"_migrateRoomSettingsFromLegacyCrypto");function Ct(i,e,t){return Li.apply(this,arguments)}o(Ct,"getAndDecryptCachedSecretKey");function Li(){return Li=u(function*(i,e,t){var r=yield new Promise(s=>{i.doTxn("readonly",[ft.STORE_ACCOUNT],_=>{i.getSecretStorePrivateKey(_,s,t)})});return r&&r.ciphertext&&r.iv&&r.mac?yield O_(r,e,t):r instanceof Uint8Array?gi(r):void 0}),Li.apply(this,arguments)}o(Li,"_getAndDecryptCachedSecretKey");function Td(i){return Wi.apply(this,arguments)}o(Td,"migrateLegacyLocalTrustIfNeeded");function Wi(){return Wi=u(function*(i){var{legacyCryptoStore:e,rustCrypto:t,logger:r}=i,s=yield t.getOwnIdentity();if(s&&!s.isVerified()){var _=yield Vd(e);if(_){var a=JSON.parse(s.masterKey);if(!a.keys||Object.keys(a.keys).length===0){r.error("Post Migration | Unexpected error: no master key in the rust session.");return}var c=Object.values(a.keys)[0];c&&c==_&&(r.info("Post Migration: Migrating legacy trusted MSK: ".concat(_," to locally verified.")),yield s.verify())}}}),Wi.apply(this,arguments)}o(Wi,"_migrateLegacyLocalTrustIfNeeded");function Vd(i){return Gi.apply(this,arguments)}o(Vd,"getLegacyTrustedPublicMasterKeyBase64");function Gi(){return Gi=u(function*(i){var e=null;return yield i.doTxn("readonly","account",t=>{i.getCrossSigningKeys(t,r=>{var s=r==null?void 0:r.master;s&&Object.keys(s.keys).length!=0&&(e=Object.values(s.keys)[0])})}),e}),Gi.apply(this,arguments)}o(Gi,"_getLegacyTrustedPublicMasterKeyBase");function Yo(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}o(Yo,"ownKeys");function jd(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Yo(Object(t),!0).forEach(function(r){S(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Yo(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}o(jd,"_objectSpread");function Nd(i){return Ji.apply(this,arguments)}o(Nd,"initRustCrypto");function Ji(){return Ji=u(function*(i){var{logger:e}=i;e.debug("Initialising Rust crypto-sdk WASM artifact"),yield a_(),e.debug("Opening Rust CryptoStore");var t;i.storePrefix?i.storeKey?t=yield A.openWithKey(i.storePrefix,i.storeKey,e):t=yield A.open(i.storePrefix,i.storePassphrase,e):t=yield A.open(null,null,e),i.legacyCryptoStore&&(yield Md(jd({legacyStore:i.legacyCryptoStore,storeHandle:t},i)));var r=yield xd(e,i.http,i.userId,i.deviceId,i.secretStorage,i.cryptoCallbacks,t,i.legacyCryptoStore);return t.free(),e.debug("Completed rust crypto-sdk setup"),r}),Ji.apply(this,arguments)}o(Ji,"_initRustCrypto");function xd(i,e,t,r,s,_,a,c){return Hi.apply(this,arguments)}o(xd,"initOlmMachine");function Hi(){return Hi=u(function*(i,e,t,r,s,_,a,c){i.debug("Init OlmMachine");var g=yield nt.initFromStore(new h(t),new O(r),a,i);c&&(yield Ud({logger:i,legacyStore:c,olmMachine:g})),g.roomKeyRequestsEnabled=!1;var p=new zi(i,g,e,t,r,s,_);if(yield g.registerRoomKeyUpdatedCallback(k=>p.onRoomKeysUpdated(k)),yield g.registerRoomKeysWithheldCallback(k=>p.onRoomKeysWithheld(k)),yield g.registerUserIdentityUpdatedCallback(k=>p.onUserIdentityUpdated(k)),yield g.registerDevicesUpdatedCallback(k=>p.onDevicesUpdated(k)),p.checkSecrets("m.megolm_backup.v1"),yield g.registerReceiveSecretCallback((k,I)=>p.checkSecrets(k)),yield g.outgoingRequests(),c&&(yield c.containsData())){var y=yield c.getMigrationState();if(y<x.INITIAL_OWN_KEY_QUERY_DONE){i.debug("Performing initial key query after migration");for(var m=!1;!m;)try{yield p.userHasCrossSigningKeys(t),m=!0}catch(k){i.error("Failed to check for cross-signing keys after migration, retrying",k)}yield Td({legacyCryptoStore:c,rustCrypto:p,logger:i}),yield c.setMigrationState(x.INITIAL_OWN_KEY_QUERY_DONE)}}return p}),Hi.apply(this,arguments)}o(Hi,"_initOlmMachine");export{Nd as initRustCrypto};
//# sourceMappingURL=index-BWRHc63P.js.map
