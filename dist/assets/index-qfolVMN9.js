var R_=Object.defineProperty;var o=(i,e)=>R_(i,"name",{value:e,configurable:!0});import{b as K_,_ as u,g as I_,a as S,K as Ft,L as Et,l as G,D as zt,E as j,H as mt,T as yt,C,M as O,d as li,e as Un,c as C_,f as E_,s as se,h as Ot,i as n_,j as i_,k as s_,I as De,m as o_,n as je,A as O_,o as M_,p as pi,q as B_,r as D_,U as Bs,t as kt,S as Ds,u as qs,v as jn,w as Fs,x as T,y as U,z as Mt,B as Q,F as ft,G as x,J as q_}from"./index-5aTWFmy-.js";var qe=function(i){return i.Change="change",i}({}),q=function(i){return i[i.Unsent=1]="Unsent",i[i.Requested=2]="Requested",i[i.Ready=3]="Ready",i[i.Started=4]="Started",i[i.Cancelled=5]="Cancelled",i[i.Done=6]="Done",i}({}),__=function(i){return i.Cancel="cancel",i.ShowSas="show_sas",i.ShowReciprocateQr="show_reciprocate_qr",i}({}),Vn=[139,1];function zs(i){var e,t=new Uint8Array(Vn.length+i.length+1);t.set(Vn,0),t.set(i,Vn.length);for(var r=0,s=0;s<t.length-1;++s)r^=t[s];t[t.length-1]=r;var _=K_.encode(t);return(e=_.match(/.{1,4}/g))===null||e===void 0?void 0:e.join(" ")}o(zs,"encodeRecoveryKey");var F_=256;function a_(i,e,t){return wi.apply(this,arguments)}o(a_,"deriveRecoveryKeyFromPassphrase");function wi(){return wi=u(function*(i,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:F_;if(!globalThis.crypto.subtle||!TextEncoder)throw new Error("Password-based backup is not available on this platform");var s=yield globalThis.crypto.subtle.importKey("raw",new TextEncoder().encode(i),{name:"PBKDF2"},!1,["deriveBits"]),_=yield globalThis.crypto.subtle.deriveBits({name:"PBKDF2",salt:new TextEncoder().encode(e),iterations:t,hash:"SHA-512"},s,r);return new Uint8Array(_)}),wi.apply(this,arguments)}o(wi,"_deriveRecoveryKeyFromPassphrase");let n;function Xi(i){n=i}o(Xi,"__wbg_set_wasm");let St=null;function ye(){return(St===null||St.byteLength===0)&&(St=new Uint8Array(n.memory.buffer)),St}o(ye,"getUint8ArrayMemory0");const c_=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let Bt=new c_("utf-8",{ignoreBOM:!0,fatal:!0});Bt.decode();const z_=2146435072;let xn=0;function U_(i,e){return xn+=e,xn>=z_&&(Bt=new c_("utf-8",{ignoreBOM:!0,fatal:!0}),Bt.decode(),xn=e),Bt.decode(ye().subarray(i,i+e))}o(U_,"decodeText");function y(i,e){return i=i>>>0,U_(i,e)}o(y,"getStringFromWasm0");let d=0;const T_=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder,Dt=new T_("utf-8"),j_=typeof Dt.encodeInto=="function"?function(i,e){return Dt.encodeInto(i,e)}:function(i,e){const t=Dt.encode(i);return e.set(t),{read:i.length,written:t.length}};function w(i,e,t){if(t===void 0){const c=Dt.encode(i),g=e(c.length,1)>>>0;return ye().subarray(g,g+c.length).set(c),d=c.length,g}let r=i.length,s=e(r,1)>>>0;const _=ye();let a=0;for(;a<r;a++){const c=i.charCodeAt(a);if(c>127)break;_[s+a]=c}if(a!==r){a!==0&&(i=i.slice(a)),s=t(s,r,r=a+i.length*3,1)>>>0;const c=ye().subarray(s+a,s+r),g=j_(i,c);a+=g.written,s=t(s,r,a,1)>>>0}return d=a,s}o(w,"passStringToWasm0");let ue=null;function B(){return(ue===null||ue.buffer.detached===!0||ue.buffer.detached===void 0&&ue.buffer!==n.memory.buffer)&&(ue=new DataView(n.memory.buffer)),ue}o(B,"getDataViewMemory0");function M(i){const e=n.__externref_table_alloc();return n.__wbindgen_export_4.set(e,i),e}o(M,"addToExternrefTable0");function R(i,e){try{return i.apply(this,e)}catch(t){const r=M(t);n.__wbindgen_exn_store(r)}}o(R,"handleError");function m(i){return i==null}o(m,"isLikeNone");function L(i,e){return i=i>>>0,ye().subarray(i/1,i/1+e)}o(L,"getArrayU8FromWasm0");const Ut=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>{n.__wbindgen_export_6.get(i.dtor)(i.a,i.b)});function es(i,e,t,r){const s={a:i,b:e,cnt:1,dtor:t},_=o((...a)=>{s.cnt++;const c=s.a;s.a=0;try{return r(c,s.b,...a)}finally{--s.cnt===0?(n.__wbindgen_export_6.get(s.dtor)(c,s.b),Ut.unregister(s)):s.a=c}},"real");return _.original=s,Ut.register(_,s,s),_}o(es,"makeMutClosure");function g_(i,e,t,r){const s={a:i,b:e,cnt:1,dtor:t},_=o((...a)=>{s.cnt++;try{return r(s.a,s.b,...a)}finally{--s.cnt===0&&(n.__wbindgen_export_6.get(s.dtor)(s.a,s.b),s.a=0,Ut.unregister(s))}},"real");return _.original=s,Ut.register(_,s,s),_}o(g_,"makeClosure");function bi(i){const e=typeof i;if(e=="number"||e=="boolean"||i==null)return`${i}`;if(e=="string")return`"${i}"`;if(e=="symbol"){const s=i.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){const s=i.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(i)){const s=i.length;let _="[";s>0&&(_+=bi(i[0]));for(let a=1;a<s;a++)_+=", "+bi(i[a]);return _+="]",_}const t=/\[object ([^\]]+)\]/.exec(toString.call(i));let r;if(t&&t.length>1)r=t[1];else return toString.call(i);if(r=="Object")try{return"Object("+JSON.stringify(i)+")"}catch{return"Object"}return i instanceof Error?`${i.name}: ${i.message}
${i.stack}`:r}o(bi,"debugString");function J(i,e){const t=e(i.length*1,1)>>>0;return ye().set(i,t/1),d=i.length,t}o(J,"passArray8ToWasm0");function p(i){const e=n.__wbindgen_export_4.get(i);return n.__externref_table_dealloc(i),e}o(p,"takeFromExternrefTable0");function f(i,e){if(!(i instanceof e))throw new Error(`expected instance of ${e.name}`)}o(f,"_assertClass");function z(i,e){const t=e(i.length*4,4)>>>0;for(let r=0;r<i.length;r++){const s=M(i[r]);B().setUint32(t+4*r,s,!0)}return d=i.length,t}o(z,"passArrayJsValueToWasm0");function Le(i,e){i=i>>>0;const t=B(),r=[];for(let s=i;s<i+4*e;s+=4)r.push(n.__wbindgen_export_4.get(t.getUint32(s,!0)));return n.__externref_drop_slice(i,e),r}o(Le,"getArrayJsValueFromWasm0");let Rt=null;function V_(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Uint16Array(n.memory.buffer)),Rt}o(V_,"getUint16ArrayMemory0");function x_(i,e){return i=i>>>0,V_().subarray(i/2,i/2+e)}o(x_,"getArrayU16FromWasm0");function u_(){const i=n.getVersions();return wr.__wrap(i)}o(u_,"getVersions");function A_(){n.start()}o(A_,"start");function P_(i,e,t){const r=n.closure41_externref_shim_multivalue_shim(i,e,t);if(r[1])throw p(r[0])}o(P_,"__wbg_adapter_58");function N_(i,e){n.wasm_bindgen__convert__closures_____invoke__h8861d869601ff522(i,e)}o(N_,"__wbg_adapter_61");function L_(i,e,t){n.closure756_externref_shim(i,e,t)}o(L_,"__wbg_adapter_64");function W_(i,e,t){n.closure438_externref_shim(i,e,t)}o(W_,"__wbg_adapter_67");function G_(i,e){n.wasm_bindgen__convert__closures_____invoke__hce61fd14ea1a6ce1(i,e)}o(G_,"__wbg_adapter_70");function J_(i,e,t,r){n.closure451_externref_shim(i,e,t,r)}o(J_,"__wbg_adapter_836");const Z=Object.freeze({MissingRoomKey:0,0:"MissingRoomKey",UnknownMessageIndex:1,1:"UnknownMessageIndex",MismatchedIdentityKeys:2,2:"MismatchedIdentityKeys",UnknownSenderDevice:3,3:"UnknownSenderDevice",UnsignedSenderDevice:4,4:"UnsignedSenderDevice",SenderIdentityVerificationViolation:5,5:"SenderIdentityVerificationViolation",UnableToDecrypt:6,6:"UnableToDecrypt",MismatchedSender:7,7:"MismatchedSender"}),H_=Object.freeze({Ed25519:0,0:"Ed25519",Curve25519:1,1:"Curve25519",Unknown:3,3:"Unknown"}),$_=Object.freeze({Curve25519:0,0:"Curve25519",Ed25519:1,1:"Ed25519",Unknown:2,2:"Unknown"}),fe=Object.freeze({OlmV1Curve25519AesSha2:0,0:"OlmV1Curve25519AesSha2",MegolmV1AesSha2:1,1:"MegolmV1AesSha2",Unknown:2,2:"Unknown"}),Fe=Object.freeze({Invited:0,0:"Invited",Joined:1,1:"Joined",Shared:2,2:"Shared",WorldReadable:3,3:"WorldReadable"}),yi=Object.freeze({Verified:0,0:"Verified",BlackListed:1,1:"BlackListed",Ignored:2,2:"Ignored",Unset:3,3:"Unset"}),Y_=Object.freeze({Trace:0,0:"Trace",Debug:1,1:"Debug",Info:2,2:"Info",Warn:3,3:"Warn",Error:4,4:"Error"}),ze=Object.freeze({Decrypted:0,0:"Decrypted",UnableToDecrypt:1,1:"UnableToDecrypt",PlainText:2,2:"PlainText",Invalid:3,3:"Invalid"}),Q_=Object.freeze({Login:0,0:"Login",Reciprocate:1,1:"Reciprocate"}),re=Object.freeze({Created:0,0:"Created",Scanned:1,1:"Scanned",Confirmed:2,2:"Confirmed",Reciprocated:3,3:"Reciprocated",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),Z_=Object.freeze({KeysUpload:0,0:"KeysUpload",KeysQuery:1,1:"KeysQuery",KeysClaim:2,2:"KeysClaim",ToDevice:3,3:"ToDevice",SignatureUpload:4,4:"SignatureUpload",RoomMessage:5,5:"RoomMessage",KeysBackup:6,6:"KeysBackup"}),fi=Object.freeze({Red:0,0:"Red",Grey:1,1:"Grey",None:2,2:"None"}),X=Object.freeze({AuthenticityNotGuaranteed:0,0:"AuthenticityNotGuaranteed",UnknownDevice:1,1:"UnknownDevice",UnsignedDevice:2,2:"UnsignedDevice",UnverifiedIdentity:3,3:"UnverifiedIdentity",SentInClear:4,4:"SentInClear",VerificationViolation:5,5:"VerificationViolation",MismatchedSender:6,6:"MismatchedSender"}),X_=Object.freeze({Missing:0,0:"Missing",Invalid:1,1:"Invalid",ValidButNotTrusted:2,2:"ValidButNotTrusted",ValidAndTrusted:3,3:"ValidAndTrusted"}),ea=Object.freeze({DecryptionFailure:0,0:"DecryptionFailure",UnverifiedSenderDevice:1,1:"UnverifiedSenderDevice",NoOlmMachine:2,2:"NoOlmMachine",EncryptionIsDisabled:3,3:"EncryptionIsDisabled"}),hi=Object.freeze({Untrusted:0,0:"Untrusted",CrossSignedOrLegacy:1,1:"CrossSignedOrLegacy",CrossSigned:2,2:"CrossSigned"}),Ue=Object.freeze({SasV1:0,0:"SasV1",QrCodeScanV1:1,1:"QrCodeScanV1",QrCodeShowV1:2,2:"QrCodeShowV1",ReciprocateV1:3,3:"ReciprocateV1"}),ee=Object.freeze({Created:0,0:"Created",Requested:1,1:"Requested",Ready:2,2:"Ready",Transitioned:3,3:"Transitioned",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),ta=["pending","done"],d_=["readonly","readwrite","versionchange","readwriteflush","cleanup"],ra=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_attachment_free(i>>>0,1)),rs=class rs{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ra.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_attachment_free(e,0)}static encrypt(e){const t=J(e,n.__wbindgen_malloc),r=d,s=n.attachment_encrypt(t,r);if(s[2])throw p(s[1]);return Se.__wrap(s[0])}static decrypt(e){f(e,Se);const t=n.attachment_decrypt(e.__wbg_ptr);if(t[3])throw p(t[2]);var r=L(t[0],t[1]).slice();return n.__wbindgen_free(t[0],t[1]*1,1),r}};o(rs,"Attachment");let vi=rs;const Us=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_backupdecryptionkey_free(i>>>0,1)),de=class de{static __wrap(e){e=e>>>0;const t=Object.create(de.prototype);return t.__wbg_ptr=e,Us.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Us.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupdecryptionkey_free(e,0)}static createRandomKey(){const e=n.backupdecryptionkey_createRandomKey();return de.__wrap(e)}static fromBase64(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.backupdecryptionkey_fromBase64(t,r);if(s[2])throw p(s[1]);return de.__wrap(s[0])}toBase64(){return n.backupdecryptionkey_toBase64(this.__wbg_ptr)}get megolmV1PublicKey(){const e=n.backupdecryptionkey_megolmV1PublicKey(this.__wbg_ptr);return er.__wrap(e)}decryptV1(e,t,r){let s,_;try{const g=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),l=d,b=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),h=d,k=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),I=d,F=n.backupdecryptionkey_decryptV1(this.__wbg_ptr,g,l,b,h,k,I);var a=F[0],c=F[1];if(F[3])throw a=0,c=0,p(F[2]);return s=a,_=c,y(a,c)}finally{n.__wbindgen_free(s,_,1)}}};o(de,"BackupDecryptionKey");let V=de;const Ts=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_backupkeys_free(i>>>0,1)),vr=class vr{static __wrap(e){e=e>>>0;const t=Object.create(vr.prototype);return t.__wbg_ptr=e,Ts.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ts.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupkeys_free(e,0)}get decryptionKey(){const e=n.__wbg_get_backupkeys_decryptionKey(this.__wbg_ptr);return e===0?void 0:V.__wrap(e)}set decryptionKey(e){let t=0;m(e)||(f(e,V),t=e.__destroy_into_raw()),n.__wbg_set_backupkeys_decryptionKey(this.__wbg_ptr,t)}get backupVersion(){const e=n.__wbg_get_backupkeys_backupVersion(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set backupVersion(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupkeys_backupVersion(this.__wbg_ptr,t,r)}get decryptionKeyBase64(){return n.backupkeys_decryptionKeyBase64(this.__wbg_ptr)}};o(vr,"BackupKeys");let Tt=vr;const js=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_backupsecretsbundle_free(i>>>0,1)),mr=class mr{static __wrap(e){e=e>>>0;const t=Object.create(mr.prototype);return t.__wbg_ptr=e,js.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,js.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_backupsecretsbundle_free(e,0)}get key(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_key(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set key(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backup_version(){let e,t;try{const r=n.__wbg_get_backupsecretsbundle_backup_version(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set backup_version(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}};o(mr,"BackupSecretsBundle");let jt=mr;const An=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_base64encodedpkmessage_free(i>>>0,1)),kr=class kr{static __wrap(e){e=e>>>0;const t=Object.create(kr.prototype);return t.__wbg_ptr=e,An.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,An.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_base64encodedpkmessage_free(e,0)}get ciphertext(){let e,t;try{const r=n.__wbg_get_base64encodedpkmessage_ciphertext(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set ciphertext(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get mac(){let e,t;try{const r=n.__wbg_get_base64encodedpkmessage_mac(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set mac(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get ephemeralKey(){let e,t;try{const r=n.__wbg_get_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set ephemeralKey(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr,t,r)}constructor(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),l=d,b=n.base64encodedpkmessage_new(s,_,a,c,g,l);return this.__wbg_ptr=b>>>0,An.register(this,this.__wbg_ptr,this),this}};o(kr,"Base64EncodedPkMessage");let We=kr;const Vs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_basemigrationdata_free(i>>>0,1)),ns=class ns{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_basemigrationdata_free(e,0)}get userId(){const e=n.__wbg_get_basemigrationdata_userId(this.__wbg_ptr);return e===0?void 0:v.__wrap(e)}set userId(e){let t=0;m(e)||(f(e,v),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_userId(this.__wbg_ptr,t)}get deviceId(){const e=n.__wbg_get_basemigrationdata_deviceId(this.__wbg_ptr);return e===0?void 0:E.__wrap(e)}set deviceId(e){let t=0;m(e)||(f(e,E),t=e.__destroy_into_raw()),n.__wbg_set_basemigrationdata_deviceId(this.__wbg_ptr,t)}get pickledAccount(){let e,t;try{const r=n.__wbg_get_basemigrationdata_pickledAccount(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickledAccount(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backupVersion(){const e=n.__wbg_get_basemigrationdata_backupVersion(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set backupVersion(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}get backupRecoveryKey(){const e=n.__wbg_get_basemigrationdata_backupRecoveryKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set backupRecoveryKey(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get privateCrossSigningMasterKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set privateCrossSigningMasterKey(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr,t,r)}get privateCrossSigningSelfSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set privateCrossSigningSelfSigningKey(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr,t,r)}get privateCrossSigningUserSigningKey(){const e=n.__wbg_get_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set privateCrossSigningUserSigningKey(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr,t,r)}constructor(){const e=n.basemigrationdata_new();return this.__wbg_ptr=e>>>0,Vs.register(this,this.__wbg_ptr,this),this}};o(ns,"BaseMigrationData");let Ge=ns;const xs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_cancelinfo_free(i>>>0,1)),Sr=class Sr{static __wrap(e){e=e>>>0;const t=Object.create(Sr.prototype);return t.__wbg_ptr=e,xs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_cancelinfo_free(e,0)}reason(){return n.cancelinfo_reason(this.__wbg_ptr)}cancelCode(){let e,t;try{const r=n.cancelinfo_cancelCode(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}cancelledbyUs(){return n.cancelinfo_cancelledbyUs(this.__wbg_ptr)!==0}};o(Sr,"CancelInfo");let he=Sr;const As=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_checkcode_free(i>>>0,1)),Rr=class Rr{static __wrap(e){e=e>>>0;const t=Object.create(Rr.prototype);return t.__wbg_ptr=e,As.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,As.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_checkcode_free(e,0)}as_bytes(){const e=n.checkcode_as_bytes(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}to_digit(){return n.checkcode_to_digit(this.__wbg_ptr)}};o(Rr,"CheckCode");let Vt=Rr;const Ps=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_collectstrategy_free(i>>>0,1)),N=class N{static __wrap(e){e=e>>>0;const t=Object.create(N.prototype);return t.__wbg_ptr=e,Ps.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ps.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_collectstrategy_free(e,0)}eq(e){return f(e,N),n.collectstrategy_eq(this.__wbg_ptr,e.__wbg_ptr)!==0}static deviceBasedStrategy(e,t){const r=n.collectstrategy_deviceBasedStrategy(e,t);return N.__wrap(r)}static allDevices(){const e=n.collectstrategy_allDevices();return N.__wrap(e)}static errorOnUnverifiedUserProblem(){const e=n.collectstrategy_errorOnUnverifiedUserProblem();return N.__wrap(e)}static identityBasedStrategy(){const e=n.collectstrategy_identityBasedStrategy();return N.__wrap(e)}static onlyTrustedDevices(){const e=n.collectstrategy_onlyTrustedDevices();return N.__wrap(e)}};o(N,"CollectStrategy");let W=N;const Ns=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_crosssigningbootstraprequests_free(i>>>0,1)),Kr=class Kr{static __wrap(e){e=e>>>0;const t=Object.create(Kr.prototype);return t.__wbg_ptr=e,Ns.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ns.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningbootstraprequests_free(e,0)}get uploadKeysRequest(){return n.__wbg_get_crosssigningbootstraprequests_uploadKeysRequest(this.__wbg_ptr)}get uploadSigningKeysRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSigningKeysRequest(this.__wbg_ptr);return bt.__wrap(e)}get uploadSignaturesRequest(){const e=n.__wbg_get_crosssigningbootstraprequests_uploadSignaturesRequest(this.__wbg_ptr);return Oe.__wrap(e)}};o(Kr,"CrossSigningBootstrapRequests");let xt=Kr;const Ls=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_crosssigningkeyexport_free(i>>>0,1)),Ir=class Ir{static __wrap(e){e=e>>>0;const t=Object.create(Ir.prototype);return t.__wbg_ptr=e,Ls.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ls.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningkeyexport_free(e,0)}get masterKey(){const e=n.crosssigningkeyexport_masterKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get self_signing_key(){const e=n.crosssigningkeyexport_self_signing_key(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get userSigningKey(){const e=n.crosssigningkeyexport_userSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}};o(Ir,"CrossSigningKeyExport");let At=Ir;const Ws=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_crosssigningstatus_free(i>>>0,1)),Cr=class Cr{static __wrap(e){e=e>>>0;const t=Object.create(Cr.prototype);return t.__wbg_ptr=e,Ws.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ws.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_crosssigningstatus_free(e,0)}get hasMaster(){return n.crosssigningstatus_hasMaster(this.__wbg_ptr)!==0}get hasSelfSigning(){return n.crosssigningstatus_hasSelfSigning(this.__wbg_ptr)!==0}get hasUserSigning(){return n.crosssigningstatus_hasUserSigning(this.__wbg_ptr)!==0}};o(Cr,"CrossSigningStatus");let Pt=Cr;const Pn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_curve25519publickey_free(i>>>0,1)),Er=class Er{static __wrap(e){e=e>>>0;const t=Object.create(Er.prototype);return t.__wbg_ptr=e,Pn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_curve25519publickey_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.curve25519publickey_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,Pn.register(this,this.__wbg_ptr,this),this}get length(){return n.curve25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=n.curve25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Er,"Curve25519PublicKey");let D=Er;const Gs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_curve25519secretkey_free(i>>>0,1)),ie=class ie{static __wrap(e){e=e>>>0;const t=Object.create(ie.prototype);return t.__wbg_ptr=e,Gs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_curve25519secretkey_free(e,0)}static new(){const e=n.curve25519secretkey_new();return ie.__wrap(e)}static fromBase64(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.curve25519secretkey_fromBase64(t,r);if(s[2])throw p(s[1]);return ie.__wrap(s[0])}toBase64(){let e,t;try{const r=n.curve25519secretkey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}toUint8Array(){const e=n.curve25519secretkey_toUint8Array(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}static fromUint8Array(e){const t=J(e,n.__wbindgen_malloc),r=d,s=n.curve25519secretkey_fromUint8Array(t,r);if(s[2])throw p(s[1]);return ie.__wrap(s[0])}};o(ie,"Curve25519SecretKey");let Je=ie;const Js=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_decryptedroomevent_free(i>>>0,1)),Or=class Or{static __wrap(e){e=e>>>0;const t=Object.create(Or.prototype);return t.__wbg_ptr=e,Js.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Js.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptedroomevent_free(e,0)}get event(){return n.__wbg_get_decryptedroomevent_event(this.__wbg_ptr)}get sender(){const e=n.decryptedroomevent_sender(this.__wbg_ptr);return v.__wrap(e)}get senderDevice(){const e=n.decryptedroomevent_senderDevice(this.__wbg_ptr);return e===0?void 0:E.__wrap(e)}get senderCurve25519Key(){let e,t;try{const r=n.decryptedroomevent_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get senderClaimedEd25519Key(){return n.decryptedroomevent_senderClaimedEd25519Key(this.__wbg_ptr)}get forwardingCurve25519KeyChain(){return n.decryptedroomevent_forwardingCurve25519KeyChain(this.__wbg_ptr)}shieldState(e){const t=n.decryptedroomevent_shieldState(this.__wbg_ptr,e);return dt.__wrap(t)}};o(Or,"DecryptedRoomEvent");let Nt=Or;const Hs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_decryptedtodeviceevent_free(i>>>0,1)),Mr=class Mr{static __wrap(e){e=e>>>0;const t=Object.create(Mr.prototype);return t.__wbg_ptr=e,Hs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Hs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptedtodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_decryptedtodeviceevent_rawEvent(this.__wbg_ptr)}get encryptionInfo(){const e=n.__wbg_get_decryptedtodeviceevent_encryptionInfo(this.__wbg_ptr);return ur.__wrap(e)}get type(){return n.decryptedtodeviceevent_type(this.__wbg_ptr)}};o(Mr,"DecryptedToDeviceEvent");let Lt=Mr;const $s=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_decryptionsettings_free(i>>>0,1)),is=class is{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$s.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_decryptionsettings_free(e,0)}get sender_device_trust_requirement(){return n.__wbg_get_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr)}set sender_device_trust_requirement(e){n.__wbg_set_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr,e)}constructor(e){const t=n.decryptionsettings_new(e);return this.__wbg_ptr=t>>>0,$s.register(this,this.__wbg_ptr,this),this}};o(is,"DecryptionSettings");let oe=is;const Ys=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_dehydrateddevice_free(i>>>0,1)),Br=class Br{static __wrap(e){e=e>>>0;const t=Object.create(Br.prototype);return t.__wbg_ptr=e,Ys.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ys.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevice_free(e,0)}keysForUpload(e,t){return f(t,H),n.dehydrateddevice_keysForUpload(this.__wbg_ptr,e,t.__wbg_ptr)}};o(Br,"DehydratedDevice");let Wt=Br;const Qs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_dehydrateddevicekey_free(i>>>0,1)),le=class le{static __wrap(e){e=e>>>0;const t=Object.create(le.prototype);return t.__wbg_ptr=e,Qs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevicekey_free(e,0)}static createRandomKey(){const e=n.dehydrateddevicekey_createRandomKey();if(e[2])throw p(e[1]);return le.__wrap(e[0])}static createKeyFromArray(e){const t=n.dehydrateddevicekey_createKeyFromArray(e);if(t[2])throw p(t[1]);return le.__wrap(t[0])}toBase64(){return n.dehydrateddevicekey_toBase64(this.__wbg_ptr)}};o(le,"DehydratedDeviceKey");let H=le;const Zs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_dehydrateddevices_free(i>>>0,1)),Dr=class Dr{static __wrap(e){e=e>>>0;const t=Object.create(Dr.prototype);return t.__wbg_ptr=e,Zs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_dehydrateddevices_free(e,0)}create(){return n.dehydrateddevices_create(this.__wbg_ptr)}rehydrate(e,t,r){f(e,H),f(t,E);const s=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;return n.dehydrateddevices_rehydrate(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,s,_)}getDehydratedDeviceKey(){return n.dehydrateddevices_getDehydratedDeviceKey(this.__wbg_ptr)}saveDehydratedDeviceKey(e){return f(e,H),n.dehydrateddevices_saveDehydratedDeviceKey(this.__wbg_ptr,e.__wbg_ptr)}deleteDehydratedDeviceKey(){return n.dehydrateddevices_deleteDehydratedDeviceKey(this.__wbg_ptr)}};o(Dr,"DehydratedDevices");let Gt=Dr;const Xs=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_device_free(i>>>0,1)),qr=class qr{static __wrap(e){e=e>>>0;const t=Object.create(qr.prototype);return t.__wbg_ptr=e,Xs.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xs.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_device_free(e,0)}requestVerification(e){var t=m(e)?0:z(e,n.__wbindgen_malloc),r=d;const s=n.device_requestVerification(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return p(s[0])}encryptToDeviceEvent(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;let a=0;return m(r)||(f(r,W),a=r.__destroy_into_raw()),n.device_encryptToDeviceEvent(this.__wbg_ptr,s,_,t,a)}isVerified(){return n.device_isVerified(this.__wbg_ptr)!==0}isCrossSigningTrusted(){return n.device_isCrossSigningTrusted(this.__wbg_ptr)!==0}isCrossSignedByOwner(){return n.device_isCrossSignedByOwner(this.__wbg_ptr)!==0}setLocalTrust(e){return n.device_setLocalTrust(this.__wbg_ptr,e)}get userId(){const e=n.device_userId(this.__wbg_ptr);return v.__wrap(e)}get deviceId(){const e=n.device_deviceId(this.__wbg_ptr);return E.__wrap(e)}get displayName(){const e=n.device_displayName(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}getKey(e){const t=n.device_getKey(this.__wbg_ptr,e);if(t[2])throw p(t[1]);return t[0]===0?void 0:$e.__wrap(t[0])}get curve25519Key(){const e=n.device_curve25519Key(this.__wbg_ptr);return e===0?void 0:D.__wrap(e)}get ed25519Key(){const e=n.device_ed25519Key(this.__wbg_ptr);return e===0?void 0:_e.__wrap(e)}get keys(){return n.device_keys(this.__wbg_ptr)}get algorithms(){return n.device_algorithms(this.__wbg_ptr)}get signatures(){const e=n.device_signatures(this.__wbg_ptr);return lt.__wrap(e)}get localTrustState(){return n.device_localTrustState(this.__wbg_ptr)}isLocallyTrusted(){return n.device_isLocallyTrusted(this.__wbg_ptr)!==0}isBlacklisted(){return n.device_isBlacklisted(this.__wbg_ptr)!==0}isDeleted(){return n.device_isDeleted(this.__wbg_ptr)!==0}firstTimeSeen(){const e=n.device_firstTimeSeen(this.__wbg_ptr);return BigInt.asUintN(64,e)}verify(){return n.device_verify(this.__wbg_ptr)}get isDehydrated(){return n.device_isDehydrated(this.__wbg_ptr)!==0}};o(qr,"Device");let He=qr;const Nn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_deviceid_free(i>>>0,1)),Fr=class Fr{static __wrap(e){e=e>>>0;const t=Object.create(Fr.prototype);return t.__wbg_ptr=e,Nn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Nn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_deviceid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.deviceid_new(t,r);return this.__wbg_ptr=s>>>0,Nn.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.deviceid_toString(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Fr,"DeviceId");let E=Fr;const eo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicekey_free(i>>>0,1)),zr=class zr{static __wrap(e){e=e>>>0;const t=Object.create(zr.prototype);return t.__wbg_ptr=e,eo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,eo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekey_free(e,0)}get name(){return n.devicekey_name(this.__wbg_ptr)}get curve25519(){const e=n.devicekey_curve25519(this.__wbg_ptr);return e===0?void 0:D.__wrap(e)}get ed25519(){const e=n.devicekey_ed25519(this.__wbg_ptr);return e===0?void 0:_e.__wrap(e)}get unknown(){const e=n.devicekey_unknown(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}toBase64(){let e,t;try{const r=n.devicekey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(zr,"DeviceKey");let $e=zr;const to=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicekeyalgorithm_free(i>>>0,1)),Ur=class Ur{static __wrap(e){e=e>>>0;const t=Object.create(Ur.prototype);return t.__wbg_ptr=e,to.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,to.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyalgorithm_free(e,0)}get name(){return n.devicekeyalgorithm_name(this.__wbg_ptr)}toString(){let e,t;try{const r=n.devicekeyalgorithm_toString(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Ur,"DeviceKeyAlgorithm");let Jt=Ur;const Ln=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicekeyid_free(i>>>0,1)),Tr=class Tr{static __wrap(e){e=e>>>0;const t=Object.create(Tr.prototype);return t.__wbg_ptr=e,Ln.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ln.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicekeyid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.devicekeyid_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,Ln.register(this,this.__wbg_ptr,this),this}get algorithm(){const e=n.devicekeyid_algorithm(this.__wbg_ptr);return Jt.__wrap(e)}get deviceId(){const e=n.devicekeyid_deviceId(this.__wbg_ptr);return E.__wrap(e)}toString(){let e,t;try{const r=n.devicekeyid_toString(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Tr,"DeviceKeyId");let ve=Tr;const ro=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_devicelists_free(i>>>0,1)),ss=class ss{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ro.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_devicelists_free(e,0)}constructor(e,t){var r=m(e)?0:z(e,n.__wbindgen_malloc),s=d,_=m(t)?0:z(t,n.__wbindgen_malloc),a=d;const c=n.devicelists_new(r,s,_,a);if(c[2])throw p(c[1]);return this.__wbg_ptr=c[0]>>>0,ro.register(this,this.__wbg_ptr,this),this}isEmpty(){return n.devicelists_isEmpty(this.__wbg_ptr)!==0}get changed(){const e=n.devicelists_changed(this.__wbg_ptr);var t=Le(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*4,4),t}get left(){const e=n.devicelists_left(this.__wbg_ptr);var t=Le(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*4,4),t}};o(ss,"DeviceLists");let me=ss;const no=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ecies_free(i>>>0,1)),os=class os{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,no.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ecies_free(e,0)}constructor(){const e=n.ecies_new();return this.__wbg_ptr=e>>>0,no.register(this,this.__wbg_ptr,this),this}public_key(){const e=n.ecies_public_key(this.__wbg_ptr);return D.__wrap(e)}establish_inbound_channel(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.ecies_establish_inbound_channel(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return Qt.__wrap(s[0])}establish_outbound_channel(e,t){f(e,D);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.ecies_establish_outbound_channel(this.__wbg_ptr,e.__wbg_ptr,r,s);if(_[2])throw p(_[1]);return tr.__wrap(_[0])}};o(os,"Ecies");let mi=os;const io=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ed25519publickey_free(i>>>0,1)),jr=class jr{static __wrap(e){e=e>>>0;const t=Object.create(jr.prototype);return t.__wbg_ptr=e,io.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,io.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519publickey_free(e,0)}get length(){return n.ed25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=n.ed25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(jr,"Ed25519PublicKey");let _e=jr;const Wn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ed25519signature_free(i>>>0,1)),Vr=class Vr{static __wrap(e){e=e>>>0;const t=Object.create(Vr.prototype);return t.__wbg_ptr=e,Wn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ed25519signature_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.ed25519signature_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,Wn.register(this,this.__wbg_ptr,this),this}toBase64(){let e,t;try{const r=n.ed25519signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Vr,"Ed25519Signature");let ke=Vr;const so=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_emoji_free(i>>>0,1)),xr=class xr{static __wrap(e){e=e>>>0;const t=Object.create(xr.prototype);return t.__wbg_ptr=e,so.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,so.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_emoji_free(e,0)}get symbol(){return n.emoji_symbol(this.__wbg_ptr)}get description(){return n.emoji_description(this.__wbg_ptr)}};o(xr,"Emoji");let Ht=xr;const Gn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_encryptedattachment_free(i>>>0,1)),Ar=class Ar{static __wrap(e){e=e>>>0;const t=Object.create(Ar.prototype);return t.__wbg_ptr=e,Gn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptedattachment_free(e,0)}constructor(e,t){const r=J(e,n.__wbindgen_malloc),s=d,_=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d,c=n.encryptedattachment_new(r,s,_,a);if(c[2])throw p(c[1]);return this.__wbg_ptr=c[0]>>>0,Gn.register(this,this.__wbg_ptr,this),this}get encryptedData(){const e=n.encryptedattachment_encryptedData(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}get mediaEncryptionInfo(){const e=n.encryptedattachment_mediaEncryptionInfo(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get hasMediaEncryptionInfoBeenConsumed(){return n.encryptedattachment_hasMediaEncryptionInfoBeenConsumed(this.__wbg_ptr)!==0}};o(Ar,"EncryptedAttachment");let Se=Ar;const oo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_encryptioninfo_free(i>>>0,1)),Pr=class Pr{static __wrap(e){e=e>>>0;const t=Object.create(Pr.prototype);return t.__wbg_ptr=e,oo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptioninfo_free(e,0)}get sender(){const e=n.__wbg_get_encryptioninfo_sender(this.__wbg_ptr);return v.__wrap(e)}set sender(e){f(e,v);var t=e.__destroy_into_raw();n.__wbg_set_encryptioninfo_sender(this.__wbg_ptr,t)}get senderDevice(){const e=n.__wbg_get_encryptioninfo_senderDevice(this.__wbg_ptr);return e===0?void 0:E.__wrap(e)}set senderDevice(e){let t=0;m(e)||(f(e,E),t=e.__destroy_into_raw()),n.__wbg_set_encryptioninfo_senderDevice(this.__wbg_ptr,t)}get senderCurve25519Key(){let e,t;try{const r=n.__wbg_get_encryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderCurve25519Key(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderClaimedEd25519Key(){const e=n.__wbg_get_encryptioninfo_senderClaimedEd25519Key(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set senderClaimedEd25519Key(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}shieldState(e){const t=n.encryptioninfo_shieldState(this.__wbg_ptr,e);return dt.__wrap(t)}};o(Pr,"EncryptionInfo");let $t=Pr;const _o=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_encryptionsettings_free(i>>>0,1)),_s=class _s{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_o.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_encryptionsettings_free(e,0)}get algorithm(){return n.__wbg_get_encryptionsettings_algorithm(this.__wbg_ptr)}set algorithm(e){n.__wbg_set_encryptionsettings_algorithm(this.__wbg_ptr,e)}get encryptStateEvents(){return n.__wbg_get_encryptionsettings_encryptStateEvents(this.__wbg_ptr)!==0}set encryptStateEvents(e){n.__wbg_set_encryptionsettings_encryptStateEvents(this.__wbg_ptr,e)}get rotationPeriod(){const e=n.__wbg_get_encryptionsettings_rotationPeriod(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriod(e){n.__wbg_set_encryptionsettings_rotationPeriod(this.__wbg_ptr,e)}get rotationPeriodMessages(){const e=n.__wbg_get_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriodMessages(e){n.__wbg_set_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr,e)}get historyVisibility(){return n.__wbg_get_encryptionsettings_historyVisibility(this.__wbg_ptr)}set historyVisibility(e){n.__wbg_set_encryptionsettings_historyVisibility(this.__wbg_ptr,e)}get sharingStrategy(){const e=n.__wbg_get_encryptionsettings_sharingStrategy(this.__wbg_ptr);return W.__wrap(e)}set sharingStrategy(e){f(e,W);var t=e.__destroy_into_raw();n.__wbg_set_encryptionsettings_sharingStrategy(this.__wbg_ptr,t)}constructor(){const e=n.encryptionsettings_new();return this.__wbg_ptr=e>>>0,_o.register(this,this.__wbg_ptr,this),this}};o(_s,"EncryptionSettings");let Ye=_s;const ao=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_establishedecies_free(i>>>0,1)),Nr=class Nr{static __wrap(e){e=e>>>0;const t=Object.create(Nr.prototype);return t.__wbg_ptr=e,ao.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ao.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_establishedecies_free(e,0)}public_key(){const e=n.establishedecies_public_key(this.__wbg_ptr);return D.__wrap(e)}encrypt(e){let t,r;try{const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=n.establishedecies_encrypt(this.__wbg_ptr,s,_);return t=a[0],r=a[1],y(a[0],a[1])}finally{n.__wbindgen_free(t,r,1)}}decrypt(e){let t,r;try{const a=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=n.establishedecies_decrypt(this.__wbg_ptr,a,c);var s=g[0],_=g[1];if(g[3])throw s=0,_=0,p(g[2]);return t=s,r=_,y(s,_)}finally{n.__wbindgen_free(t,r,1)}}check_code(){const e=n.establishedecies_check_code(this.__wbg_ptr);return Vt.__wrap(e)}};o(Nr,"EstablishedEcies");let ae=Nr;const co=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_eventid_free(i>>>0,1)),as=class as{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,co.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_eventid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.eventid_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,co.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.eventid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.eventid_serverName(this.__wbg_ptr);return e===0?void 0:ut.__wrap(e)}toString(){let e,t;try{const r=n.eventid_toString(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(as,"EventId");let Qe=as;const go=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_identitykeys_free(i>>>0,1)),Lr=class Lr{static __wrap(e){e=e>>>0;const t=Object.create(Lr.prototype);return t.__wbg_ptr=e,go.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,go.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_identitykeys_free(e,0)}get ed25519(){const e=n.__wbg_get_identitykeys_ed25519(this.__wbg_ptr);return _e.__wrap(e)}set ed25519(e){f(e,_e);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_ed25519(this.__wbg_ptr,t)}get curve25519(){const e=n.__wbg_get_identitykeys_curve25519(this.__wbg_ptr);return D.__wrap(e)}set curve25519(e){f(e,D);var t=e.__destroy_into_raw();n.__wbg_set_identitykeys_curve25519(this.__wbg_ptr,t)}};o(Lr,"IdentityKeys");let Yt=Lr;const uo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_inboundcreationresult_free(i>>>0,1)),Wr=class Wr{static __wrap(e){e=e>>>0;const t=Object.create(Wr.prototype);return t.__wbg_ptr=e,uo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,uo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return ae.__wrap(e)}set channel(e){f(e,ae);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get message(){let e,t;try{const r=n.__wbg_get_inboundcreationresult_message(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set message(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}};o(Wr,"InboundCreationResult");let Qt=Wr;const lo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_inboundgroupsession_free(i>>>0,1)),Gr=class Gr{static __wrap(e){e=e>>>0;const t=Object.create(Gr.prototype);return t.__wbg_ptr=e,lo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_inboundgroupsession_free(e,0)}get roomId(){const e=n.inboundgroupsession_roomId(this.__wbg_ptr);return K.__wrap(e)}get senderKey(){const e=n.inboundgroupsession_senderKey(this.__wbg_ptr);return D.__wrap(e)}get sessionId(){let e,t;try{const r=n.inboundgroupsession_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}hasBeenImported(){return n.inboundgroupsession_hasBeenImported(this.__wbg_ptr)!==0}};o(Gr,"InboundGroupSession");let Zt=Gr;const po=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_invalidtodeviceevent_free(i>>>0,1)),Jr=class Jr{static __wrap(e){e=e>>>0;const t=Object.create(Jr.prototype);return t.__wbg_ptr=e,po.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,po.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_invalidtodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_invalidtodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return n.invalidtodeviceevent_type(this.__wbg_ptr)}};o(Jr,"InvalidToDeviceEvent");let Xt=Jr;const Jn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysbackuprequest_free(i>>>0,1)),Hr=class Hr{static __wrap(e){e=e>>>0;const t=Object.create(Hr.prototype);return t.__wbg_ptr=e,Jn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Jn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysbackuprequest_free(e,0)}get id(){return n.__wbg_get_keysbackuprequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysbackuprequest_body(this.__wbg_ptr)}get version(){return n.__wbg_get_keysbackuprequest_version(this.__wbg_ptr)}constructor(e,t,r){const s=n.keysbackuprequest_new(e,t,r);return this.__wbg_ptr=s>>>0,Jn.register(this,this.__wbg_ptr,this),this}get type(){return n.keysbackuprequest_type(this.__wbg_ptr)}};o(Hr,"KeysBackupRequest");let Ze=Hr;const Hn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysclaimrequest_free(i>>>0,1)),$r=class $r{static __wrap(e){e=e>>>0;const t=Object.create($r.prototype);return t.__wbg_ptr=e,Hn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Hn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysclaimrequest_free(e,0)}get id(){return n.__wbg_get_keysclaimrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysclaimrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysclaimrequest_new(e,t);return this.__wbg_ptr=r>>>0,Hn.register(this,this.__wbg_ptr,this),this}get type(){return n.keysclaimrequest_type(this.__wbg_ptr)}};o($r,"KeysClaimRequest");let Xe=$r;const $n=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysqueryrequest_free(i>>>0,1)),Yr=class Yr{static __wrap(e){e=e>>>0;const t=Object.create(Yr.prototype);return t.__wbg_ptr=e,$n.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$n.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysqueryrequest_free(e,0)}get id(){return n.__wbg_get_keysqueryrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysqueryrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysqueryrequest_new(e,t);return this.__wbg_ptr=r>>>0,$n.register(this,this.__wbg_ptr,this),this}get type(){return n.keysqueryrequest_type(this.__wbg_ptr)}};o(Yr,"KeysQueryRequest");let Re=Yr;const Yn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_keysuploadrequest_free(i>>>0,1)),Qr=class Qr{static __wrap(e){e=e>>>0;const t=Object.create(Qr.prototype);return t.__wbg_ptr=e,Yn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Yn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_keysuploadrequest_free(e,0)}get id(){return n.__wbg_get_keysuploadrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_keysuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.keysuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Yn.register(this,this.__wbg_ptr,this),this}get type(){return n.keysuploadrequest_type(this.__wbg_ptr)}};o(Qr,"KeysUploadRequest");let et=Qr;const wo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_maybesignature_free(i>>>0,1)),Zr=class Zr{static __wrap(e){e=e>>>0;const t=Object.create(Zr.prototype);return t.__wbg_ptr=e,wo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_maybesignature_free(e,0)}isValid(){return n.maybesignature_isValid(this.__wbg_ptr)!==0}isInvalid(){return n.maybesignature_isInvalid(this.__wbg_ptr)!==0}get signature(){const e=n.maybesignature_signature(this.__wbg_ptr);return e===0?void 0:cr.__wrap(e)}get invalidSignatureSource(){const e=n.maybesignature_invalidSignatureSource(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}};o(Zr,"MaybeSignature");let tt=Zr;const bo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_megolmdecryptionerror_free(i>>>0,1)),Xr=class Xr{static __wrap(e){e=e>>>0;const t=Object.create(Xr.prototype);return t.__wbg_ptr=e,bo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmdecryptionerror_free(e,0)}get code(){return n.__wbg_get_megolmdecryptionerror_code(this.__wbg_ptr)}get description(){return n.__wbg_get_megolmdecryptionerror_description(this.__wbg_ptr)}get maybe_withheld(){return n.__wbg_get_megolmdecryptionerror_maybe_withheld(this.__wbg_ptr)}};o(Xr,"MegolmDecryptionError");let rt=Xr;const yo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_megolmv1backupkey_free(i>>>0,1)),en=class en{static __wrap(e){e=e>>>0;const t=Object.create(en.prototype);return t.__wbg_ptr=e,yo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_megolmv1backupkey_free(e,0)}get publicKeyBase64(){return n.megolmv1backupkey_publicKeyBase64(this.__wbg_ptr)}get algorithm(){return n.megolmv1backupkey_algorithm(this.__wbg_ptr)}};o(en,"MegolmV1BackupKey");let er=en;const na=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_migration_free(i>>>0,1)),cs=class cs{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,na.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_migration_free(e,0)}static migrateBaseData(e,t,r,s){return f(e,Ge),f(r,P),n.migration_migrateBaseData(e.__wbg_ptr,t,r.__wbg_ptr,m(s)?0:M(s))}static migrateOlmSessions(e,t,r,s){const _=z(e,n.__wbindgen_malloc),a=d;f(r,P);const c=n.migration_migrateOlmSessions(_,a,t,r.__wbg_ptr,m(s)?0:M(s));if(c[2])throw p(c[1]);return p(c[0])}static migrateMegolmSessions(e,t,r,s){const _=z(e,n.__wbindgen_malloc),a=d;f(r,P);const c=n.migration_migrateMegolmSessions(_,a,t,r.__wbg_ptr,m(s)?0:M(s));if(c[2])throw p(c[1]);return p(c[0])}};o(cs,"Migration");let Ke=cs;const Qn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_olmmachine_free(i>>>0,1)),tn=class tn{static __wrap(e){e=e>>>0;const t=Object.create(tn.prototype);return t.__wbg_ptr=e,Qn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_olmmachine_free(e,0)}constructor(){const e=n.olmmachine_new();if(e[2])throw p(e[1]);return this.__wbg_ptr=e[0]>>>0,Qn.register(this,this.__wbg_ptr,this),this}static initialize(e,t,r,s,_){f(e,v),f(t,E);var a=m(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=m(s)?0:w(s,n.__wbindgen_malloc,n.__wbindgen_realloc),l=d;return n.olmmachine_initialize(e.__wbg_ptr,t.__wbg_ptr,a,c,g,l,m(_)?0:M(_))}static initFromStore(e,t,r,s){return f(e,v),f(t,E),f(r,P),n.olmmachine_initFromStore(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,m(s)?0:M(s))}get userId(){const e=n.olmmachine_userId(this.__wbg_ptr);return v.__wrap(e)}get deviceId(){const e=n.olmmachine_deviceId(this.__wbg_ptr);return E.__wrap(e)}get deviceCreationTimeMs(){return n.olmmachine_deviceCreationTimeMs(this.__wbg_ptr)}get identityKeys(){const e=n.olmmachine_identityKeys(this.__wbg_ptr);return Yt.__wrap(e)}get displayName(){return n.olmmachine_displayName(this.__wbg_ptr)}get roomKeyRequestsEnabled(){return n.olmmachine_roomKeyRequestsEnabled(this.__wbg_ptr)!==0}set roomKeyRequestsEnabled(e){n.olmmachine_set_roomKeyRequestsEnabled(this.__wbg_ptr,e)}get roomKeyForwardingEnabled(){return n.olmmachine_roomKeyForwardingEnabled(this.__wbg_ptr)!==0}set roomKeyForwardingEnabled(e){n.olmmachine_set_roomKeyForwardingEnabled(this.__wbg_ptr,e)}trackedUsers(){const e=n.olmmachine_trackedUsers(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}updateTrackedUsers(e){const t=z(e,n.__wbindgen_malloc),r=d;return n.olmmachine_updateTrackedUsers(this.__wbg_ptr,t,r)}markAllTrackedUsersAsDirty(){return n.olmmachine_markAllTrackedUsersAsDirty(this.__wbg_ptr)}receiveSyncChanges(e,t,r,s,_){const a=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d;f(t,me);let g=0;m(_)||(f(_,oe),g=_.__destroy_into_raw());const l=n.olmmachine_receiveSyncChanges(this.__wbg_ptr,a,c,t.__wbg_ptr,r,m(s)?0:M(s),g);if(l[2])throw p(l[1]);return p(l[0])}outgoingRequests(){return n.olmmachine_outgoingRequests(this.__wbg_ptr)}markRequestAsSent(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=n.olmmachine_markRequestAsSent(this.__wbg_ptr,s,_,t,a,c);if(g[2])throw p(g[1]);return p(g[0])}encryptRoomEvent(e,t,r){f(e,K);const s=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=n.olmmachine_encryptRoomEvent(this.__wbg_ptr,e.__wbg_ptr,s,_,a,c);if(g[2])throw p(g[1]);return p(g[0])}encryptStateEvent(e,t,r,s){f(e,K);const _=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d,c=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),g=d,l=w(s,n.__wbindgen_malloc,n.__wbindgen_realloc),b=d,h=n.olmmachine_encryptStateEvent(this.__wbg_ptr,e.__wbg_ptr,_,a,c,g,l,b);if(h[2])throw p(h[1]);return p(h[0])}decryptRoomEvent(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;f(t,K),f(r,oe);const a=n.olmmachine_decryptRoomEvent(this.__wbg_ptr,s,_,t.__wbg_ptr,r.__wbg_ptr);if(a[2])throw p(a[1]);return p(a[0])}getRoomEventEncryptionInfo(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;f(t,K);const _=n.olmmachine_getRoomEventEncryptionInfo(this.__wbg_ptr,r,s,t.__wbg_ptr);if(_[2])throw p(_[1]);return p(_[0])}crossSigningStatus(){return n.olmmachine_crossSigningStatus(this.__wbg_ptr)}exportSecretsBundle(){return n.olmmachine_exportSecretsBundle(this.__wbg_ptr)}importSecretsBundle(e){f(e,Ee);var t=e.__destroy_into_raw();return n.olmmachine_importSecretsBundle(this.__wbg_ptr,t)}exportCrossSigningKeys(){return n.olmmachine_exportCrossSigningKeys(this.__wbg_ptr)}importCrossSigningKeys(e,t,r){var s=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=m(t)?0:w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d,g=m(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),l=d;return n.olmmachine_importCrossSigningKeys(this.__wbg_ptr,s,_,a,c,g,l)}bootstrapCrossSigning(e){return n.olmmachine_bootstrapCrossSigning(this.__wbg_ptr,e)}getIdentity(e){return f(e,v),n.olmmachine_getIdentity(this.__wbg_ptr,e.__wbg_ptr)}sign(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.olmmachine_sign(this.__wbg_ptr,t,r)}invalidateGroupSession(e){return f(e,K),n.olmmachine_invalidateGroupSession(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKey(e,t,r){f(e,K);const s=z(t,n.__wbindgen_malloc),_=d;return f(r,Ye),n.olmmachine_shareRoomKey(this.__wbg_ptr,e.__wbg_ptr,s,_,r.__wbg_ptr)}queryKeysForUsers(e){const t=z(e,n.__wbindgen_malloc),r=d,s=n.olmmachine_queryKeysForUsers(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return Re.__wrap(s[0])}getMissingSessions(e){const t=z(e,n.__wbindgen_malloc),r=d;return n.olmmachine_getMissingSessions(this.__wbg_ptr,t,r)}getUserDevices(e,t){return f(e,v),n.olmmachine_getUserDevices(this.__wbg_ptr,e.__wbg_ptr,!m(t),m(t)?0:t)}getDevice(e,t,r){return f(e,v),f(t,E),n.olmmachine_getDevice(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,!m(r),m(r)?0:r)}getVerification(e,t){f(e,v);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_getVerification(this.__wbg_ptr,e.__wbg_ptr,r,s);if(_[2])throw p(_[1]);return p(_[0])}getVerificationRequest(e,t){f(e,v);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_getVerificationRequest(this.__wbg_ptr,e.__wbg_ptr,r,s);return _===0?void 0:Me.__wrap(_)}getVerificationRequests(e){return f(e,v),n.olmmachine_getVerificationRequests(this.__wbg_ptr,e.__wbg_ptr)}receiveVerificationEvent(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;f(t,K);const _=n.olmmachine_receiveVerificationEvent(this.__wbg_ptr,r,s,t.__wbg_ptr);if(_[2])throw p(_[1]);return p(_[0])}exportRoomKeys(e){return n.olmmachine_exportRoomKeys(this.__wbg_ptr,e)}importRoomKeys(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_importRoomKeys(this.__wbg_ptr,r,s,t);if(_[2])throw p(_[1]);return p(_[0])}importExportedRoomKeys(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=n.olmmachine_importExportedRoomKeys(this.__wbg_ptr,r,s,t);if(_[2])throw p(_[1]);return p(_[0])}importBackedUpRoomKeys(e,t,r){const s=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=n.olmmachine_importBackedUpRoomKeys(this.__wbg_ptr,e,m(t)?0:M(t),s,_);if(a[2])throw p(a[1]);return p(a[0])}saveBackupDecryptionKey(e,t){f(e,V);const r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;return n.olmmachine_saveBackupDecryptionKey(this.__wbg_ptr,e.__wbg_ptr,r,s)}getBackupKeys(){return n.olmmachine_getBackupKeys(this.__wbg_ptr)}verifyBackup(e){const t=n.olmmachine_verifyBackup(this.__wbg_ptr,e);if(t[2])throw p(t[1]);return p(t[0])}enableBackupV1(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d,_=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d,c=n.olmmachine_enableBackupV1(this.__wbg_ptr,r,s,_,a);if(c[2])throw p(c[1]);return p(c[0])}isBackupEnabled(){return n.olmmachine_isBackupEnabled(this.__wbg_ptr)}disableBackup(){return n.olmmachine_disableBackup(this.__wbg_ptr)}backupRoomKeys(){return n.olmmachine_backupRoomKeys(this.__wbg_ptr)}roomKeyCounts(){return n.olmmachine_roomKeyCounts(this.__wbg_ptr)}static encryptExportedRoomKeys(e,t,r){let s,_;try{const g=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),l=d,b=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),h=d,k=n.olmmachine_encryptExportedRoomKeys(g,l,b,h,r);var a=k[0],c=k[1];if(k[3])throw a=0,c=0,p(k[2]);return s=a,_=c,y(a,c)}finally{n.__wbindgen_free(s,_,1)}}static decryptExportedRoomKeys(e,t){let r,s;try{const c=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),g=d,l=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),b=d,h=n.olmmachine_decryptExportedRoomKeys(c,g,l,b);var _=h[0],a=h[1];if(h[3])throw _=0,a=0,p(h[2]);return r=_,s=a,y(_,a)}finally{n.__wbindgen_free(r,s,1)}}registerRoomKeyUpdatedCallback(e){n.olmmachine_registerRoomKeyUpdatedCallback(this.__wbg_ptr,e)}registerRoomKeysWithheldCallback(e){n.olmmachine_registerRoomKeysWithheldCallback(this.__wbg_ptr,e)}registerUserIdentityUpdatedCallback(e){n.olmmachine_registerUserIdentityUpdatedCallback(this.__wbg_ptr,e)}registerDevicesUpdatedCallback(e){n.olmmachine_registerDevicesUpdatedCallback(this.__wbg_ptr,e)}registerReceiveSecretCallback(e){n.olmmachine_registerReceiveSecretCallback(this.__wbg_ptr,e)}getSecretsFromInbox(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.olmmachine_getSecretsFromInbox(this.__wbg_ptr,t,r)}deleteSecretsFromInbox(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;return n.olmmachine_deleteSecretsFromInbox(this.__wbg_ptr,t,r)}requestMissingSecretsIfNeeded(){return n.olmmachine_requestMissingSecretsIfNeeded(this.__wbg_ptr)}getRoomSettings(e){return f(e,K),n.olmmachine_getRoomSettings(this.__wbg_ptr,e.__wbg_ptr)}setRoomSettings(e,t){return f(e,K),f(t,ge),n.olmmachine_setRoomSettings(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}dehydratedDevices(){const e=n.olmmachine_dehydratedDevices(this.__wbg_ptr);return Gt.__wrap(e)}buildRoomKeyBundle(e){return f(e,K),n.olmmachine_buildRoomKeyBundle(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKeyBundleData(e,t,r,s,_){f(e,v),f(t,K);const a=w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d;var g=m(s)?0:w(s,n.__wbindgen_malloc,n.__wbindgen_realloc),l=d;f(_,W);var b=_.__destroy_into_raw();const h=n.olmmachine_shareRoomKeyBundleData(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,a,c,g,l,b);if(h[2])throw p(h[1]);return p(h[0])}getReceivedRoomKeyBundleData(e,t){return f(e,K),f(t,v),n.olmmachine_getReceivedRoomKeyBundleData(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}receiveRoomKeyBundle(e,t){f(e,pt);var r=e.__destroy_into_raw();const s=J(t,n.__wbindgen_malloc),_=d,a=n.olmmachine_receiveRoomKeyBundle(this.__wbg_ptr,r,s,_);if(a[2])throw p(a[1]);return p(a[0])}close(){const e=this.__destroy_into_raw();n.olmmachine_close(e)}};o(tn,"OlmMachine");let nt=tn;const fo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_otheruseridentity_free(i>>>0,1)),rn=class rn{static __wrap(e){e=e>>>0;const t=Object.create(rn.prototype);return t.__wbg_ptr=e,fo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_otheruseridentity_free(e,0)}isVerified(){return n.otheruseridentity_isVerified(this.__wbg_ptr)!==0}verify(){return n.otheruseridentity_verify(this.__wbg_ptr)}requestVerification(e,t,r){f(e,K),f(t,Qe);var s=m(r)?0:z(r,n.__wbindgen_malloc),_=d;const a=n.otheruseridentity_requestVerification(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,s,_);if(a[2])throw p(a[1]);return Me.__wrap(a[0])}verificationRequestContent(e){let t,r;try{var s=m(e)?0:z(e,n.__wbindgen_malloc),_=d;const g=n.otheruseridentity_verificationRequestContent(this.__wbg_ptr,s,_);var a=g[0],c=g[1];if(g[3])throw a=0,c=0,p(g[2]);return t=a,r=c,y(a,c)}finally{n.__wbindgen_free(t,r,1)}}get masterKey(){let e,t;try{const _=n.otheruseridentity_masterKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,p(_[2]);return e=r,t=s,y(r,s)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const _=n.otheruseridentity_selfSigningKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,p(_[2]);return e=r,t=s,y(r,s)}finally{n.__wbindgen_free(e,t,1)}}pinCurrentMasterKey(){return n.otheruseridentity_pinCurrentMasterKey(this.__wbg_ptr)}identityNeedsUserApproval(){return n.otheruseridentity_identityNeedsUserApproval(this.__wbg_ptr)!==0}wasPreviouslyVerified(){return n.otheruseridentity_wasPreviouslyVerified(this.__wbg_ptr)!==0}withdrawVerification(){return n.otheruseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return n.otheruseridentity_hasVerificationViolation(this.__wbg_ptr)!==0}};o(rn,"OtherUserIdentity");let it=rn;const ho=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_outboundcreationresult_free(i>>>0,1)),nn=class nn{static __wrap(e){e=e>>>0;const t=Object.create(nn.prototype);return t.__wbg_ptr=e,ho.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ho.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_outboundcreationresult_free(e,0)}get channel(){const e=n.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return ae.__wrap(e)}set channel(e){f(e,ae);var t=e.__destroy_into_raw();n.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get initial_message(){let e,t;try{const r=n.__wbg_get_outboundcreationresult_initial_message(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set initial_message(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}};o(nn,"OutboundCreationResult");let tr=nn;const vo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_ownuseridentity_free(i>>>0,1)),sn=class sn{static __wrap(e){e=e>>>0;const t=Object.create(sn.prototype);return t.__wbg_ptr=e,vo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_ownuseridentity_free(e,0)}isVerified(){return n.ownuseridentity_isVerified(this.__wbg_ptr)!==0}verify(){return n.ownuseridentity_verify(this.__wbg_ptr)}requestVerification(e){var t=m(e)?0:z(e,n.__wbindgen_malloc),r=d;const s=n.ownuseridentity_requestVerification(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return p(s[0])}trustsOurOwnDevice(){return n.ownuseridentity_trustsOurOwnDevice(this.__wbg_ptr)}get masterKey(){let e,t;try{const _=n.ownuseridentity_masterKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,p(_[2]);return e=r,t=s,y(r,s)}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const _=n.ownuseridentity_selfSigningKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,p(_[2]);return e=r,t=s,y(r,s)}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const _=n.ownuseridentity_userSigningKey(this.__wbg_ptr);var r=_[0],s=_[1];if(_[3])throw r=0,s=0,p(_[2]);return e=r,t=s,y(r,s)}finally{n.__wbindgen_free(e,t,1)}}wasPreviouslyVerified(){return n.ownuseridentity_wasPreviouslyVerified(this.__wbg_ptr)!==0}withdrawVerification(){return n.ownuseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return n.ownuseridentity_hasVerificationViolation(this.__wbg_ptr)!==0}};o(sn,"OwnUserIdentity");let st=sn;const mo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pickledinboundgroupsession_free(i>>>0,1)),on=class on{static __unwrap(e){return e instanceof on?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledinboundgroupsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledinboundgroupsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get senderSigningKey(){const e=n.__wbg_get_pickledinboundgroupsession_senderSigningKey(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}set senderSigningKey(e){var t=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get roomId(){const e=n.__wbg_get_pickledinboundgroupsession_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}set roomId(e){let t=0;m(e)||(f(e,K),t=e.__destroy_into_raw()),n.__wbg_set_pickledinboundgroupsession_roomId(this.__wbg_ptr,t)}get imported(){return n.__wbg_get_pickledinboundgroupsession_imported(this.__wbg_ptr)!==0}set imported(e){n.__wbg_set_pickledinboundgroupsession_imported(this.__wbg_ptr,e)}get backedUp(){return n.__wbg_get_pickledinboundgroupsession_backedUp(this.__wbg_ptr)!==0}set backedUp(e){n.__wbg_set_pickledinboundgroupsession_backedUp(this.__wbg_ptr,e)}constructor(){const e=n.pickledinboundgroupsession_new();return this.__wbg_ptr=e>>>0,mo.register(this,this.__wbg_ptr,this),this}};o(on,"PickledInboundGroupSession");let ot=on;const ko=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pickledsession_free(i>>>0,1)),_n=class _n{static __unwrap(e){return e instanceof _n?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ko.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pickledsession_free(e,0)}get pickle(){let e,t;try{const r=n.__wbg_get_pickledsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set pickle(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=n.__wbg_get_pickledsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderKey(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get createdUsingFallbackKey(){return n.__wbg_get_pickledsession_createdUsingFallbackKey(this.__wbg_ptr)!==0}set createdUsingFallbackKey(e){n.__wbg_set_pickledsession_createdUsingFallbackKey(this.__wbg_ptr,e)}get creationTime(){return n.__wbg_get_pickledsession_creationTime(this.__wbg_ptr)}set creationTime(e){n.__wbg_set_pickledsession_creationTime(this.__wbg_ptr,e)}get lastUseTime(){return n.__wbg_get_pickledsession_lastUseTime(this.__wbg_ptr)}set lastUseTime(e){n.__wbg_set_pickledsession_lastUseTime(this.__wbg_ptr,e)}constructor(){const e=n.pickledsession_new();return this.__wbg_ptr=e>>>0,ko.register(this,this.__wbg_ptr,this),this}};o(_n,"PickledSession");let _t=_n;const Zn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pkdecryption_free(i>>>0,1)),Ve=class Ve{static __wrap(e){e=e>>>0;const t=Object.create(Ve.prototype);return t.__wbg_ptr=e,Zn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pkdecryption_free(e,0)}constructor(){const e=n.pkdecryption_new();return this.__wbg_ptr=e>>>0,Zn.register(this,this.__wbg_ptr,this),this}static fromKey(e){f(e,Je);const t=n.pkdecryption_fromKey(e.__wbg_ptr);return Ve.__wrap(t)}secretKey(){const e=n.pkdecryption_secretKey(this.__wbg_ptr);return Je.__wrap(e)}publicKey(){const e=n.pkdecryption_publicKey(this.__wbg_ptr);return D.__wrap(e)}decryptString(e){let t,r;try{f(e,ce);const a=n.pkdecryption_decryptString(this.__wbg_ptr,e.__wbg_ptr);var s=a[0],_=a[1];if(a[3])throw s=0,_=0,p(a[2]);return t=s,r=_,y(s,_)}finally{n.__wbindgen_free(t,r,1)}}decrypt(e){f(e,ce);const t=n.pkdecryption_decrypt(this.__wbg_ptr,e.__wbg_ptr);if(t[3])throw p(t[2]);var r=L(t[0],t[1]).slice();return n.__wbindgen_free(t[0],t[1]*1,1),r}};o(Ve,"PkDecryption");let ki=Ve;const So=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pkencryption_free(i>>>0,1)),xe=class xe{static __wrap(e){e=e>>>0;const t=Object.create(xe.prototype);return t.__wbg_ptr=e,So.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,So.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pkencryption_free(e,0)}static fromKey(e){f(e,D);const t=n.pkencryption_fromKey(e.__wbg_ptr);return xe.__wrap(t)}encrypt(e){const t=J(e,n.__wbindgen_malloc),r=d,s=n.pkencryption_encrypt(this.__wbg_ptr,t,r);return ce.__wrap(s)}encryptString(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.pkencryption_encrypt(this.__wbg_ptr,t,r);return ce.__wrap(s)}};o(xe,"PkEncryption");let Si=xe;const Ro=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_pkmessage_free(i>>>0,1)),pe=class pe{static __wrap(e){e=e>>>0;const t=Object.create(pe.prototype);return t.__wbg_ptr=e,Ro.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ro.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_pkmessage_free(e,0)}ciphertext(){const e=n.pkmessage_ciphertext(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}mac(){const e=n.pkmessage_mac(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}ephemeralKey(){const e=n.pkmessage_ephemeralKey(this.__wbg_ptr);return D.__wrap(e)}static fromParts(e,t,r){const s=J(e,n.__wbindgen_malloc),_=d,a=J(t,n.__wbindgen_malloc),c=d;f(r,D);const g=n.pkmessage_fromParts(s,_,a,c,r.__wbg_ptr);return pe.__wrap(g)}static fromBase64(e){f(e,We);const t=n.pkmessage_fromBase64(e.__wbg_ptr);if(t[2])throw p(t[1]);return pe.__wrap(t[0])}toBase64(){const e=n.pkmessage_toBase64(this.__wbg_ptr);return We.__wrap(e)}};o(pe,"PkMessage");let ce=pe;const Ko=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_plaintexttodeviceevent_free(i>>>0,1)),an=class an{static __wrap(e){e=e>>>0;const t=Object.create(an.prototype);return t.__wbg_ptr=e,Ko.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ko.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_plaintexttodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_plaintexttodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return n.plaintexttodeviceevent_type(this.__wbg_ptr)}};o(an,"PlainTextToDeviceEvent");let rr=an;const Xn=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_putdehydrateddevicerequest_free(i>>>0,1)),cn=class cn{static __wrap(e){e=e>>>0;const t=Object.create(cn.prototype);return t.__wbg_ptr=e,Xn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xn.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_putdehydrateddevicerequest_free(e,0)}get body(){return n.__wbg_get_putdehydrateddevicerequest_body(this.__wbg_ptr)}constructor(e){const t=n.putdehydrateddevicerequest_new(e);return this.__wbg_ptr=t>>>0,Xn.register(this,this.__wbg_ptr,this),this}};o(cn,"PutDehydratedDeviceRequest");let at=cn;const Io=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qr_free(i>>>0,1)),gn=class gn{static __wrap(e){e=e>>>0;const t=Object.create(gn.prototype);return t.__wbg_ptr=e,Io.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Io.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qr_free(e,0)}state(){return n.qr_state(this.__wbg_ptr)}hasBeenScanned(){return n.qr_hasBeenScanned(this.__wbg_ptr)!==0}hasBeenConfirmed(){return n.qr_hasBeenConfirmed(this.__wbg_ptr)!==0}get userId(){const e=n.qr_userId(this.__wbg_ptr);return v.__wrap(e)}get otherUserId(){const e=n.qr_otherUserId(this.__wbg_ptr);return v.__wrap(e)}get otherDeviceId(){const e=n.qr_otherDeviceId(this.__wbg_ptr);return E.__wrap(e)}weStarted(){return n.qr_weStarted(this.__wbg_ptr)!==0}cancelInfo(){const e=n.qr_cancelInfo(this.__wbg_ptr);return e===0?void 0:he.__wrap(e)}isDone(){return n.qr_isDone(this.__wbg_ptr)!==0}isCancelled(){return n.qr_isCancelled(this.__wbg_ptr)!==0}isSelfVerification(){return n.qr_isSelfVerification(this.__wbg_ptr)!==0}reciprocated(){return n.qr_reciprocated(this.__wbg_ptr)!==0}get flowId(){let e,t;try{const r=n.qr_flowId(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.qr_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}toQrCode(){const e=n.qr_toQrCode(this.__wbg_ptr);if(e[2])throw p(e[1]);return nr.__wrap(e[0])}toBytes(){const e=n.qr_toBytes(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}reciprocate(){const e=n.qr_reciprocate(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}confirmScanning(){const e=n.qr_confirmScanning(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}cancel(){const e=n.qr_cancel(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}cancelWithCode(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.qr_cancelWithCode(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return p(s[0])}registerChangesCallback(e){n.qr_registerChangesCallback(this.__wbg_ptr,e)}};o(gn,"Qr");let Ie=gn;const Co=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qrcode_free(i>>>0,1)),un=class un{static __wrap(e){e=e>>>0;const t=Object.create(un.prototype);return t.__wbg_ptr=e,Co.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Co.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcode_free(e,0)}renderIntoBuffer(){const e=n.qrcode_renderIntoBuffer(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}};o(un,"QrCode");let nr=un;const ei=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qrcodedata_free(i>>>0,1)),we=class we{static __wrap(e){e=e>>>0;const t=Object.create(we.prototype);return t.__wbg_ptr=e,ei.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ei.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodedata_free(e,0)}constructor(e,t,r){f(e,D);var s=e.__destroy_into_raw();const _=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),a=d;var c=m(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),g=d;const l=n.qrcodedata_new(s,_,a,c,g);if(l[2])throw p(l[1]);return this.__wbg_ptr=l[0]>>>0,ei.register(this,this.__wbg_ptr,this),this}static fromBytes(e){const t=J(e,n.__wbindgen_malloc),r=d,s=n.qrcodedata_fromBytes(t,r);if(s[2])throw p(s[1]);return we.__wrap(s[0])}toBytes(){const e=n.qrcodedata_toBytes(this.__wbg_ptr);var t=L(e[0],e[1]).slice();return n.__wbindgen_free(e[0],e[1]*1,1),t}static fromBase64(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.qrcodedata_fromBase64(t,r);if(s[2])throw p(s[1]);return we.__wrap(s[0])}toBase64(){let e,t;try{const r=n.qrcodedata_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get publicKey(){const e=n.qrcodedata_publicKey(this.__wbg_ptr);return D.__wrap(e)}get rendezvousUrl(){let e,t;try{const r=n.qrcodedata_rendezvousUrl(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.qrcodedata_serverName(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}get mode(){return n.qrcodedata_mode(this.__wbg_ptr)}};o(we,"QrCodeData");let Ri=we;const Eo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_qrcodescan_free(i>>>0,1)),Ae=class Ae{static __wrap(e){e=e>>>0;const t=Object.create(Ae.prototype);return t.__wbg_ptr=e,Eo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Eo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_qrcodescan_free(e,0)}static fromBytes(e){const t=n.qrcodescan_fromBytes(e);if(t[2])throw p(t[1]);return Ae.__wrap(t[0])}};o(Ae,"QrCodeScan");let ct=Ae;const Oo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_rehydrateddevice_free(i>>>0,1)),dn=class dn{static __wrap(e){e=e>>>0;const t=Object.create(dn.prototype);return t.__wbg_ptr=e,Oo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Oo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_rehydrateddevice_free(e,0)}receiveEvents(e,t){const r=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;let _=0;return m(t)||(f(t,oe),_=t.__destroy_into_raw()),n.rehydrateddevice_receiveEvents(this.__wbg_ptr,r,s,_)}};o(dn,"RehydratedDevice");let ir=dn;const ti=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomid_free(i>>>0,1)),Pe=class Pe{static __wrap(e){e=e>>>0;const t=Object.create(Pe.prototype);return t.__wbg_ptr=e,ti.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof Pe?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ti.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.roomid_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,ti.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=n.roomid_toString(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Pe,"RoomId");let K=Pe;const Mo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeycounts_free(i>>>0,1)),ln=class ln{static __wrap(e){e=e>>>0;const t=Object.create(ln.prototype);return t.__wbg_ptr=e,Mo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Mo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeycounts_free(e,0)}get total(){return n.__wbg_get_roomkeycounts_total(this.__wbg_ptr)}set total(e){n.__wbg_set_roomkeycounts_total(this.__wbg_ptr,e)}get backedUp(){return n.__wbg_get_roomkeycounts_backedUp(this.__wbg_ptr)}set backedUp(e){n.__wbg_set_roomkeycounts_backedUp(this.__wbg_ptr,e)}};o(ln,"RoomKeyCounts");let sr=ln;const Bo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeyimportresult_free(i>>>0,1)),pn=class pn{static __wrap(e){e=e>>>0;const t=Object.create(pn.prototype);return t.__wbg_ptr=e,Bo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Bo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyimportresult_free(e,0)}get importedCount(){return n.__wbg_get_roomkeyimportresult_importedCount(this.__wbg_ptr)>>>0}get totalCount(){return n.__wbg_get_roomkeyimportresult_totalCount(this.__wbg_ptr)>>>0}keys(){return n.roomkeyimportresult_keys(this.__wbg_ptr)}};o(pn,"RoomKeyImportResult");let or=pn;const Do=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeyinfo_free(i>>>0,1)),wn=class wn{static __wrap(e){e=e>>>0;const t=Object.create(wn.prototype);return t.__wbg_ptr=e,Do.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Do.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeyinfo_free(e,0)}get algorithm(){return n.roomkeyinfo_algorithm(this.__wbg_ptr)}get roomId(){const e=n.roomkeyinfo_roomId(this.__wbg_ptr);return K.__wrap(e)}get senderKey(){const e=n.roomkeyinfo_senderKey(this.__wbg_ptr);return D.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeyinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(wn,"RoomKeyInfo");let _r=wn;const qo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomkeywithheldinfo_free(i>>>0,1)),bn=class bn{static __wrap(e){e=e>>>0;const t=Object.create(bn.prototype);return t.__wbg_ptr=e,qo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,qo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomkeywithheldinfo_free(e,0)}get sender(){const e=n.roomkeywithheldinfo_sender(this.__wbg_ptr);return v.__wrap(e)}get algorithm(){return n.roomkeywithheldinfo_algorithm(this.__wbg_ptr)}get withheldCode(){let e,t;try{const r=n.roomkeywithheldinfo_withheldCode(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.roomkeywithheldinfo_roomId(this.__wbg_ptr);return K.__wrap(e)}get sessionId(){let e,t;try{const r=n.roomkeywithheldinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(bn,"RoomKeyWithheldInfo");let ar=bn;const ri=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roommessagerequest_free(i>>>0,1)),yn=class yn{static __wrap(e){e=e>>>0;const t=Object.create(yn.prototype);return t.__wbg_ptr=e,ri.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ri.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roommessagerequest_free(e,0)}get id(){return n.__wbg_get_roommessagerequest_id(this.__wbg_ptr)}get room_id(){return n.__wbg_get_roommessagerequest_room_id(this.__wbg_ptr)}get txn_id(){return n.__wbg_get_roommessagerequest_txn_id(this.__wbg_ptr)}get event_type(){return n.__wbg_get_roommessagerequest_event_type(this.__wbg_ptr)}get body(){return n.__wbg_get_roommessagerequest_body(this.__wbg_ptr)}constructor(e,t,r,s,_){const a=n.roommessagerequest_new(e,t,r,s,_);return this.__wbg_ptr=a>>>0,ri.register(this,this.__wbg_ptr,this),this}get type(){return n.roommessagerequest_type(this.__wbg_ptr)}};o(yn,"RoomMessageRequest");let gt=yn;const ni=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_roomsettings_free(i>>>0,1)),fn=class fn{static __wrap(e){e=e>>>0;const t=Object.create(fn.prototype);return t.__wbg_ptr=e,ni.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ni.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_roomsettings_free(e,0)}get algorithm(){return n.__wbg_get_roomsettings_algorithm(this.__wbg_ptr)}set algorithm(e){n.__wbg_set_roomsettings_algorithm(this.__wbg_ptr,e)}get encryptStateEvents(){return n.__wbg_get_roomsettings_encryptStateEvents(this.__wbg_ptr)!==0}set encryptStateEvents(e){n.__wbg_set_roomsettings_encryptStateEvents(this.__wbg_ptr,e)}get onlyAllowTrustedDevices(){return n.__wbg_get_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr)!==0}set onlyAllowTrustedDevices(e){n.__wbg_set_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr,e)}get sessionRotationPeriodMs(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set sessionRotationPeriodMs(e){n.__wbg_set_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr,!m(e),m(e)?0:e)}get sessionRotationPeriodMessages(){const e=n.__wbg_get_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set sessionRotationPeriodMessages(e){n.__wbg_set_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr,!m(e),m(e)?0:e)}constructor(){const e=n.roomsettings_new();return this.__wbg_ptr=e>>>0,ni.register(this,this.__wbg_ptr,this),this}};o(fn,"RoomSettings");let ge=fn;const Fo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_sas_free(i>>>0,1)),hn=class hn{static __wrap(e){e=e>>>0;const t=Object.create(hn.prototype);return t.__wbg_ptr=e,Fo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_sas_free(e,0)}get userId(){const e=n.sas_userId(this.__wbg_ptr);return v.__wrap(e)}get deviceId(){const e=n.sas_deviceId(this.__wbg_ptr);return E.__wrap(e)}get otherUserId(){const e=n.sas_otherUserId(this.__wbg_ptr);return v.__wrap(e)}get otherDeviceId(){const e=n.sas_otherDeviceId(this.__wbg_ptr);return E.__wrap(e)}get flowId(){let e,t;try{const r=n.sas_flowId(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get roomId(){const e=n.sas_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}supportsEmoji(){return n.sas_supportsEmoji(this.__wbg_ptr)!==0}startedFromRequest(){return n.sas_startedFromRequest(this.__wbg_ptr)!==0}isSelfVerification(){return n.sas_isSelfVerification(this.__wbg_ptr)!==0}haveWeConfirmed(){return n.sas_haveWeConfirmed(this.__wbg_ptr)!==0}hasBeenAccepted(){return n.sas_hasBeenAccepted(this.__wbg_ptr)!==0}cancelInfo(){const e=n.sas_cancelInfo(this.__wbg_ptr);return e===0?void 0:he.__wrap(e)}weStarted(){return n.sas_weStarted(this.__wbg_ptr)!==0}accept(){const e=n.sas_accept(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}confirm(){return n.sas_confirm(this.__wbg_ptr)}cancel(){const e=n.sas_cancel(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}cancelWithCode(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.sas_cancelWithCode(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return p(s[0])}timedOut(){return n.sas_timedOut(this.__wbg_ptr)!==0}canBePresented(){return n.sas_canBePresented(this.__wbg_ptr)!==0}isDone(){return n.sas_isDone(this.__wbg_ptr)!==0}isCancelled(){return n.sas_isCancelled(this.__wbg_ptr)!==0}emoji(){const e=n.sas_emoji(this.__wbg_ptr);let t;return e[0]!==0&&(t=Le(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*4,4)),t}emojiIndex(){const e=n.sas_emojiIndex(this.__wbg_ptr);let t;return e[0]!==0&&(t=L(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}decimals(){const e=n.sas_decimals(this.__wbg_ptr);let t;return e[0]!==0&&(t=x_(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*2,2)),t}registerChangesCallback(e){n.sas_registerChangesCallback(this.__wbg_ptr,e)}};o(hn,"Sas");let Ce=hn;const zo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_secretsbundle_free(i>>>0,1)),Ne=class Ne{static __wrap(e){e=e>>>0;const t=Object.create(Ne.prototype);return t.__wbg_ptr=e,zo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,zo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_secretsbundle_free(e,0)}get masterKey(){let e,t;try{const r=n.secretsbundle_masterKey(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const r=n.secretsbundle_selfSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const r=n.secretsbundle_userSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get backupBundle(){const e=n.secretsbundle_backupBundle(this.__wbg_ptr);return e===0?void 0:jt.__wrap(e)}to_json(){const e=n.secretsbundle_to_json(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}static from_json(e){const t=n.secretsbundle_from_json(e);if(t[2])throw p(t[1]);return Ne.__wrap(t[0])}};o(Ne,"SecretsBundle");let Ee=Ne;const ii=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_servername_free(i>>>0,1)),vn=class vn{static __wrap(e){e=e>>>0;const t=Object.create(vn.prototype);return t.__wbg_ptr=e,ii.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ii.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_servername_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.servername_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,ii.register(this,this.__wbg_ptr,this),this}get host(){let e,t;try{const r=n.servername_host(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get port(){const e=n.servername_port(this.__wbg_ptr);return e===16777215?void 0:e}isIpLiteral(){return n.servername_isIpLiteral(this.__wbg_ptr)!==0}};o(vn,"ServerName");let ut=vn;const Uo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_shieldstate_free(i>>>0,1)),mn=class mn{static __wrap(e){e=e>>>0;const t=Object.create(mn.prototype);return t.__wbg_ptr=e,Uo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Uo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_shieldstate_free(e,0)}get color(){return n.__wbg_get_shieldstate_color(this.__wbg_ptr)}set color(e){n.__wbg_set_shieldstate_color(this.__wbg_ptr,e)}get code(){const e=n.__wbg_get_shieldstate_code(this.__wbg_ptr);return e===7?void 0:e}set code(e){n.__wbg_set_shieldstate_code(this.__wbg_ptr,m(e)?7:e)}get message(){const e=n.shieldstate_message(this.__wbg_ptr);let t;return e[0]!==0&&(t=y(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*1,1)),t}};o(mn,"ShieldState");let dt=mn;const To=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signature_free(i>>>0,1)),kn=class kn{static __wrap(e){e=e>>>0;const t=Object.create(kn.prototype);return t.__wbg_ptr=e,To.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,To.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signature_free(e,0)}get ed25519(){const e=n.signature_ed25519(this.__wbg_ptr);return e===0?void 0:ke.__wrap(e)}toBase64(){let e,t;try{const r=n.signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(kn,"Signature");let cr=kn;const si=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signatureuploadrequest_free(i>>>0,1)),Sn=class Sn{static __wrap(e){e=e>>>0;const t=Object.create(Sn.prototype);return t.__wbg_ptr=e,si.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,si.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureuploadrequest_free(e,0)}get id(){return n.__wbg_get_signatureuploadrequest_id(this.__wbg_ptr)}get body(){return n.__wbg_get_signatureuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=n.signatureuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,si.register(this,this.__wbg_ptr,this),this}get type(){return n.signatureuploadrequest_type(this.__wbg_ptr)}};o(Sn,"SignatureUploadRequest");let Oe=Sn;const jo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signatureverification_free(i>>>0,1)),Rn=class Rn{static __wrap(e){e=e>>>0;const t=Object.create(Rn.prototype);return t.__wbg_ptr=e,jo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatureverification_free(e,0)}get deviceState(){return n.signatureverification_deviceState(this.__wbg_ptr)}get userState(){return n.signatureverification_userState(this.__wbg_ptr)}trusted(){return n.signatureverification_trusted(this.__wbg_ptr)!==0}};o(Rn,"SignatureVerification");let gr=Rn;const oi=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_signatures_free(i>>>0,1)),Kn=class Kn{static __wrap(e){e=e>>>0;const t=Object.create(Kn.prototype);return t.__wbg_ptr=e,oi.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oi.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_signatures_free(e,0)}constructor(){const e=n.signatures_new();return this.__wbg_ptr=e>>>0,oi.register(this,this.__wbg_ptr,this),this}addSignature(e,t,r){f(e,v),f(t,ve),f(r,ke);const s=n.signatures_addSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return s===0?void 0:tt.__wrap(s)}getSignature(e,t){f(e,v),f(t,ve);const r=n.signatures_getSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return r===0?void 0:ke.__wrap(r)}get(e){return f(e,v),n.signatures_get(this.__wbg_ptr,e.__wbg_ptr)}clear(){n.signatures_clear(this.__wbg_ptr)}isEmpty(){return n.signatures_isEmpty(this.__wbg_ptr)!==0}get count(){return n.signatures_count(this.__wbg_ptr)>>>0}asJSON(){const e=n.signatures_asJSON(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}};o(Kn,"Signatures");let lt=Kn;const Vo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_storehandle_free(i>>>0,1)),In=class In{static __wrap(e){e=e>>>0;const t=Object.create(In.prototype);return t.__wbg_ptr=e,Vo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_storehandle_free(e,0)}static open(e,t,r){var s=m(e)?0:w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=m(t)?0:w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),c=d;return n.storehandle_open(s,_,a,c,m(r)?0:M(r))}static openWithKey(e,t,r){const s=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d,a=J(t,n.__wbindgen_malloc),c=d;return n.storehandle_openWithKey(s,_,a,c,m(r)?0:M(r))}};o(In,"StoreHandle");let P=In;const xo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_storedroomkeybundledata_free(i>>>0,1)),Cn=class Cn{static __wrap(e){e=e>>>0;const t=Object.create(Cn.prototype);return t.__wbg_ptr=e,xo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_storedroomkeybundledata_free(e,0)}get senderUser(){const e=n.storedroomkeybundledata_senderUser(this.__wbg_ptr);return v.__wrap(e)}get roomId(){const e=n.storedroomkeybundledata_roomId(this.__wbg_ptr);return K.__wrap(e)}get url(){let e,t;try{const r=n.storedroomkeybundledata_url(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get encryptionInfo(){let e,t;try{const r=n.storedroomkeybundledata_encryptionInfo(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}};o(Cn,"StoredRoomKeyBundleData");let pt=Cn;const Ao=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_todeviceencryptioninfo_free(i>>>0,1)),En=class En{static __wrap(e){e=e>>>0;const t=Object.create(En.prototype);return t.__wbg_ptr=e,Ao.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ao.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todeviceencryptioninfo_free(e,0)}get senderCurve25519Key(){let e,t;try{const r=n.__wbg_get_todeviceencryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}set senderCurve25519Key(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d;n.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get sender(){const e=n.__wbg_get_todeviceencryptioninfo_sender(this.__wbg_ptr);return v.__wrap(e)}set sender(e){f(e,v);var t=e.__destroy_into_raw();n.__wbg_set_todeviceencryptioninfo_sender(this.__wbg_ptr,t)}get senderDevice(){const e=n.__wbg_get_todeviceencryptioninfo_senderDevice(this.__wbg_ptr);return e===0?void 0:E.__wrap(e)}set senderDevice(e){let t=0;m(e)||(f(e,E),t=e.__destroy_into_raw()),n.__wbg_set_todeviceencryptioninfo_senderDevice(this.__wbg_ptr,t)}isSenderVerified(){return n.todeviceencryptioninfo_isSenderVerified(this.__wbg_ptr)!==0}};o(En,"ToDeviceEncryptionInfo");let ur=En;const _i=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_todevicerequest_free(i>>>0,1)),On=class On{static __wrap(e){e=e>>>0;const t=Object.create(On.prototype);return t.__wbg_ptr=e,_i.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_i.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todevicerequest_free(e,0)}get id(){return n.__wbg_get_todevicerequest_id(this.__wbg_ptr)}get event_type(){return n.__wbg_get_todevicerequest_event_type(this.__wbg_ptr)}get txn_id(){return n.__wbg_get_todevicerequest_txn_id(this.__wbg_ptr)}get body(){return n.__wbg_get_todevicerequest_body(this.__wbg_ptr)}constructor(e,t,r,s){const _=n.todevicerequest_new(e,t,r,s);return this.__wbg_ptr=_>>>0,_i.register(this,this.__wbg_ptr,this),this}get type(){return n.todevicerequest_type(this.__wbg_ptr)}};o(On,"ToDeviceRequest");let wt=On;const Po=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_todeviceunabletodecryptinfo_free(i>>>0,1)),Mn=class Mn{static __wrap(e){e=e>>>0;const t=Object.create(Mn.prototype);return t.__wbg_ptr=e,Po.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Po.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_todeviceunabletodecryptinfo_free(e,0)}get reason(){return n.__wbg_get_todeviceunabletodecryptinfo_reason(this.__wbg_ptr)}set reason(e){n.__wbg_set_todeviceunabletodecryptinfo_reason(this.__wbg_ptr,e)}};o(Mn,"ToDeviceUnableToDecryptInfo");let dr=Mn;const No=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_tracing_free(i>>>0,1)),gs=class gs{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,No.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_tracing_free(e,0)}static isAvailable(){return n.tracing_isAvailable()!==0}constructor(e){const t=n.tracing_new(e);if(t[2])throw p(t[1]);return this.__wbg_ptr=t[0]>>>0,No.register(this,this.__wbg_ptr,this),this}set minLevel(e){const t=n.tracing_set_minLevel(this.__wbg_ptr,e);if(t[1])throw p(t[0])}turnOn(){const e=n.tracing_turnOn(this.__wbg_ptr);if(e[1])throw p(e[0])}turnOff(){const e=n.tracing_turnOff(this.__wbg_ptr);if(e[1])throw p(e[0])}};o(gs,"Tracing");let Ki=gs;const Lo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_utdtodeviceevent_free(i>>>0,1)),Bn=class Bn{static __wrap(e){e=e>>>0;const t=Object.create(Bn.prototype);return t.__wbg_ptr=e,Lo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_utdtodeviceevent_free(e,0)}get rawEvent(){return n.__wbg_get_utdtodeviceevent_rawEvent(this.__wbg_ptr)}get utdInfo(){const e=n.__wbg_get_utdtodeviceevent_utdInfo(this.__wbg_ptr);return dr.__wrap(e)}get type(){return n.utdtodeviceevent_type(this.__wbg_ptr)}};o(Bn,"UTDToDeviceEvent");let lr=Bn;const ai=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_uploadsigningkeysrequest_free(i>>>0,1)),Dn=class Dn{static __wrap(e){e=e>>>0;const t=Object.create(Dn.prototype);return t.__wbg_ptr=e,ai.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ai.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_uploadsigningkeysrequest_free(e,0)}get body(){return n.__wbg_get_uploadsigningkeysrequest_body(this.__wbg_ptr)}constructor(e){const t=n.uploadsigningkeysrequest_new(e);return this.__wbg_ptr=t>>>0,ai.register(this,this.__wbg_ptr,this),this}};o(Dn,"UploadSigningKeysRequest");let bt=Dn;const Wo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_userdevices_free(i>>>0,1)),qn=class qn{static __wrap(e){e=e>>>0;const t=Object.create(qn.prototype);return t.__wbg_ptr=e,Wo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userdevices_free(e,0)}get(e){f(e,E);const t=n.userdevices_get(this.__wbg_ptr,e.__wbg_ptr);return t===0?void 0:He.__wrap(t)}isAnyVerified(){return n.userdevices_isAnyVerified(this.__wbg_ptr)!==0}keys(){return n.userdevices_keys(this.__wbg_ptr)}devices(){return n.userdevices_devices(this.__wbg_ptr)}};o(qn,"UserDevices");let pr=qn;const ci=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_userid_free(i>>>0,1)),be=class be{static __wrap(e){e=e>>>0;const t=Object.create(be.prototype);return t.__wbg_ptr=e,ci.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof be?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ci.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_userid_free(e,0)}constructor(e){const t=w(e,n.__wbindgen_malloc,n.__wbindgen_realloc),r=d,s=n.userid_new(t,r);if(s[2])throw p(s[1]);return this.__wbg_ptr=s[0]>>>0,ci.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=n.userid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}get serverName(){const e=n.userid_serverName(this.__wbg_ptr);return ut.__wrap(e)}isHistorical(){return n.userid_isHistorical(this.__wbg_ptr)!==0}toString(){let e,t;try{const r=n.userid_toString(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}clone(){const e=n.userid_clone(this.__wbg_ptr);return be.__wrap(e)}};o(be,"UserId");let v=be;const Go=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_verificationrequest_free(i>>>0,1)),Fn=class Fn{static __wrap(e){e=e>>>0;const t=Object.create(Fn.prototype);return t.__wbg_ptr=e,Go.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Go.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_verificationrequest_free(e,0)}static request(e,t,r,s){let _,a;try{f(e,v),f(t,E),f(r,v);var c=m(s)?0:z(s,n.__wbindgen_malloc),g=d;const h=n.verificationrequest_request(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,c,g);var l=h[0],b=h[1];if(h[3])throw l=0,b=0,p(h[2]);return _=l,a=b,y(l,b)}finally{n.__wbindgen_free(_,a,1)}}get ownUserId(){const e=n.verificationrequest_ownUserId(this.__wbg_ptr);return v.__wrap(e)}get otherUserId(){const e=n.verificationrequest_otherUserId(this.__wbg_ptr);return v.__wrap(e)}get otherDeviceId(){const e=n.verificationrequest_otherDeviceId(this.__wbg_ptr);return e===0?void 0:E.__wrap(e)}get roomId(){const e=n.verificationrequest_roomId(this.__wbg_ptr);return e===0?void 0:K.__wrap(e)}get cancelInfo(){const e=n.verificationrequest_cancelInfo(this.__wbg_ptr);return e===0?void 0:he.__wrap(e)}isPassive(){return n.verificationrequest_isPassive(this.__wbg_ptr)!==0}isReady(){return n.verificationrequest_isReady(this.__wbg_ptr)!==0}timedOut(){return n.verificationrequest_timedOut(this.__wbg_ptr)!==0}timeRemainingMillis(){return n.verificationrequest_timeRemainingMillis(this.__wbg_ptr)}get theirSupportedMethods(){const e=n.verificationrequest_theirSupportedMethods(this.__wbg_ptr);if(e[3])throw p(e[2]);let t;return e[0]!==0&&(t=Le(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*4,4)),t}get ourSupportedMethods(){const e=n.verificationrequest_ourSupportedMethods(this.__wbg_ptr);if(e[3])throw p(e[2]);let t;return e[0]!==0&&(t=Le(e[0],e[1]).slice(),n.__wbindgen_free(e[0],e[1]*4,4)),t}get flowId(){let e,t;try{const r=n.verificationrequest_flowId(this.__wbg_ptr);return e=r[0],t=r[1],y(r[0],r[1])}finally{n.__wbindgen_free(e,t,1)}}isSelfVerification(){return n.verificationrequest_isSelfVerification(this.__wbg_ptr)!==0}weStarted(){return n.verificationrequest_weStarted(this.__wbg_ptr)!==0}isDone(){return n.verificationrequest_isDone(this.__wbg_ptr)!==0}phase(){return n.verificationrequest_phase(this.__wbg_ptr)}getVerification(){return n.verificationrequest_getVerification(this.__wbg_ptr)}registerChangesCallback(e){n.verificationrequest_registerChangesCallback(this.__wbg_ptr,e)}isCancelled(){return n.verificationrequest_isCancelled(this.__wbg_ptr)!==0}acceptWithMethods(e){const t=z(e,n.__wbindgen_malloc),r=d,s=n.verificationrequest_acceptWithMethods(this.__wbg_ptr,t,r);if(s[2])throw p(s[1]);return p(s[0])}accept(){const e=n.verificationrequest_accept(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}cancel(){const e=n.verificationrequest_cancel(this.__wbg_ptr);if(e[2])throw p(e[1]);return p(e[0])}startSas(){return n.verificationrequest_startSas(this.__wbg_ptr)}generateQrCode(){return n.verificationrequest_generateQrCode(this.__wbg_ptr)}scanQrCode(e){return f(e,ct),n.verificationrequest_scanQrCode(this.__wbg_ptr,e.__wbg_ptr)}};o(Fn,"VerificationRequest");let Me=Fn;const Jo=typeof FinalizationRegistry>"u"?{register:o(()=>{},"register"),unregister:o(()=>{},"unregister")}:new FinalizationRegistry(i=>n.__wbg_versions_free(i>>>0,1)),zn=class zn{static __wrap(e){e=e>>>0;const t=Object.create(zn.prototype);return t.__wbg_ptr=e,Jo.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Jo.unregister(this),e}free(){const e=this.__destroy_into_raw();n.__wbg_versions_free(e,0)}get vodozemac(){return n.__wbg_get_versions_vodozemac(this.__wbg_ptr)}get matrix_sdk_crypto(){return n.__wbg_get_versions_matrix_sdk_crypto(this.__wbg_ptr)}get git_sha(){return n.__wbg_get_versions_git_sha(this.__wbg_ptr)}get git_description(){return n.__wbg_get_versions_git_description(this.__wbg_ptr)}};o(zn,"Versions");let wr=zn;function ia(i,e){return Error(y(i,e))}o(ia,"__wbg_Error_0497d5bdba9362e5");function sa(i,e){const t=String(e),r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(sa,"__wbg_String_8f0eb39a4a4c2f66");function oa(i){return i.Window}o(oa,"__wbg_Window_b0044ac7db258535");function _a(i){return i.WorkerGlobalScope}o(_a,"__wbg_WorkerGlobalScope_b74cefefc62a37da");function aa(){return R(function(i,e,t){return i.add(e,t)},arguments)}o(aa,"__wbg_add_64c6e51ab0ed12dd");function ca(i,e){return i.add(e)}o(ca,"__wbg_add_dd833f9f523abe36");function ga(i,e){return i.at(e)}o(ga,"__wbg_at_5b2884630cb66ea6");function ua(i){return Tt.__wrap(i)}o(ua,"__wbg_backupkeys_new");function da(){return R(function(i,e){return IDBKeyRange.bound(i,e)},arguments)}o(da,"__wbg_bound_0274374bea7f6bca");function la(){return R(function(i,e,t,r){return IDBKeyRange.bound(i,e,t!==0,r!==0)},arguments)}o(la,"__wbg_bound_eb572b424befade3");function pa(i){return i.buffer}o(pa,"__wbg_buffer_a1a27a0dfa70165d");function wa(){return R(function(i,e,t,r){return i.call(e,t,r)},arguments)}o(wa,"__wbg_call_1b920c3ac0afee4b");function ba(){return R(function(i,e,t,r,s){return i.call(e,t,r,s)},arguments)}o(ba,"__wbg_call_36f1bbf64b4cf7c7");function ya(){return R(function(i,e,t){return i.call(e,t)},arguments)}o(ya,"__wbg_call_f2db6205e5c51dc8");function fa(){return R(function(i,e){return i.call(e)},arguments)}o(fa,"__wbg_call_fbe8be8bf6436ce5");function ha(i){return clearTimeout(i)}o(ha,"__wbg_clearTimeout_5a54f8841c30079a");function va(){return R(function(i){return i.clear()},arguments)}o(va,"__wbg_clear_e6ec1cc113e1555e");function ma(i){i.close()}o(ma,"__wbg_close_2079e209ea5709b5");function ka(i){return i.code}o(ka,"__wbg_code_5e459ca721f994f5");function Sa(){return R(function(i){i.continue()},arguments)}o(Sa,"__wbg_continue_7d9cdafc888cb902");function Ra(){return R(function(i){return i.count()},arguments)}o(Ra,"__wbg_count_2941fdbb8154c02d");function Ka(){return R(function(i){return i.count()},arguments)}o(Ka,"__wbg_count_5ceb291ba9a02b4b");function Ia(){return R(function(i,e,t,r){return i.createIndex(y(e,t),r)},arguments)}o(Ia,"__wbg_createIndex_32ba53785b2ef24e");function Ca(){return R(function(i,e,t,r,s){return i.createIndex(y(e,t),r,s)},arguments)}o(Ca,"__wbg_createIndex_a343510ba567e58c");function Ea(){return R(function(i,e,t){return i.createObjectStore(y(e,t))},arguments)}o(Ea,"__wbg_createObjectStore_b1f08961900155dd");function Oa(i){return xt.__wrap(i)}o(Oa,"__wbg_crosssigningbootstraprequests_new");function Ma(i){return At.__wrap(i)}o(Ma,"__wbg_crosssigningkeyexport_new");function Ba(i){return Pt.__wrap(i)}o(Ba,"__wbg_crosssigningstatus_new");function Da(i){return i.crypto}o(Da,"__wbg_crypto_574e78ad8b13b65f");function qa(i){console.debug(i)}o(qa,"__wbg_debug_58d16ea352cfbca1");function Fa(i,e){i.debug(e)}o(Fa,"__wbg_debug_ada37632f0e8cdde");function za(i){return Nt.__wrap(i)}o(za,"__wbg_decryptedroomevent_new");function Ua(i){return Lt.__wrap(i)}o(Ua,"__wbg_decryptedtodeviceevent_new");function Ta(i){return Wt.__wrap(i)}o(Ta,"__wbg_dehydrateddevice_new");function ja(i){return H.__wrap(i)}o(ja,"__wbg_dehydrateddevicekey_new");function Va(){return R(function(i,e,t){i.deleteObjectStore(y(e,t))},arguments)}o(Va,"__wbg_deleteObjectStore_7b427b19378475fd");function xa(){return R(function(i){return i.delete()},arguments)}o(xa,"__wbg_delete_1af2aac87b36c0f1");function Aa(){return R(function(i,e){return i.delete(e)},arguments)}o(Aa,"__wbg_delete_71b7921c73aa9378");function Pa(i){return He.__wrap(i)}o(Pa,"__wbg_device_new");function Na(i){return E.__wrap(i)}o(Na,"__wbg_deviceid_new");function La(i){return $e.__wrap(i)}o(La,"__wbg_devicekey_new");function Wa(i){return ve.__wrap(i)}o(Wa,"__wbg_devicekeyid_new");function Ga(i){return i.done}o(Ga,"__wbg_done_4d01f352bade43b7");function Ja(i){return Ht.__wrap(i)}o(Ja,"__wbg_emoji_new");function Ha(i){return Se.__wrap(i)}o(Ha,"__wbg_encryptedattachment_new");function $a(i){return $t.__wrap(i)}o($a,"__wbg_encryptioninfo_new");function Ya(i){return Object.entries(i)}o(Ya,"__wbg_entries_41651c850143b957");function Qa(i){return i.entries()}o(Qa,"__wbg_entries_c951fa14164704e7");function Za(i,e){i.error(e)}o(Za,"__wbg_error_24afdcd463ac8bd9");function Xa(){return R(function(i){const e=i.error;return m(e)?0:M(e)},arguments)}o(Xa,"__wbg_error_4e978abc9692c0c5");function ec(i){console.error(i)}o(ec,"__wbg_error_51ecdd39ec054205");function tc(i,e){let t,r;try{t=i,r=e,console.error(y(i,e))}finally{n.__wbindgen_free(t,r,1)}}o(tc,"__wbg_error_7534b8e9a36f1ab4");function rc(i){return Array.from(i)}o(rc,"__wbg_from_12ff8e47307bd4c7");function nc(){return R(function(i){return i.getAllKeys()},arguments)}o(nc,"__wbg_getAllKeys_fce3f6ef8201c450");function ic(){return R(function(i){return i.getAll()},arguments)}o(ic,"__wbg_getAll_22a744d3b40f0fb5");function sc(){return R(function(i,e,t){return i.getAll(e,t>>>0)},arguments)}o(sc,"__wbg_getAll_654e689108532352");function oc(){return R(function(i,e){return i.getAll(e)},arguments)}o(oc,"__wbg_getAll_864be044b219e256");function _c(){return R(function(i,e){globalThis.crypto.getRandomValues(L(i,e))},arguments)}o(_c,"__wbg_getRandomValues_38a1ff1ea09f6cc7");function ac(){return R(function(i,e){i.getRandomValues(e)},arguments)}o(ac,"__wbg_getRandomValues_b8f5dbd5f3995a9e");function cc(i){return i.getTime()}o(cc,"__wbg_getTime_2afe67905d873e92");function gc(){return R(function(i,e){return Reflect.get(i,e)},arguments)}o(gc,"__wbg_get_92470be87867c2e5");function uc(i,e){return i[e>>>0]}o(uc,"__wbg_get_a131a44bd1eb6979");function dc(){return R(function(i,e){return i.get(e)},arguments)}o(dc,"__wbg_get_a4719581b0d717ad");function lc(){return R(function(i,e){return i.get(e)},arguments)}o(lc,"__wbg_get_d37904b955701f99");function pc(i,e){return i[e]}o(pc,"__wbg_getwithrefkey_1dc361bd10053bfe");function wc(i){return i.global}o(wc,"__wbg_global_b6f5c73312f62313");function bc(i){return Zt.__wrap(i)}o(bc,"__wbg_inboundgroupsession_new");function yc(){return R(function(i,e,t){return i.index(y(e,t))},arguments)}o(yc,"__wbg_index_405783ca8da5f008");function fc(){return R(function(i){const e=i.indexedDB;return m(e)?0:M(e)},arguments)}o(fc,"__wbg_indexedDB_317016dcb8a872d6");function hc(){return R(function(i){const e=i.indexedDB;return m(e)?0:M(e)},arguments)}o(hc,"__wbg_indexedDB_601ec26c63e333de");function vc(){return R(function(i){const e=i.indexedDB;return m(e)?0:M(e)},arguments)}o(vc,"__wbg_indexedDB_63b82e158eb67cbd");function mc(i){console.info(i)}o(mc,"__wbg_info_e56933705c348038");function kc(i,e){i.info(e)}o(kc,"__wbg_info_f3589034369581f6");function Sc(i){let e;try{e=i instanceof ArrayBuffer}catch{e=!1}return e}o(Sc,"__wbg_instanceof_ArrayBuffer_a8b6f580b363f2bc");function Rc(i){let e;try{e=i instanceof Map}catch{e=!1}return e}o(Rc,"__wbg_instanceof_Map_80cc65041c96417a");function Kc(i){let e;try{e=i instanceof Promise}catch{e=!1}return e}o(Kc,"__wbg_instanceof_Promise_66f94afc64d9039f");function Ic(i){let e;try{e=i instanceof Uint8Array}catch{e=!1}return e}o(Ic,"__wbg_instanceof_Uint8Array_ca460677bc155827");function Cc(i){return Xt.__wrap(i)}o(Cc,"__wbg_invalidtodeviceevent_new");function Ec(i){return Array.isArray(i)}o(Ec,"__wbg_isArray_2a07fd175d45c496");function Oc(i){return Array.isArray(i)}o(Oc,"__wbg_isArray_5f090bed72bd4f89");function Mc(i){return Number.isSafeInteger(i)}o(Mc,"__wbg_isSafeInteger_90d7c4674047d684");function Bc(i,e,t){const r=e.item(t>>>0);var s=m(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;B().setInt32(i+4*1,_,!0),B().setInt32(i+4*0,s,!0)}o(Bc,"__wbg_item_15285ca2d766f142");function Dc(){return Symbol.iterator}o(Dc,"__wbg_iterator_4068add5b2aef7a6");function qc(){return R(function(i){return i.key},arguments)}o(qc,"__wbg_key_a17a68df9ec1b180");function Fc(i){return Ze.__wrap(i)}o(Fc,"__wbg_keysbackuprequest_new");function zc(i){return Xe.__wrap(i)}o(zc,"__wbg_keysclaimrequest_new");function Uc(i){return Re.__wrap(i)}o(Uc,"__wbg_keysqueryrequest_new");function Tc(i){return et.__wrap(i)}o(Tc,"__wbg_keysuploadrequest_new");function jc(i){return i.length}o(jc,"__wbg_length_471141fa24df24b2");function Vc(i){return i.length}o(Vc,"__wbg_length_ab6d22b5ead75c72");function xc(i){return i.length}o(xc,"__wbg_length_f00ec12454a5d9fd");function Ac(){return R(function(i,e){return IDBKeyRange.lowerBound(i,e!==0)},arguments)}o(Ac,"__wbg_lowerBound_13c8e875a3fb9f7d");function Pc(i){return tt.__wrap(i)}o(Pc,"__wbg_maybesignature_new");function Nc(i){return rt.__wrap(i)}o(Nc,"__wbg_megolmdecryptionerror_new");function Lc(i,e){const t=e.message,r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(Lc,"__wbg_message_2d95ea5aff0d63b9");function Wc(i){return i.msCrypto}o(Wc,"__wbg_msCrypto_a61aeb35a24c1329");function Gc(i,e){const t=e.name,r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(Gc,"__wbg_name_2acff1e83d9735f9");function Jc(){return new Object}o(Jc,"__wbg_new_07b483f72211fd66");function Hc(){return new Array}o(Hc,"__wbg_new_58353953ad2097cc");function $c(){return new Error}o($c,"__wbg_new_8a6f238a6ece86ea");function Yc(i){return new Date(i)}o(Yc,"__wbg_new_a2957aa5684de228");function Qc(){return new Map}o(Qc,"__wbg_new_a979b4b45bd55c7f");function Zc(i){return new Uint8ClampedArray(i)}o(Zc,"__wbg_new_b3a08d2910ee5170");function Xc(i){return new Set(i)}o(Xc,"__wbg_new_db7d9b0ee94df522");function eg(i,e){try{var t={a:i,b:e},r=o((_,a)=>{const c=t.a;t.a=0;try{return J_(c,t.b,_,a)}finally{t.a=c}},"cb0");return new Promise(r)}finally{t.a=t.b=0}}o(eg,"__wbg_new_e30c39c06edaabf2");function tg(i){return new Uint8Array(i)}o(tg,"__wbg_new_e52b3efaaa774f96");function rg(i,e){return new Function(y(i,e))}o(rg,"__wbg_newnoargs_ff528e72d35de39a");function ng(i,e,t){return new Uint8ClampedArray(i,e>>>0,t>>>0)}o(ng,"__wbg_newwithbyteoffsetandlength_06e8c938173769b5");function ig(i,e,t){return new Uint8Array(i,e>>>0,t>>>0)}o(ig,"__wbg_newwithbyteoffsetandlength_3b01ecda099177e8");function sg(i){return new Uint8Array(i>>>0)}o(sg,"__wbg_newwithlength_08f872dc1e3ada2e");function og(i){return new Uint8ClampedArray(i>>>0)}o(og,"__wbg_newwithlength_8a0d31010560ce9a");function _g(){return R(function(i,e){return new DOMException(y(i,e))},arguments)}o(_g,"__wbg_newwithmessage_54042111509ba20c");function ag(i){return i.next}o(ag,"__wbg_next_8bb824d217961b5d");function cg(){return R(function(i){return i.next()},arguments)}o(cg,"__wbg_next_e2da48d8fff7439a");function gg(i){return i.node}o(gg,"__wbg_node_905d3e251edff8a2");function ug(i){return i.now()}o(ug,"__wbg_now_2c95c9de01293173");function dg(){return Date.now()}o(dg,"__wbg_now_eb0821f3bd9f6529");function lg(i){return i.objectStoreNames}o(lg,"__wbg_objectStoreNames_e82275eb2d403a92");function pg(){return R(function(i,e,t){return i.objectStore(y(e,t))},arguments)}o(pg,"__wbg_objectStore_b463d32c86d6b543");function wg(i){return i.oldVersion}o(wg,"__wbg_oldVersion_af5af638a028177c");function bg(i){return nt.__wrap(i)}o(bg,"__wbg_olmmachine_new");function yg(){return R(function(i){return i.openCursor()},arguments)}o(yg,"__wbg_openCursor_7c13a2cd32c6258b");function fg(){return R(function(i,e){return i.openCursor(e)},arguments)}o(fg,"__wbg_openCursor_a53133c898e0829c");function hg(){return R(function(i){return i.openCursor()},arguments)}o(hg,"__wbg_openCursor_dbd279400634ae67");function vg(){return R(function(i,e,t,r){return i.open(y(e,t),r>>>0)},arguments)}o(vg,"__wbg_open_0f04f50fa4d98f67");function mg(){return R(function(i,e,t){return i.open(y(e,t))},arguments)}o(mg,"__wbg_open_b70fb421d97aad40");function kg(i){return it.__wrap(i)}o(kg,"__wbg_otheruseridentity_new");function Sg(i){return st.__wrap(i)}o(Sg,"__wbg_ownuseridentity_new");function Rg(){return R(function(i,e){return JSON.parse(y(i,e))},arguments)}o(Rg,"__wbg_parse_c7ba327fb6231e7f");function Kg(i){return i.performance}o(Kg,"__wbg_performance_7a3ffd0b17f663ad");function Ig(i){return ot.__unwrap(i)}o(Ig,"__wbg_pickledinboundgroupsession_unwrap");function Cg(i){return _t.__unwrap(i)}o(Cg,"__wbg_pickledsession_unwrap");function Eg(i){return rr.__wrap(i)}o(Eg,"__wbg_plaintexttodeviceevent_new");function Og(i){return i.process}o(Og,"__wbg_process_dc0fbacc7c1c06f7");function Mg(i,e){return i.push(e)}o(Mg,"__wbg_push_73fd7b5550ebf707");function Bg(){return R(function(i,e,t){return i.put(e,t)},arguments)}o(Bg,"__wbg_put_7f0b4dcc666f09e3");function Dg(i){return at.__wrap(i)}o(Dg,"__wbg_putdehydrateddevicerequest_new");function qg(i){return Ie.__wrap(i)}o(qg,"__wbg_qr_new");function Fg(i){queueMicrotask(i)}o(Fg,"__wbg_queueMicrotask_46c1df247678729f");function zg(i){return i.queueMicrotask}o(zg,"__wbg_queueMicrotask_8acf3ccb75ed8d11");function Ug(){return R(function(i,e){i.randomFillSync(e)},arguments)}o(Ug,"__wbg_randomFillSync_ac0988aba3254290");function Tg(i){const e=i.readyState;return(ta.indexOf(e)+1||3)-1}o(Tg,"__wbg_readyState_249e5707a38b7a7a");function jg(i){return ir.__wrap(i)}o(jg,"__wbg_rehydrateddevice_new");function Vg(){return R(function(){return module.require},arguments)}o(Vg,"__wbg_require_60cc747a6bc5215a");function xg(i){return Promise.resolve(i)}o(xg,"__wbg_resolve_0dac8c580ffd4678");function Ag(){return R(function(i){return i.result},arguments)}o(Ag,"__wbg_result_a0f1bf2fe64a516c");function Pg(i){return K.__unwrap(i)}o(Pg,"__wbg_roomid_unwrap");function Ng(i){return sr.__wrap(i)}o(Ng,"__wbg_roomkeycounts_new");function Lg(i){return or.__wrap(i)}o(Lg,"__wbg_roomkeyimportresult_new");function Wg(i){return _r.__wrap(i)}o(Wg,"__wbg_roomkeyinfo_new");function Gg(i){return ar.__wrap(i)}o(Gg,"__wbg_roomkeywithheldinfo_new");function Jg(i){return gt.__wrap(i)}o(Jg,"__wbg_roommessagerequest_new");function Hg(i){return ge.__wrap(i)}o(Hg,"__wbg_roomsettings_new");function $g(i){return Ce.__wrap(i)}o($g,"__wbg_sas_new");function Yg(i){return Ee.__wrap(i)}o(Yg,"__wbg_secretsbundle_new");function Qg(){return R(function(i,e){return setTimeout(i,e)},arguments)}o(Qg,"__wbg_setTimeout_db2dbaeefb6f39c7");function Zg(i,e,t){i[e]=t}o(Zg,"__wbg_set_3f1d0b984ed272ed");function Xg(i,e,t){i[e>>>0]=t}o(Xg,"__wbg_set_7422acbe992d64ab");function eu(i,e,t){return i.set(e,t)}o(eu,"__wbg_set_d6bdfd275fb8a4ce");function tu(i,e,t){i.set(e,t>>>0)}o(tu,"__wbg_set_fd40eacc85c5ab66");function ru(i,e,t){i.set(e,t>>>0)}o(ru,"__wbg_set_fe4e79d1ed3b0e9b");function nu(i,e){i.onabort=e}o(nu,"__wbg_setonabort_479ebb5884fcb171");function iu(i,e){i.onblocked=e}o(iu,"__wbg_setonblocked_046331b614d6f8e3");function su(i,e){i.oncomplete=e}o(su,"__wbg_setoncomplete_27bdbca012e45c05");function ou(i,e){i.onerror=e}o(ou,"__wbg_setonerror_537b68f474e27d4e");function _u(i,e){i.onerror=e}o(_u,"__wbg_setonerror_ce5c4d34aed931bb");function au(i,e){i.onsuccess=e}o(au,"__wbg_setonsuccess_0b2b45bd8cc13b95");function cu(i,e){i.onupgradeneeded=e}o(cu,"__wbg_setonupgradeneeded_be2e0ae927917f82");function gu(i,e){i.onversionchange=e}o(gu,"__wbg_setonversionchange_407ebf1ad930c84c");function uu(i,e){i.unique=e!==0}o(uu,"__wbg_setunique_727cefd7e14cf677");function du(i){return lt.__wrap(i)}o(du,"__wbg_signatures_new");function lu(i){return Oe.__wrap(i)}o(lu,"__wbg_signatureuploadrequest_new");function pu(i){return gr.__wrap(i)}o(pu,"__wbg_signatureverification_new");function wu(i,e){const t=e.stack,r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(wu,"__wbg_stack_0ed75d68575b0f3c");function bu(){const i=typeof global>"u"?null:global;return m(i)?0:M(i)}o(bu,"__wbg_static_accessor_GLOBAL_487c52c58d65314d");function yu(){const i=typeof globalThis>"u"?null:globalThis;return m(i)?0:M(i)}o(yu,"__wbg_static_accessor_GLOBAL_THIS_ee9704f328b6b291");function fu(){const i=typeof self>"u"?null:self;return m(i)?0:M(i)}o(fu,"__wbg_static_accessor_SELF_78c9e3071b912620");function hu(){const i=typeof window>"u"?null:window;return m(i)?0:M(i)}o(hu,"__wbg_static_accessor_WINDOW_a093d21393777366");function vu(i){return pt.__wrap(i)}o(vu,"__wbg_storedroomkeybundledata_new");function mu(i){return P.__wrap(i)}o(mu,"__wbg_storehandle_new");function ku(){return R(function(i){return JSON.stringify(i)},arguments)}o(ku,"__wbg_stringify_c242842b97f054cc");function Su(i,e,t){return i.subarray(e>>>0,t>>>0)}o(Su,"__wbg_subarray_dd4ade7d53bd8e26");function Ru(i){const e=i.target;return m(e)?0:M(e)}o(Ru,"__wbg_target_15f1da583855ac4e");function Ku(i,e,t){return i.then(e,t)}o(Ku,"__wbg_then_82ab9fb4080f1707");function Iu(i,e){return i.then(e)}o(Iu,"__wbg_then_db882932c0c714c6");function Cu(i){return wt.__wrap(i)}o(Cu,"__wbg_todevicerequest_new");function Eu(i){const e=i.transaction;return m(e)?0:M(e)}o(Eu,"__wbg_transaction_34c41b46ca391af6");function Ou(){return R(function(i,e,t,r){return i.transaction(y(e,t),d_[r])},arguments)}o(Ou,"__wbg_transaction_36c8b28ed4349a9a");function Mu(){return R(function(i,e,t){return i.transaction(e,d_[t])},arguments)}o(Mu,"__wbg_transaction_399fc15f5bba1880");function Bu(){return R(function(i,e){return i.update(e)},arguments)}o(Bu,"__wbg_update_297181dae0cc0af4");function Du(i){return pr.__wrap(i)}o(Du,"__wbg_userdevices_new");function qu(i){return v.__wrap(i)}o(qu,"__wbg_userid_new");function Fu(i){return v.__unwrap(i)}o(Fu,"__wbg_userid_unwrap");function zu(i){return lr.__wrap(i)}o(zu,"__wbg_utdtodeviceevent_new");function Uu(i){return i.value}o(Uu,"__wbg_value_17b896954e14f896");function Tu(){return R(function(i){return i.value},arguments)}o(Tu,"__wbg_value_648dc44894c8dc95");function ju(i){return i.values()}o(ju,"__wbg_values_81045499c3c8e670");function Vu(i){return Me.__wrap(i)}o(Vu,"__wbg_verificationrequest_new");function xu(i){return i.version}o(xu,"__wbg_version_2c3ed4a311fdabdf");function Au(i){return i.versions}o(Au,"__wbg_versions_c01dfd4722a88165");function Pu(i,e){i.warn(e)}o(Pu,"__wbg_warn_9b968a0475b49f6b");function Nu(i){console.warn(i)}o(Nu,"__wbg_warn_d89f6637da554c8d");function Lu(){return[]}o(Lu,"__wbindgen_array_new");function Wu(i,e){i.push(e)}o(Wu,"__wbindgen_array_push");function Gu(i){return+i}o(Gu,"__wbindgen_as_number");function Ju(i){return i}o(Ju,"__wbindgen_bigint_from_i64");function Hu(i){return BigInt.asUintN(64,i)}o(Hu,"__wbindgen_bigint_from_u64");function $u(i,e){const t=e,r=typeof t=="bigint"?t:void 0;B().setBigInt64(i+8*1,m(r)?BigInt(0):r,!0),B().setInt32(i+4*0,!m(r),!0)}o($u,"__wbindgen_bigint_get_as_i64");function Yu(i){const e=i;return typeof e=="boolean"?e?1:0:2}o(Yu,"__wbindgen_boolean_get");function Qu(i){const e=i.original;return e.cnt--==1?(e.a=0,!0):!1}o(Qu,"__wbindgen_cb_drop");function Zu(i,e,t){return es(i,e,40,P_)}o(Zu,"__wbindgen_closure_wrapper1160");function Xu(i,e,t){return es(i,e,432,N_)}o(Xu,"__wbindgen_closure_wrapper2391");function ed(i,e,t){return es(i,e,432,L_)}o(ed,"__wbindgen_closure_wrapper5618");function td(i,e,t){return g_(i,e,437,W_)}o(td,"__wbindgen_closure_wrapper7116");function rd(i,e,t){return g_(i,e,437,G_)}o(rd,"__wbindgen_closure_wrapper7121");function nd(i,e){const t=bi(e),r=w(t,n.__wbindgen_malloc,n.__wbindgen_realloc),s=d;B().setInt32(i+4*1,s,!0),B().setInt32(i+4*0,r,!0)}o(nd,"__wbindgen_debug_string");function id(i,e){return i in e}o(id,"__wbindgen_in");function sd(){const i=n.__wbindgen_export_4,e=i.grow(4);i.set(0,void 0),i.set(e+0,void 0),i.set(e+1,null),i.set(e+2,!0),i.set(e+3,!1)}o(sd,"__wbindgen_init_externref_table");function od(i){return typeof i=="bigint"}o(od,"__wbindgen_is_bigint");function _d(i){return typeof i=="function"}o(_d,"__wbindgen_is_function");function ad(i){return i===null}o(ad,"__wbindgen_is_null");function cd(i){const e=i;return typeof e=="object"&&e!==null}o(cd,"__wbindgen_is_object");function gd(i){return typeof i=="string"}o(gd,"__wbindgen_is_string");function ud(i){return i===void 0}o(ud,"__wbindgen_is_undefined");function dd(i,e){return i===e}o(dd,"__wbindgen_jsval_eq");function ld(i,e){return i==e}o(ld,"__wbindgen_jsval_loose_eq");function pd(){return n.memory}o(pd,"__wbindgen_memory");function wd(i,e){const t=e,r=typeof t=="number"?t:void 0;B().setFloat64(i+8*1,m(r)?0:r,!0),B().setInt32(i+4*0,!m(r),!0)}o(wd,"__wbindgen_number_get");function bd(i){return i}o(bd,"__wbindgen_number_new");function yd(i,e){const t=e,r=typeof t=="string"?t:void 0;var s=m(r)?0:w(r,n.__wbindgen_malloc,n.__wbindgen_realloc),_=d;B().setInt32(i+4*1,_,!0),B().setInt32(i+4*0,s,!0)}o(yd,"__wbindgen_string_get");function fd(i,e){return y(i,e)}o(fd,"__wbindgen_string_new");function hd(i,e){throw new Error(y(i,e))}o(hd,"__wbindgen_throw");function vd(i){let e;try{e=+i}catch(r){e=r}return e}o(vd,"__wbindgen_try_into_number");const md=Object.freeze(Object.defineProperty({__proto__:null,Attachment:vi,BackupDecryptionKey:V,BackupKeys:Tt,BackupSecretsBundle:jt,Base64EncodedPkMessage:We,BaseMigrationData:Ge,CancelInfo:he,CheckCode:Vt,CollectStrategy:W,CrossSigningBootstrapRequests:xt,CrossSigningKeyExport:At,CrossSigningStatus:Pt,Curve25519PublicKey:D,Curve25519SecretKey:Je,DecryptedRoomEvent:Nt,DecryptedToDeviceEvent:Lt,DecryptionErrorCode:Z,DecryptionSettings:oe,DehydratedDevice:Wt,DehydratedDeviceKey:H,DehydratedDevices:Gt,Device:He,DeviceId:E,DeviceKey:$e,DeviceKeyAlgorithm:Jt,DeviceKeyAlgorithmName:H_,DeviceKeyId:ve,DeviceKeyName:$_,DeviceLists:me,Ecies:mi,Ed25519PublicKey:_e,Ed25519Signature:ke,Emoji:Ht,EncryptedAttachment:Se,EncryptionAlgorithm:fe,EncryptionInfo:$t,EncryptionSettings:Ye,EstablishedEcies:ae,EventId:Qe,HistoryVisibility:Fe,IdentityKeys:Yt,InboundCreationResult:Qt,InboundGroupSession:Zt,InvalidToDeviceEvent:Xt,KeysBackupRequest:Ze,KeysClaimRequest:Xe,KeysQueryRequest:Re,KeysUploadRequest:et,LocalTrust:yi,LoggerLevel:Y_,MaybeSignature:tt,MegolmDecryptionError:rt,MegolmV1BackupKey:er,Migration:Ke,OlmMachine:nt,OtherUserIdentity:it,OutboundCreationResult:tr,OwnUserIdentity:st,PickledInboundGroupSession:ot,PickledSession:_t,PkDecryption:ki,PkEncryption:Si,PkMessage:ce,PlainTextToDeviceEvent:rr,ProcessedToDeviceEventType:ze,PutDehydratedDeviceRequest:at,Qr:Ie,QrCode:nr,QrCodeData:Ri,QrCodeMode:Q_,QrCodeScan:ct,QrState:re,RehydratedDevice:ir,RequestType:Z_,RoomId:K,RoomKeyCounts:sr,RoomKeyImportResult:or,RoomKeyInfo:_r,RoomKeyWithheldInfo:ar,RoomMessageRequest:gt,RoomSettings:ge,Sas:Ce,SecretsBundle:Ee,ServerName:ut,ShieldColor:fi,ShieldState:dt,ShieldStateCode:X,Signature:cr,SignatureState:X_,SignatureUploadRequest:Oe,SignatureVerification:gr,Signatures:lt,StoreHandle:P,StoredRoomKeyBundleData:pt,ToDeviceEncryptionInfo:ur,ToDeviceRequest:wt,ToDeviceUnableToDecryptInfo:dr,ToDeviceUnableToDecryptReason:ea,Tracing:Ki,TrustRequirement:hi,UTDToDeviceEvent:lr,UploadSigningKeysRequest:bt,UserDevices:pr,UserId:v,VerificationMethod:Ue,VerificationRequest:Me,VerificationRequestPhase:ee,Versions:wr,__wbg_Error_0497d5bdba9362e5:ia,__wbg_String_8f0eb39a4a4c2f66:sa,__wbg_Window_b0044ac7db258535:oa,__wbg_WorkerGlobalScope_b74cefefc62a37da:_a,__wbg_add_64c6e51ab0ed12dd:aa,__wbg_add_dd833f9f523abe36:ca,__wbg_at_5b2884630cb66ea6:ga,__wbg_backupkeys_new:ua,__wbg_bound_0274374bea7f6bca:da,__wbg_bound_eb572b424befade3:la,__wbg_buffer_a1a27a0dfa70165d:pa,__wbg_call_1b920c3ac0afee4b:wa,__wbg_call_36f1bbf64b4cf7c7:ba,__wbg_call_f2db6205e5c51dc8:ya,__wbg_call_fbe8be8bf6436ce5:fa,__wbg_clearTimeout_5a54f8841c30079a:ha,__wbg_clear_e6ec1cc113e1555e:va,__wbg_close_2079e209ea5709b5:ma,__wbg_code_5e459ca721f994f5:ka,__wbg_continue_7d9cdafc888cb902:Sa,__wbg_count_2941fdbb8154c02d:Ra,__wbg_count_5ceb291ba9a02b4b:Ka,__wbg_createIndex_32ba53785b2ef24e:Ia,__wbg_createIndex_a343510ba567e58c:Ca,__wbg_createObjectStore_b1f08961900155dd:Ea,__wbg_crosssigningbootstraprequests_new:Oa,__wbg_crosssigningkeyexport_new:Ma,__wbg_crosssigningstatus_new:Ba,__wbg_crypto_574e78ad8b13b65f:Da,__wbg_debug_58d16ea352cfbca1:qa,__wbg_debug_ada37632f0e8cdde:Fa,__wbg_decryptedroomevent_new:za,__wbg_decryptedtodeviceevent_new:Ua,__wbg_dehydrateddevice_new:Ta,__wbg_dehydrateddevicekey_new:ja,__wbg_deleteObjectStore_7b427b19378475fd:Va,__wbg_delete_1af2aac87b36c0f1:xa,__wbg_delete_71b7921c73aa9378:Aa,__wbg_device_new:Pa,__wbg_deviceid_new:Na,__wbg_devicekey_new:La,__wbg_devicekeyid_new:Wa,__wbg_done_4d01f352bade43b7:Ga,__wbg_emoji_new:Ja,__wbg_encryptedattachment_new:Ha,__wbg_encryptioninfo_new:$a,__wbg_entries_41651c850143b957:Ya,__wbg_entries_c951fa14164704e7:Qa,__wbg_error_24afdcd463ac8bd9:Za,__wbg_error_4e978abc9692c0c5:Xa,__wbg_error_51ecdd39ec054205:ec,__wbg_error_7534b8e9a36f1ab4:tc,__wbg_from_12ff8e47307bd4c7:rc,__wbg_getAllKeys_fce3f6ef8201c450:nc,__wbg_getAll_22a744d3b40f0fb5:ic,__wbg_getAll_654e689108532352:sc,__wbg_getAll_864be044b219e256:oc,__wbg_getRandomValues_38a1ff1ea09f6cc7:_c,__wbg_getRandomValues_b8f5dbd5f3995a9e:ac,__wbg_getTime_2afe67905d873e92:cc,__wbg_get_92470be87867c2e5:gc,__wbg_get_a131a44bd1eb6979:uc,__wbg_get_a4719581b0d717ad:dc,__wbg_get_d37904b955701f99:lc,__wbg_getwithrefkey_1dc361bd10053bfe:pc,__wbg_global_b6f5c73312f62313:wc,__wbg_inboundgroupsession_new:bc,__wbg_index_405783ca8da5f008:yc,__wbg_indexedDB_317016dcb8a872d6:fc,__wbg_indexedDB_601ec26c63e333de:hc,__wbg_indexedDB_63b82e158eb67cbd:vc,__wbg_info_e56933705c348038:mc,__wbg_info_f3589034369581f6:kc,__wbg_instanceof_ArrayBuffer_a8b6f580b363f2bc:Sc,__wbg_instanceof_Map_80cc65041c96417a:Rc,__wbg_instanceof_Promise_66f94afc64d9039f:Kc,__wbg_instanceof_Uint8Array_ca460677bc155827:Ic,__wbg_invalidtodeviceevent_new:Cc,__wbg_isArray_2a07fd175d45c496:Ec,__wbg_isArray_5f090bed72bd4f89:Oc,__wbg_isSafeInteger_90d7c4674047d684:Mc,__wbg_item_15285ca2d766f142:Bc,__wbg_iterator_4068add5b2aef7a6:Dc,__wbg_key_a17a68df9ec1b180:qc,__wbg_keysbackuprequest_new:Fc,__wbg_keysclaimrequest_new:zc,__wbg_keysqueryrequest_new:Uc,__wbg_keysuploadrequest_new:Tc,__wbg_length_471141fa24df24b2:jc,__wbg_length_ab6d22b5ead75c72:Vc,__wbg_length_f00ec12454a5d9fd:xc,__wbg_lowerBound_13c8e875a3fb9f7d:Ac,__wbg_maybesignature_new:Pc,__wbg_megolmdecryptionerror_new:Nc,__wbg_message_2d95ea5aff0d63b9:Lc,__wbg_msCrypto_a61aeb35a24c1329:Wc,__wbg_name_2acff1e83d9735f9:Gc,__wbg_new_07b483f72211fd66:Jc,__wbg_new_58353953ad2097cc:Hc,__wbg_new_8a6f238a6ece86ea:$c,__wbg_new_a2957aa5684de228:Yc,__wbg_new_a979b4b45bd55c7f:Qc,__wbg_new_b3a08d2910ee5170:Zc,__wbg_new_db7d9b0ee94df522:Xc,__wbg_new_e30c39c06edaabf2:eg,__wbg_new_e52b3efaaa774f96:tg,__wbg_newnoargs_ff528e72d35de39a:rg,__wbg_newwithbyteoffsetandlength_06e8c938173769b5:ng,__wbg_newwithbyteoffsetandlength_3b01ecda099177e8:ig,__wbg_newwithlength_08f872dc1e3ada2e:sg,__wbg_newwithlength_8a0d31010560ce9a:og,__wbg_newwithmessage_54042111509ba20c:_g,__wbg_next_8bb824d217961b5d:ag,__wbg_next_e2da48d8fff7439a:cg,__wbg_node_905d3e251edff8a2:gg,__wbg_now_2c95c9de01293173:ug,__wbg_now_eb0821f3bd9f6529:dg,__wbg_objectStoreNames_e82275eb2d403a92:lg,__wbg_objectStore_b463d32c86d6b543:pg,__wbg_oldVersion_af5af638a028177c:wg,__wbg_olmmachine_new:bg,__wbg_openCursor_7c13a2cd32c6258b:yg,__wbg_openCursor_a53133c898e0829c:fg,__wbg_openCursor_dbd279400634ae67:hg,__wbg_open_0f04f50fa4d98f67:vg,__wbg_open_b70fb421d97aad40:mg,__wbg_otheruseridentity_new:kg,__wbg_ownuseridentity_new:Sg,__wbg_parse_c7ba327fb6231e7f:Rg,__wbg_performance_7a3ffd0b17f663ad:Kg,__wbg_pickledinboundgroupsession_unwrap:Ig,__wbg_pickledsession_unwrap:Cg,__wbg_plaintexttodeviceevent_new:Eg,__wbg_process_dc0fbacc7c1c06f7:Og,__wbg_push_73fd7b5550ebf707:Mg,__wbg_put_7f0b4dcc666f09e3:Bg,__wbg_putdehydrateddevicerequest_new:Dg,__wbg_qr_new:qg,__wbg_queueMicrotask_46c1df247678729f:Fg,__wbg_queueMicrotask_8acf3ccb75ed8d11:zg,__wbg_randomFillSync_ac0988aba3254290:Ug,__wbg_readyState_249e5707a38b7a7a:Tg,__wbg_rehydrateddevice_new:jg,__wbg_require_60cc747a6bc5215a:Vg,__wbg_resolve_0dac8c580ffd4678:xg,__wbg_result_a0f1bf2fe64a516c:Ag,__wbg_roomid_unwrap:Pg,__wbg_roomkeycounts_new:Ng,__wbg_roomkeyimportresult_new:Lg,__wbg_roomkeyinfo_new:Wg,__wbg_roomkeywithheldinfo_new:Gg,__wbg_roommessagerequest_new:Jg,__wbg_roomsettings_new:Hg,__wbg_sas_new:$g,__wbg_secretsbundle_new:Yg,__wbg_setTimeout_db2dbaeefb6f39c7:Qg,__wbg_set_3f1d0b984ed272ed:Zg,__wbg_set_7422acbe992d64ab:Xg,__wbg_set_d6bdfd275fb8a4ce:eu,__wbg_set_fd40eacc85c5ab66:tu,__wbg_set_fe4e79d1ed3b0e9b:ru,__wbg_set_wasm:Xi,__wbg_setonabort_479ebb5884fcb171:nu,__wbg_setonblocked_046331b614d6f8e3:iu,__wbg_setoncomplete_27bdbca012e45c05:su,__wbg_setonerror_537b68f474e27d4e:ou,__wbg_setonerror_ce5c4d34aed931bb:_u,__wbg_setonsuccess_0b2b45bd8cc13b95:au,__wbg_setonupgradeneeded_be2e0ae927917f82:cu,__wbg_setonversionchange_407ebf1ad930c84c:gu,__wbg_setunique_727cefd7e14cf677:uu,__wbg_signatures_new:du,__wbg_signatureuploadrequest_new:lu,__wbg_signatureverification_new:pu,__wbg_stack_0ed75d68575b0f3c:wu,__wbg_static_accessor_GLOBAL_487c52c58d65314d:bu,__wbg_static_accessor_GLOBAL_THIS_ee9704f328b6b291:yu,__wbg_static_accessor_SELF_78c9e3071b912620:fu,__wbg_static_accessor_WINDOW_a093d21393777366:hu,__wbg_storedroomkeybundledata_new:vu,__wbg_storehandle_new:mu,__wbg_stringify_c242842b97f054cc:ku,__wbg_subarray_dd4ade7d53bd8e26:Su,__wbg_target_15f1da583855ac4e:Ru,__wbg_then_82ab9fb4080f1707:Ku,__wbg_then_db882932c0c714c6:Iu,__wbg_todevicerequest_new:Cu,__wbg_transaction_34c41b46ca391af6:Eu,__wbg_transaction_36c8b28ed4349a9a:Ou,__wbg_transaction_399fc15f5bba1880:Mu,__wbg_update_297181dae0cc0af4:Bu,__wbg_userdevices_new:Du,__wbg_userid_new:qu,__wbg_userid_unwrap:Fu,__wbg_utdtodeviceevent_new:zu,__wbg_value_17b896954e14f896:Uu,__wbg_value_648dc44894c8dc95:Tu,__wbg_values_81045499c3c8e670:ju,__wbg_verificationrequest_new:Vu,__wbg_version_2c3ed4a311fdabdf:xu,__wbg_versions_c01dfd4722a88165:Au,__wbg_warn_9b968a0475b49f6b:Pu,__wbg_warn_d89f6637da554c8d:Nu,__wbindgen_array_new:Lu,__wbindgen_array_push:Wu,__wbindgen_as_number:Gu,__wbindgen_bigint_from_i64:Ju,__wbindgen_bigint_from_u64:Hu,__wbindgen_bigint_get_as_i64:$u,__wbindgen_boolean_get:Yu,__wbindgen_cb_drop:Qu,__wbindgen_closure_wrapper1160:Zu,__wbindgen_closure_wrapper2391:Xu,__wbindgen_closure_wrapper5618:ed,__wbindgen_closure_wrapper7116:td,__wbindgen_closure_wrapper7121:rd,__wbindgen_debug_string:nd,__wbindgen_in:id,__wbindgen_init_externref_table:sd,__wbindgen_is_bigint:od,__wbindgen_is_function:_d,__wbindgen_is_null:ad,__wbindgen_is_object:cd,__wbindgen_is_string:gd,__wbindgen_is_undefined:ud,__wbindgen_jsval_eq:dd,__wbindgen_jsval_loose_eq:ld,__wbindgen_memory:pd,__wbindgen_number_get:wd,__wbindgen_number_new:bd,__wbindgen_string_get:yd,__wbindgen_string_new:fd,__wbindgen_throw:hd,__wbindgen_try_into_number:vd,getVersions:u_,start:A_},Symbol.toStringTag,{value:"Module"})),kd=new URL("/assets/matrix_sdk_crypto_wasm_bg-dMeGppz-.wasm",import.meta.url);Xi(new Proxy({},{get(){throw new Error("@matrix-org/matrix-sdk-crypto-wasm was used before it was initialized. Call `initAsync` first.")}}));let gi=null;async function Sd(i){const{instance:e}=await WebAssembly.instantiateStreaming(fetch(i),{"./matrix_sdk_crypto_wasm_bg.js":md});Xi(e.exports),e.exports.__wbindgen_start()}o(Sd,"loadModuleAsync");async function l_(i=kd){gi||(gi=Sd(i)),await gi}o(l_,"initAsync");var Ho=/[\\\"\x00-\x1F]/g,$={};for(var Kt=0;Kt<32;++Kt)$[String.fromCharCode(Kt)]="\\U"+("0000"+Kt.toString(16)).slice(-4).toUpperCase();$["\b"]="\\b";$["	"]="\\t";$[`
`]="\\n";$["\f"]="\\f";$["\r"]="\\r";$['"']='\\"';$["\\"]="\\\\";function p_(i){return Ho.lastIndex=0,i.replace(Ho,function(e){return $[e]})}o(p_,"escapeString");function ts(i){switch(typeof i){case"string":return'"'+p_(i)+'"';case"number":return isFinite(i)?i:"null";case"boolean":return i;case"object":return i===null?"null":Array.isArray(i)?Rd(i):Kd(i);default:throw new Error("Cannot stringify: "+typeof i)}}o(ts,"stringify");function Rd(i){for(var e="[",t="",r=0;r<i.length;++r)t+=e,e=",",t+=ts(i[r]);return e!=","?"[]":t+"]"}o(Rd,"stringifyArray");function Kd(i){var e="{",t="",r=Object.keys(i);r.sort();for(var s=0;s<r.length;++s){var _=r[s];t+=e+'"'+p_(_)+'":',e=",",t+=ts(i[_])}return e!=","?"{}":t+"}"}o(Kd,"stringifyObject");var Id={stringify:ts};const Cd=I_(Id),us=class us{constructor(e,t,r,s,_,a){this.prefixedLogger=e,this.olmMachine=t,this.keyClaimManager=r,this.outgoingRequestManager=s,this.room=_,this.encryptionSettings=a,S(this,"lazyLoadedMembersResolved",!1),S(this,"currentEncryptionPromise",Promise.resolve());var c=_.getJoinedMembers();this.olmMachine.updateTrackedUsers(c.map(g=>new v(g.userId))).catch(g=>this.prefixedLogger.error("Error initializing tracked users",g))}onCryptoEvent(e){if(JSON.stringify(this.encryptionSettings)!=JSON.stringify(e))throw new Error("Cannot reconfigure an active RoomEncryptor")}onRoomMembership(e){(e.membership==Ft.Join||e.membership==Ft.Invite&&this.room.shouldEncryptForInvitedMembers())&&this.olmMachine.updateTrackedUsers([new v(e.userId)]).catch(t=>{this.prefixedLogger.error("Unable to update tracked users",t)})}prepareForEncryption(e,t){var r=this;return u(function*(){yield r.encryptEvent(null,e,t)})()}encryptEvent(e,t,r){var s,_=this,a=new Et(this.prefixedLogger,e?(s=e.getTxnId())!==null&&s!==void 0?s:"":"prepareForEncryption"),c=this.currentEncryptionPromise.catch(()=>{}).then(u(function*(){yield G(a,"ensureEncryptionSession",u(function*(){yield _.ensureEncryptionSession(a,t,r)})),e&&(yield G(a,"encryptEventInner",u(function*(){yield _.encryptEventInner(a,e)})))}));return this.currentEncryptionPromise=c,c}ensureEncryptionSession(e,t,r){var s=this;return u(function*(){if(s.encryptionSettings.algorithm!=="m.megolm.v1.aes-sha2")throw new Error("Cannot encrypt in ".concat(s.room.roomId," for unsupported algorithm '").concat(s.encryptionSettings.algorithm,"'"));e.debug("Starting encryption");var _=yield s.room.getEncryptionTargetMembers();s.lazyLoadedMembersResolved?(e.debug("Processing outgoing requests in background"),s.outgoingRequestManager.doProcessOutgoingRequests()):(yield G(e,"loadMembersIfNeeded: updateTrackedUsers",u(function*(){yield s.olmMachine.updateTrackedUsers(_.map(b=>new v(b.userId)))})),e.debug("Updated tracked users"),s.lazyLoadedMembersResolved=!0,e.debug("Processing outgoing requests"),yield G(e,"doProcessOutgoingRequests",u(function*(){yield s.outgoingRequestManager.doProcessOutgoingRequests()}))),e.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(s.room.shouldEncryptForInvitedMembers(),"):"),_.map(b=>"".concat(b.userId," (").concat(b.membership,")")));var a=_.map(b=>new v(b.userId));yield G(e,"ensureSessionsForUsers",u(function*(){yield s.keyClaimManager.ensureSessionsForUsers(e,a)}));var c=new Ye;switch(c.historyVisibility=Ed(s.room.getHistoryVisibility()),c.algorithm=fe.MegolmV1AesSha2,typeof s.encryptionSettings.rotation_period_ms=="number"&&(c.rotationPeriod=BigInt(s.encryptionSettings.rotation_period_ms*1e3)),typeof s.encryptionSettings.rotation_period_msgs=="number"&&(c.rotationPeriodMessages=BigInt(s.encryptionSettings.rotation_period_msgs)),r.kind){case zt.AllDevicesIsolationMode:{var g,l=(g=s.room.getBlacklistUnverifiedDevices())!==null&&g!==void 0?g:t;c.sharingStrategy=W.deviceBasedStrategy(l,r.errorOnVerifiedUserProblems)}break;case zt.OnlySignedDevicesIsolationMode:c.sharingStrategy=W.identityBasedStrategy();break}yield G(e,"shareRoomKey",u(function*(){var b=yield s.olmMachine.shareRoomKey(new K(s.room.roomId),a,c);if(b)for(var h of b)yield s.outgoingRequestManager.outgoingRequestProcessor.makeOutgoingRequest(h)}))})()}forceDiscardSession(){var e=this;return u(function*(){var t=yield e.olmMachine.invalidateGroupSession(new K(e.room.roomId));t&&e.prefixedLogger.info("Discarded existing group session")})()}encryptEventInner(e,t){var r=this;return u(function*(){e.debug("Encrypting actual message content");var s=yield r.olmMachine.encryptRoomEvent(new K(r.room.roomId),t.getType(),JSON.stringify(t.getContent()));t.makeEncrypted(j.RoomMessageEncrypted,JSON.parse(s),r.olmMachine.identityKeys.curve25519.toBase64(),r.olmMachine.identityKeys.ed25519.toBase64()),e.debug("Encrypted event successfully")})()}};o(us,"RoomEncryptor");let Ii=us;function Ed(i){switch(i){case mt.Invited:return Fe.Invited;case mt.Joined:return Fe.Joined;case mt.Shared:return Fe.Shared;case mt.WorldReadable:return Fe.WorldReadable}}o(Ed,"toRustHistoryVisibility");var Te="/_matrix/client/unstable/org.matrix.msc3814.v1",ui="org.matrix.msc3814",Od=7*24*60*60*1e3;const ds=class ds extends yt{constructor(e,t,r,s,_){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=s,this.secretStorage=_,S(this,"intervalId",void 0)}cacheKey(e){var t=this;return u(function*(){yield t.olmMachine.dehydratedDevices().saveDehydratedDeviceKey(e),t.emit(C.DehydrationKeyCached)})()}isSupported(){var e=this;return u(function*(){try{yield e.http.authedRequest(O.Get,"/dehydrated_device",void 0,void 0,{prefix:Te})}catch(r){var t=r;if(t.errcode==="M_UNRECOGNIZED")return!1;if(t.errcode==="M_NOT_FOUND")return!0;throw r}return!0})()}start(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};if(typeof r=="boolean"&&(r={createNewKey:r}),!(r.onlyIfKeyCached&&!(yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey()))){if(t.stop(),r.rehydrate!==!1)try{yield t.rehydrateDeviceIfAvailable()}catch(s){t.logger.info("dehydration: Error rehydrating device:",s),t.emit(C.RehydrationError,s.message)}r.createNewKey&&(yield t.resetKey()),yield t.scheduleDeviceDehydration()}})()}isKeyStored(){var e=this;return u(function*(){return!!(yield e.secretStorage.isStored(ui))})()}resetKey(){var e=this;return u(function*(){var t=H.createRandomKey();return yield e.secretStorage.store(ui,t.toBase64()),yield e.cacheKey(t),t})()}getKey(e){var t=this;return u(function*(){var r=yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey();if(r)return r;var s=yield t.secretStorage.get(ui);if(s===void 0)return e?yield t.resetKey():null;var _=li(s);try{var a=H.createKeyFromArray(_);return yield t.cacheKey(a),a}finally{_.fill(0)}})()}rehydrateDeviceIfAvailable(){var e=this;return u(function*(){var t=yield e.getKey(!1);if(!t)return!1;var r;try{r=yield e.http.authedRequest(O.Get,"/dehydrated_device",void 0,void 0,{prefix:Te})}catch(k){var s=k;if(s.errcode==="M_NOT_FOUND"||s.errcode==="M_UNRECOGNIZED")return e.logger.info("dehydration: No dehydrated device"),!1;throw s}e.logger.info("dehydration: dehydrated device found"),e.emit(C.RehydrationStarted);var _=yield e.olmMachine.dehydratedDevices().rehydrate(t,new E(r.device_id),JSON.stringify(r.device_data));e.logger.info("dehydration: device rehydrated");for(var a=void 0,c=0,g=0,l=Un("/dehydrated_device/$device_id/events",{$device_id:r.device_id});;){var b=yield e.http.authedRequest(O.Post,l,void 0,a?{next_batch:a}:{},{prefix:Te});if(b.events.length===0)break;c+=b.events.length,a=b.next_batch;var h=yield _.receiveEvents(JSON.stringify(b.events));g+=h.length,e.emit(C.RehydrationProgress,g,c)}return e.logger.info("dehydration: received ".concat(g," room keys from ").concat(c," to-device events")),e.emit(C.RehydrationCompleted),!0})()}createAndUploadDehydratedDevice(){var e=this;return u(function*(){var t=yield e.getKey(!0),r=yield e.olmMachine.dehydratedDevices().create();e.emit(C.DehydratedDeviceCreated);var s=yield r.keysForUpload("Dehydrated device",t);yield e.outgoingRequestProcessor.makeOutgoingRequest(s),e.emit(C.DehydratedDeviceUploaded),e.logger.info("dehydration: uploaded device")})()}scheduleDeviceDehydration(){var e=this;return u(function*(){e.stop(),yield e.createAndUploadDehydratedDevice(),e.intervalId=setInterval(()=>{e.createAndUploadDehydratedDevice().catch(t=>{e.emit(C.DehydratedDeviceRotationError,t.message),e.logger.error("Error creating dehydrated device:",t)})},Od)})()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}delete(){var e=this;return u(function*(){e.stop();try{yield e.http.authedRequest(O.Delete,"/dehydrated_device",void 0,{},{prefix:Te})}catch(r){var t=r;if(t.errcode==="M_UNRECOGNIZED")return;if(t.errcode==="M_NOT_FOUND")return;throw r}})()}};o(ds,"DehydratedDeviceManager");let Ci=ds;function $o(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}o($o,"ownKeys$2");function Md(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$o(Object(t),!0).forEach(function(r){S(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):$o(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}o(Md,"_objectSpread$2");const ls=class ls{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.http=r}makeOutgoingRequest(e,t){var r=this;return u(function*(){var s;if(e instanceof et)s=yield r.requestWithRetry(O.Post,"/_matrix/client/v3/keys/upload",{},e.body);else if(e instanceof Re)s=yield r.requestWithRetry(O.Post,"/_matrix/client/v3/keys/query",{},e.body);else if(e instanceof Xe)s=yield r.requestWithRetry(O.Post,"/_matrix/client/v3/keys/claim",{},e.body);else if(e instanceof Oe)s=yield r.requestWithRetry(O.Post,"/_matrix/client/v3/keys/signatures/upload",{},e.body);else if(e instanceof Ze)s=yield r.requestWithRetry(O.Put,"/_matrix/client/v3/room_keys/keys",{version:e.version},e.body);else if(e instanceof wt)s=yield r.sendToDeviceRequest(e);else if(e instanceof gt){var _="/_matrix/client/v3/rooms/".concat(encodeURIComponent(e.room_id),"/send/")+"".concat(encodeURIComponent(e.event_type),"/").concat(encodeURIComponent(e.txn_id));s=yield r.requestWithRetry(O.Put,_,{},e.body)}else if(e instanceof bt){yield r.makeRequestWithUIA(O.Post,"/_matrix/client/v3/keys/device_signing/upload",{},e.body,t);return}else if(e instanceof at){var a=Te+"/dehydrated_device";yield r.rawJsonRequest(O.Put,a,{},e.body);return}else r.logger.warn("Unsupported outgoing message",Object.getPrototypeOf(e)),s="";if(e.id)try{yield G(r.logger,"Mark Request as sent ".concat(e.type),u(function*(){yield r.olmMachine.markRequestAsSent(e.id,e.type,s)}))}catch(c){if(c instanceof Error&&(c.message==="Attempt to use a moved value"||c.message==="null pointer passed to rust"))r.logger.debug("Ignoring error '".concat(c.message,"': client is likely shutting down"));else throw c}else r.logger.trace("Outgoing request type:".concat(e.type," does not have an ID"))})()}sendToDeviceRequest(e){var t=this;return u(function*(){var r=JSON.parse(e.body),s=[];for(var[_,a]of Object.entries(r.messages))for(var[c,g]of Object.entries(a))s.push("".concat(_,"/").concat(c," (msgid ").concat(g[C_],")"));t.logger.info("Sending batch of to-device messages. type=".concat(e.event_type," txnid=").concat(e.txn_id),s);var l="/_matrix/client/v3/sendToDevice/".concat(encodeURIComponent(e.event_type),"/")+encodeURIComponent(e.txn_id);return yield t.requestWithRetry(O.Put,l,{},e.body)})()}makeRequestWithUIA(e,t,r,s,_){var a=this;return u(function*(){if(!_)return yield a.requestWithRetry(e,t,r,s);var c=JSON.parse(s),g=function(){var b=u(function*(h){var k=Md({},c);h!==null&&(k.auth=h);var I=yield a.requestWithRetry(e,t,r,JSON.stringify(k));return JSON.parse(I)});return o(function(k){return b.apply(this,arguments)},"makeRequest")}(),l=yield _(g);return JSON.stringify(l)})()}requestWithRetry(e,t,r,s){var _=this;return u(function*(){for(var a=0;;)try{return yield _.rawJsonRequest(e,t,r,s)}catch(g){a++;var c=E_(g,a,!0);if(c<0)throw g;yield se(c)}})()}rawJsonRequest(e,t,r,s){var _=this;return u(function*(){var a={json:!1,headers:{"Content-Type":"application/json",Accept:"application/json"},prefix:"",localTimeoutMs:6e4};return yield _.http.authedRequest(e,t,r,s,a)})()}};o(ls,"OutgoingRequestProcessor");let Ei=ls;const ps=class ps{constructor(e,t){this.olmMachine=e,this.outgoingRequestProcessor=t,S(this,"currentClaimPromise",void 0),S(this,"stopped",!1),this.currentClaimPromise=Promise.resolve()}stop(){this.stopped=!0}ensureSessionsForUsers(e,t){var r=this.currentClaimPromise.catch(()=>{}).then(()=>this.ensureSessionsForUsersInner(e,t));return this.currentClaimPromise=r,r}ensureSessionsForUsersInner(e,t){var r=this;return u(function*(){if(r.stopped)throw new Error("Cannot ensure Olm sessions: shutting down");e.info("Checking for missing Olm sessions");var s=yield r.olmMachine.getMissingSessions(t.map(_=>_.clone()));s&&(e.info("Making /keys/claim request"),yield r.outgoingRequestProcessor.makeOutgoingRequest(s)),e.info("Olm sessions prepared")})()}};o(ps,"KeyClaimManager");let Oi=ps;function Bd(i,e){var t=new Map;for(var[r,s]of i.keys.entries())t.set(r.toString(),s.toBase64());var _=Ot.Unverified;i.isBlacklisted()?_=Ot.Blocked:i.isVerified()&&(_=Ot.Verified);var a=new Map,c=i.signatures.get(e);if(c){var g=new Map;for(var[l,b]of c.entries())b.isValid()&&b.signature&&g.set(l,b.signature.toBase64());a.set(e.toString(),g)}var h=i.algorithms,k=new Set;return h.forEach(I=>{switch(I){case fe.MegolmV1AesSha2:k.add("m.megolm.v1.aes-sha2");break;case fe.OlmV1Curve25519AesSha2:default:k.add("m.olm.v1.curve25519-aes-sha2");break}}),new n_({deviceId:i.deviceId.toString(),userId:e.toString(),keys:t,algorithms:Array.from(k),verified:_,signatures:a,displayName:i.displayName,dehydrated:i.isDehydrated})}o(Bd,"rustDeviceToJsDevice");function Dd(i){return new Map(Object.entries(i).map(e=>{var[t,r]=e;return[t,qd(r)]}))}o(Dd,"deviceKeysToDeviceMap");function qd(i){var e,t=new Map(Object.entries(i.keys)),r=(e=i.unsigned)===null||e===void 0?void 0:e.device_display_name,s=new Map;if(i.signatures)for(var _ in i.signatures)s.set(_,new Map(Object.entries(i.signatures[_])));return new n_({deviceId:i.device_id,userId:i.user_id,keys:t,algorithms:i.algorithms,verified:Ot.Unverified,signatures:s,displayName:r})}o(qd,"downloadDeviceToJsDevice");const ws=class ws{constructor(e,t,r,s){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,this.secretStorage=s}bootstrapCrossSigning(e){var t=this;return u(function*(){if(e.setupNewCrossSigning){yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);return}var r=yield t.olmMachine.crossSigningStatus(),s=yield t.secretStorage.get("m.cross_signing.master"),_=yield t.secretStorage.get("m.cross_signing.self_signing"),a=yield t.secretStorage.get("m.cross_signing.user_signing"),c=!!(s&&_&&a),g=r.hasMaster&&r.hasUserSigning&&r.hasSelfSigning;if(t.logger.debug("bootstrapCrossSigning: starting",{setupNewCrossSigning:e.setupNewCrossSigning,olmDeviceHasMaster:r.hasMaster,olmDeviceHasUserSigning:r.hasUserSigning,olmDeviceHasSelfSigning:r.hasSelfSigning,privateKeysInSecretStorage:c}),g)(yield t.secretStorage.hasKey())?c?t.logger.debug("bootstrapCrossSigning: Olm device has private keys and they are saved in secret storage; doing nothing"):(t.logger.debug("bootstrapCrossSigning: Olm device has private keys: exporting to secret storage"),yield t.exportCrossSigningKeysToStorage()):t.logger.warn("bootstrapCrossSigning: Olm device has private keys, but secret storage is not yet set up; doing nothing for now.");else if(c){t.logger.debug("bootstrapCrossSigning: Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally");var l=yield t.olmMachine.importCrossSigningKeys(s,_,a);if(!l.hasMaster||!l.hasSelfSigning||!l.hasUserSigning)throw new Error("importCrossSigningKeys failed to import the keys");var b=yield t.olmMachine.getDevice(t.olmMachine.userId,t.olmMachine.deviceId);try{var h=yield b.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(h)}finally{b.free()}}else t.logger.debug("bootstrapCrossSigning: Cross-signing private keys not found locally or in secret storage, creating new keys"),yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);t.logger.debug("bootstrapCrossSigning: complete")})()}resetCrossSigning(e){var t=this;return u(function*(){var r=yield t.olmMachine.bootstrapCrossSigning(!0);(yield t.secretStorage.hasKey())?(t.logger.debug("resetCrossSigning: exporting private keys to secret storage"),yield t.exportCrossSigningKeysToStorage()):t.logger.warn("resetCrossSigning: Secret storage is not yet set up; not exporting keys to secret storage yet."),t.logger.debug("resetCrossSigning: publishing public keys to server");for(var s of[r.uploadKeysRequest,r.uploadSigningKeysRequest,r.uploadSignaturesRequest])s&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(s,e))})()}exportCrossSigningKeysToStorage(){var e=this;return u(function*(){var t=yield e.olmMachine.exportCrossSigningKeys();t!=null&&t.masterKey?yield e.secretStorage.store("m.cross_signing.master",t.masterKey):e.logger.error("Cannot export MSK to secret storage, private key unknown"),t!=null&&t.self_signing_key?yield e.secretStorage.store("m.cross_signing.self_signing",t.self_signing_key):e.logger.error("Cannot export SSK to secret storage, private key unknown"),t!=null&&t.userSigningKey?yield e.secretStorage.store("m.cross_signing.user_signing",t.userSigningKey):e.logger.error("Cannot export USK to secret storage, private key unknown")})()}};o(ws,"CrossSigningIdentity");let Mi=ws;function Yo(i){return Bi.apply(this,arguments)}o(Yo,"secretStorageContainsCrossSigningKeys");function Bi(){return Bi=u(function*(i){return w_(i,["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"])}),Bi.apply(this,arguments)}o(Bi,"_secretStorageContainsCrossSigningKeys");function w_(i,e){return Di.apply(this,arguments)}o(w_,"secretStorageCanAccessSecrets");function Di(){return Di=u(function*(i,e){var t=yield i.getDefaultKeyId();if(!t)return!1;for(var r of e){var s=(yield i.isStored(r))||{};if(!(t in s))return!1}return!0}),Di.apply(this,arguments)}o(Di,"_secretStorageCanAccessSecrets");var A=function(i){return i.Sas="m.sas.v1",i.ShowQrCode="m.qr_code.show.v1",i.ScanQrCode="m.qr_code.scan.v1",i.Reciprocate="m.reciprocate.v1",i}({});const bs=class bs extends yt{constructor(e,t,r,s,_){super(),this.logger=e,this.olmMachine=t,this.inner=r,this.outgoingRequestProcessor=s,this.supportedVerificationMethods=_,S(this,"reEmitter",void 0),S(this,"_accepting",!1),S(this,"_cancelling",!1),S(this,"_verifier",void 0),this.reEmitter=new i_(this);var a=new WeakRef(this);r.registerChangesCallback(u(function*(){var c;return(c=a.deref())===null||c===void 0?void 0:c.onChange()}))}onChange(){var e=this.inner.getVerification();e instanceof Ce?this._verifier===void 0||this._verifier instanceof yr?this.setVerifier(new fr(e,this,this.outgoingRequestProcessor)):this._verifier instanceof fr&&this._verifier.replaceInner(e):e instanceof Ie&&this._verifier===void 0&&this.setVerifier(new yr(e,this.outgoingRequestProcessor)),this.emit(qe.Change)}setVerifier(e){this._verifier&&this.reEmitter.stopReEmitting(this._verifier,[qe.Change]),this._verifier=e,this.reEmitter.reEmit(this._verifier,[qe.Change])}get transactionId(){return this.inner.flowId}get roomId(){var e;return(e=this.inner.roomId)===null||e===void 0?void 0:e.toString()}get initiatedByMe(){return this.inner.weStarted()}get otherUserId(){return this.inner.otherUserId.toString()}get otherDeviceId(){var e;return(e=this.inner.otherDeviceId)===null||e===void 0?void 0:e.toString()}getOtherDevice(){var e=this;return u(function*(){var t=e.inner.otherDeviceId;if(t)return yield e.olmMachine.getDevice(e.inner.otherUserId,t,5)})()}get isSelfVerification(){return this.inner.isSelfVerification()}get phase(){var e=this.inner.phase();switch(e){case ee.Created:case ee.Requested:return q.Requested;case ee.Ready:return this._accepting?q.Requested:q.Ready;case ee.Transitioned:if(!this._verifier)throw new Error("VerificationRequest: inner phase == Transitioned but no verifier!");return this._verifier.verificationPhase;case ee.Done:return q.Done;case ee.Cancelled:return q.Cancelled}throw new Error("Unknown verification phase ".concat(e))}get pending(){if(this.inner.isPassive())return!1;var e=this.phase;return e!==q.Done&&e!==q.Cancelled}get accepting(){return this._accepting}get declining(){return this._cancelling}get timeout(){return this.inner.timeRemainingMillis()}get methods(){throw new Error("not implemented")}get chosenMethod(){if(this.phase!==q.Started)return null;var e=this.inner.getVerification();return e instanceof Ce?A.Sas:e instanceof Ie?A.Reciprocate:null}otherPartySupportsMethod(e){var t=this.inner.theirSupportedMethods;if(t===void 0)return!1;var r=b_[e];return t.some(s=>s===r)}accept(){var e=this;return u(function*(){if(e.inner.phase()!==ee.Requested||e._accepting)throw new Error("Cannot accept a verification request in phase ".concat(e.phase));e._accepting=!0;try{var t=e.inner.acceptWithMethods(e.supportedVerificationMethods.map(qt));t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}finally{e._accepting=!1}e.emit(qe.Change)})()}cancel(e){var t=this;return u(function*(){if(!t._cancelling){t.logger.info("Cancelling verification request with params:",e),t._cancelling=!0;try{var r=t.inner.cancel();r&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(r))}finally{t._cancelling=!1}}})()}beginKeyVerification(e,t){throw new Error("not implemented")}startVerification(e){var t=this;return u(function*(){if(e!==A.Sas)throw new Error("Unsupported verification method ".concat(e));if(!(yield t.getOtherDevice()))throw new Error("startVerification(): other device is unknown");var r=yield t.inner.startSas();if(r){var[,s]=r;yield t.outgoingRequestProcessor.makeOutgoingRequest(s)}if(!t._verifier)throw new Error("Still no verifier after startSas() call");return t._verifier})()}scanQRCode(e){var t=this;return u(function*(){var r=ct.fromBytes(e),s=yield t.inner.scanQrCode(r);if(!t._verifier)throw new Error("Still no verifier after scanQrCode() call");var _=s.reciprocate();return _&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(_)),t._verifier})()}get verifier(){return this.phase===q.Started?this._verifier:void 0}getQRCodeBytes(){throw new Error("getQRCodeBytes() unsupported in Rust Crypto; use generateQRCode() instead.")}generateQRCode(){var e=this;return u(function*(){if(!(yield e.getOtherDevice()))throw new Error("generateQRCode(): other device is unknown");var t=yield e.inner.generateQrCode();if(t)return t.toBytes()})()}get cancellationCode(){var e,t;return(e=(t=this.inner.cancelInfo)===null||t===void 0?void 0:t.cancelCode())!==null&&e!==void 0?e:null}get cancellingUserId(){var e=this.inner.cancelInfo;if(e)return e.cancelledbyUs()?this.olmMachine.userId.toString():this.inner.otherUserId.toString()}};o(bs,"RustVerificationRequest");let qi=bs;const ys=class ys extends yt{constructor(e,t){super(),this.inner=e,this.outgoingRequestProcessor=t,S(this,"completionDeferred",void 0),this.completionDeferred=Promise.withResolvers();var r=new WeakRef(this);e.registerChangesCallback(u(function*(){var s;return(s=r.deref())===null||s===void 0?void 0:s.onChange()})),this.completionDeferred.promise.catch(()=>null)}onChange(){if(this.inner.isDone())this.completionDeferred.resolve(void 0);else if(this.inner.isCancelled()){var e=this.inner.cancelInfo();this.completionDeferred.reject(new Error("Verification cancelled by ".concat(e.cancelledbyUs()?"us":"them"," with code ").concat(e.cancelCode(),": ").concat(e.reason())))}this.emit(qe.Change)}get hasBeenCancelled(){return this.inner.isCancelled()}get userId(){return this.inner.otherUserId.toString()}cancel(e){var t=this.inner.cancel();t&&this.outgoingRequestProcessor.makeOutgoingRequest(t)}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}};o(ys,"BaseRustVerifer");let br=ys;const fs=class fs extends br{constructor(e,t){super(e,t),S(this,"callbacks",null)}onChange(){this.callbacks===null&&this.inner.hasBeenScanned()&&(this.callbacks={confirm:o(()=>{this.confirmScanning()},"confirm"),cancel:o(()=>this.cancel(),"cancel")}),super.onChange()}verify(){var e=this;return u(function*(){e.callbacks!==null&&e.emit(__.ShowReciprocateQr,e.callbacks),yield e.completionDeferred.promise})()}get verificationPhase(){switch(this.inner.state()){case re.Created:return q.Ready;case re.Scanned:return q.Started;case re.Confirmed:return q.Started;case re.Reciprocated:return q.Started;case re.Done:return q.Done;case re.Cancelled:return q.Cancelled;default:throw new Error("Unknown qr code state ".concat(this.inner.state()))}}getReciprocateQrCodeCallbacks(){return this.callbacks}confirmScanning(){var e=this;return u(function*(){var t=e.inner.confirmScanning();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))})()}};o(fs,"RustQrCodeVerifier");let yr=fs;const hs=class hs extends br{constructor(e,t,r){super(e,r),S(this,"callbacks",null)}verify(){var e=this;return u(function*(){yield e.sendAccept(),yield e.completionDeferred.promise})()}sendAccept(){var e=this;return u(function*(){var t=e.inner.accept();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))})()}onChange(){var e=this;if(super.onChange(),this.callbacks===null){var t=this.inner.emoji(),r=this.inner.decimals();if(t===void 0&&r===void 0)return;var s={};t&&(s.emoji=t.map(_=>[_.symbol,_.description])),r&&(s.decimal=[r[0],r[1],r[2]]),this.callbacks={sas:s,confirm:function(){var _=u(function*(){var c=yield e.inner.confirm();for(var g of c)yield e.outgoingRequestProcessor.makeOutgoingRequest(g)});function a(){return _.apply(this,arguments)}return o(a,"confirm"),a}(),mismatch:o(()=>{var _=this.inner.cancelWithCode("m.mismatched_sas");_&&this.outgoingRequestProcessor.makeOutgoingRequest(_)},"mismatch"),cancel:o(()=>{var _=this.inner.cancelWithCode("m.user");_&&this.outgoingRequestProcessor.makeOutgoingRequest(_)},"cancel")},this.emit(__.ShowSas,this.callbacks)}}get verificationPhase(){return q.Started}getShowSasCallbacks(){return this.callbacks}replaceInner(e){if(this.inner!=e){this.inner=e;var t=new WeakRef(this);e.registerChangesCallback(u(function*(){var r;return(r=t.deref())===null||r===void 0?void 0:r.onChange()})),this.sendAccept(),this.onChange()}}};o(hs,"RustSASVerifier");let fr=hs;var b_={[A.Sas]:Ue.SasV1,[A.ScanQrCode]:Ue.QrCodeScanV1,[A.ShowQrCode]:Ue.QrCodeShowV1,[A.Reciprocate]:Ue.ReciprocateV1};function qt(i){var e=b_[i];if(e===void 0)throw new Error("Unknown verification method ".concat(i));return e}o(qt,"verificationMethodIdentifierToMethod");function Fd(i){switch(i.getType()){case j.KeyVerificationCancel:case j.KeyVerificationDone:case j.KeyVerificationMac:case j.KeyVerificationStart:case j.KeyVerificationKey:case j.KeyVerificationReady:case j.KeyVerificationAccept:return!0;case j.RoomMessage:return i.getContent().msgtype===s_.KeyVerificationRequest;default:return!1}}o(Fd,"isVerificationEvent");const vs=class vs extends yt{constructor(e,t,r,s){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=s,S(this,"checkedForBackup",!1),S(this,"serverBackupInfo",void 0),S(this,"activeBackupVersion",null),S(this,"stopped",!1),S(this,"backupKeysLoopRunning",!1),S(this,"keyBackupCheckInProgress",null)}stop(){this.stopped=!0}getActiveBackupVersion(){var e=this;return u(function*(){return(yield e.olmMachine.isBackupEnabled())?e.activeBackupVersion:null})()}getServerBackupInfo(){var e=this;return u(function*(){return yield e.checkKeyBackupAndEnable(!1),e.serverBackupInfo})()}isKeyBackupTrusted(e){var t=this;return u(function*(){var r=yield t.olmMachine.verifyBackup(e),s=yield t.olmMachine.getBackupKeys(),_=s==null?void 0:s.decryptionKey,a=!!_&&t.backupInfoMatchesBackupDecryptionKey(e,_);return{matchesDecryptionKey:a,trusted:r.trusted()}})()}checkKeyBackupAndEnable(e){return!e&&this.checkedForBackup?Promise.resolve(null):(this.keyBackupCheckInProgress||(this.keyBackupCheckInProgress=this.doCheckKeyBackup().finally(()=>{this.keyBackupCheckInProgress=null})),this.keyBackupCheckInProgress)}handleBackupSecretReceived(e){var t=this;return u(function*(){var r,s;try{s=yield t.requestKeyBackupVersion()}catch(c){return t.logger.warn("handleBackupSecretReceived: Error checking for latest key backup",c),!1}if(!((r=s)!==null&&r!==void 0&&r.version))return t.logger.warn("handleBackupSecretReceived: Received a backup decryption key, but there is no trusted server-side key backup"),!1;try{var _=V.fromBase64(e),a=t.backupInfoMatchesBackupDecryptionKey(s,_);return a?(t.logger.info("handleBackupSecretReceived: A valid backup decryption key has been received and stored in cache."),yield t.saveBackupDecryptionKey(_,s.version),!0):(t.logger.warn("handleBackupSecretReceived: Private decryption key does not match the public key of the current remote backup."),!1)}catch(c){t.logger.warn("handleBackupSecretReceived: Invalid backup decryption key",c)}return!1})()}saveBackupDecryptionKey(e,t){var r=this;return u(function*(){yield r.olmMachine.saveBackupDecryptionKey(e,t),r.emit(C.KeyBackupDecryptionKeyCached,t)})()}importRoomKeys(e,t){var r=this;return u(function*(){yield r.importRoomKeysAsJson(JSON.stringify(e),t)})()}importRoomKeysAsJson(e,t){var r=this;return u(function*(){yield r.olmMachine.importExportedRoomKeys(e,(s,_)=>{var a,c={total:Number(_),successes:Number(s),stage:De.LoadKeys,failures:0};t==null||(a=t.progressCallback)===null||a===void 0||a.call(t,c)})})()}importBackedUpRoomKeys(e,t,r){var s=this;return u(function*(){var _=new Map;for(var a of e){var c=new K(a.room_id);_.has(c)||_.set(c,new Map),_.get(c).set(a.session_id,a)}yield s.olmMachine.importBackedUpRoomKeys(_,(g,l,b)=>{var h,k={total:Number(l),successes:Number(g),stage:De.LoadKeys,failures:Number(b)};r==null||(h=r.progressCallback)===null||h===void 0||h.call(r,k)},t)})()}doCheckKeyBackup(){var e=this;return u(function*(){e.logger.debug("Checking key backup status...");var t;try{t=yield e.requestKeyBackupVersion()}catch(_){return e.logger.warn("Error checking for active key backup",_),e.serverBackupInfo=void 0,null}e.checkedForBackup=!0,t&&!t.version&&(e.logger.warn("active backup lacks a useful 'version'; ignoring it"),t=void 0),e.serverBackupInfo=t;var r=yield e.getActiveBackupVersion();if(!t)return r!==null?(e.logger.debug("No key backup present on server: disabling key backup"),yield e.disableKeyBackup()):e.logger.debug("No key backup present on server: not enabling key backup"),null;var s=yield e.isKeyBackupTrusted(t);return!s.matchesDecryptionKey&&!s.trusted?r!==null?(e.logger.debug("Key backup present on server but not trusted: disabling key backup"),yield e.disableKeyBackup()):e.logger.debug("Key backup present on server but not trusted: not enabling key backup"):r===null?(e.logger.debug("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):r!==t.version?(e.logger.debug("On backup version ".concat(r," but found version ").concat(t.version,": switching.")),yield e.disableKeyBackup(),yield e.enableKeyBackup(t)):e.logger.debug("Backup version ".concat(t.version," still current")),{backupInfo:t,trustInfo:s}})()}enableKeyBackup(e){var t=this;return u(function*(){yield t.olmMachine.enableBackupV1(e.auth_data.public_key,e.version),t.activeBackupVersion=e.version,t.emit(C.KeyBackupStatus,!0),t.backupKeysLoop()})()}maybeUploadKey(){var e=this;return u(function*(){e.activeBackupVersion!=null&&e.backupKeysLoop()})()}disableKeyBackup(){var e=this;return u(function*(){yield e.olmMachine.disableBackup(),e.activeBackupVersion=null,e.emit(C.KeyBackupStatus,!1)})()}backupKeysLoop(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:1e4;if(t.backupKeysLoopRunning){t.logger.debug("Backup loop already running");return}t.backupKeysLoopRunning=!0,t.logger.debug("Backup: Starting keys upload loop for backup version:".concat(t.activeBackupVersion,"."));var s=Math.random()*r;yield se(s);try{for(var _=0,a=null,c=!0;!t.stopped;){var g=void 0;try{g=yield G(t.logger,"BackupRoomKeys: Get keys to backup from rust crypto-sdk",u(function*(){return yield t.olmMachine.backupRoomKeys()}))}catch(I){t.logger.error("Backup: Failed to get keys to backup from rust crypto-sdk",I)}if(!g||t.stopped||!t.activeBackupVersion){t.logger.debug("Backup: Ending loop for version ".concat(t.activeBackupVersion,".")),g||t.emit(C.KeyBackupSessionsRemaining,0);return}try{if(yield t.outgoingRequestProcessor.makeOutgoingRequest(g),_=0,t.stopped)break;if(!c&&a===null)try{var l=yield t.olmMachine.roomKeyCounts();a=l.total-l.backedUp}catch(I){t.logger.error("Backup: Failed to get key counts from rust crypto-sdk",I)}if(a!==null){t.emit(C.KeyBackupSessionsRemaining,a);var b=t.keysCountInBatch(g);a=Math.max(a-b,0)}}catch(I){if(_++,t.logger.error("Backup: Error processing backup request for rust crypto-sdk",I),I instanceof o_){var h=I.data.errcode;if(h=="M_NOT_FOUND"||h=="M_WRONG_ROOM_KEYS_VERSION"){t.logger.debug("Backup: Failed to upload keys to current vesion: ".concat(h,"."));try{yield t.disableKeyBackup()}catch(F){t.logger.error("Backup: An error occurred while disabling key backup:",F)}t.emit(C.KeyBackupFailed,I.data.errcode),t.backupKeysLoopRunning=!1,t.checkKeyBackupAndEnable(!0);return}else if(I.isRateLimitError())try{var k=I.getRetryAfterMs();if(k&&k>0){yield se(k);continue}}catch(F){t.logger.warn("Backup: An error occurred while retrieving a rate-limit retry delay",F)}}yield se(1e3*Math.pow(2,Math.min(_-1,4)))}c=!1}}finally{t.backupKeysLoopRunning=!1}})()}keysCountInBatch(e){var t=JSON.parse(e.body);return Qo(t)}requestKeyBackupVersion(e){var t=this;return u(function*(){return yield y_(t.http,e)})()}setupKeyBackup(e){var t=this;return u(function*(){yield t.deleteAllKeyBackupVersions();var r=V.createRandomKey(),s=r.megolmV1PublicKey,_={public_key:s.publicKeyBase64};yield e(_);var a=yield t.http.authedRequest(O.Post,"/room_keys/version",void 0,{algorithm:s.algorithm,auth_data:_},{prefix:je.V3});return yield t.saveBackupDecryptionKey(r,a.version),{version:a.version,algorithm:s.algorithm,authData:_,decryptionKey:r}})()}deleteAllKeyBackupVersions(){var e=this;return u(function*(){for(var t,r,s=(t=(r=yield e.requestKeyBackupVersion())===null||r===void 0?void 0:r.version)!==null&&t!==void 0?t:null;s!=null;){var _,a;yield e.deleteKeyBackupVersion(s),s=(_=(a=yield e.requestKeyBackupVersion())===null||a===void 0?void 0:a.version)!==null&&_!==void 0?_:null}})()}deleteKeyBackupVersion(e){var t=this;return u(function*(){t.logger.debug("deleteKeyBackupVersion v:".concat(e));var r=Un("/room_keys/version/$version",{$version:e});yield t.http.authedRequest(O.Delete,r,void 0,void 0,{prefix:je.V3}),t.activeBackupVersion===e&&(t.serverBackupInfo=null,yield t.disableKeyBackup())})()}createBackupDecryptor(e){return new zi(this.logger,e)}restoreKeyBackup(e,t,r){var s=this;return u(function*(){var _=yield s.downloadKeyBackup(e);return s.importKeyBackup(_,e,t,r)})()}downloadKeyBackup(e){return this.http.authedRequest(O.Get,"/room_keys/keys",{version:e},void 0,{prefix:je.V3})}importKeyBackup(e,t,r,s){var _=this;return u(function*(){var a,c=200,g=Qo(e),l=0,b=0;s==null||(a=s.progressCallback)===null||a===void 0||a.call(s,{total:g,successes:l,stage:De.LoadKeys,failures:b});var h=function(){var v_=u(function*(Tn){var ht,vt=[],m_=o(function*(Os){var S_=yield r.decryptSessions(Tn.get(Os));S_.forEach(Ms=>{Ms.room_id=Os,vt.push(Ms)})},"_loop");for(var k_ of Tn.keys())yield*m_(k_);try{yield _.importBackedUpRoomKeys(vt,t),l+=vt.length}catch(Es){b+=vt.length,_.logger.error("Error importing keys from backup",Es)}s==null||(ht=s.progressCallback)===null||ht===void 0||ht.call(s,{total:g,successes:l,stage:De.LoadKeys,failures:b})});return o(function(ht){return v_.apply(this,arguments)},"handleChunkCallback")}(),k=0,I=new Map;for(var[F,Y]of Object.entries(e.rooms))if(Y.sessions){I.set(F,{});for(var[Be,f_]of Object.entries(Y.sessions)){var h_=I.get(F);h_[Be]=f_,k+=1,k>=c&&(yield h(I),I=new Map,I.set(F,{}),k=0)}}return k>0&&(yield h(I)),{total:g,imported:l}})()}backupInfoMatchesBackupDecryptionKey(e,t){var r;return e.algorithm!=="m.megolm_backup.v1.curve25519-aes-sha2"?(this.logger.warn("backupMatchesPrivateKey: Unsupported backup algorithm",e.algorithm),!1):((r=e.auth_data)===null||r===void 0?void 0:r.public_key)===t.megolmV1PublicKey.publicKeyBase64}};o(vs,"RustBackupManager");let Fi=vs;const ms=class ms{constructor(e,t){this.logger=e,S(this,"decryptionKey",void 0),S(this,"sourceTrusted",void 0),this.decryptionKey=t,this.sourceTrusted=!1}decryptSessions(e){var t=this;return u(function*(){var r=[];for(var[s,_]of Object.entries(e))try{var a=JSON.parse(t.decryptionKey.decryptV1(_.session_data.ephemeral,_.session_data.mac,_.session_data.ciphertext));a.session_id=s,r.push(a)}catch(c){t.logger.debug("Failed to decrypt megolm session from backup",c,_)}return r})()}free(){this.decryptionKey.free()}};o(ms,"RustBackupDecryptor");let zi=ms;function y_(i,e){return Ui.apply(this,arguments)}o(y_,"requestKeyBackupVersion");function Ui(){return Ui=u(function*(i,e){try{var t=e?Un("/room_keys/version/$version",{$version:e}):"/room_keys/version";return yield i.authedRequest(O.Get,t,void 0,void 0,{prefix:je.V3})}catch(r){if(r.errcode==="M_NOT_FOUND")return null;throw r}}),Ui.apply(this,arguments)}o(Ui,"_requestKeyBackupVersion");function di(i,e){var t=e.auth_data;return t.public_key===i.megolmV1PublicKey.publicKeyBase64}o(di,"decryptionKeyMatchesKeyBackupInfo");function Qo(i){var e=0;for(var{sessions:t}of Object.values(i.rooms))e+=Object.keys(t).length;return e}o(Qo,"countKeysInBackup");const ks=class ks{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,S(this,"stopped",!1),S(this,"outgoingRequestLoopRunning",!1),S(this,"nextLoopDeferred",void 0)}stop(){this.stopped=!0}doProcessOutgoingRequests(){this.nextLoopDeferred||(this.nextLoopDeferred=Promise.withResolvers());var e=this.nextLoopDeferred.promise;return this.outgoingRequestLoopRunning||this.outgoingRequestLoop().catch(t=>{this.logger.error("Uncaught error in outgoing request loop",t)}),e}outgoingRequestLoop(){var e=this;return u(function*(){if(e.outgoingRequestLoopRunning)throw new Error("Cannot run two outgoing request loops");e.outgoingRequestLoopRunning=!0;try{for(;!e.stopped&&e.nextLoopDeferred;){var t=e.nextLoopDeferred;e.nextLoopDeferred=void 0,yield e.processOutgoingRequests().then(t.resolve,t.reject)}}finally{e.outgoingRequestLoopRunning=!1}e.nextLoopDeferred&&e.nextLoopDeferred.reject(new Error("OutgoingRequestsManager was stopped"))})()}processOutgoingRequests(){var e=this;return u(function*(){if(!e.stopped){var t=yield e.olmMachine.outgoingRequests(),r=o(function*(c){if(e.stopped)return{v:void 0};try{yield G(e.logger,"Make outgoing request ".concat(c.type),u(function*(){yield e.outgoingRequestProcessor.makeOutgoingRequest(c)}))}catch(g){e.logger.error("Failed to process outgoing request ".concat(c.type,": ").concat(g))}},"_loop"),s;for(var _ of t)if(s=yield*r(_),s)return s.v}})()}};o(ks,"OutgoingRequestsManager");let Ti=ks;var It=5e3,te=function(i){return i.MISSING_DECRYPTION_KEY="MISSING_DECRYPTION_KEY",i.NETWORK_ERROR="NETWORK_ERROR",i.STOPPED="STOPPED",i}(te||{});const Ss=class Ss extends Error{constructor(e){super("Failed to get key from backup: ".concat(e)),this.code=e,this.name="KeyDownloadError"}};o(Ss,"KeyDownloadError");let ne=Ss;const Rs=class Rs extends Error{constructor(e){super("Failed to get key from backup: rate limited"),this.retryMillis=e,this.name="KeyDownloadRateLimitError"}};o(Rs,"KeyDownloadRateLimitError");let hr=Rs;const Ks=class Ks{constructor(e,t,r,s){this.olmMachine=t,this.http=r,this.backupManager=s,S(this,"stopped",!1),S(this,"configuration",null),S(this,"sessionLastCheckAttemptedTime",new Map),S(this,"logger",void 0),S(this,"downloadLoopRunning",!1),S(this,"queuedRequests",[]),S(this,"hasConfigurationProblem",!1),S(this,"currentBackupVersionCheck",null),S(this,"onBackupStatusChanged",()=>{this.hasConfigurationProblem=!1,this.configuration=null,this.getOrCreateBackupConfiguration().then(_=>{_&&this.downloadKeysLoop()})}),this.logger=e.getChild("[PerSessionKeyBackupDownloader]"),s.on(C.KeyBackupStatus,this.onBackupStatusChanged),s.on(C.KeyBackupFailed,this.onBackupStatusChanged),s.on(C.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isKeyBackupDownloadConfigured(){return this.configuration!==null}getServerBackupInfo(){var e=this;return u(function*(){return yield e.backupManager.getServerBackupInfo()})()}onDecryptionKeyMissingError(e,t){if(this.isAlreadyInQueue(e,t)){this.logger.trace("Not checking key backup for session ".concat(t," as it is already queued"));return}if(this.wasRequestedRecently(t)){this.logger.trace("Not checking key backup for session ".concat(t," as it was already requested recently"));return}this.queuedRequests.push({roomId:e,megolmSessionId:t}),this.downloadKeysLoop()}stop(){this.stopped=!0,this.backupManager.off(C.KeyBackupStatus,this.onBackupStatusChanged),this.backupManager.off(C.KeyBackupFailed,this.onBackupStatusChanged),this.backupManager.off(C.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isAlreadyInQueue(e,t){return this.queuedRequests.some(r=>r.roomId==e&&r.megolmSessionId==t)}markAsNotFoundInBackup(e){var t=Date.now();this.sessionLastCheckAttemptedTime.set(e,t),this.sessionLastCheckAttemptedTime.size>100&&(this.sessionLastCheckAttemptedTime=new Map(Array.from(this.sessionLastCheckAttemptedTime).filter((r,s)=>Math.max(t-s,0)<It)))}wasRequestedRecently(e){var t=this.sessionLastCheckAttemptedTime.get(e);return t?Math.max(Date.now()-t,0)<It:!1}getBackupDecryptionKey(){var e=this;return u(function*(){try{return yield e.olmMachine.getBackupKeys()}catch{return null}})()}requestRoomKeyFromBackup(e,t,r){var s=this;return u(function*(){var _=Un("/room_keys/keys/$roomId/$sessionId",{$roomId:t,$sessionId:r});return yield s.http.authedRequest(O.Get,_,{version:e},void 0,{prefix:je.V3})})()}downloadKeysLoop(){var e=this;return u(function*(){if(!e.downloadLoopRunning&&!e.hasConfigurationProblem){e.downloadLoopRunning=!0;try{for(;e.queuedRequests.length>0;){var t=e.queuedRequests[0];try{var r=yield e.getOrCreateBackupConfiguration();if(!r){e.downloadLoopRunning=!1;return}var s=yield e.queryKeyBackup(t.roomId,t.megolmSessionId,r);if(e.stopped)return;try{yield e.decryptAndImport(t,s,r)}catch(_){e.logger.error("Error while decrypting and importing key backup for session ".concat(t.megolmSessionId),_)}e.queuedRequests.shift()}catch(_){if(_ instanceof ne)switch(_.code){case te.MISSING_DECRYPTION_KEY:e.markAsNotFoundInBackup(t.megolmSessionId),e.queuedRequests.shift();break;case te.NETWORK_ERROR:yield se(It);break;case te.STOPPED:e.downloadLoopRunning=!1;return}else _ instanceof hr&&(yield se(_.retryMillis))}}}finally{e.downloadLoopRunning=!1}}})()}queryKeyBackup(e,t,r){var s=this;return u(function*(){if(s.logger.debug("Checking key backup for session ".concat(t)),s.stopped)throw new ne(te.STOPPED);try{var _=yield s.requestRoomKeyFromBackup(r.backupVersion,e,t);return s.logger.debug("Got key from backup for sessionId:".concat(t)),_}catch(l){if(s.stopped)throw new ne(te.STOPPED);if(s.logger.info("No luck requesting key backup for session ".concat(t,": ").concat(l)),l instanceof o_){var a=l.data.errcode;if(a=="M_NOT_FOUND")throw new ne(te.MISSING_DECRYPTION_KEY);if(l.isRateLimitError()){var c;try{var g;c=(g=l.getRetryAfterMs())!==null&&g!==void 0?g:void 0}catch(b){s.logger.warn("Error while retrieving a rate-limit retry delay",b)}throw c&&c>0&&s.logger.info("Rate limited by server, waiting ".concat(c,"ms")),new hr(c??It)}}throw new ne(te.NETWORK_ERROR)}})()}decryptAndImport(e,t,r){var s=this;return u(function*(){var _={[e.megolmSessionId]:t},a=yield r.decryptor.decryptSessions(_);for(var c of a)c.room_id=e.roomId;yield s.backupManager.importBackedUpRoomKeys(a,r.backupVersion)})()}getOrCreateBackupConfiguration(){var e=this;return u(function*(){if(e.configuration)return e.configuration;if(e.hasConfigurationProblem)return null;if(e.currentBackupVersionCheck!=null)return e.logger.debug("Already checking server version, use current promise"),yield e.currentBackupVersionCheck;e.currentBackupVersionCheck=e.internalCheckFromServer();try{return yield e.currentBackupVersionCheck}finally{e.currentBackupVersionCheck=null}})()}internalCheckFromServer(){var e=this;return u(function*(){var t,r,s,_=null;try{_=yield e.backupManager.getServerBackupInfo()}catch(h){return e.logger.debug("Backup: error while checking server version: ".concat(h)),e.hasConfigurationProblem=!0,null}if(e.logger.debug("Got current backup version from server: ".concat((t=_)===null||t===void 0?void 0:t.version)),((r=_)===null||r===void 0?void 0:r.algorithm)!="m.megolm_backup.v1.curve25519-aes-sha2"){var a;return e.logger.info("Unsupported algorithm ".concat((a=_)===null||a===void 0?void 0:a.algorithm)),e.hasConfigurationProblem=!0,null}if(!((s=_)!==null&&s!==void 0&&s.version))return e.logger.info("No current key backup"),e.hasConfigurationProblem=!0,null;var c=yield e.backupManager.getActiveBackupVersion();if(c==null||_.version!=c)return e.logger.info("The current backup version on the server (".concat(_.version,") is not trusted. Version we are currently backing up to: ").concat(c)),e.hasConfigurationProblem=!0,null;var g=yield e.getBackupDecryptionKey();if(!(g!=null&&g.decryptionKey))return e.logger.debug("Not checking key backup for session (no decryption key)"),e.hasConfigurationProblem=!0,null;if(c!=g.backupVersion)return e.logger.debug("Version for which we have a decryption key (".concat(g.backupVersion,") doesn't match the version we are backing up to (").concat(c,")")),e.hasConfigurationProblem=!0,null;var l=_.auth_data;if(l.public_key!=g.decryptionKey.megolmV1PublicKey.publicKeyBase64)return e.logger.debug("Key backup on server does not match our decryption key"),e.hasConfigurationProblem=!0,null;var b=e.backupManager.createBackupDecryptor(g.decryptionKey);return e.hasConfigurationProblem=!1,e.configuration={decryptor:b,backupVersion:c},e.configuration})()}};o(Ks,"PerSessionKeyBackupDownloader");let ji=Ks;function zd(i,e){if(!i.private_key_salt||!i.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return a_(e,i.private_key_salt,i.private_key_iterations,i.private_key_bits)}o(zd,"keyFromAuthData");function Zo(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}o(Zo,"ownKeys$1");function Xo(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zo(Object(t),!0).forEach(function(r){S(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Zo(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}o(Xo,"_objectSpread$1");var e_=[A.Sas,A.ScanQrCode,A.ShowQrCode,A.Reciprocate];const Is=class Is extends yt{constructor(e,t,r,s,_,a,c){super(),this.logger=e,this.olmMachine=t,this.http=r,this.userId=s,this.secretStorage=a,this.cryptoCallbacks=c,S(this,"RECOVERY_KEY_DERIVATION_ITERATIONS",5e5),S(this,"_trustCrossSignedDevices",!0),S(this,"deviceIsolationMode",new O_(!1)),S(this,"stopped",!1),S(this,"roomEncryptors",{}),S(this,"eventDecryptor",void 0),S(this,"keyClaimManager",void 0),S(this,"outgoingRequestProcessor",void 0),S(this,"crossSigningIdentity",void 0),S(this,"backupManager",void 0),S(this,"outgoingRequestsManager",void 0),S(this,"perSessionBackupDownloader",void 0),S(this,"dehydratedDeviceManager",void 0),S(this,"reemitter",new i_(this)),S(this,"globalBlacklistUnverifiedDevices",!1),S(this,"_supportedVerificationMethods",e_),this.outgoingRequestProcessor=new Ei(e,t,r),this.outgoingRequestsManager=new Ti(this.logger,t,this.outgoingRequestProcessor),this.keyClaimManager=new Oi(t,this.outgoingRequestProcessor),this.backupManager=new Fi(e,t,r,this.outgoingRequestProcessor),this.perSessionBackupDownloader=new ji(this.logger,this.olmMachine,this.http,this.backupManager),this.dehydratedDeviceManager=new Ci(this.logger,t,r,this.outgoingRequestProcessor,a),this.eventDecryptor=new xi(this.logger,t,this.perSessionBackupDownloader),this.reemitter.reEmit(this.backupManager,[C.KeyBackupStatus,C.KeyBackupSessionsRemaining,C.KeyBackupFailed,C.KeyBackupDecryptionKeyCached]),this.reemitter.reEmit(this.dehydratedDeviceManager,[C.DehydratedDeviceCreated,C.DehydratedDeviceUploaded,C.RehydrationStarted,C.RehydrationProgress,C.RehydrationCompleted,C.RehydrationError,C.DehydrationKeyCached,C.DehydratedDeviceRotationError]),this.crossSigningIdentity=new Mi(e,t,this.outgoingRequestProcessor,a),this.checkKeyBackupAndEnable()}getOlmMachineOrThrow(){if(this.stopped)throw new M_;return this.olmMachine}set globalErrorOnUnknownDevices(e){}get globalErrorOnUnknownDevices(){return!1}stop(){this.stopped||(this.stopped=!0,this.keyClaimManager.stop(),this.backupManager.stop(),this.outgoingRequestsManager.stop(),this.perSessionBackupDownloader.stop(),this.dehydratedDeviceManager.stop(),this.olmMachine.close())}encryptEvent(e,t){var r=this;return u(function*(){var s=e.getRoomId(),_=r.roomEncryptors[s];if(!_)throw new Error("Cannot encrypt event in unconfigured room ".concat(s));yield _.encryptEvent(e,r.globalBlacklistUnverifiedDevices,r.deviceIsolationMode)})()}decryptEvent(e){var t=this;return u(function*(){var r=e.getRoomId();if(!r)throw new Error("to-device event was not decrypted in preprocessToDeviceMessages");return yield t.eventDecryptor.attemptEventDecryption(e,t.deviceIsolationMode)})()}getBackupDecryptor(e,t){var r=this;return u(function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor: expects Uint8Array");if(e.algorithm!="m.megolm_backup.v1.curve25519-aes-sha2")throw new Error("getBackupDecryptor: Unsupported algorithm ".concat(e.algorithm));var s=V.fromBase64(pi(t));if(!di(s,e))throw new Error("getBackupDecryptor: key backup on server does not match the decryption key");return r.backupManager.createBackupDecryptor(s)})()}importBackedUpRoomKeys(e,t,r){var s=this;return u(function*(){return yield s.backupManager.importBackedUpRoomKeys(e,t,r)})()}maybeAcceptKeyBundle(e,t){var r=this;return u(function*(){var s=new Et(r.logger,"maybeAcceptKeyBundle(".concat(e,", ").concat(t,")")),_=yield r.olmMachine.getReceivedRoomKeyBundleData(new K(e),new v(t));if(!_){s.info("No key bundle found for user");return}s.info("Fetching key bundle ".concat(_.url));var a=B_(r.http.opts.baseUrl,_.url,void 0,void 0,void 0,!1,!0,!0),c;try{var g=new URL(a);c=yield r.http.authedRequest(O.Get,g.pathname+g.search,{},void 0,{rawResponseBody:!0,prefix:""})}catch(l){throw s.warn("Error downloading encrypted bundle from ".concat(a,":"),l),l}s.info("Received blob of length ".concat(c.size));try{yield r.olmMachine.receiveRoomKeyBundle(_,new Uint8Array(yield c.arrayBuffer()))}catch(l){throw s.warn("Error receiving encrypted bundle:",l),l}})()}getVersion(){var e=u_();return"Rust SDK ".concat(e.matrix_sdk_crypto," (").concat(e.git_sha,"), Vodozemac ").concat(e.vodozemac)}setDeviceIsolationMode(e){this.deviceIsolationMode=e}isEncryptionEnabledInRoom(e){var t=this;return u(function*(){var r=yield t.olmMachine.getRoomSettings(new K(e));return!!(r!=null&&r.algorithm)})()}getOwnDeviceKeys(){var e=this;return u(function*(){var t=e.olmMachine.identityKeys;return{ed25519:t.ed25519.toBase64(),curve25519:t.curve25519.toBase64()}})()}prepareToEncrypt(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareForEncryption(this.globalBlacklistUnverifiedDevices,this.deviceIsolationMode)}forceDiscardSession(e){var t;return(t=this.roomEncryptors[e])===null||t===void 0?void 0:t.forceDiscardSession()}exportRoomKeys(){var e=this;return u(function*(){var t=yield e.olmMachine.exportRoomKeys(()=>!0);return JSON.parse(t)})()}exportRoomKeysAsJson(){var e=this;return u(function*(){return yield e.olmMachine.exportRoomKeys(()=>!0)})()}importRoomKeys(e,t){var r=this;return u(function*(){return yield r.backupManager.importRoomKeys(e,t)})()}importRoomKeysAsJson(e,t){var r=this;return u(function*(){return yield r.backupManager.importRoomKeysAsJson(e,t)})()}userHasCrossSigningKeys(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:t.userId,s=e.length>1&&e[1]!==void 0?e[1]:!1,_=yield t.olmMachine.trackedUsers(),a;for(var c of _)if(r===c.toString()){a=c;break}if(a!==void 0){if(r===t.userId){var g=t.olmMachine.queryKeysForUsers([a.clone()]);yield t.outgoingRequestProcessor.makeOutgoingRequest(g)}var l=yield t.olmMachine.getIdentity(a);return l==null||l.free(),l!==void 0}else if(s){var b,h=yield t.downloadDeviceList(new Set([r])),k=(b=h.master_keys)===null||b===void 0?void 0:b[r];return k?!!Object.values(k.keys)[0]:!1}else return!1})()}getUserDeviceInfo(e){var t=arguments,r=this;return u(function*(){var s=t.length>1&&t[1]!==void 0?t[1]:!1,_=new Map,a=yield r.getOlmMachineOrThrow().trackedUsers(),c=new Set;a.forEach(h=>c.add(h.toString()));var g=new Set;for(var l of e)c.has(l)?_.set(l,yield r.getUserDevices(l)):g.add(l);if(s&&g.size>=1){var b=yield r.downloadDeviceList(g);Object.entries(b.device_keys).forEach(h=>{var[k,I]=h;return _.set(k,Dd(I))})}return _})()}getUserDevices(e){var t=this;return u(function*(){var r=new v(e),s=yield t.olmMachine.getUserDevices(r,1);try{var _=s.devices();try{return new Map(_.map(a=>[a.deviceId.toString(),Bd(a,r)]))}finally{_.forEach(a=>a.free())}}finally{s.free()}})()}downloadDeviceList(e){var t=this;return u(function*(){var r={device_keys:{}};return e.forEach(s=>r.device_keys[s]=[]),yield t.http.authedRequest(O.Post,"/_matrix/client/v3/keys/query",void 0,r,{prefix:""})})()}getTrustCrossSignedDevices(){return this._trustCrossSignedDevices}setTrustCrossSignedDevices(e){this._trustCrossSignedDevices=e}setDeviceVerified(e,t){var r=arguments,s=this;return u(function*(){var _=r.length>2&&r[2]!==void 0?r[2]:!0,a=yield s.olmMachine.getDevice(new v(e),new E(t));if(!a)throw new Error("Unknown device ".concat(e,"|").concat(t));try{yield a.setLocalTrust(_?yi.Verified:yi.Unset)}finally{a.free()}})()}crossSignDevice(e){var t=this;return u(function*(){var r=yield t.olmMachine.getDevice(new v(t.userId),new E(e));if(!r)throw new Error("Unknown device ".concat(e));try{var s=yield r.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(s)}finally{r.free()}})()}getDeviceVerificationStatus(e,t){var r=this;return u(function*(){var s=yield r.olmMachine.getDevice(new v(e),new E(t));if(!s)return null;try{return new D_({signedByOwner:s.isCrossSignedByOwner(),crossSigningVerified:s.isCrossSigningTrusted(),localVerified:s.isLocallyTrusted(),trustCrossSignedDevices:r._trustCrossSignedDevices})}finally{s.free()}})()}getUserVerificationStatus(e){var t=this;return u(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new v(e));if(r===void 0)return new Bs(!1,!1,!1);var s=r.isVerified(),_=r.wasPreviouslyVerified(),a=r instanceof it?r.identityNeedsUserApproval():!1;return r.free(),new Bs(s,_,!1,a)})()}pinCurrentUserIdentity(e){var t=this;return u(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new v(e));if(r===void 0)throw new Error("Cannot pin identity of unknown user");if(r instanceof st)throw new Error("Cannot pin identity of own user");yield r.pinCurrentMasterKey()})()}withdrawVerificationRequirement(e){var t=this;return u(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new v(e));if(r===void 0)throw new Error("Cannot withdraw verification of unknown user");yield r.withdrawVerification()})()}isCrossSigningReady(){var e=this;return u(function*(){var{privateKeysInSecretStorage:t,privateKeysCachedLocally:r}=yield e.getCrossSigningStatus(),s=!!r.masterKey&&!!r.selfSigningKey&&!!r.userSigningKey,_=yield e.getOwnIdentity();return!!(_!=null&&_.isVerified())&&(s||t)})()}getCrossSigningKeyId(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:kt.Master,s=yield t.olmMachine.getIdentity(new v(t.userId));if(!s)return null;try{var _=yield t.olmMachine.crossSigningStatus(),a=_.hasMaster&&_.hasUserSigning&&_.hasSelfSigning;if(!a||!s.isVerified())return null;var c;switch(r){case kt.Master:c=s.masterKey;break;case kt.SelfSigning:c=s.selfSigningKey;break;case kt.UserSigning:c=s.userSigningKey;break;default:return null}var g=JSON.parse(c);return Object.values(g.keys)[0]}finally{s.free()}})()}bootstrapCrossSigning(e){var t=this;return u(function*(){yield t.crossSigningIdentity.bootstrapCrossSigning(e)})()}isSecretStorageReady(){var e=this;return u(function*(){var t=["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"],r=(yield e.backupManager.getActiveBackupVersion())!=null;return r&&t.push("m.megolm_backup.v1"),w_(e.secretStorage,t)})()}bootstrapSecretStorage(){var e=arguments,t=this;return u(function*(){var{createSecretStorageKey:r,setupNewSecretStorage:s,setupNewKeyBackup:_}=e.length>0&&e[0]!==void 0?e[0]:{},a=s||!(yield t.secretStorageHasAESKey());if(a){if(!r)throw new Error("unable to create a new secret storage key, createSecretStorageKey is not set");t.logger.info("bootstrapSecretStorage: creating new secret storage key");var c=yield r();if(!c)throw new Error("createSecretStorageKey() callback did not return a secret storage key");yield t.addSecretStorageKeyToSecretStorage(c)}var g=yield t.olmMachine.exportCrossSigningKeys(),l=g&&g.masterKey!==void 0&&g.self_signing_key!==void 0&&g.userSigningKey!==void 0;l&&(a||!(yield Yo(t.secretStorage)))&&(t.logger.info("bootstrapSecretStorage: cross-signing keys not yet exported; doing so now."),yield t.secretStorage.store("m.cross_signing.master",g.masterKey),yield t.secretStorage.store("m.cross_signing.user_signing",g.userSigningKey),yield t.secretStorage.store("m.cross_signing.self_signing",g.self_signing_key)),_?yield t.resetKeyBackup():yield t.saveBackupKeyToStorage()})()}saveBackupKeyToStorage(){var e=this;return u(function*(){var t=yield e.backupManager.getServerBackupInfo();if(!t||!t.version){e.logger.info("Not saving backup key to secret storage: no backup info");return}var r=yield e.olmMachine.getBackupKeys();if(!r.decryptionKey){e.logger.info("Not saving backup key to secret storage: no backup key");return}if(!di(r.decryptionKey,t)){e.logger.info("Not saving backup key to secret storage: decryption key does not match backup info");return}var s=r.decryptionKey.toBase64();yield e.secretStorage.store("m.megolm_backup.v1",s)})()}addSecretStorageKeyToSecretStorage(e){var t=this;return u(function*(){var r,s,_,a,c=yield t.secretStorage.addKey(Ds,{passphrase:(r=e.keyInfo)===null||r===void 0?void 0:r.passphrase,name:(s=e.keyInfo)===null||s===void 0?void 0:s.name,key:e.privateKey});yield t.secretStorage.setDefaultKeyId(c.keyId),(_=(a=t.cryptoCallbacks).cacheSecretStorageKey)===null||_===void 0||_.call(a,c.keyId,c.keyInfo,e.privateKey)})()}secretStorageHasAESKey(){var e=this;return u(function*(){var t=yield e.secretStorage.getKey();if(!t)return!1;var[,r]=t;return r.algorithm===Ds})()}getCrossSigningStatus(){var e=this;return u(function*(){var t=yield e.getOlmMachineOrThrow().getIdentity(new v(e.userId)),r=!!(t!=null&&t.masterKey)&&!!(t!=null&&t.selfSigningKey)&&!!(t!=null&&t.userSigningKey);t==null||t.free();var s=yield Yo(e.secretStorage),_=yield e.getOlmMachineOrThrow().crossSigningStatus();return{publicKeysOnDevice:r,privateKeysInSecretStorage:s,privateKeysCachedLocally:{masterKey:!!(_!=null&&_.hasMaster),userSigningKey:!!(_!=null&&_.hasUserSigning),selfSigningKey:!!(_!=null&&_.hasSelfSigning)}}})()}createRecoveryKeyFromPassphrase(e){var t=this;return u(function*(){if(e){var r=qs(32),s=yield a_(e,r,t.RECOVERY_KEY_DERIVATION_ITERATIONS);return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:t.RECOVERY_KEY_DERIVATION_ITERATIONS,salt:r}},privateKey:s,encodedPrivateKey:zs(s)}}else{var _=new Uint8Array(32);return globalThis.crypto.getRandomValues(_),{privateKey:_,encodedPrivateKey:zs(_)}}})()}getEncryptionInfoForEvent(e){var t=this;return u(function*(){return t.eventDecryptor.getEncryptionInfoForEvent(e)})()}getVerificationRequestsToDeviceInProgress(e){var t=this.olmMachine.getVerificationRequests(new v(e));return t.filter(r=>r.roomId===void 0).map(r=>this.makeVerificationRequest(r))}findVerificationRequestDMInProgress(e,t){if(!t)throw new Error("missing userId");var r=this.olmMachine.getVerificationRequests(new v(t)),s=r.find(_=>{var a;return((a=_.roomId)===null||a===void 0?void 0:a.toString())===e});if(s)return this.makeVerificationRequest(s)}requestVerificationDM(e,t){var r=this;return u(function*(){var s=yield r.olmMachine.getIdentity(new v(e));if(!s)throw new Error("unknown userId ".concat(e));try{var _=r._supportedVerificationMethods.map(l=>qt(l)),a=yield s.verificationRequestContent(_),c=yield r.sendVerificationRequestContent(t,a),g=yield s.requestVerification(new K(t),new Qe(c),_);return r.makeVerificationRequest(g)}finally{s.free()}})()}sendVerificationRequestContent(e,t){var r=this;return u(function*(){var s=qs(32),{event_id:_}=yield r.http.authedRequest(O.Put,"/_matrix/client/v3/rooms/".concat(encodeURIComponent(e),"/send/m.room.message/").concat(encodeURIComponent(s)),void 0,t,{prefix:""});return _})()}setSupportedVerificationMethods(e){this._supportedVerificationMethods=e??e_}requestOwnUserVerification(){var e=this;return u(function*(){var t=yield e.olmMachine.getIdentity(new v(e.userId));if(t===void 0)throw new Error("cannot request verification for this device when there is no existing cross-signing key");try{var[r,s]=yield t.requestVerification(e._supportedVerificationMethods.map(qt));return yield e.outgoingRequestProcessor.makeOutgoingRequest(s),e.makeVerificationRequest(r)}finally{t.free()}})()}requestDeviceVerification(e,t){var r=this;return u(function*(){var s=yield r.olmMachine.getDevice(new v(e),new E(t));if(!s)throw new Error("Not a known device");try{var[_,a]=s.requestVerification(r._supportedVerificationMethods.map(qt));return yield r.outgoingRequestProcessor.makeOutgoingRequest(a),r.makeVerificationRequest(_)}finally{s.free()}})()}getSessionBackupPrivateKey(){var e=this;return u(function*(){var t=yield e.olmMachine.getBackupKeys();return t.decryptionKey?li(t.decryptionKey.toBase64()):null})()}storeSessionBackupPrivateKey(e,t){var r=this;return u(function*(){var s=pi(e);if(!t)throw new Error("storeSessionBackupPrivateKey: version is required");yield r.backupManager.saveBackupDecryptionKey(V.fromBase64(s),t)})()}loadSessionBackupPrivateKeyFromSecretStorage(){var e=this;return u(function*(){var t=yield e.secretStorage.get("m.megolm_backup.v1");if(!t)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: missing decryption key in secret storage");var r=yield e.backupManager.getServerBackupInfo();if(!r||!r.version)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: unable to get backup version");var s=V.fromBase64(t);if(!di(s,r))throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: decryption key does not match backup info");yield e.backupManager.saveBackupDecryptionKey(s,r.version)})()}getActiveSessionBackupVersion(){var e=this;return u(function*(){return yield e.backupManager.getActiveBackupVersion()})()}getKeyBackupInfo(){var e=this;return u(function*(){return(yield e.backupManager.getServerBackupInfo())||null})()}isKeyBackupTrusted(e){var t=this;return u(function*(){return yield t.backupManager.isKeyBackupTrusted(e)})()}checkKeyBackupAndEnable(){var e=this;return u(function*(){return yield e.backupManager.checkKeyBackupAndEnable(!0)})()}deleteKeyBackupVersion(e){var t=this;return u(function*(){yield t.backupManager.deleteKeyBackupVersion(e)})()}resetKeyBackup(){var e=this;return u(function*(){var t=yield e.backupManager.setupKeyBackup(r=>e.signObject(r));(yield e.secretStorageHasAESKey())&&(yield e.secretStorage.store("m.megolm_backup.v1",t.decryptionKey.toBase64())),e.checkKeyBackupAndEnable()})()}disableKeyStorage(){var e=this;return u(function*(){var t=yield e.getKeyBackupInfo();t!=null&&t.version?yield e.deleteKeyBackupVersion(t.version):e.logger.error("Can't delete key backup version: no version available"),yield e.deleteSecretStorage(),yield e.dehydratedDeviceManager.delete()})()}signObject(e){var t=this;return u(function*(){var r=new Map(Object.entries(e.signatures||{})),s=e.unsigned;delete e.signatures,delete e.unsigned;var _=r.get(t.userId)||{},a=Cd.stringify(e),c=yield t.olmMachine.sign(a),g=JSON.parse(c.asJSON());r.set(t.userId,Xo(Xo({},_),g[t.userId])),s!==void 0&&(e.unsigned=s),e.signatures=Object.fromEntries(r.entries())})()}restoreKeyBackupWithPassphrase(e,t){var r=this;return u(function*(){var s=yield r.backupManager.getServerBackupInfo();if(!(s!=null&&s.version))throw new Error("No backup info available");var _=yield zd(s.auth_data,e);return yield r.storeSessionBackupPrivateKey(_,s.version),r.restoreKeyBackup(t)})()}restoreKeyBackup(e){var t=this;return u(function*(){var r=yield t.olmMachine.getBackupKeys(),{decryptionKey:s,backupVersion:_}=r;if(!s||!_)throw new Error("No decryption key found in crypto store");var a=li(s.toBase64()),c=yield t.backupManager.requestKeyBackupVersion(_);if(!c)throw new Error("Backup version to restore ".concat(_," not found on server"));var g=yield t.getBackupDecryptor(c,a);try{var l;return e==null||(l=e.progressCallback)===null||l===void 0||l.call(e,{stage:De.Fetch}),yield t.backupManager.restoreKeyBackup(_,g,e)}finally{g.free()}})()}isDehydrationSupported(){var e=this;return u(function*(){return yield e.dehydratedDeviceManager.isSupported()})()}startDehydration(){var e=arguments,t=this;return u(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};if(!(yield t.isCrossSigningReady())||!(yield t.isSecretStorageReady()))throw new Error("Device dehydration requires cross-signing and secret storage to be set up");return yield t.dehydratedDeviceManager.start(r||{})})()}importSecretsBundle(e){var t=this;return u(function*(){var r=Ee.from_json(e);yield t.getOlmMachineOrThrow().importSecretsBundle(r)})()}exportSecretsBundle(){var e=this;return u(function*(){var t=yield e.getOlmMachineOrThrow().exportSecretsBundle(),r=t.to_json();return t.free(),r})()}encryptToDeviceMessages(e,t,r){var s=this;return u(function*(){var _=new Et(s.logger,"encryptToDeviceMessages"),a=new Set(t.map(g=>{var{userId:l}=g;return l}));yield s.keyClaimManager.ensureSessionsForUsers(_,Array.from(a).map(g=>new v(g)));var c={batch:[],eventType:j.RoomMessageEncrypted};return yield Promise.all(t.map(function(){var g=u(function*(l){var{userId:b,deviceId:h}=l,k=yield s.olmMachine.getDevice(new v(b),new E(h));if(k){var I=JSON.parse(yield k.encryptToDeviceEvent(e,r));c.batch.push({deviceId:h,userId:b,payload:I})}else s.logger.warn("encryptToDeviceMessages: unknown device ".concat(b,":").concat(h))});return function(l){return g.apply(this,arguments)}}())),c})()}resetEncryption(e){var t=this;return u(function*(){t.logger.debug("resetEncryption: resetting encryption"),t.dehydratedDeviceManager.delete(),yield t.backupManager.deleteAllKeyBackupVersions(),yield t.deleteSecretStorage(),yield t.crossSigningIdentity.bootstrapCrossSigning({setupNewCrossSigning:!0,authUploadDeviceSigningKeys:e}),yield t.resetKeyBackup(),t.logger.debug("resetEncryption: ended")})()}deleteSecretStorage(){var e=this;return u(function*(){yield e.secretStorage.store("m.cross_signing.master",null),yield e.secretStorage.store("m.cross_signing.self_signing",null),yield e.secretStorage.store("m.cross_signing.user_signing",null),yield e.secretStorage.store("m.megolm_backup.v1",null);var t=yield e.secretStorage.getDefaultKeyId();t&&(yield e.secretStorage.store("m.secret_storage.key.".concat(t),null)),yield e.secretStorage.setDefaultKeyId(null)})()}shareRoomHistoryWithUser(e,t){var r=this;return u(function*(){var s=new Et(r.logger,"shareRoomHistoryWithUser(".concat(e,", ").concat(t,")")),_=yield r.getOwnIdentity();if(!(_!=null&&_.isVerified())){s.warn("Not sharing message history as the current device is not verified by our cross-signing identity");return}s.info("Sharing message history");var a=yield r.getOlmMachineOrThrow().buildRoomKeyBundle(new K(e));if(!a){s.info("No keys to share");return}var c=yield r.http.uploadContent(a.encryptedData);s.info("Uploaded encrypted key blob: ".concat(JSON.stringify(c)));var g=r.getOlmMachineOrThrow().queryKeysForUsers([new v(t)]);yield r.outgoingRequestProcessor.makeOutgoingRequest(g),yield r.keyClaimManager.ensureSessionsForUsers(s,[new v(t)]);var l=yield r.getOlmMachineOrThrow().shareRoomKeyBundleData(new v(t),new K(e),c.content_uri,a.mediaEncryptionInfo,W.identityBasedStrategy());for(var b of l)yield r.outgoingRequestProcessor.makeOutgoingRequest(b)})()}receiveSyncChanges(e){var t=this;return u(function*(){var{events:r,oneTimeKeysCounts:s=new Map,unusedFallbackKeys:_,devices:a=new me}=e;return yield t.olmMachine.receiveSyncChanges(r?JSON.stringify(r):"[]",a,s,_)})()}preprocessToDeviceMessages(e){var t=this;return u(function*(){var r=yield t.receiveSyncChanges({events:e}),s=[];for(var _ of r){var a=JSON.parse(_.rawEvent);if(a.type===j.KeyVerificationRequest){var c=a.sender,g=a.content.transaction_id;g&&c&&t.onIncomingKeyVerificationRequest(c,g)}switch(_.type){case ze.Decrypted:{var l,b=_.encryptionInfo;s.push({message:a,encryptionInfo:{sender:b.sender.toString(),senderDevice:(l=b.senderDevice)===null||l===void 0?void 0:l.toString(),senderCurve25519KeyBase64:b.senderCurve25519Key,senderVerified:b.isSenderVerified()}});break}case ze.PlainText:{s.push({message:a,encryptionInfo:null});break}case ze.UnableToDecrypt:break;case ze.Invalid:break}}return s})()}processKeyCounts(e,t){var r=this;return u(function*(){var s=e&&new Map(Object.entries(e)),_=t&&new Set(t);(s!==void 0||_!==void 0)&&(yield r.receiveSyncChanges({oneTimeKeysCounts:s,unusedFallbackKeys:_}))})()}processDeviceLists(e){var t=this;return u(function*(){var r,s,_=new me((r=e.changed)===null||r===void 0?void 0:r.map(a=>new v(a)),(s=e.left)===null||s===void 0?void 0:s.map(a=>new v(a)));yield t.receiveSyncChanges({devices:_})})()}onCryptoEvent(e,t){var r=this;return u(function*(){var s=t.getContent(),_=new ge;if(s.algorithm==="m.megolm.v1.aes-sha2")_.algorithm=fe.MegolmV1AesSha2;else{r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event with invalid algorithm ").concat(s.algorithm));return}try{_.sessionRotationPeriodMs=s.rotation_period_ms,_.sessionRotationPeriodMessages=s.rotation_period_msgs,yield r.olmMachine.setRoomSettings(new K(e.roomId),_)}catch(c){r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event which caused error: ").concat(c));return}var a=r.roomEncryptors[e.roomId];a?a.onCryptoEvent(s):r.roomEncryptors[e.roomId]=new Ii(r.logger.getChild("[".concat(e.roomId," encryption]")),r.olmMachine,r.keyClaimManager,r.outgoingRequestsManager,e,s)})()}onSyncCompleted(e){this.outgoingRequestsManager.doProcessOutgoingRequests().catch(t=>{this.logger.warn("onSyncCompleted: Error processing outgoing requests",t)})}markAllTrackedUsersAsDirty(){var e=this;return u(function*(){yield e.olmMachine.markAllTrackedUsersAsDirty()})()}onIncomingKeyVerificationRequest(e,t){var r=this.olmMachine.getVerificationRequest(new v(e),t);r?this.emit(C.VerificationRequestReceived,this.makeVerificationRequest(r)):this.logger.info("Ignoring just-received verification request ".concat(t," which did not start a rust-side verification"))}makeVerificationRequest(e){return new qi(this.logger,this.olmMachine,e,this.outgoingRequestProcessor,this._supportedVerificationMethods)}onRoomMembership(e,t,r){var s=this.roomEncryptors[e.getRoomId()];s&&s.onRoomMembership(t)}onRoomKeysUpdated(e){var t=this;return u(function*(){for(var r of e)t.onRoomKeyUpdated(r);t.backupManager.maybeUploadKey()})()}onRoomKeyUpdated(e){var t=this;if(!this.stopped){this.logger.debug("Got update for session ".concat(e.sessionId," from sender ").concat(e.senderKey.toBase64()," in ").concat(e.roomId.toString()));var r=this.eventDecryptor.getEventsPendingRoomKey(e.roomId.toString(),e.sessionId);if(r.length!==0){this.logger.debug("Retrying decryption on events:",r.map(a=>"".concat(a.getId())));var s=o(function(c){c.attemptDecryption(t,{isRetry:!0}).catch(g=>{t.logger.info("Still unable to decrypt event ".concat(c.getId()," after receiving key"))})},"_loop");for(var _ of r)s(_)}}}onRoomKeysWithheld(e){var t=this;return u(function*(){for(var r of e){t.logger.debug("Got withheld message for session ".concat(r.sessionId," in ").concat(r.roomId.toString()));var s=t.eventDecryptor.getEventsPendingRoomKey(r.roomId.toString(),r.sessionId);if(s.length===0)return;t.logger.debug("Retrying decryption on events:",s.map(a=>"".concat(a.getId())));for(var _ of s)_.attemptDecryption(t,{isRetry:!0}).catch(a=>{})}})()}onUserIdentityUpdated(e){var t=this;return u(function*(){var r=yield t.getUserVerificationStatus(e.toString());t.emit(C.UserTrustStatusChanged,e.toString(),r),e.toString()===t.userId&&(t.emit(C.KeysChanged,{}),yield t.checkKeyBackupAndEnable())})()}onDevicesUpdated(e){var t=this;return u(function*(){t.emit(C.WillUpdateDevices,e,!1),t.emit(C.DevicesUpdated,e,!1)})()}handleSecretReceived(e,t){var r=this;return u(function*(){return r.logger.debug("onReceiveSecret: Received secret ".concat(e)),e==="m.megolm_backup.v1"?yield r.backupManager.handleBackupSecretReceived(t):!1})()}checkSecrets(e){var t=this;return u(function*(){var r=yield t.olmMachine.getSecretsFromInbox(e);for(var s of r)if(yield t.handleSecretReceived(e,s))break;yield t.olmMachine.deleteSecretsFromInbox(e)})()}onLiveEventFromSync(e){var t=this;return u(function*(){if(!(e.isState()||e.getUnsigned().transaction_id)){var r=function(){var c=u(function*(g){Fd(e)&&(yield t.onKeyVerificationEvent(g))});return o(function(l){return c.apply(this,arguments)},"processEvent")}();if(e.isDecryptionFailure()||e.isEncrypted()){var s=3e5,_=setTimeout(()=>e.off(jn.Decrypted,a),s),a=o((c,g)=>{g||(clearTimeout(_),e.off(jn.Decrypted,a),r(c))},"onDecrypted");e.on(jn.Decrypted,a)}else yield r(e)}})()}onKeyVerificationEvent(e){var t=this;return u(function*(){var r=e.getRoomId();if(!r)throw new Error("missing roomId in the event");t.logger.debug("Incoming verification event ".concat(e.getId()," type ").concat(e.getType()," from ").concat(e.getSender())),yield t.olmMachine.receiveVerificationEvent(JSON.stringify({event_id:e.getId(),type:e.getType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getContent(),origin_server_ts:e.getTs()}),new K(r)),e.getType()===j.RoomMessage&&e.getContent().msgtype===s_.KeyVerificationRequest&&t.onIncomingKeyVerificationRequest(e.getSender(),e.getId()),t.outgoingRequestsManager.doProcessOutgoingRequests().catch(s=>{t.logger.warn("onKeyVerificationRequest: Error processing outgoing requests",s)})})()}getOwnIdentity(){var e=this;return u(function*(){return yield e.olmMachine.getIdentity(new v(e.userId))})()}};o(Is,"RustCrypto");let Vi=Is;const Cs=class Cs{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.perSessionBackupDownloader=r,S(this,"eventsPendingKey",new Fs(()=>new Fs(()=>new Set)))}attemptEventDecryption(e,t){var r=this;return u(function*(){r.addEventToPendingList(e);var s;switch(t.kind){case zt.AllDevicesIsolationMode:s=hi.Untrusted;break;case zt.OnlySignedDevicesIsolationMode:s=hi.CrossSignedOrLegacy;break}try{var _=yield r.olmMachine.decryptRoomEvent(t_(e),new K(e.getRoomId()),new oe(s));return r.removeEventFromPendingList(e),{clearEvent:JSON.parse(_.event),claimedEd25519Key:_.senderClaimedEd25519Key,senderCurve25519Key:_.senderCurve25519Key,forwardingCurve25519KeyChain:_.forwardingCurve25519KeyChain}}catch(a){if(a instanceof rt)r.onMegolmDecryptionError(e,a,yield r.perSessionBackupDownloader.getServerBackupInfo());else throw new T(U.UNKNOWN_ERROR,"Unknown error")}})()}onMegolmDecryptionError(e,t,r){var s=e.getWireContent(),_={sender_key:s.sender_key,session_id:s.session_id};if(t.code===Z.MissingRoomKey||t.code===Z.UnknownMessageIndex){this.perSessionBackupDownloader.onDecryptionKeyMissingError(e.getRoomId(),s.session_id);var a=e.getMembershipAtEvent();if(a&&a!==Ft.Join&&a!==Ft.Invite)throw new T(U.HISTORICAL_MESSAGE_USER_NOT_JOINED,"This message was sent when we were not a member of the room.",_);if(e.getTs()<=this.olmMachine.deviceCreationTimeMs)throw r===null?new T(U.HISTORICAL_MESSAGE_NO_KEY_BACKUP,"This message was sent before this device logged in, and there is no key backup on the server.",_):this.perSessionBackupDownloader.isKeyBackupDownloadConfigured()?new T(U.HISTORICAL_MESSAGE_WORKING_BACKUP,"This message was sent before this device logged in. Key backup is working, but we still do not (yet) have the key.",_):new T(U.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED,"This message was sent before this device logged in, and key backup is not working.",_)}if(t.maybe_withheld){var c=t.maybe_withheld==="The sender has disabled encrypting to unverified devices."?U.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:U.MEGOLM_KEY_WITHHELD;throw new T(c,t.maybe_withheld,_)}switch(t.code){case Z.MissingRoomKey:throw new T(U.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",_);case Z.UnknownMessageIndex:throw new T(U.OLM_UNKNOWN_MESSAGE_INDEX,"The sender's device has not sent us the keys for this message at this index.",_);case Z.SenderIdentityVerificationViolation:throw this.removeEventFromPendingList(e),new T(U.SENDER_IDENTITY_PREVIOUSLY_VERIFIED,"The sender identity is unverified, but was previously verified.");case Z.UnknownSenderDevice:throw this.removeEventFromPendingList(e),new T(U.UNKNOWN_SENDER_DEVICE,"The sender device is not known.");case Z.UnsignedSenderDevice:throw this.removeEventFromPendingList(e),new T(U.UNSIGNED_SENDER_DEVICE,"The sender identity is not cross-signed.");default:throw new T(U.UNKNOWN_ERROR,t.description,_)}}getEncryptionInfoForEvent(e){var t=this;return u(function*(){if(!e.getClearContent()||e.isDecryptionFailure())return null;if(e.status!==null)return{shieldColour:Mt.NONE,shieldReason:null};var r=yield t.olmMachine.getRoomEventEncryptionInfo(t_(e),new K(e.getRoomId()));return Ud(t.logger,r)})()}getEventsPendingRoomKey(e,t){var r=this.eventsPendingKey.get(e);if(!r)return[];var s=r.get(t);return s?[...s]:[]}addEventToPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t),s=r.getOrCreate(e.getWireContent().session_id);s.add(e)}}removeEventFromPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t);if(r){var s=r.get(e.getWireContent().session_id);s&&(s.delete(e),s.size===0&&(r.delete(e.getWireContent().session_id),r.size===0&&this.eventsPendingKey.delete(t)))}}}};o(Cs,"EventDecryptor");let xi=Cs;function t_(i){return JSON.stringify({event_id:i.getId(),type:i.getWireType(),sender:i.getSender(),state_key:i.getStateKey(),content:i.getWireContent(),origin_server_ts:i.getTs()})}o(t_,"stringifyEvent");function Ud(i,e){if(e===void 0)return null;var t=e.shieldState(!1),r;switch(t.color){case fi.Grey:r=Mt.GREY;break;case fi.None:r=Mt.NONE;break;default:r=Mt.RED}var s;switch(t.code){case void 0:case null:s=null;break;case X.AuthenticityNotGuaranteed:s=Q.AUTHENTICITY_NOT_GUARANTEED;break;case X.UnknownDevice:s=Q.UNKNOWN_DEVICE;break;case X.UnsignedDevice:s=Q.UNSIGNED_DEVICE;break;case X.UnverifiedIdentity:s=Q.UNVERIFIED_IDENTITY;break;case X.SentInClear:s=Q.SENT_IN_CLEAR;break;case X.VerificationViolation:s=Q.VERIFICATION_VIOLATION;break;case X.MismatchedSender:s=Q.MISMATCHED_SENDER;break;default:s=Q.UNKNOWN;break}return{shieldColour:r,shieldReason:s}}o(Ud,"rustEncryptionInfoToJsEncryptionInfo");function Td(i){return Ai.apply(this,arguments)}o(Td,"migrateFromLegacyCrypto");function Ai(){return Ai=u(function*(i){var e,{logger:t,legacyStore:r}=i;if(yield l_(),!(yield r.containsData()))return;yield r.startup();var s=null;if(yield r.doTxn("readonly",[ft.STORE_ACCOUNT],k=>{r.getAccount(k,I=>{s=I})}),!s){t.debug("Legacy crypto store is not set up (no account found). Not migrating.");return}var _=yield r.getMigrationState();if(_>=x.MEGOLM_SESSIONS_MIGRATED)return;var a=yield Vd(t,r),c=yield xd(t,r),g=1+a+c;t.info("Migrating data from legacy crypto store. ".concat(a," olm sessions and ").concat(c," megolm sessions to migrate."));var l=0;function b(k){var I;l+=k,(I=i.legacyMigrationProgressListener)===null||I===void 0||I.call(i,l,g)}o(b,"onProgress"),b(0);var h=new TextEncoder().encode(i.legacyPickleKey);_===x.NOT_STARTED&&(t.info("Migrating data from legacy crypto store. Step 1: base data"),yield jd(i.http,i.userId,i.deviceId,r,h,i.storeHandle,t),_=x.INITIAL_DATA_MIGRATED,yield r.setMigrationState(_)),b(1),_===x.INITIAL_DATA_MIGRATED&&(t.info("Migrating data from legacy crypto store. Step 2: olm sessions (".concat(a," sessions to migrate).")),yield Ad(t,r,h,i.storeHandle,b),_=x.OLM_SESSIONS_MIGRATED,yield r.setMigrationState(_)),_===x.OLM_SESSIONS_MIGRATED&&(t.info("Migrating data from legacy crypto store. Step 3: megolm sessions (".concat(c," sessions to migrate).")),yield Pd(t,r,h,i.storeHandle,b),_=x.MEGOLM_SESSIONS_MIGRATED,yield r.setMigrationState(_)),(e=i.legacyMigrationProgressListener)===null||e===void 0||e.call(i,-1,-1),t.info("Migration from legacy crypto store complete")}),Ai.apply(this,arguments)}o(Ai,"_migrateFromLegacyCrypto");function jd(i,e,t,r,s,_,a){return Pi.apply(this,arguments)}o(jd,"migrateBaseData");function Pi(){return Pi=u(function*(i,e,t,r,s,_,a){var c=new Ge;c.userId=new v(e),c.deviceId=new E(t),yield r.doTxn("readonly",[ft.STORE_ACCOUNT],Y=>r.getAccount(Y,Be=>{c.pickledAccount=Be??""}));var g=yield Ct(r,s,"m.megolm_backup.v1");if(g){for(var l=!1,b=null;!l;)try{b=yield y_(i),l=!0}catch(Y){a.info("Failed to get backup version during migration, retrying in 2 seconds",Y),yield se(2e3)}if(b&&b.algorithm=="m.megolm_backup.v1.curve25519-aes-sha2")try{var h,k=V.fromBase64(g),I=(h=b.auth_data)===null||h===void 0?void 0:h.public_key,F=k.megolmV1PublicKey.publicKeyBase64==I;F?(c.backupVersion=b.version,c.backupRecoveryKey=g):a.debug("The backup key to migrate does not match the active backup version","Cached pub key: ".concat(k.megolmV1PublicKey.publicKeyBase64),"Active pub key: ".concat(I))}catch(Y){a.warn("Failed to check if the backup key to migrate matches the active backup version",Y)}}c.privateCrossSigningMasterKey=yield Ct(r,s,"master"),c.privateCrossSigningSelfSigningKey=yield Ct(r,s,"self_signing"),c.privateCrossSigningUserSigningKey=yield Ct(r,s,"user_signing"),yield Ke.migrateBaseData(c,s,_,a)}),Pi.apply(this,arguments)}o(Pi,"_migrateBaseData");function Vd(i,e){return Ni.apply(this,arguments)}o(Vd,"countOlmSessions");function Ni(){return Ni=u(function*(i,e){i.debug("Counting olm sessions to be migrated");var t;return yield e.doTxn("readonly",[ft.STORE_SESSIONS],r=>e.countEndToEndSessions(r,s=>t=s)),t}),Ni.apply(this,arguments)}o(Ni,"_countOlmSessions");function xd(i,e){return Li.apply(this,arguments)}o(xd,"countMegolmSessions");function Li(){return Li=u(function*(i,e){return i.debug("Counting megolm sessions to be migrated"),yield e.countEndToEndInboundGroupSessions()}),Li.apply(this,arguments)}o(Li,"_countMegolmSessions");function Ad(i,e,t,r,s){return Wi.apply(this,arguments)}o(Ad,"migrateOlmSessions");function Wi(){return Wi=u(function*(i,e,t,r,s){for(;;){var _=yield e.getEndToEndSessionsBatch();if(_===null)return;i.debug("Migrating batch of ".concat(_.length," olm sessions"));var a=[];for(var c of _){var g=new _t;g.senderKey=c.deviceKey,g.pickle=c.session,g.lastUseTime=g.creationTime=new Date(c.lastReceivedMessageTs),a.push(g)}yield Ke.migrateOlmSessions(a,t,r,i),yield e.deleteEndToEndSessionsBatch(_),s(_.length)}}),Wi.apply(this,arguments)}o(Wi,"_migrateOlmSessions");function Pd(i,e,t,r,s){return Gi.apply(this,arguments)}o(Pd,"migrateMegolmSessions");function Gi(){return Gi=u(function*(i,e,t,r,s){for(;;){var _=yield e.getEndToEndInboundGroupSessionsBatch();if(_===null)return;i.debug("Migrating batch of ".concat(_.length," megolm sessions"));var a=[];for(var c of _){var g,l=c.sessionData,b=new ot;b.pickle=l.session,b.roomId=new K(l.room_id),b.senderKey=c.senderKey,b.senderSigningKey=(g=l.keysClaimed)===null||g===void 0?void 0:g.ed25519,b.backedUp=!c.needsBackup,b.imported=l.untrusted===!0,a.push(b)}yield Ke.migrateMegolmSessions(a,t,r,i),yield e.deleteEndToEndInboundGroupSessionsBatch(_),s(_.length)}}),Gi.apply(this,arguments)}o(Gi,"_migrateMegolmSessions");function Nd(i){return Ji.apply(this,arguments)}o(Nd,"migrateRoomSettingsFromLegacyCrypto");function Ji(){return Ji=u(function*(i){var{logger:e,legacyStore:t,olmMachine:r}=i;if(yield t.containsData()){var s=yield t.getMigrationState();if(!(s>=x.ROOM_SETTINGS_MIGRATED)){var _={};yield t.doTxn("readwrite",[ft.STORE_ROOMS],l=>{t.getEndToEndRooms(l,b=>{_=b})}),e.debug("Migrating ".concat(Object.keys(_).length," sets of room settings"));for(var[a,c]of Object.entries(_))try{var g=new ge;if(c.algorithm!=="m.megolm.v1.aes-sha2"){e.warn("Room ".concat(a,": ignoring room with invalid algorithm ").concat(c.algorithm));continue}g.algorithm=fe.MegolmV1AesSha2,g.sessionRotationPeriodMs=c.rotation_period_ms,g.sessionRotationPeriodMessages=c.rotation_period_msgs,yield r.setRoomSettings(new K(a),g)}catch(l){e.warn("Room ".concat(a,": ignoring settings ").concat(JSON.stringify(c)," which caused error ").concat(l))}e.debug("Completed room settings migration"),yield t.setMigrationState(x.ROOM_SETTINGS_MIGRATED)}}}),Ji.apply(this,arguments)}o(Ji,"_migrateRoomSettingsFromLegacyCrypto");function Ct(i,e,t){return Hi.apply(this,arguments)}o(Ct,"getAndDecryptCachedSecretKey");function Hi(){return Hi=u(function*(i,e,t){var r=yield new Promise(s=>{i.doTxn("readonly",[ft.STORE_ACCOUNT],_=>{i.getSecretStorePrivateKey(_,s,t)})});return r&&r.ciphertext&&r.iv&&r.mac?yield q_(r,e,t):r instanceof Uint8Array?pi(r):void 0}),Hi.apply(this,arguments)}o(Hi,"_getAndDecryptCachedSecretKey");function Ld(i){return $i.apply(this,arguments)}o(Ld,"migrateLegacyLocalTrustIfNeeded");function $i(){return $i=u(function*(i){var{legacyCryptoStore:e,rustCrypto:t,logger:r}=i,s=yield t.getOwnIdentity();if(s&&!s.isVerified()){var _=yield Wd(e);if(_){var a=JSON.parse(s.masterKey);if(!a.keys||Object.keys(a.keys).length===0){r.error("Post Migration | Unexpected error: no master key in the rust session.");return}var c=Object.values(a.keys)[0];c&&c==_&&(r.info("Post Migration: Migrating legacy trusted MSK: ".concat(_," to locally verified.")),yield s.verify())}}}),$i.apply(this,arguments)}o($i,"_migrateLegacyLocalTrustIfNeeded");function Wd(i){return Yi.apply(this,arguments)}o(Wd,"getLegacyTrustedPublicMasterKeyBase64");function Yi(){return Yi=u(function*(i){var e=null;return yield i.doTxn("readonly","account",t=>{i.getCrossSigningKeys(t,r=>{var s=r==null?void 0:r.master;s&&Object.keys(s.keys).length!=0&&(e=Object.values(s.keys)[0])})}),e}),Yi.apply(this,arguments)}o(Yi,"_getLegacyTrustedPublicMasterKeyBase");function r_(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}o(r_,"ownKeys");function Gd(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?r_(Object(t),!0).forEach(function(r){S(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):r_(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}o(Gd,"_objectSpread");function Yd(i){return Qi.apply(this,arguments)}o(Yd,"initRustCrypto");function Qi(){return Qi=u(function*(i){var{logger:e}=i;e.debug("Initialising Rust crypto-sdk WASM artifact"),yield l_(),e.debug("Opening Rust CryptoStore");var t;i.storePrefix?i.storeKey?t=yield P.openWithKey(i.storePrefix,i.storeKey,e):t=yield P.open(i.storePrefix,i.storePassphrase,e):t=yield P.open(null,null,e),i.legacyCryptoStore&&(yield Td(Gd({legacyStore:i.legacyCryptoStore,storeHandle:t},i)));var r=yield Jd(e,i.http,i.userId,i.deviceId,i.secretStorage,i.cryptoCallbacks,t,i.legacyCryptoStore);return t.free(),e.debug("Completed rust crypto-sdk setup"),r}),Qi.apply(this,arguments)}o(Qi,"_initRustCrypto");function Jd(i,e,t,r,s,_,a,c){return Zi.apply(this,arguments)}o(Jd,"initOlmMachine");function Zi(){return Zi=u(function*(i,e,t,r,s,_,a,c){i.debug("Init OlmMachine");var g=yield nt.initFromStore(new v(t),new E(r),a,i);c&&(yield Nd({logger:i,legacyStore:c,olmMachine:g})),g.roomKeyRequestsEnabled=!1;var l=new Vi(i,g,e,t,r,s,_);if(yield g.registerRoomKeyUpdatedCallback(k=>l.onRoomKeysUpdated(k)),yield g.registerRoomKeysWithheldCallback(k=>l.onRoomKeysWithheld(k)),yield g.registerUserIdentityUpdatedCallback(k=>l.onUserIdentityUpdated(k)),yield g.registerDevicesUpdatedCallback(k=>l.onDevicesUpdated(k)),l.checkSecrets("m.megolm_backup.v1"),yield g.registerReceiveSecretCallback((k,I)=>l.checkSecrets(k)),yield g.outgoingRequests(),c&&(yield c.containsData())){var b=yield c.getMigrationState();if(b<x.INITIAL_OWN_KEY_QUERY_DONE){i.debug("Performing initial key query after migration");for(var h=!1;!h;)try{yield l.userHasCrossSigningKeys(t),h=!0}catch(k){i.error("Failed to check for cross-signing keys after migration, retrying",k)}yield Ld({legacyCryptoStore:c,rustCrypto:l,logger:i}),yield c.setMigrationState(x.INITIAL_OWN_KEY_QUERY_DONE)}}return l}),Zi.apply(this,arguments)}o(Zi,"_initOlmMachine");export{Yd as initRustCrypto};
//# sourceMappingURL=index-qfolVMN9.js.map
